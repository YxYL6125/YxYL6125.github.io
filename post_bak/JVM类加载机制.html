<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="å½“æˆ‘ä»¬ç”¨javaå‘½ä»¤è¿è¡ŒæŸä¸ªç±»çš„mainå‡½æ•°å¯åŠ¨ç¨‹åºçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡**ç±»åŠ è½½å™¨**å§ä¸»ç±»åŠ è½½åˆ°JVM">
<meta property="og:type" content="website">
<meta property="og:title" content="JVMç±»åŠ è½½æœºåˆ¶">
<meta property="og:url" content="https://www.yxyl6125.eu.org/post_bak/JVM%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6.html">
<meta property="og:site_name" content="YxYLğŸ¥">
<meta property="og:description" content="å½“æˆ‘ä»¬ç”¨javaå‘½ä»¤è¿è¡ŒæŸä¸ªç±»çš„mainå‡½æ•°å¯åŠ¨ç¨‹åºçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡**ç±»åŠ è½½å™¨**å§ä¸»ç±»åŠ è½½åˆ°JVM">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230100805505.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230143652368.png">
<meta property="og:image" content="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230194832606.png">
<meta property="article:published_time" content="2022-12-30T02:00:24.000Z">
<meta property="article:modified_time" content="2022-12-30T02:00:24.000Z">
<meta property="article:author" content="YxYL">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="ç±»åŠ è½½">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230100805505.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=180">
          
        
      
    
    <!-- title -->
    <title>JVMç±»åŠ è½½æœºåˆ¶</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->

    <script async defer
            data-website-id="e77e68be-f6e4-4br3-9365-2b76b57cd571"
            src="https://analytics.domain.com/umami.js">
    </script>


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    <div class="content index py4 ">
        
          <header id="header">
  <a class="u-url u-uid" href="/">
  
    
      <img id="logo" alt class="u-logo" src="/images/logo.png" />
    
  
    <div id="title">
      <h1 class="p-name">YxYLğŸ¥</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-2x"></i></a>
      </li>
      <!--
     --><li><a href="/">é¦–é¡µ</a></li><!--
   --><!--
     --><li><a href="/about/">å…³äº</a></li><!--
   --><!--
     --><li><a href="/archives/">å½’æ¡£</a></li><!--
   --><!--
     --><li><a href="/category/">åˆ†ç±»</a></li><!--
   --><!--
     --><li><a href="/tags/">tags</a></li><!--
   --><!--
     --><li><a target="_blank" rel="noopener" href="https://github.com/YxYL6125">é¡¹ç›®</a></li><!--
   -->
    </ul>
  </div>
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <h2 id="ç±»åŠ è½½è¿è¡Œå…¨è¿‡ç¨‹"><a class="header-anchor" href="#ç±»åŠ è½½è¿è¡Œå…¨è¿‡ç¨‹">Â¶</a>ç±»åŠ è½½è¿è¡Œå…¨è¿‡ç¨‹</h2>
<p>å½“æˆ‘ä»¬ç”¨javaå‘½ä»¤è¿è¡ŒæŸä¸ªç±»çš„mainå‡½æ•°å¯åŠ¨ç¨‹åºçš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡<strong>ç±»åŠ è½½å™¨</strong>å§ä¸»ç±»åŠ è½½åˆ°JVM</p>
<p>é€šè¿‡JavaæŒ‡ä»¤æ‰§è¡Œä»£ç çš„å¤§ä½“æµç¨‹å¦‚ä¸‹ï¼š</p>
<p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230100805505.png" alt="image-20221230100805505"></p>
<ul>
<li>å…¶ä¸­åœ¨C++å±‚é¢çš„ï¼š
<ul>
<li>é€šè¿‡java.exeè°ƒç”¨åº•å±‚çš„<code>jvm.dll</code>æ–‡ä»¶åˆ›å»ºJavaè™šæ‹Ÿæœº</li>
<li>åˆ›å»ºä¸€ä¸ª<strong>å¼•å¯¼ç±»åŠ è½½å™¨å®ä¾‹</strong>(C++)</li>
</ul>
</li>
<li>Javaå±‚é¢ï¼š
<ul>
<li>ç”±åŠ è½½å®Œæ‰€æœ‰éœ€è¦ä½¿ç”¨åˆ°çš„ç±»</li>
<li>æ‰§è¡Œ<code>main</code>æ–¹æ³•</li>
<li>javaç¨‹åºæ‰§è¡Œç»“æŸï¼ŒJVMé”€æ¯</li>
</ul>
</li>
</ul>
<p>å…¶ä¸­<code>loadClass</code>çš„ç±»åŠ è½½è¿‡ç¨‹æœ‰å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<blockquote>
<p>**åŠ è½½&gt;&gt;éªŒè¯&gt;&gt;å‡†å¤‡&gt;&gt;è§£æ&gt;&gt;åˆå§‹åŒ–&gt;&gt;**ä½¿ç”¨&gt;&gt;å¸è½½</p>
</blockquote>
<ul>
<li>åŠ è½½ï¼šåœ¨ç£ç›˜ä¸ŠæŸ¥æ‰¾å¹¶é€šè¿‡IOè¯»å…¥å­—èŠ‚ç æ–‡ä»¶</li>
<li>éªŒè¯ï¼šæ ¡éªŒå­—èŠ‚ç æ–‡ä»¶çš„æ­£ç¡®æ€§</li>
<li>å‡†å¤‡ï¼šç»™ç±»çš„é™æ€å˜é‡åˆ†é…å†…å­˜ï¼Œ<strong>å¹¶èµ‹äºˆé»˜è®¤å€¼</strong></li>
<li>è§£æï¼šå°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ï¼Œè¿™ä¸ªé˜¶æ®µä¼šæŠŠä¸€äº›é™æ€æ–¹æ³•æ›¿æ¢ä¸ºæ‰§è¡Œæ•°æ®æ‰€å­˜å†…å­˜çš„æŒ‡é’ˆæˆ–å¥æŸ„ç­‰ï¼Œè¿™æ˜¯æ‰€è°“çš„é™æ€é“¾æ¥è¿‡ç¨‹(ç±»åŠ è½½å™¨æœŸé—´å®Œæˆ)ï¼Œ<strong>åŠ¨æ€é“¾æ¥</strong>æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„å°†ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨</li>
<li>åˆå§‹åŒ–ï¼šå¯¹å’çš„é™æ€å˜é‡åˆå§‹åŒ–ä¸ºæŒ‡å®šçš„å€¼(å³åœ¨ä»£ç ä¸­çš„èµ‹å€¼æ“ä½œ)ï¼Œæ‰§è¡Œé™æ€ä»£ç å—(<code>static</code>)</li>
</ul>
<h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a class="header-anchor" href="#åŒäº²å§”æ´¾æœºåˆ¶">Â¶</a>åŒäº²å§”æ´¾æœºåˆ¶</h2>
<p>Jvmç±»åŠ è½½å™¨æ˜¯æœ‰äº²å­å±‚çº§å…³ç³»ç»“æ„çš„ï¼š<br>
<img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230143652368.png" alt="image-20221230143652368"></p>
<p>è¿™é‡Œç±»åŠ è½½å…¶å®å°±æœ‰ä¸€ä¸ª<strong>åŒäº²å§”æ´¾æœºåˆ¶</strong>ï¼ŒåŠ è½½æŸä¸ªç±»æ—¶ä¼šå…ˆå§”æ‰˜é™„åŠ è½½å™¨å¯»æ‰¾ç›®æ ‡ç±»ï¼Œæ‰¾ä¸åˆ°å†å§”æ‰˜ä¸Šå±‚çˆ¶åŠ è½½å™¨åŠ è½½ï¼Œå¦‚æœæ‰€æœ‰çˆ¶åŠ è½½å™¨åœ¨è‡ªå·±çš„åŠ è½½ç±»è·¯å¾„éƒ½æ‰¾ä¸åˆ°ç›®æ ‡ç±»ï¼Œåˆ™åœ¨è‡ªå·±çš„ç±»åŠ è½½è·¯å¾„ä¸­æŸ¥æ‰¾å¹¶è½½å…¥ç›®æ ‡ç±»</p>
<p>åŒäº²å§”æ´¾æœºåˆ¶ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p>
<blockquote>
<p>å…ˆæ‰¾çˆ¶ç±»åŠ è½½ï¼Œæ‰¾ä¸åˆ°å†ç”±å­ç±»è‡ªå·±åŠ è½½</p>
</blockquote>
<p><strong>AppClassLoader</strong>çš„<code>loadClass</code>æ–¹æ³•æœ€ç»ˆä¼šè°ƒç”¨å…¶çˆ¶ç±»<strong>ClassLoader</strong>çš„<code>loadClass</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å¤§ä½“é€»è¾‘ï¼š</p>
<ol>
<li>é¦–å…ˆï¼Œæ£€æŸ¥ä¸€ä¸‹æŒ‡å®šåç§°çš„ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡ï¼Œå¦‚æœåŠ è½½è¿‡äº†ï¼Œå°±ä¸éœ€è¦å†åŠ è½½ï¼Œç›´æ¥è¿”å›</li>
<li>å¦‚æœè¿™ä¸ªç±»æ²¡æœ‰è¢«åŠ è½½è¿‡ï¼Œé‚£ä¹ˆå†åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æœ‰çˆ¶åŠ è½½å™¨ï¼›å¦‚æœæœ‰çˆ¶åŠ è½½å™¨ï¼Œåˆ™ç”±é™„åŠ å™¨åŠ è½½(å³è°ƒç”¨<code>parent.loadClass(name,false);</code>)ã€‚æˆ–è€…æ˜¯è°ƒç”¨<code>Bootstrapç±»åŠ è½½å™¨</code>æ¥åŠ è½½</li>
<li>å¦‚æœçˆ¶åŠ è½½å™¨åŠBootstrapåŠ è½½å™¨éƒ½æ²¡æœ‰æ‰¾åˆ°æŒ‡å®šç±»ï¼Œé‚£ä¹ˆåˆ™è°ƒç”¨å½“å‰ç±»åŠ è½½å™¨äº†çš„<code>findClass</code>æ–¹æ³•æ¥å®Œæˆç±»åŠ è½½</li>
</ol>
<blockquote>
<p>æ•´ä½“æ¥è¯´å°±åƒæ˜¯ä¸ªé—­ç¯</p>
<p>ç¬¬ä¸€ä¸ªå»è¶Ÿæ˜¯å¿…ç»çš„ï¼Œ</p>
<p>åé¢å¦‚æœå‘ç°æŒ‡å®šç±»å·²ç»è¢«åŠ è½½è¿‡äº†ï¼Œå°±ç›´æ¥è¿”å›ï¼›</p>
<p>å¦‚æœæ²¡æœ‰ï¼Œæœ€å¤šä¸è¿‡å›æ¥çš„é‚£ä¸€è¶Ÿæœ€åè¿”å›ï¼›</p>
<p>ä¹‹åçš„åœ¨åé¢å»çš„é‚£ä¸€è¶Ÿå¿…è¿”å›æŒ‡å®šç±»ï¼Œå› ä¸ºè‚¯å®šè¢«åŠ è½½è¿‡äº†</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ClassLoaderçš„loadClassæ–¹æ³•ï¼Œé‡Œé¢å®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶</span></span><br><span class="line"><span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">	<span class="comment">// æ£€æŸ¥å½“å‰ç±»åŠ è½½å™¨æ˜¯å¦å·²ç»åŠ è½½äº†è¯¥ç±»</span></span><br><span class="line">        Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line">        <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">t0</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (parent != <span class="literal">null</span>) &#123; <span class="comment">//å¦‚æœå½“å‰åŠ è½½å™¨çˆ¶åŠ è½½å™¨ä¸ä¸ºç©ºåˆ™å§”æ‰˜çˆ¶åŠ è½½å™¨åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = parent.loadClass(name, <span class="literal">false</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">//å¦‚æœå½“å‰åŠ è½½å™¨çˆ¶åŠ è½½å™¨ä¸ºç©ºåˆ™å§”æ‰˜å¼•å¯¼ç±»åŠ è½½å™¨åŠ è½½è¯¥ç±»</span></span><br><span class="line">                    c = findBootstrapClassOrNull(name);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">                <span class="comment">// ClassNotFoundException thrown if class not found</span></span><br><span class="line">                <span class="comment">// from the nonâ€null parent class loader</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">                <span class="comment">//éƒ½ä¼šè°ƒç”¨URLClassLoaderçš„findClassæ–¹æ³•åœ¨åŠ è½½å™¨çš„ç±»è·¯å¾„é‡ŒæŸ¥æ‰¾å¹¶åŠ è½½è¯¥ç±»</span></span><br><span class="line">                c = findClass(name);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getParentDelegationTime().addTime(t1 â€ t0);</span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (resolve) &#123; <span class="comment">//ä¸ä¼šæ‰§è¡Œ</span></span><br><span class="line">            resolveClass(c);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="åŸå› "><a class="header-anchor" href="#åŸå› ">Â¶</a>åŸå› </h3>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦è®¾è®¡åŒäº²å§”æ´¾æœºåˆ¶å‘¢ï¼š</p>
<ul>
<li>æ²™ç®±å®‰å…¨æœºåˆ¶ï¼šæ¯”å¦‚ï¼Œè‡ªå·±å†™çš„<strong>java.lang.String.class</strong>ç±»ä¸ä¼šè¢«åŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥é˜²æ­¢æ ¸å¿ƒAPIåº“è¢«éšæ„çº‚æ”¹ï¼Œé˜²æ­¢é»‘å®¢å†™åé—¨</li>
<li>é¿å…ç±»çš„é‡å¤åŠ è½½ï¼šå½“çˆ¶äº²å·²ç»åŠ è½½äº†è¯¥ç±»æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦å­<strong>ClassLoader</strong>åœ¨åŠ è½½ä¸€æ¬¡ï¼Œä¿è¯è¢«åŠ è½½ç±»çš„å”¯ä¸€æ€§</li>
</ul>
<p>ä»¥ä¸‹ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> java.lang;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">String</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;**************My String Class**************&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœï¼š</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">è¿è¡Œç»“æœï¼š</span><br><span class="line"> é”™è¯¯: åœ¨ç±» java.lang.String ä¸­æ‰¾ä¸åˆ° main æ–¹æ³•, è¯·å°† main æ–¹æ³•å®šä¹‰ä¸º:</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line"> å¦åˆ™ JavaFX åº”ç”¨ç¨‹åºç±»å¿…é¡»æ‰©å±•javafx.application.Application</span><br></pre></td></tr></table></figure>
<h3 id="å…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶"><a class="header-anchor" href="#å…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶">Â¶</a>å…¨ç›˜è´Ÿè´£å§”æ‰˜æœºåˆ¶</h3>
<p><strong>â€œå…¨ç›˜è´Ÿè´£â€<strong>æ˜¯æŒ‡å½“ä¸€ä¸ª</strong>ClassLoader</strong>è£…è½½ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œé™¤éæ˜¾å¼çš„ä½¿ç”¨å¦ä¸€ä¸ª<strong>ClassLoader</strong>ï¼Œè¯¥ç±»æ‰€ä¾èµ–åŠå…¶å¼•ç”¨çš„ç±»ä¹Ÿç”±è¿™ä¸ª<strong>ClassLoader</strong>åŠ è½½/è½½å…¥</p>
<h3 id="è‡ªå®šä¹‰ç±»åŠ è½½å™¨"><a class="header-anchor" href="#è‡ªå®šä¹‰ç±»åŠ è½½å™¨">Â¶</a>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</h3>
<p>è‡ªå®šä¹‰ç±»åŠ è½½å™¨åªéœ€è¦ç»§æ‰¿<code>java.lang.ClassLoader</code>ç±»ï¼Œè¿™ä¸ªç±»æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•</p>
<ul>
<li><code>loadClass(String, boolean)</code>ï¼šå®ç°äº†åŒäº²å§”æ´¾æœºåˆ¶</li>
<li><code>findClass</code>ï¼šé»˜è®¤æ˜¯ç°å®ç©ºæ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰ç±»åŠ è½½å™¨ä¸»è¦æ˜¯é‡å†™<code>findClass</code>æ–¹æ³•</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: GroovyProject</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-12-30 13:34</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClassLoader</span> <span class="keyword">extends</span> <span class="title class_">ClassLoader</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String classPath;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyClassLoader</span><span class="params">(String classPath)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.classPath = classPath;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">byte</span>[] loadByte(String name) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        name = name.replaceAll(<span class="string">&quot;\\.&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(classPath + <span class="string">&quot;/&quot;</span> + name + <span class="string">&quot;.class&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> fis.available();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[len];</span><br><span class="line">        fis.read(data);</span><br><span class="line">        fis.close();</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            data = loadByte(name);</span><br><span class="line">            <span class="keyword">return</span> defineClass(name, data, <span class="number">0</span>, data.length);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ClassNotFoundException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">MyClassLoader</span> <span class="variable">classLoader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClassLoader</span>(<span class="string">&quot;C:\\Users\\é›·ç¥æˆ˜æœº\\Desktop&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">clazz</span> <span class="operator">=</span> classLoader.loadClass(<span class="string">&quot;AtomicIntegerFieldUpdaterTest&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> clazz.newInstance();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getDeclaredMethod(<span class="string">&quot;sout&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        method.invoke(obj, <span class="literal">null</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;clazz.getClassLoader().getClass().getName() = &quot;</span> + clazz.getClassLoader().getClass().getName());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡debugæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨åŠ è½½çš„æ—¶å€™ï¼Œæœ€ç»ˆä¼šè°ƒåˆ°æˆ‘ä»¬è‡ªå®šä¹‰çš„findClassæ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨loadClassæ–¹æ³•ï¼Œå¾—åˆ°æŒ‡å®šç±»ä¿¡æ¯ã€‚</p>
<blockquote>
<p>æ ¹æ®åŒäº²å§”æ´¾æœºåˆ¶æˆ‘ä»¬çŸ¥é“ï¼Œé¦–å…ˆä¼šè®©<strong>BootstrapClassLoader</strong>å»åŠ è½½ï¼Œå†<strong>ExtClassLoader</strong>ï¼Œå†<strong>APPClassLoder</strong>ï¼Œæœ€åå†æ˜¯è‡ªå·±å®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œ</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬æµ‹è¯•çš„æ—¶å€™ï¼Œéœ€è¦å°†æŒ‡å®šç±»çš„classå­—èŠ‚ç æ–‡ä»¶æ”¾åˆ°æ‰«æè·¯å¾„ä¸‹ï¼Œå¹¶æŠŠæŒ‡å®šç±»ä»é¡¹ç›®ä¸­åˆ é™¤</p>
<p>è¿™æ ·ï¼Œæ‰ä¸ä¼šè¢«å¼€å§‹çš„<strong>APPClassLoader</strong>ç´¢æ‰«æåˆ°</p>
</blockquote>
<h3 id="æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶"><a class="header-anchor" href="#æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶">Â¶</a>æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶</h3>
<p>ç”±ä¸Šé¢è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥çŸ¥é“ï¼Œæœ€ç»ˆè°ƒç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„<code>findClass</code>æ–¹æ³•çš„æ—¶å€™ï¼Œæ˜¯ä¼šè°ƒç”¨<code>loadClass</code>æ–¹æ³•ä»¥æ¥è·å¾—æŒ‡å®šç±»çš„ä¿¡æ¯çš„</p>
<p>è¿™é‡Œçš„<strong>loadClassæ–¹æ³•</strong>å°±å®ç°äº†åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œæ‰€ä»¥ï¼Œè¦æ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶ï¼Œåªéœ€è¦é‡å†™ä¸€é<code>loadClass</code>æ–¹æ³•å°±è¡Œäº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é‡å†™ç±»åŠ è½½æ–¹æ³•ï¼Œå®ç°è‡ªå·±çš„åŠ è½½é€»è¾‘ï¼Œä¸å§”æ´¾ç»™åŒäº²åŠ è½½</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> resolve</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassNotFoundException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> Class&lt;?&gt; loadClass(String name, <span class="type">boolean</span> resolve) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (getClassLoadingLock(name)) &#123;</span><br><span class="line">            <span class="comment">// First, check if the class has already been loaded</span></span><br><span class="line">            Class&lt;?&gt; c = findLoadedClass(name);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (c == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="comment">// If still not found, then invoke findClass in order</span></span><br><span class="line">                <span class="comment">// to find the class.</span></span><br><span class="line">                <span class="type">long</span> <span class="variable">t1</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line"></span><br><span class="line">                <span class="comment">//éè‡ªå®šä¹‰çš„ç±»è¿˜æ˜¯èµ°åŒäº²å§”æ´¾åŠ è½½</span></span><br><span class="line">                <span class="keyword">if</span> (!name.startsWith(<span class="string">&quot;è‡ªå·±å®šä¹‰çš„åŒ…å&quot;</span>)) &#123;</span><br><span class="line">                    c = <span class="built_in">this</span>.getParent().loadClass(name);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    c = findClass(name);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// this is the defining class loader; record the stats</span></span><br><span class="line">                sun.misc.PerfCounter.getFindClassTime().addElapsedTimeFrom(t1);</span><br><span class="line">                sun.misc.PerfCounter.getFindClasses().increment();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (resolve) &#123;</span><br><span class="line">                resolveClass(c);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Tomcatæ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶"><a class="header-anchor" href="#Tomcatæ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶">Â¶</a>Tomcatæ‰“ç ´åŒäº²å§”æ‰˜æœºåˆ¶</h2>
<p>ä»¥Tomcatç±»åŠ è½½ä¸ºä¾‹ï¼ŒTomcatå¦‚æœä½¿ç”¨é»˜è®¤çš„åŒäº²å§”æ‰˜æœºåˆ¶çš„è¯ï¼š</p>
<p>é¦–å…ˆæƒ³ä¸€ä¸‹ï¼šTomcatæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œä»–éœ€è¦è§£å†³ï¼š</p>
<ol>
<li>ä¸€ä¸ªwebå®¹å™¨å¯èƒ½éœ€è¦éƒ¨ç½²ä¸¤ä¸ªåº”ç”¨ç¨‹åºï¼Œä¸åŒçš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼š<strong>ä¾èµ–ç”¨ä¸€ä¸ªç¬¬ä¸‰æ–¹ç±»åº“çš„ä¸åŒç‰ˆæœ¬</strong>ï¼Œä¸èƒ½è¦æ±‚åŒä¸€ä¸ªç±»åº“åœ¨ä¸€ä¸ªæœåŠ¡å™¨åªæœ‰ä¸€ä»½ï¼Œå› æ­¤è¦ä¿è¯æ¯ä¸ªåº”ç”¨ç¨‹åºçš„ç±»åº“éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¿è¯äº’ç›¸éš”ç¦»</li>
<li>éƒ¨ç½²åœ¨åŒä¸€ä¸ªwebå®¹å™¨ä¸­<strong>ç›¸åŒçš„ç‰ˆæœ¬å¯ä»¥å…±äº«</strong>ã€‚å¦åˆ™å¦‚æœæœåŠ¡å™¨æœ‰10ä¸ªåº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆè¦æœ‰10ä»½ç›¸åŒçš„ç±»åº“åŠ è½½è¿›è™šæ‹Ÿæœº</li>
<li><strong>webå®¹å™¨ä¹Ÿè¦æœ‰è‡ªå·±çš„ä¾èµ–çš„ç±»åº“ï¼Œä¸èƒ½ä¸åº”ç”¨ç¨‹åºç±»åº“æ··æ·†</strong>ã€‚åŸºäºå®‰å…¨è€ƒè™‘ï¼Œåº”è¯¥è®©å®¹å™¨çš„ç±»åº“å’Œç¨‹åºçš„ç±»åº“éš”ç¦»å¼€æ¥</li>
<li>webå®¹å™¨è¦æ”¯æŒjspçš„ä¿®æ”¹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œjpsæ–‡ä»¶æœ€ç»ˆä¹Ÿæ˜¯è¦ç¼–è¯‘æˆclassæ–‡ä»¶æ‰èƒ½å†è™šæ‹Ÿæœºä¸­è¿è¡Œï¼Œä½†ç¨‹åºè¿è¡Œåä¿®æ”¹jspå·²ç»æ˜¯å¸ç©ºè§æƒ¯çš„äº‹æƒ…ï¼Œwebå®¹å™¨éœ€è¦æ”¯æŒjspä¿®æ”¹åä¸ç”¨é‡å¯</li>
</ol>
<p>æ‰€ä»¥ï¼Œå¦‚æœTomcatä½¿ç”¨çš„é»˜è®¤çš„åŒäº²å§”æ´¾ç±»åŠ è½½æœºåˆ¶ï¼Œæ˜¯ä¸è¡Œçš„ï¼š</p>
<ol>
<li>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœä½¿ç”¨é»˜è®¤çš„ç±»åŠ è½½æœºåˆ¶ï¼Œé‚£ä¹ˆæ˜¯æ— æ³•åŠ è½½ä¸¤ä¸ªç›¸åŒç±»åº“çš„ä¸åŒç‰ˆæœ¬çš„ï¼Œé»˜è®¤çš„ç±»åŠ è½½å™¨æ˜¯ä¸ç®¡ä½ æ˜¯ä»€ä¹ˆç‰ˆæœ¬çš„ï¼Œåªåœ¨ä¹ä½ çš„å…¨é™å®šç±»åï¼Œå¹¶ä¸”åªæœ‰ä¸€ä»½</li>
<li>ç¬¬äºŒä¸ªé—®é¢˜ï¼šé»˜è®¤çš„ç±»åŠ è½½å™¨æ˜¯èƒ½å¤Ÿå®ç°çš„ï¼Œå› ä¸ºä»–çš„èŒè´£å°±æ˜¯ä¿è¯å”¯ä¸€æ€§</li>
<li>ç¬¬ä¸‰ä¸ªé—®é¢˜è·Ÿç¬¬ä¸€ä¸ªé—®é¢˜ä¸€æ ·</li>
</ol>
<h3 id="Tomcatçš„ç±»åŠ è½½"><a class="header-anchor" href="#Tomcatçš„ç±»åŠ è½½">Â¶</a>Tomcatçš„ç±»åŠ è½½</h3>
<p>Tomcatçš„å‡ ä¸ªä¸»è¦ç±»åŠ è½½å™¨ï¼š</p>
<ul>
<li><strong>commonLoader</strong>ï¼šTomcatæœ€åŸºæœ¬çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯ä»¥è¢«Tomcatå®¹å™¨æœ¬èº«ä»¥åŠå„ä¸ªWebappè®¿é—®</li>
<li><strong>catalinaLoader</strong>ï¼šTomcatå®¹å™¨ç§æœ‰çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºWebappä¸å¯è§</li>
<li><strong>sharedLoader</strong>ï¼šå„ä¸ªWebappå…±äº«çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classå¯¹äºæ‰€æœ‰Webappå¯è§ï¼Œä½†æ˜¯å¯¹äºTomcatå®¹å™¨ä¸å¯è§</li>
<li><strong>WebappClassLoader</strong>ï¼šå„ä¸ªWebappä¼¼æœ‰æ„çš„ç±»åŠ è½½å™¨ï¼ŒåŠ è½½è·¯å¾„ä¸­çš„classåªå¯¹å½“å‰Webappå¯è§ï¼Œæ¯”å¦‚åŠ è½½waråŒ…é‡Œç›¸å…³çš„ç±»ï¼Œæ¯ä¸ªwaråŒ…åº”ç”¨éƒ½æœ‰è‡ªå·±çš„WebappClassLoaderï¼Œå®ç°ç›¸äº’éš”ç¦»ï¼Œæ¯”å¦‚ä¸åŒwaråŒ…åº”ç”¨å¼•å…¥ä¸ç”¨çš„springç‰ˆæœ¬ï¼Œè¿™æ ·å®ç°å°±èƒ½åŠ è½½å„è‡ªçš„sprinç‰ˆæœ¬</li>
</ul>
<p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221230194832606.png" alt="image-20221230194832606"></p>
<p>å¾ˆæ˜¾ç„¶ï¼ŒTomcatè¿™ç§ç±»åŠ è½½æœºåˆ¶æœªè¢«äº†Javaæ¨èçš„åŒäº²å§”æ´¾æ¨¡å‹</p>
<p>Tomcatä¸ºäº†å®ç°éš”ç¦»æ€§ï¼Œæ²¡æœ‰éµå®ˆè¿™ä¸ªçº¦å®šï¼Œæ¯ä¸ª<code>webappClassLoader</code>åŠ è½½è‡ªå·±çš„ç›®å½•å…ˆçš„classæ–‡ä»¶ï¼Œä¸ä¼šä¼ é€’ç»™çˆ¶ç±»åŠ è½½å™¨ï¼Œæ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶</p>
<blockquote>
<p>æ³¨æ„ï¼šåŒä¸€ä¸ªJVMå†…ï¼Œä¸¤ä¸ªç›¸åŒåŒ…åå’Œç±»åçš„ç±»å¯¹è±¡å¯ä»¥å…±å­˜ï¼Œ</p>
<p>å› ä¸ºä»–ä»¬çš„ç±»åŠ è½½å™¨å¯ä»¥ä¸ä¸€æ ·ï¼Œæ‰€ä»¥çœ‹ä¸¤ä¸ªç±»å¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªï¼Œ</p>
<p>é™¤äº†çœ‹ç±»çš„åŒ…åå’Œç±»åæ˜¯å¦éƒ½ç›¸åŒä¹‹å¤–ï¼Œ</p>
<p>è¿˜éœ€è¦çœ‹ä»–ä»¬çš„ç±»åŠ è½½å™¨ä¹Ÿæ˜¯åŒä¸€ä¸ªæ‰èƒ½è®¤ä¸ºä»–ä»¬æ˜¯åŒä¸€ä¸ª</p>
</blockquote>

        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2023
    YxYL
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/category/">åˆ†ç±»</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/YxYL6125">é¡¹ç›®</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
