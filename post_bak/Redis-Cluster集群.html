<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="Redis Clusterå°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º16384ä¸ªslotsï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ§½ä½ã€‚">
<meta property="og:type" content="website">
<meta property="og:title" content="Redis-Clusteré›†ç¾¤">
<meta property="og:url" content="https://www.yxyl6125.eu.org/post_bak/Redis-Cluster%E9%9B%86%E7%BE%A4.html">
<meta property="og:site_name" content="YxYLğŸ¥">
<meta property="og:description" content="Redis Clusterå°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º16384ä¸ªslotsï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ§½ä½ã€‚">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/355f81d892dfa5f9fc8b3530f41452ca.png">
<meta property="og:image" content="https://img-blog.csdnimg.cn/img_convert/0e13d83a3bf5f683182ccb1e84a13412.png">
<meta property="article:published_time" content="2023-01-20T05:52:10.000Z">
<meta property="article:modified_time" content="2023-01-20T05:52:10.000Z">
<meta property="article:author" content="YxYL">
<meta property="article:tag" content="Redis">
<meta property="article:tag" content="é›†ç¾¤">
<meta property="article:tag" content="éƒ¨ç½²">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://img-blog.csdnimg.cn/img_convert/355f81d892dfa5f9fc8b3530f41452ca.png">
    
    
      
        
          
            <link rel="shortcut icon" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=48">
          
        
      
      
        
          
            <link rel="icon" type="image/png" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=192" sizes="192x192">
          
        
      
      
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="https://www.gravatar.com/avatar/1c0ccb80f18de6871d3fd37b97cd3594?s=180">
          
        
      
    
    <!-- title -->
    <title>Redis-Clusteré›†ç¾¤</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->

    <script async defer
            data-website-id="e77e68be-f6e4-4br3-9365-2b76b57cd571"
            src="https://analytics.domain.com/umami.js">
    </script>


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
		<script type="text/x-mathjax-config">
		  MathJax.Hub.Config({
			tex2jax: {
			  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
			  inlineMath: [['$','$']]
			}
		  });
		</script>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML' async></script>
	
<!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Zfour/Butterfly-double-row-display@1.00/cardlistpost.min.css"/>
<style>#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags:before {content:"\A";
  white-space: pre;}#recent-posts > .recent-post-item >.recent-post-info > .article-meta-wrap > .tags > .article-meta__separator{display:none}</style>
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
    <div class="content index py4 ">
        
          <header id="header">
  <a class="u-url u-uid" href="/">
  
    
      <img id="logo" alt class="u-logo" src="/images/logo.png" />
    
  
    <div id="title">
      <h1 class="p-name">YxYLğŸ¥</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#" aria-label="ç›®å½•"><i class="fa-solid fa-bars fa-2x"></i></a>
      </li>
      <!--
     --><li><a href="/">é¦–é¡µ</a></li><!--
   --><!--
     --><li><a href="/about/">å…³äº</a></li><!--
   --><!--
     --><li><a href="/archives/">å½’æ¡£</a></li><!--
   --><!--
     --><li><a href="/category/">åˆ†ç±»</a></li><!--
   --><!--
     --><li><a href="/tags/">tags</a></li><!--
   --><!--
     --><li><a target="_blank" rel="noopener" href="https://github.com/YxYL6125">é¡¹ç›®</a></li><!--
   -->
    </ul>
  </div>
</header>

        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  

  <div class="content" itemprop="articleBody">
      
          <p><strong>å“¨å…µæ¨¡å¼ï¼š</strong></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/355f81d892dfa5f9fc8b3530f41452ca.png" alt="å“¨å…µæ¨¡å¼"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œsentinelé€šè¿‡clientï¼Œè·å–ä¸»ä»masterçš„ä¿¡æ¯ï¼Œä»è€Œè·å–æ•´ä¸ªé›†ç¾¤çš„ä¿¡æ¯ï¼Œå¦‚æœmasterå®•æœºäº†çš„è¯ï¼Œsentinelé€šè¿‡ç®—æ³•è¿›è¡Œå¯¹slaveçš„é€‰ä¸¾ï¼Œä½¿ä¹‹æˆä¸ºæ–°çš„master</p>
<p>è¿™æ ·çš„å“¨å…µæ¨¡å¼ï¼Œç»´æŒäº†Redisé›†ç¾¤çš„å¯ç”¨æ€§</p>
<p>è¿™é‡Œæ¥çœ‹çœ‹Clusteré›†ç¾¤æ¨¡å¼</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/0e13d83a3bf5f683182ccb1e84a13412.png" alt="Clusteré›†ç¾¤æ¨¡å¼"></p>
<blockquote>
<p>Redis-Clusteræ˜¯ä¸€ç§æœåŠ¡å™¨ShardingæŠ€æœ¯ï¼ŒRedis3.0ç‰ˆæœ¬ä»¥åç‰ˆæœ¬æ­£å¼æä¾›æ”¯æŒã€‚</p>
</blockquote>
<h3 id="Goals"><a class="header-anchor" href="#Goals">Â¶</a>Goals</h3>
<p>é«˜æ€§èƒ½å¯çº¿æ€§æ‰©å±•è‡³æœ€å¤š1000èŠ‚ç‚¹ã€‚é›†ç¾¤ä¸­æ²¡æœ‰ä»£ç†ï¼Œ(é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´)ä½¿ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œæ²¡æœ‰å½’å¹¶æ“ä½œ</p>
<ul>
<li><strong>å¯æ¥æ”¶çš„å†™å…¥å®‰å…¨</strong>ï¼šç³»ç»Ÿå°è¯•ä¿ç•™æ‰€æœ‰è¿æ¥åˆ°masterèŠ‚ç‚¹çš„clientå‘èµ·çš„å†™æ“ä½œã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªå°çš„æ—¶é—´çª—ï¼Œæ—¶é—´çª—å†…çš„å·²ç¡®è®¤å†™æ“ä½œå¯èƒ½ä¸¢å¤±ã€‚è€Œåœ¨åˆ†åŒºæ•…éšœä¸‹ï¼Œå¯¹å°‘æ•°æ´¾masterçš„å†™å…¥ï¼Œå‘ç”Ÿå†™ä¸¢å¤±çš„æ—¶é—´çª—ä¼šå¾ˆå¤§</li>
<li><strong>å¯ç”¨æ€§</strong>ï¼šRedis Clusteråœ¨ä»¥ä¸‹åœºæ™¯ä¸‹é›†ç¾¤æ€»æ˜¯å¯ç”¨ï¼š
<ul>
<li>å¤§éƒ¨åˆ†masterèŠ‚ç‚¹å¯ç”¨ï¼Œå¹¶ä¸”å¯¹å°‘éƒ¨åˆ†ä¸å¯ç”¨çš„masterï¼Œæ¯ä¸€ä¸ªmasterè‡³å°‘æœ‰ä¸€ä¸ªå½“å‰å¯ç”¨çš„slave</li>
<li>â€¦â€¦</li>
</ul>
</li>
</ul>
<h3 id="Hash-Slot"><a class="header-anchor" href="#Hash-Slot">Â¶</a>Hash Slot</h3>
<blockquote>
<p>å“ˆå¸Œæ§½(Hash Slot)</p>
</blockquote>
<p>Redis-Clusteræ²¡æœ‰ä½¿ç”¨ä¸€è‡´æ€§hashï¼Œè€Œæ˜¯å¼•å…¥äº†å“ˆå¸Œæ§½çš„æ¦‚å¿µã€‚Redis-Clusterä¸­ç”¨16384(å³2çš„14æ¬¡æ–¹)ä¸ªå“ˆå¸Œæ§½ï¼Œæ¯ä¸ªkeyé€šè¿‡CRC16æ ¡éªŒåå¯¹16383å–æ¨¡æ¥å†³å®šæ”¾ç½®å“ªä¸ªæ§½ã€‚Clusterä¸­çš„æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€éƒ¨åˆ†hashæ§½</p>
<p>æ¯”å¦‚é›†ç¾¤ä¸­å­˜åœ¨ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å¯èƒ½å­˜åœ¨çš„ä¸€ç§åˆ†é…å¦‚ä¸‹ï¼š</p>
<ul>
<li>èŠ‚ç‚¹1åŒ…å«0-5500å·å“ˆå¸Œæ§½ï¼›</li>
<li>èŠ‚ç‚¹2åŒ…å«5501-11000å·å“ˆå¸Œæ§½ï¼›</li>
<li>èŠ‚ç‚¹3åŒ…å«11001016384å·å“ˆå¸Œæ§½ï¼›</li>
</ul>
<h2 id="æ­å»ºRedis-Cluster"><a class="header-anchor" href="#æ­å»ºRedis-Cluster">Â¶</a>æ­å»ºRedis-Cluster</h2>
<p>Redisé›†ç¾¤è‡³å°‘éœ€è¦3ä¸ªmasterèŠ‚ç‚¹ï¼Œæ¯ä¸ªmasterèŠ‚ç‚¹ä¸‹å±slaveèŠ‚ç‚¹ä¸é™åˆ¶1ä¸ª</p>
<p><code>docker-compose</code></p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.7&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">redis79:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis79</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis79/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis79/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span>    </span><br><span class="line"></span><br><span class="line">  <span class="attr">redis80:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis80</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis80/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis80/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span></span><br><span class="line"> </span><br><span class="line">  <span class="attr">redis81:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis81</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis81/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis81/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">redis82:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis82</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis82/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis82/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">redis83:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis83</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis83/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis83/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">redis84:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis:6.2-alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">redis84</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">network_mode:</span> <span class="string">&quot;host&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis84/data:/data</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./redis84/redis.conf:/usr/local/etc/redis/redis.conf</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;redis-server&quot;</span>,<span class="string">&quot;/usr/local/etc/redis/redis.conf&quot;</span>]</span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">REDISCLI_AUTH=yc088088</span></span><br></pre></td></tr></table></figure>
<p><code>redis.conf</code></p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="comment"># redisç›‘å¬ç«¯å£</span></span><br><span class="line">port 6384</span><br><span class="line"><span class="comment"># å¼€å¯é›†ç¾¤                      </span></span><br><span class="line">cluster-enabled <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># é›†ç¾¤é…ç½®æ–‡ä»¶            </span></span><br><span class="line">cluster-config-file nodes.conf </span><br><span class="line"><span class="comment"># é›†ç¾¤èŠ‚ç‚¹å¤šå°‘æ—¶é—´æœªå“åº”è§†ä¸ºè¯¥èŠ‚ç‚¹ä¸¢å¤±</span></span><br><span class="line">cluster-node-timeout 5000      </span><br><span class="line">appendonly <span class="built_in">yes</span></span><br><span class="line"></span><br><span class="line">masterauth <span class="variable">$&#123;your pwd&#125;</span></span><br><span class="line">requirepass <span class="variable">$&#123;your pwd&#125;</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæ­å»º6ä¸ªæ¸¸ç¦»çš„Rediså®ä¾‹</p>
<p>æ­å»ºClusteré›†ç¾¤åªéœ€è¦ï¼š</p>
<ol>
<li>
<p>è¿›å…¥éšä¾¿ä¸€ä¸ªèŠ‚ç‚¹</p>
</li>
<li>
<p>æ‰§è¡Œå‘½ä»¤ï¼š</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 redis-5.0.3]<span class="comment"># redis-cli -a $&#123;your pwd&#125; --cluster create --cluster-replicas 1 47.96.114.225:8001 47.96.114.225:8002 47.96.114.225:8003 47.96.114.225:8004 47.96.114.225:8005 47.96.114.225:8006 $&#123;è¿™é‡Œæ˜¯é›†ç¾¤nodesçš„ip:port&#125;</span></span><br></pre></td></tr></table></figure>
</li>
<li>
<p>å®Œæ¯•</p>
</li>
</ol>
<h2 id="é›†ç¾¤åŸç†"><a class="header-anchor" href="#é›†ç¾¤åŸç†">Â¶</a>é›†ç¾¤åŸç†</h2>
<p>Redis Clusterå°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º16384ä¸ªslotsï¼Œæ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£å…¶ä¸­çš„ä¸€éƒ¨åˆ†æ§½ä½ã€‚æ§½ä½çš„ä¿¡æ¯å­˜å‚¨äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸­ã€‚å½“Redis Clusterçš„å®¢æˆ·ç«¯æ¥è¿æ¥é›†ç¾¤æ—¶ï¼Œå®ƒä¹Ÿä¼šå¾—åˆ°ä¸€ä»½é›†ç¾¤çš„æ§½ä½é…ç½®ä¿¡æ¯å¹¶å°†å…¶ç¼“å­˜åœ¨å®¢æˆ·ç«¯æœ¬åœ°ã€‚è¿™æ ·å®¢æˆ·ç«¯è¦æŸ¥æ‰¾æŸä¸ªkeyæ—¶ï¼Œå¯ä»¥ç›´æ¥å®šä½åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚åŒæ—¶å› ä¸ºæ§½ä½ä¿¡æ¯å¯èƒ½ä¼šå­˜åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿˜éœ€è¦çº æ­£æœºåˆ¶æ¥å®ç°æ§½ä½ä¿¡æ¯çš„æ ¡éªŒè°ƒæ•´</p>
<h3 id="slotå®šä½ç®—æ³•"><a class="header-anchor" href="#slotå®šä½ç®—æ³•">Â¶</a>slotå®šä½ç®—æ³•</h3>
<p>Clusteré»˜è®¤ä¼šå¯¹keyå€¼ä½¿ç”¨CRC16ç®—æ³•è¿›è¡ŒHashå¾—åˆ°ä¸€ä¸ªæ•´æ•°å€¼ï¼Œç„¶åç”¨è¿™ä¸ªæ•´æ•°å€¼æ¥å¯¹16384è¿›è¡Œå–æ¨¡æ¥å¾—åˆ°å…·ä½“æ§½ä½</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">HASH_SLOT = CRC16(key) mod 16384</span><br></pre></td></tr></table></figure>
<h3 id="è·³è½¬é‡å®šä½"><a class="header-anchor" href="#è·³è½¬é‡å®šä½">Â¶</a>è·³è½¬é‡å®šä½</h3>
<p>å½“å®¢æˆ·ç«¯åƒä¸€ä¸ªé”™è¯¯çš„èŠ‚ç‚¹å‘å‡ºäº†æŒ‡ä»¤ï¼Œè¯¥èŠ‚ç‚¹ä¼šå‘ç°æŒ‡ä»¤çš„keyçš„æ§½ä½å¹¶ä¸å±è‡ªå·±ç®¡ç†ï¼Œè¿™æ—¶å®ƒä¼šå‘å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªç‰¹æ®Šçš„è·³è½¬æŒ‡ä»¤æºå¸¦ç›®æ ‡æ“ä½œçš„èŠ‚ç‚¹åœ°å€ï¼Œå‘Šè¯‰å®¢æˆ·ç«¯å»è¿æ¥è¿™ä¸ªèŠ‚ç‚¹å»è·å–æ•°æ®ã€‚å®¢æˆ·ç«¯æ”¶åˆ°æŒ‡ä»¤åé™¤äº†è·³è½¬åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ä¸Šå»æ“ä½œï¼Œè¿˜ä¼šåŒæ­¥æ›´æ–°çº æ­£æœ¬åœ°çš„æ§½ä½æ˜ å°„è¡¨ç¼“å­˜ï¼Œåç»­æ‰€æœ‰keyå°†ä½¿ç”¨æ–°çš„æ§½ä½æ˜ å°„è¡¨</p>
<h3 id="Redisé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶"><a class="header-anchor" href="#Redisé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶">Â¶</a>Redisé›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶</h3>
<p>Redis ClusterèŠ‚ç‚¹ä¹‹é—´é‡‡å–<strong>gossipåè®®</strong>è¿›è¡Œé€šä¿¡</p>
<p>ç»´æŠ¤é›†ç¾¤çš„å…ƒæ•°æ®(é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯ï¼Œä¸»ä»è§’è‰²ï¼ŒèŠ‚ç‚¹æ•°é‡ï¼Œå„èŠ‚ç‚¹å…±äº«çš„æ•°æ®ç­‰)æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<ol>
<li>é›†ä¸­å¼</li>
<li>gossip</li>
</ol>
<h4 id="é›†ä¸­å¼"><a class="header-anchor" href="#é›†ä¸­å¼">Â¶</a>é›†ä¸­å¼</h4>
<p>ä¼˜ç‚¹åœ¨äºå…ƒæ•°æ®æ›´æ–°å’Œè¯»å–ï¼Œæ—¶æ•ˆæ€§éå¸¸å¥½ï¼Œä¸€æ—¦å…ƒæ•°æ®å‡ºç°å˜æ›´ç«‹å³å°±ä¼šæ›´æ–°åˆ°é›†ä¸­å¼çš„å­˜å‚¨ä¸­ï¼Œå…¶ä»–èŠ‚ç‚¹è¯»å–çš„æ—¶å€™ç«‹å³å°±å¯ä»¥æ„ŸçŸ¥åˆ°ï¼›</p>
<p>ä¸è¶³åœ¨äºæ‰€æœ‰çš„å…ƒæ•°æ®æ›´æ–°å‹åŠ›å…¨éƒ¨é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œå¯èƒ½å¯¼è‡´å…ƒæ•°æ®çš„å­˜å‚¨å‹åŠ›ã€‚</p>
<p>å¾ˆå¤šä¸­é—´ä»¶éƒ½ä¼šå€ŸåŠ©zookeeperé›†ä¸­å¼å­˜å‚¨å…ƒæ•°æ®</p>
<h4 id="gossip"><a class="header-anchor" href="#gossip">Â¶</a>gossip</h4>
<p>gossipåè®®çš„æœ‰ç‚¹åœ¨äºå…ƒæ•°æ®çš„æ›´æ–°æ¯”è¾ƒåˆ†æ•£ï¼Œä¸æ˜¯é›†ä¸­åœ¨ä¸€ä¸ªåœ°æ–¹ï¼Œæ›´æ–°è¯·æ±‚ä¼šé™†é™†ç»­ç»­ï¼Œæ‰“åˆ°æ‰€æœ‰èŠ‚ç‚¹ä¸Šå»æ›´æ–°ï¼Œæœ‰ä¸€å®šçš„å»¶æ—¶ï¼Œé™ä½äº†å‹åŠ›ï¼›</p>
<p>ç¼ºç‚¹åœ¨äºå…ƒæ•°æ®æ›´æ–°æœ‰å»¶æ—¶å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤çš„ä¸€äº›æ“ä½œä¼šæœ‰ä¸€äº›æ»å</p>
<blockquote>
<p>gossipé€šä¿¡çš„10000ç«¯å£</p>
</blockquote>
<p>æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸“é—¨ç”¨äºèŠ‚ç‚¹é—´gossipé€šä¿¡çš„ç«¯å£ï¼Œå°±æ˜¯è‡ªå·±æä¾›æœåŠ¡çš„ç«¯å£å·+10000</p>
<p>æ¯”å¦‚7001ï¼Œé‚£ä¹ˆç”¨äºèŠ‚ç‚¹ä¹‹é—´é€šä¿¡çš„å°±æ˜¯17001ç«¯å£ã€‚æ¯ä¸ªèŠ‚ç‚¹æ¯éš”ä¸€æ®µæ—¶é—´éƒ½ä¼šå¾€å¦å¤–å‡ ä¸ªèŠ‚ç‚¹å‘é€<code>ping</code>æ¶ˆæ¯ï¼ŒåŒæ—¶å…¶ä»–å‡ ä¸ªèŠ‚ç‚¹æ”¶åˆ°pingæ¶ˆæ¯ä¹‹åè¿”å›<code>pong</code>æ¶ˆæ¯</p>
<h2 id="Redis-Cluster-é›†ç¾¤é€‰ä¸¾åŸç†"><a class="header-anchor" href="#Redis-Cluster-é›†ç¾¤é€‰ä¸¾åŸç†">Â¶</a>Redis Cluster é›†ç¾¤é€‰ä¸¾åŸç†</h2>
<p>å½“slaveå‘ç°è‡ªå·±çš„masterå˜æˆFail(ä¸å¯ç”¨)çŠ¶æ€æ—¶ï¼Œä¾¿å°è¯•è¿›è¡ŒFailoverï¼Œä»¥æœŸæˆä¸ºæ–°çš„masterã€‚ç”±äºæŒ‚æ‰çš„masterå¯èƒ½ä¼šæœ‰å¤šä¸ªslaveï¼Œä»è€Œå­˜åœ¨å¤šä¸ªslaveç«äº‰æˆä¸ºmasterèŠ‚ç‚¹çš„è¿‡ç¨‹</p>
<ol>
<li>å½“slaveå‘ç°è‡ªå·±çš„masterå˜æˆFail</li>
<li>å°†è‡ªå·±è®°å½•çš„é›†ç¾¤currentEpoch +1 ï¼Œå¹¶å¹¿æ’­<code>FAILOVER_AUTH_REQUEST</code>æ¶ˆæ¯ç»™æ‰€æœ‰èŠ‚ç‚¹</li>
<li>å…¶ä»–èŠ‚ç‚¹æ¥æ”¶åˆ°è¿™ä¸ªæ¶ˆæ¯ï¼Œåªæœ‰masterä¼šå“åº”(åœ¨ä¸€æ¬¡é€‰ä¸¾å‘¨æœŸå†…ï¼Œåªä¼šå“åº”ä¸€æ¬¡)ï¼Œåˆ¤æ–­è¯·æ±‚è€…çš„åˆæ³•æ€§ï¼Œå¹¶å‘é€<code>FAILOVER_AUTH_ACK</code>ï¼Œå¯¹æ¯åŒä¸€ä¸ªepochåªå‘é€ä¸€æ¬¡ack</li>
<li>å°è¯•failoverçš„slaveæ”¶é›†masterè¿”å›çš„ack</li>
<li>slaveæ”¶åˆ°è¶…è¿‡åŠæ•°masterçš„ackåå˜æˆæ–°çš„Master(è¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè‡³å°‘éœ€è¦ä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œå¦‚æœåªæœ‰ä¸¤ä¸ªï¼Œå½“å…¶ä¸­ä¸€ä¸ªæŒ‚äº†ï¼Œåªå‰©ä¸€ä¸ªä¸»èŠ‚ç‚¹æ˜¯ä¸èƒ½é€‰ä¸¾æˆåŠŸçš„)</li>
<li>slaveå¹¿æ’­Pongä¿¡æ¯é€šçŸ¥å…¶ä»–é›†ç¾¤èŠ‚ç‚¹</li>
</ol>
<p>ä»èŠ‚ç‚¹å¹¶ä¸æ˜¯åœ¨ä¸»èŠ‚ç‚¹å·²ç»å…¥FAILçŠ¶æ€å°±é©¬ä¸Šå°è¯•å‘èµ·é€‰ä¸¾ï¼Œè€Œæ˜¯æœ‰ä¸€å®šå»¶è¿Ÿï¼Œä¸€å®šçš„å»¶è¿Ÿç¡®ä¿æˆ‘ä»¬ç­‰å¾…FAILçŠ¶æ€åœ¨é›†ç¾¤ä¸­ä¼ æ’­ï¼Œslaveå¦‚æœç«‹å³å°è¯•é€‰ä¸¾ï¼Œå…¶ä»–masteræˆ–è®¸å°šæœªæ„è¯†åˆ°FAILçŠ¶æ€ï¼Œå¯èƒ½ä¼šæ‹’ç»æŠ•ç¥¨</p>

        
  </div>
</article>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2021-2023
    YxYL
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">é¦–é¡µ</a></li><!--
     --><!--
       --><li><a href="/about/">å…³äº</a></li><!--
     --><!--
       --><li><a href="/archives/">å½’æ¡£</a></li><!--
     --><!--
       --><li><a href="/category/">åˆ†ç±»</a></li><!--
     --><!--
       --><li><a href="/tags/">tags</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/YxYL6125">é¡¹ç›®</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
