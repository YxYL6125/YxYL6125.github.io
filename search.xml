<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>K8Sç¬”è®°1</title>
      <link href="/2022/09/18/K8S%E7%AC%94%E8%AE%B01/"/>
      <url>/2022/09/18/K8S%E7%AC%94%E8%AE%B01/</url>
      
        <content type="html"><![CDATA[<h1>Kubernetes</h1><blockquote><p>K8S</p><p>ä¸€é¡¹åŸºäºç”Ÿäº§ç¯å¢ƒçº§åˆ«ä¸‹å®¹å™¨åŒ–ç¼–æ’è‡ªåŠ¨åŒ–éƒ¨ç½²æŠ€æœ¯</p></blockquote><p>è¿™é‡Œçš„ç¼–æ’æŒ‡çš„æ˜¯ï¼š</p><ul><li>æŒ‰ç…§ä¸€å®šçš„ç›®çš„ä¸€æ¬¡æ’åˆ—</li><li>è°ƒé…ã€å®‰æ’</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
          <category> K8S </category>
          
      </categories>
      
      
        <tags>
            
            <tag> K8S </tag>
            
            <tag> å­¦ä¹ ç¬”è®° </tag>
            
            <tag> è¿ç»´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡ç®€å•éƒ¨ç½²</title>
      <link href="/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2/"/>
      <url>/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h1>å¾®æœåŠ¡ç®€å•éƒ¨ç½²</h1><h2 id="ğŸ“‹ï¼šDocker-Conpose"><a class="header-anchor" href="#ğŸ“‹ï¼šDocker-Conpose">Â¶</a>ğŸ“‹ï¼šDocker-Conpose</h2><ul><li>Docker-Composeæ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰å’Œè¿è¡Œå¤æ‚åº”ç”¨çš„dockerå·¥å…·ã€‚ä¸€ä¸ªä½¿ç”¨Dockerå®¹å™¨çš„åº”ç”¨ï¼Œä¸€èˆ¬æ˜¯ç”±å¤šä¸ªå®¹å™¨ç»„æˆã€‚ä½¿ç”¨Docker-Composeå°±ä¸ç”¨å†™å¤šä¸ªshellè„šæœ¬æ¥å¯åŠ¨ç®¡ç†å®¹å™¨äº†ã€‚</li></ul><ol><li>æŸ¥çœ‹dockerç‰ˆæœ¬ï¼š<br><code>docker -version </code></li><li>å®‰è£…docker-compose<br><code>sudo apt install docker-compose</code></li><li>æŸ¥çœ‹docker-composeç‰ˆæœ¬<br><code>docker-compose -version</code></li></ol><h2 id="â°ï¼šæ‰“åŒ…"><a class="header-anchor" href="#â°ï¼šæ‰“åŒ…">Â¶</a>â°ï¼šæ‰“åŒ…</h2><ul><li>åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºimageåŒ…ï¼Œæ”¾æ¯ä¸ªå¾®æœåŠ¡æ‰“åŒ…å¥½çš„é•œåƒï¼Œå¯é€‰æ‹©æ¯ä¸ªå¾®æœåŠ¡å•ç‹¬ä¸€ä¸ªåŒ…ï¼Œä»¥ä¾¿äºä»¥åå¾®æœåŠ¡ç‰ˆæœ¬çš„ç»´æŠ¤ï¼Œå›æ»šã€‚</li></ul><h2 id="ğŸš‰ï¼šDockerfile"><a class="header-anchor" href="#ğŸš‰ï¼šDockerfile">Â¶</a>ğŸš‰ï¼šDockerfile</h2><ul><li><p>åœ¨æ¯ä¸ªå¾®æœåŠ¡åŒ…ä¸‹ç¼–å†™Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jre</span><br><span class="line"><span class="keyword">ENV</span> APP_PATH=/apps</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$APP_PATH</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> xxx-1.0-SNAPSHOT.jar <span class="variable">$APP_PATH</span>/app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> $&#123;PORT&#125;</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸Šä¼ Docker-Composeæ–‡ä»¶"><a class="header-anchor" href="#ä¸Šä¼ Docker-Composeæ–‡ä»¶">Â¶</a>ä¸Šä¼ Docker-Composeæ–‡ä»¶</h2><ul><li><p>åœ¨<code>Docker-Compose</code>æ–‡ä»¶ä¸­ç¼–å†™æœåŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span> <span class="comment">#å®šä¹‰dockerç½‘ç»œ</span></span><br><span class="line">  <span class="attr">yingxue_network:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment">#æŒ‚è½½æ•°æ®å·</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">  <span class="attr">redisdata:</span></span><br><span class="line">  <span class="attr">mqdata:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="comment">#æ¯ä¸ªæœåŠ¡</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server:2.0.2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;JVM_XMS=256m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;JVM_XMX=256m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MODE=standalone&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">yingxue_network</span></span><br><span class="line">        </span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">yingxue_network</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./yingxue.sql:/docker-entrypoint-initdb.d/yingxue.sql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MYSQL_ROOT_PASSWORD=&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MYSQL_DATABASE=yingxue&quot;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redisdata:/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="string">xxxæœåŠ¡:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">  <span class="attr">context:</span> <span class="string">./images/xxx</span></span><br><span class="line">  <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;xxxx:xxxx&quot;</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">  <span class="string">-mysql</span></span><br><span class="line">  <span class="string">-redis</span></span><br><span class="line">  <span class="string">-rebbitmq</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">....</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å°†æ¯ä¸ªè½¯ä»¶æœåŠ¡å’Œå†™çš„å¾®æœåŠ¡å†™åœ¨åŒä¸€ä¸ª<code>docker-compose</code>æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çš„åˆ†æˆä¸¤ä¸ª<code>docker-compose</code>ï¼Œå¯å°†å…¶åˆ’åˆ†æˆï¼š</p><ol><li>docker-compose-app.ymlï¼šå¾®æœåŠ¡</li><li>docker-compose-env.ymlï¼šç¯å¢ƒæœåŠ¡</li></ol></li></ul><h2 id="ğŸš€ï¼šç‚¹ç«"><a class="header-anchor" href="#ğŸš€ï¼šç‚¹ç«">Â¶</a>ğŸš€ï¼šç‚¹ç«</h2><ul><li>cdåˆ°docker-composeæ–‡ä»¶ï¼Œ</li><li><code>docker-compose up -d</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®æœåŠ¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gatewayè‡ªå®šä¹‰ç½‘å…³Filter</title>
      <link href="/2022/09/18/Gateway%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3Filter/"/>
      <url>/2022/09/18/Gateway%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3Filter/</url>
      
        <content type="html"><![CDATA[<h1>SpringCloud-Gatewayè‡ªå®šä¹‰ç½‘å…³Filter</h1><p>è‡ªå®šä¹‰filterå¯ä»¥å®ç°ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œä¸€ç§æ˜¯å±€éƒ¨ç”Ÿæ•ˆçš„ï¼Œéœ€è¦é…ç½®ã€‚</p><p>ğŸ–•ï¼šè¿™è¾¹è‡ªå®šä¹‰ä¸‹å±€éƒ¨çš„</p><ol><li><p>é¦–å…ˆå‘½åä¸ºï¼š<code>xxxGatewayFilterFactory</code>æ¯”å¦‚<code>TokenGatewayFilterFactory</code>ï¼Œ<code>AddLogGatewayFilterFactory</code>ç­‰ç­‰ï¼Œå†æ³¨å…¥IOCç®¡ç†</p></li><li><p>ç„¶åï¼Œé€šè¿‡çœ‹å…¶ä»–è‡ªå¸¦çš„å±€éƒ¨(å…¨å±€)Filterç±»å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬éƒ½ç»§æ‰¿äº†<code>AbstractGatewayFilterFactory</code>è¿™ä¸ªæŠ½è±¡ç±»ï¼Œ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenGatewayFilterFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractGatewayFilterFactory</span>&lt;TokenGatewayFilterFactory.Config&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„æ³›å‹æ˜¯Filterç±»ä¸­è‡ªå®šä¹‰çš„å†…éƒ¨ç±»<code>Config</code></p></li><li><p>é‡å†™<code>apply()</code>ï¼Œ<code>shortcutFieldOrder()</code>æ–¹æ³•ï¼Œ</p><ul><li>å…¶ä¸­applyæ˜¯æ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒå†³å®šç€æˆ‘ä»¬éœ€è¦çš„è¿‡æ»¤ä¸šåŠ¡ï¼Œ</li><li>shortcutFieldOrder()æ–¹æ³•å¯æ ¹æ®è‡ªå®šä¹‰é¡ºåºæ¥æ”¶æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¼ è¿‡æ¥çš„value</li></ul></li><li><p>åˆ›å»ºFilteræ„é€ æ–¹æ³•ï¼Œå¯ä»¥ä¼ è¿›æ¥éœ€è¦ç”¨åˆ°çš„å·¥å…·ç±»ç­‰ç­‰â€¦</p></li></ol><p>ğŸ†—ï¼šFilter overåï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç½‘å…³é…ç½®æ–‡ä»¶ä¸­æ¯ä¸ªéœ€è¦Filterçš„è·¯ç”±ä¸­è¿›è¡Œé…ç½®äº†ï¼Œå¯ä¼ çš„å‚æ•°ç”±shortcutFieldOrderå†³å®šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Filter </tag>
            
            <tag> Gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUC</title>
      <link href="/2022/09/17/JUC/"/>
      <url>/2022/09/17/JUC/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸŒ -JUCæ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#ğŸŒ -JUCæ˜¯ä»€ä¹ˆ">Â¶</a>ğŸŒ :JUCæ˜¯ä»€ä¹ˆ</h2><p>JUCæ˜¯<code>java.util.concurrent</code>åŒ…çš„ç¼©å†™ï¼Œè¿™ä¸ªåŒ…é‡ŒåŒ…å«äº†å„ç§å„æ ·çš„å…³äºçº¿ç¨‹é€šè®¯ï¼Œæ§åˆ¶åŒæ­¥çš„å·¥å…·ç±»â€”â€”&gt;å³Javaå¹¶å‘å·¥å…·åŒ…ã€‚</p><p>å¦å¤–ï¼ŒJUCçš„æ¡†æ¶ç»“æ„ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸è§çš„ç»§æ‰¿å®ç°æ¡†æ¶ç»“æ„ã€‚JUCåº•å±‚åœ¨Javaä¸­æ˜¯unsafeï¼Œunsafeæ˜¯jvmçš„å®ç°ã€‚æœ‰äº†unsafeçš„æ”¯æŒï¼Œæ‰å‡ºç°å¯ä»¥è¿›è¡ŒåŸå­æ“ä½œçš„AtomicåŸå­ç±»â€¦æœ€åæ‰åˆ°æˆ‘ä»¬çš„Utilsã€‚</p><h2 id="ğŸš€-è¿›ç¨‹å’Œçº¿ç¨‹"><a class="header-anchor" href="#ğŸš€-è¿›ç¨‹å’Œçº¿ç¨‹">Â¶</a>ğŸš€:è¿›ç¨‹å’Œçº¿ç¨‹</h2><blockquote><p>å®˜æ–¹ï¼šè¿›ç¨‹æ˜¯CPUåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦èµ„æºçš„æœ€å°å•ä½</p></blockquote><p>Javaé»˜è®¤æœ‰2ä¸ªçº¿ç¨‹ï¼šmian(ä¸»çº¿ç¨‹)ã€GC(å®ˆæŠ¤çº¿ç¨‹)</p><h2 id="ğŸš¢-å¹¶å‘å’Œå¹¶è¡Œ"><a class="header-anchor" href="#ğŸš¢-å¹¶å‘å’Œå¹¶è¡Œ">Â¶</a>ğŸš¢:å¹¶å‘å’Œå¹¶è¡Œ</h2><ul><li>å¹¶å‘ï¼ˆå¤šä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ªèµ„æºï¼‰ï¼šCPUä¸€æ ¸ï¼Œæ¨¡æ‹Ÿå‡ºæ¥å¤šä¸ªçº¿ç¨‹</li><li>å¹¶è¡Œï¼ˆå¤šä¸ªäººä¸€èµ·è¡Œèµ°ï¼‰ï¼šCPUå¤šæ ¸ï¼Œæ‰§è¡Œå¤šæ¡çº¿ç¨‹</li></ul><blockquote><p>çº¿ç¨‹æœ‰6ä¸ªçŠ¶æ€ï¼š</p></blockquote><ol><li><strong>NEW-&gt;æ–°ç”Ÿ</strong></li><li><strong>RUNNABLE-&gt;è¿è¡Œ</strong></li><li><strong>BLOCKED-&gt;é˜»å¡</strong></li><li><strong>WAITING-&gt;ç­‰å¾…</strong></li><li><strong>TIMED_WAITING-&gt;æ­»ç­‰</strong></li><li><strong>TERMINATED-&gt;ç»ˆç»“</strong></li></ol><blockquote><p>wait/sleepåŒºåˆ«</p></blockquote><ul><li>waitï¼š<br>è¦é‡Šæ”¾é”<br>ä¸éœ€è¦æ•è·å¼‚å¸¸<br>åªèƒ½åœ¨é™æ€ä»£ç å—ä¸­(<code>static</code>)</li><li>sleepï¼š<br>ä¸é‡Šæ”¾é”<br>éœ€è¦æ•è·å¼‚å¸¸<br>ä»»æ„åœ°æ–¹éƒ½å¯ä»¥<strong>ç¡</strong></li></ul><h2 id="ğŸ”’-Lock-é”"><a class="header-anchor" href="#ğŸ”’-Lock-é”">Â¶</a>ğŸ”’:Lock(é”)</h2><blockquote><p>ä¼ ç»Ÿsynchronized æœ¬è´¨ï¼šé˜Ÿåˆ—+é” â€”â€”&gt; æ’é˜Ÿ</p></blockquote><p><code>java.util.concurrent.locks.Lock</code></p><p>å…¶å­ç±»ï¼š</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220915205227492.png" alt="image-20220915205227492"></p><blockquote><p>synchronizedå’Œlockçš„åŒºåˆ«</p></blockquote><ul><li>synchronized  æ˜¯å…³é”®å­—ï¼›lockæ˜¯ç±»</li><li>synchronized  ä¸èƒ½åˆ¤æ–­é”çš„çŠ¶æ€ï¼›lockå¯ä»¥åˆ¤æ–­é”</li><li>synchronized  è‡ªåŠ¨é‡Šæ”¾é”ï¼›lockå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä¸é‡Šæ”¾çš„è¯â€“&gt;æ­»é”</li><li>synchronized  Thread1å µå¡â€“&gt;Thread2ç­‰å¾…ï¼›lockä¸ä¸€å®šç­‰</li><li>synchronized  é€‚åˆå°‘ä»£ç åŒæ­¥ï¼›locké€‚åˆå¤§é‡ä»£ç åŒæ­¥</li><li><strong>â€¦</strong></li></ul><h2 id="â­-JUCç‰ˆçš„PCé—®é¢˜"><a class="header-anchor" href="#â­-JUCç‰ˆçš„PCé—®é¢˜">Â¶</a>â­:JUCç‰ˆçš„PCé—®é¢˜</h2><blockquote><p>é€šè¿‡lockæ‰¾åˆ°Condition<br>conditionæ¥å¯¹çº¿ç¨‹è¿›è¡Œç›‘è§†æ“ä½œ(ç­‰å¾…ï¼Œå”¤é†’â€¦)<br>conditionæ“ä½œçº¿ç¨‹ï¼Œå¯ä»¥ç²¾å‡†çš„å¯¹çº¿ç¨‹çš„å”¤é†’</p></blockquote><p><strong>èµ„æºç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tea3</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçœ‹åˆ°åˆ¤æ–­çº¿ç¨‹æ“ä½œèµ„æºç­‰å¾…çš„æ¡ä»¶ä½¿ç”¨<code>while</code>åˆ¤æ–­è€Œä¸ç”¨<code>if</code>ï¼Œä¸ºäº†é˜²æ­¢è™šå‡å”¤é†’çš„é—®é¢˜ã€‚</strong></p><h2 id="ğŸ’¦-é›†åˆç±»ä¸å®‰å…¨"><a class="header-anchor" href="#ğŸ’¦-é›†åˆç±»ä¸å®‰å…¨">Â¶</a>ğŸ’¦:é›†åˆç±»ä¸å®‰å…¨</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨å¤šçº¿ç¨‹ä¸‹è¿›è¡Œä»»ä½•æ“ä½œéƒ½æ˜¯ä»¤äººèƒ†æˆ˜å¿ƒæƒŠçš„ã€‚</p><p>å¤šçº¿ç¨‹ä¸‹ï¼Œå¯¹é›†åˆCRUDï¼Œéš¾å…ä¼šé‡åˆ°<code>ConcurrentModificationException</code>çº¿ç¨‹æ“ä½œå¼‚å¸¸ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ArrayListåº•å±‚çš„æ•°æ®æ“ä½œæ–¹æ³•éƒ½æ˜¯å•çº¿ç¨‹çš„ï¼Œæ²¡æœ‰å¯¹çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p><p>é’ˆå¯¹è¿™ç‚¹ï¼Œæœ‰3ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆ(ä»…åŸºäºJavaå±‚é¢)ï¼š</p><ol><li>ä½¿ç”¨Vectoré›†åˆç±»ï¼ŒVectoré›†åˆç±»åº•å±‚å¯¹é›†åˆæ“ä½œè¿›è¡Œäº†synchronizedé”å¤„ç†ï¼Œä½†ç›¸å¯¹æ¥è¯´æ•ˆç‡è¾ƒä½<br><code>List list = new Vector&lt;&gt;();</code></li><li>ä½¿ç”¨é›†åˆå·¥å…·ç±»ä¸­çš„**â€œé”é›†åˆâ€**ï¼Œ<code>Collections.synchronizedList(....);</code></li><li>ä½¿ç”¨<strong>è¯»å†™é”é›†åˆ(JUC)</strong>ï¼Œ<code>CopyOnWriteArrayList</code>åº•å±‚å¯¹æ•°æ®çš„é›†åˆæ“ä½¿ç”¨äº†JUCä¸­çš„Locké”ç±»ï¼Œæ•ˆç‡è¾ƒVectorè‡ªç„¶<strong>upup</strong><br><code>List list = new CopyOnWriteArrayList();</code></li></ol><h2 id="ğŸ¶-çº¿ç¨‹æ± "><a class="header-anchor" href="#ğŸ¶-çº¿ç¨‹æ± ">Â¶</a>ğŸ¶:çº¿ç¨‹æ± </h2><p>å†™åˆ°è¿™é‡Œçªç„¶æƒ³èµ·æ¥é‚£å¤©å­¦é•¿é¢è¯•çš„é—®é¢˜â€”â€”è¯´ä¸‹çº¿ç¨‹çš„åˆ›å»ºæ–¹æ³•å§</p><p>å¤´ä¸€æ¬¡æ„Ÿå—åˆ°å½“æ—¶å¼€å­¦ç”¨ä¸€ä¸ªæœˆå­¦Javaè¿™é—¨ç¼–ç¨‹è¯­è¨€çš„æ—¶å€™åˆ°å¦‚ä»Šè¿™æ ·ä¸€ä¸ªä¸å¤ªæ­£å¼çš„é¢è¯•ï¼Œé¢ä¸´å¦‚æ­¤åŸºç¡€ç®€å•çš„é—®é¢˜ æ—¶æ˜¯å¤šä¹ˆçš„æ— åŠ›â€¦</p><p>åˆ›å»ºçº¿ç¨‹ä¸€å…±æœ‰4ä¸ªæ–¹æ³•ï¼Œä½†ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œå®Œå…¨å¯ä»¥æ€»ç»“ä¸ºä¸€ä¸ªæ–¹æ³•â€”â€”å…¶æœ€ç»ˆéƒ½æ˜¯æ‰§è¡Œçš„<code>Thread.start()</code>å½“ä¸­çš„<code>run()</code>æ–¹æ³•</p><ol><li><p>å®ç°<code>Runable</code>æ¥å£ï¼Œé‡å†™<code>Run()</code>æ–¹æ³•</p></li><li><p>å®ç°<code>Callable</code>æ¥å£ï¼Œé‡å†™<code>Call()</code>æ–¹æ³•</p><ul><li><blockquote><p>ä¸ï¼ˆ1ï¼‰ä¸åŒçš„æ˜¯ï¼Œ<code>Call()</code>æ–¹æ³•æ˜¯åˆè¿”å›å€¼çš„ï¼Œå…¶ç±»å‹ç”±æˆ‘ä»¬åˆ›å»ºåŒ¿åå†…éƒ¨ç±»çš„æ—¶å€™æŒ‡å®šæ³›å‹ã€‚è€Œ<code>Callableæ¥å£</code>æœ¬èº«å¹¶ä¸æ˜¯<code>Runable</code>çš„å­ç±»ï¼Œåˆ›å»ºçº¿ç¨‹å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•æ˜¯å› ä¸ºï¼šThreadåœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯éœ€è¦å°†<code>Runable</code>æˆ–å…¶å­ç±»ä¼ å…¥ï¼Œå…¶ä¸­åŒ…å«äº†å­ç±»<code>FutureTask</code>è¿™æ ·ä¸€ä¸ªç±»ï¼Œåœ¨åˆ›å»ºè¿™ä¸ªç±»æ—¶å¯å°†Callableæ¥å£çš„å®ç°å½“åšæ„é€ å‚æ•°ä¼ è¿›å»ï¼Œä»¥è¾¾åˆ°åˆ›å»ºçº¿ç¨‹çš„ç›®çš„â€¦</p></blockquote></li></ul></li><li><p>ğŸ’©ç›´æ¥New Thread</p></li><li><p>é€šè¿‡çº¿ç¨‹æ± åˆ›å»ºâ€¦</p></li></ol><hr><p><strong>æ± åŒ–æŠ€æœ¯</strong></p><blockquote><p>ç¨‹åºè¿è¡Œçš„æœ¬è´¨æ˜¯ï¼šå ç”¨OSçš„èµ„æºï¼Œè€Œä¼˜åŒ–èµ„æºçš„ä½¿ç”¨â€”â€”&gt;æ± åŒ–æŠ€æœ¯</p><p>äº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æºï¼Œéœ€è¦ç”¨çš„è¯ä»æˆ‘è¿™å„¿æ‹¿ï¼Œç”¨å®Œè¿˜æˆ‘</p></blockquote><p>å…¶ä¼˜ç‚¹ï¼š</p><ul><li>é™ä½èµ„æºçš„æ¶ˆè€—ï¼šæœ¬è´¨å³ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨æ•ˆç‡</li><li>æ–¹ä¾¿çº¿ç¨‹ç®¡ç†ï¼šåˆ›å»ºçº¿ç¨‹æ± åˆå§‹åŒ–äº‹å…ˆçº¿ç¨‹</li><li>æé«˜å“åº”é€Ÿåº¦ï¼šä¸ç”¨é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹</li></ul><h3 id="çº¿ç¨‹æ± çš„3ä¸ªFunc"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„3ä¸ªFunc">Â¶</a>çº¿ç¨‹æ± çš„3ä¸ªFunc</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Executor</span> <span class="variable">executor1</span> <span class="operator">=</span> Executors.newSingleThreadExecutor(); -- å•ä¾‹çº¿ç¨‹</span><br><span class="line"><span class="type">Executor</span> <span class="variable">executor2</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>); -- å›ºå®šçº¿ç¨‹</span><br><span class="line"><span class="type">Executor</span> <span class="variable">executor3</span> <span class="operator">=</span> Executors.newCachedThreadPool(); --å¼¹æ€§</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°">Â¶</a>çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°</h3><p>é€šè¿‡ä¸‰ä¸ªFuncå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>Executors.newCachedThreadPool(); --å¼¹æ€§</code>è¿™æ ·ä¸€ä¸ªæ–¹æ³•æ˜¯å€¼å¾—æˆ‘ä»¬é’ççš„ï¼Œ</p><p>å…¶æ„é€ æ–¹æ³•ï¼š</p><img src="C:/Users/%E9%9B%B7%E7%A5%9E%E6%88%98%E6%9C%BA/AppData/Roaming/Typora/typora-user-images/image-20220918095441793.png" alt="image-20220918095441793" style="zoom: 65%;" /><blockquote><p>ä½†æ˜¯è¯»æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p></blockquote><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220918094909666.png" alt="image-20220918094909666" style="zoom: 80%;" /><blockquote><p>è¿™é‡Œ<strong>å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡</strong>æ˜¯ï¼š<code>Integer.MAX_VALUE</code> = 2^31 - 1 â€”â€”&gt;<strong>å¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMï¼</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220918095025854.png" alt="image-20220918095025854"></p><blockquote><p>è¿™ä¹Ÿæ˜¯é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œé‡Œé¢æåˆ°çš„ï¼Œçº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ <code>Executors</code> å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ <code>ThreadPoolExecutor</code> è¿™æ ·ä¸€ä¸ªåŸç”Ÿçš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p></blockquote><hr><p>å½’è¨€ï¼šå…¶7ä¸ªå‚æ•°åˆ†åˆ«ï¼š</p><ol><li>int <code>corePoolSize</code>ï¼š<strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong></li><li>int <code>maximumPoolSize</code>ï¼š<strong>æœ€å¤§åˆ›å»ºçº¿ç¨‹æ•°</strong></li><li>long <code>keepAliveTime</code>ï¼š<strong>å­˜æ´»æ—¶é—´</strong></li><li>TimeUnit <code>unit</code>ï¼š<strong>Timeç±»ç®¡ç†å·¥å…·</strong></li><li>BlockingQueue<Runnable> <code>workQueue</code>ï¼šæŒ‡å®šé˜»å¡é˜Ÿåˆ—</li><li>ThreadFactory <code>threadFactory</code>ï¼š<strong>çº¿ç¨‹å·¥å‚</strong></li><li>RejectedExecutionHandler <code>handler</code>ï¼š<strong>æ‹’ç»ç­–ç•¥</strong></li></ol><h3 id="çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥">Â¶</a>çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥</h3><ul><li><code>new ThreadPoolExecutor.AbortPolicy()</code> // é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li><code>new ThreadPoolExecutor.CallerRunsPolicy()</code> //å“ªæ¥çš„å»å“ªé‡Œ!</li><li><code>new ThreadPoolExecutor.DiscardPolicy()</code> //é˜Ÿåˆ—æ»¡äº†ï¼Œä¸¢æ‰ä»»åŠ¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸!</li><li><code>new ThreadPoolExecutor.DiscardoldestPolicyO()</code> //é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å»å’Œæœ€æ—©çš„ç«äº‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸!</li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JUC </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
