<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CASå’ŒåŸå­ç±»æ“ä½œ</title>
      <link href="/2022/12/19/CAS%E5%92%8C%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%93%8D%E4%BD%9C/"/>
      <url>/2022/12/19/CAS%E5%92%8C%E5%8E%9F%E5%AD%90%E7%B1%BB%E6%93%8D%E4%BD%9C/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯CAS"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯CAS">Â¶</a>ä»€ä¹ˆæ˜¯CAS</h2><p>CAS(Compare And Swapï¼Œæ¯”è¾ƒå¹¶äº¤æ¢)ï¼Œé€šå¸¸æŒ‡çš„æ˜¯è¿™æ ·ä¸€ç§åŸå­æ“ä½œï¼š</p><blockquote><p>é’ˆå¯¹ä¸€ä¸ªå˜é‡ï¼Œé¦–å…ˆå…ˆæ¯”è¾ƒä»–çš„å†…å­˜å€¼ä¸æŸä¸ªæœŸæœ›å€¼æ˜¯å¦ç›¸åŒï¼Œå¦‚æœç›¸åŒï¼Œå°±ç»™ä»–èµ‹ä¸€ä¸ªæ–°å€¼</p></blockquote><p>CASçš„é€»è¾‘ç”¨ä¼ªä»£ç æè¿°å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(value == expectedValue)&#123;</span><br><span class="line">value = newValue;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>CASå¯ä»¥çœ‹åšæ˜¯ä»–ä»¬åˆå¹¶åçš„æ•´ä½“â€”â€”ä¸€ä¸ªä¸å¯åˆ†å‰²çš„åŸå­æ“ä½œï¼Œå¹¶ä¸”èµ·åŸå­æ€§æ˜¯ç›´æ¥åœ¨ç¡¬ä»¶å±‚é¢å¾—åˆ°ä¿éšœçš„</li><li>CASè¯¾çœ‹åšæ˜¯ä¹è§‚é”(å¯¹æ¯”æ•°æ®åº“çš„æ‚²è§‚ã€ä¹è§‚é”)çš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒJavaåŸå­ç±»ä¸­çš„é€’å¢æ“ä½œå°±é€šè¿‡CASè‡ªæ—‹å®ç°</li><li>CASæ˜¯ä¸€ç§æ— é”ç®—æ³•ï¼Œåœ¨ä¸ä½¿ç”¨é”(æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡)çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥</li></ul><h2 id="CASåº”ç”¨"><a class="header-anchor" href="#CASåº”ç”¨">Â¶</a>CASåº”ç”¨</h2><p>åœ¨Javaä¸­ï¼ŒCASæ“ä½œæ˜¯æœ‰<code>Unsafe</code>ç±»æä¾›æ”¯æŒçš„ï¼Œè¯¥ç±»å®šä¹‰äº†ä¸‰ç§é’ˆå¯¹ä¸åŒç±»å‹å˜é‡çš„CASæ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapObject</span><span class="params">(Object var1,<span class="type">long</span> var2,Object var4,Object var5)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapInt</span><span class="params">(Object var1,<span class="type">long</span> var2,<span class="type">int</span> var4,<span class="type">int</span> var5)</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">native</span> <span class="type">boolean</span> <span class="title function_">compareAndSwapLong</span><span class="params">(Object var1,<span class="type">long</span> var2,<span class="type">long</span> var4,<span class="type">long</span> var5)</span>;</span><br></pre></td></tr></table></figure><p>ä»–ä»¬éƒ½æ˜¯<a href="https://cloud.tencent.com/developer/article/1744704">nativeæ–¹æ³•</a>ï¼Œç”±Javaè™šæ‹Ÿæœºæä¾›å…·ä½“å®ç°ï¼Œè¿™æ„å‘³ç€ä¸åŒçš„Javaè™šæ‹Ÿæœºå¯¹ä»–ä»¬çš„å®ç°å¯èƒ½ä¼šç•¥æœ‰ä¸åŒã€‚</p><p>ä»¥<code>compareAndSwapInt</code>ä¸ºä¾‹ï¼Œ<code>Unsafe</code>çš„<code>compareAndSwapInt</code>æ–¹æ³•æ¥æ”¶4ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ï¼š</p><ol><li>å¯¹è±¡å®ä¾‹</li><li>å†…å­˜åç§»é‡(æœ‰headerçš„8ä¸ªå­—èŠ‚+x86æœºå™¨çš„å‹ç¼©æŒ‡é’ˆç²˜çš„4ä¸ªå­—èŠ‚+å¯¹è±¡å­˜å‚¨æ•°æ®æœ¬èº«çš„å­—èŠ‚æ•°ï¼Œå†æ·»ä¸Šå¯¹é½æ‰€éœ€è¦çš„å­—èŠ‚æ•°ä½¿ä¹‹æˆä¸º8çš„æ•´æ•°å€)</li><li>å­—æ®µæœŸæœ›å€¼</li><li>å­—æ®µæ–°å€¼</li></ol><p>è¿™ä¸ªæ–¹æ³•ä¼šé’ˆå¯¹æŒ‡å®šå¯¹è±¡å®ä¾‹ä¸­çš„å¯¹åº”åç§»é‡çš„å­—æ®µæ‰§è¡ŒCASæ“ä½œ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CASTest</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Entity</span> <span class="variable">entity</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Entity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">Unsafe</span> <span class="variable">unsafe</span> <span class="operator">=</span> UnsafeFactory.getUnsafe();</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">offset</span> <span class="operator">=</span> UnsafeFactory.getFieldOffset(unsafe, Entity.class, <span class="string">&quot;x&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> successful;</span><br><span class="line"></span><br><span class="line">     <span class="comment">// 4ä¸ªå‚æ•°åˆ†åˆ«æ˜¯ï¼šå¯¹è±¡å®ä¾‹ã€å­—æ®µçš„å†…å­˜åç§»é‡ã€å­—æ®µæœŸæœ›å€¼ã€å­—æ®µæ–°å€¼</span></span><br><span class="line">    successful = unsafe.compareAndSwapInt(entity, offset, <span class="number">0</span>, <span class="number">3</span>);</span><br><span class="line">    System.out.println(successful + <span class="string">&quot;\t&quot;</span> + entity.x);</span><br><span class="line"></span><br><span class="line">    successful = unsafe.compareAndSwapInt(entity, offset, <span class="number">3</span>, <span class="number">5</span>);</span><br><span class="line">    System.out.println(successful + <span class="string">&quot;\t&quot;</span> + entity.x);</span><br><span class="line"></span><br><span class="line">    successful = unsafe.compareAndSwapInt(entity, offset, <span class="number">3</span>, <span class="number">8</span>);</span><br><span class="line">    System.out.println(successful + <span class="string">&quot;\t&quot;</span> + entity.x);</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UnsafeFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å– Unsafe å¯¹è±¡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> Unsafe <span class="title function_">getUnsafe</span><span class="params">()</span> &#123;</span><br><span class="line">         <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> Unsafe.class.getDeclaredField(<span class="string">&quot;theUnsafe&quot;</span>);</span><br><span class="line">         field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">         <span class="keyword">return</span> (Unsafe) field.get(<span class="literal">null</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">         e.printStackTrace();</span><br><span class="line">         &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è·å–å­—æ®µçš„å†…å­˜åç§»é‡</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unsafe</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> clazz</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> fieldName</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">long</span> <span class="title function_">getFieldOffset</span><span class="params">(Unsafe unsafe, Class clazz, String fieldNam&#123;</span></span><br><span class="line"><span class="params">         <span class="keyword">try</span> &#123;</span></span><br><span class="line"><span class="params">         return unsafe.objectFieldOffset(clazz.getDeclaredField(fieldName)</span>);</span><br><span class="line">         &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</span><br><span class="line">         <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(e);</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h2 id="CASç¼ºé™·"><a class="header-anchor" href="#CASç¼ºé™·">Â¶</a>CASç¼ºé™·</h2><p>CASè™½ç„¶é«˜æ ¡è§£å†³äº†åŸå­æ“ä½œä½†æ˜¯è¿˜æ˜¯å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œä¸»è¦å˜ç°åœ¨ä¸‰ä¸ªæ–¹é¢ï¼š</p><ul><li>è‡ªæ—‹CASé•¿æ—¶é—´åœ°ä¸æˆåŠŸï¼Œè®©CPUåœ¨é‚£é‡Œç©ºè½¬ï¼Œå¯¼è‡´ç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€</li><li>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæ˜¯åˆ†å¸ƒå¼çš„è¯ï¼Œè¿˜æ˜¯è€è€å®å®ç”¨åˆ†å¸ƒå¼é”å§</li><li>ABAé—®é¢˜</li></ul><h3 id="ABAé—®é¢˜"><a class="header-anchor" href="#ABAé—®é¢˜">Â¶</a>ABAé—®é¢˜</h3><p>å½“æœ‰å¤šä¸ªçº¿ç¨‹å¯¹ä»–ä¸€ä¸ªåŸå­ç±»è¿›è¡Œæ“ä½œçš„æ—¶å€™ï¼ŒæŸä¸ªçº¿ç¨‹åœ¨çŸ­æ—¶é—´å†…å°†åŸå­ç±»çš„å€¼Aä¿®æ”¹ä¸ºBï¼Œåˆé©¬ä¸Šå°†å…¶ä¿®æ”¹ä¸ºAï¼Œè¿™ä¸ªæ—¶å€™å…¶ä»–çº¿ç¨‹ä¸æ„ŸçŸ¥ï¼Œè¿˜æ˜¯ä¼šä¿®æ”¹æˆåŠŸ</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221219093920543.png" alt="image-20221219093920543"></p><p>å…¶ä¸­ï¼Œå¯¹æŸä¸€ä¸ªå…±äº«å˜é‡çš„æ“ä½œåºåˆ—ä¸ºï¼šè¯»å–-ä¿®æ”¹-å†™å›(å³A-B-A)ï¼Œå¦‚æœåœ¨ä¿®æ”¹æ“ä½œBæœŸé—´ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿå¯¹è¿™ä¸ªå˜é‡è¿›è¡Œäº†ä¿®æ”¹æ²¡é‚£ä¹ˆåŸæœ¬çš„ä¿®æ”¹æ“ä½œå°±ä¼šè¢«è¦†ç›–æ‰</p><p>ABAé—®é¢˜é€šå¸¸å‡ºç°åœ¨ä½¿ç”¨CASæ“ä½œçš„åœºæ™¯ä¸­ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼ŒABAé—®é¢˜å¯èƒ½ä¼šå¸¦æ¥éšæ‚£(åŒ…æ‹¬ä½†ä¸é™äºè¿™äº›åœºæ™¯)</p><ol><li>ä½¿ç”¨CASå®ç°çš„é”ï¼šå¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå¦ä¸€ä¸ªçº¿ç¨‹åœ¨æ¬¡æœŸé—´å¯¹å…±äº«å˜é‡è¿›è¡Œäº†ä¿®æ”¹ï¼Œå¹¶ä¸”å°†å…¶ä¿®æ”¹å›å»ï¼Œé‚£ä¹ˆè¦åŸæœ¬çš„çº¿ç¨‹å¯èƒ½ä¼šåœ¨é‡Šæ”¾é”çš„æ—¶å€™å°†ä¿®æ”¹çš„å€¼å†™å›ï¼Œå¯¼è‡´çŠ¶æ€çš„æ··ä¹±</li><li>ä½¿ç”¨CASå®ç°çš„é˜Ÿåˆ—(å †æ ˆ)ï¼šå¦‚æœåœ¨ä¸€ä¸ªçº¿ç¨‹å‘é˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ çš„åŒæ—¶ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹å°†é˜Ÿåˆ—ä¸­çš„æŸä¸ªåŸåƒç´ åˆ é™¤ï¼Œå¹¶ä¸”å°†å…¶æ’å…¥å›æ¥ï¼Œé‚£ä¹ˆåŸæœ¬çš„çº¿ç¨‹å¯èƒ½ä¼šè®¤ä¸ºé˜Ÿåˆ—ä¸­ä»»ç„¶å­˜åœ¨è¿™ä¸ªå…ƒç´ ï¼Œå¯¼è‡´çŠ¶æ€çš„æ··ä¹±</li><li>â€¦â€¦</li></ol><h3 id="è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ">Â¶</a>è§£å†³æ–¹æ¡ˆ</h3><p>æ•°æ®åº“æœ‰ä¸ªé”æˆä¸ºä¹è§‚é”ï¼Œæ˜¯ä¸€ç§åŸºäºæ•°æ®ç‰ˆæœ¬å®ç°çš„æ•°æ®åŒæ­¥æœºåˆ¶ï¼Œæ¯æ¬¡ä¿®æ”¹ä¸€æ¬¡æ•°æ®ï¼Œç‰ˆæœ¬å·å°±ä¼šè¿›è¡Œç´¯åŠ </p><p>åŒæ ·ï¼ŒJavaä¹Ÿæä¾›äº†ç›¸åº”çš„åŸå­å¼•ç”¨ç±»<code>AtomicStampedReference&lt;V&gt;</code></p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221219190644368.png" alt="image-20221219190644368"></p><ul><li><code>reference</code>å³æˆ‘ä»¬å®é™…å­˜å‚¨çš„å˜é‡ï¼Œ</li><li><code>stamp</code>æ˜¯ç‰ˆæœ¬ï¼Œæ¯æ¬¡ä¿®æ”¹å¯ä»¥é€šè¿‡+1æ¥ä¿è¯ç‰ˆæœ¬å”¯ä¸€æ€§</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">demo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰AtomicStampedReference </span></span><br><span class="line">        <span class="comment">// Pair.referenceå€¼ä¸º1, Pair.stampä¸º1</span></span><br><span class="line">        <span class="type">AtomicStampedReference</span> <span class="variable">atomicStampedReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span>[] stampHolder = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> (<span class="type">int</span>) atomicStampedReference.get(stampHolder);</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> stampHolder[<span class="number">0</span>];</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread1 read value: &quot;</span> + value + <span class="string">&quot;, stamp: &quot;</span> + stamp);</span><br><span class="line">            <span class="comment">// é˜»å¡1s</span></span><br><span class="line">            LockSupport.parkNanos(<span class="number">1000000000L</span>);</span><br><span class="line">            <span class="comment">// Thread1é€šè¿‡CASä¿®æ”¹valueå€¼ä¸º3</span></span><br><span class="line">            <span class="keyword">if</span> (atomicStampedReference.compareAndSet(value, <span class="number">3</span>, stamp, stamp + <span class="number">1</span>)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread1 update from &quot;</span> + value + <span class="string">&quot; to 3&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread1 update fail!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">int</span>[] stampHolder = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">1</span>];</span><br><span class="line">            <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> (<span class="type">int</span>) atomicStampedReference.get(stampHolder);</span><br><span class="line">            <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> stampHolder[<span class="number">0</span>];</span><br><span class="line">            System.out.println(<span class="string">&quot;Thread2 read value: &quot;</span> + value + <span class="string">&quot;, stamp: &quot;</span> + stamp);</span><br><span class="line">            <span class="comment">// Thread2é€šè¿‡CASä¿®æ”¹valueå€¼ä¸º2</span></span><br><span class="line">            <span class="keyword">if</span> (atomicStampedReference.compareAndSet(value, <span class="number">2</span>, stamp, stamp + <span class="number">1</span>)) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread2 update from &quot;</span> + value + <span class="string">&quot; to 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// do something</span></span><br><span class="line"></span><br><span class="line">                value = (<span class="type">int</span>) atomicStampedReference.get(stampHolder);</span><br><span class="line">                stamp = stampHolder[<span class="number">0</span>];</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread2 read value: &quot;</span> + value + <span class="string">&quot;, stamp: &quot;</span> + stamp);</span><br><span class="line">                <span class="comment">// Thread2é€šè¿‡CASä¿®æ”¹valueå€¼ä¸º1</span></span><br><span class="line">                <span class="keyword">if</span> (atomicStampedReference.compareAndSet(value, <span class="number">1</span>, stamp, stamp + <span class="number">1</span>)) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread2 update from &quot;</span> + value + <span class="string">&quot; to 1&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;Thread2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Thread1 read value: 1, stamp: 1</span><br><span class="line">Thread2 read value: 1, stamp: 1</span><br><span class="line">Thread2 update from 1 to 2</span><br><span class="line">Thread2 read value: 2, stamp: 2</span><br><span class="line">Thread2 update from 2 to 1</span><br><span class="line">Thread1 update fail!</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ï¼ŒABBé—®é¢˜å¾—åˆ°è§£å†³ã€‚Açº¿ç¨‹æ²¡æœ‰ä¿®æ”¹æˆåŠŸ</p><blockquote><p><code>AtomicMarkableReference</code>å¯ä»¥ç†è§£ä¸ºä¸Šé¢<code>AtomicStampedReference</code>çš„ç®€åŒ–ç‰ˆ</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221219191150048.png" alt="image-20221219191150048"></p><p>å°±æ˜¯ä¸å…³å¿ƒä¿®æ”¹è¿‡å‡ æ¬¡ï¼Œä»…ä»…å…³å¿ƒæ˜¯å¦ä¿®æ”¹è¿‡</p><p>å› æ­¤å˜é‡<code>mark</code>æ˜¯<code>boolean</code>ç±»å‹ï¼Œä»…è®°å½•å€¼æ˜¯å¤Ÿæœ‰è¿‡ä¿®æ”¹</p></blockquote><h2 id="åŸå­ç±»æ“ä½œ"><a class="header-anchor" href="#åŸå­ç±»æ“ä½œ">Â¶</a>åŸå­ç±»æ“ä½œ</h2><p>åœ¨å¹¶å‘ç¼–ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°å¹¶å‘å®‰å…¨çš„é—®é¢˜</p><blockquote><p>æœ‰ä¸€ä¸ªå¾ˆç®€å•çš„ä¾‹å­å°±æ˜¯å¤šçº¿ç¨‹æ›´æ–°å˜é‡ <code>i=1</code>ï¼Œæ¯”å¦‚å¤šä¸ªçº¿ç¨‹æ‰§è¡Œ<code>i++</code>æ“ä½œï¼Œå°±æœ‰å¯èƒ½è·å–ä¸åˆ°æ­£ç¡®çš„å€¼ï¼Œè€Œè¿™ä¸ªé—®é¢˜ï¼Œæœ€å¸¸ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡<code>synchronized</code>è¿›è¡Œæ§åˆ¶æ¥è¾¾åˆ°çº¿ç¨‹å®‰å…¨çš„ç›®çš„ã€‚ä½†æ˜¯ç”±äº<code>synchronized</code>æ˜¯é‡‡ç”¨çš„æ‚²è§‚é”ç­–ç•¥ï¼Œå¹¶ä¸æ˜¯ç‰¹åˆ«é«˜æ•ˆçš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼Œå®é™…ä¸Šï¼Œåœ¨JUCä¸‹çš„atomicåŒ…æä¾›äº†ä¸€ç³»åˆ—çš„æ“ä½œç®€å•ï¼Œæ€§èƒ½é«˜æ•ˆï¼Œå¹¶èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨çš„ç±»å»æ›´æ–°åŸºæœ¬ç±»å‹å˜é‡ï¼Œæ•°ç»„å…ƒç´ ï¼Œåº”ç”¨ç±»å‹ï¼Œä»¥åŠæ›´æ–°å¯¹è±¡ä¸­çš„å­—æ®µç±»å‹ï¼ŒatomicåŒ…ä¸‹çš„è¿™äº›ç±»éƒ½æ˜¯é‡‡ç”¨çš„æ˜¯ä¹è§‚é”ç­–ç•¥å»åŸå­æ›´æ–°æ•°æ®ï¼Œåœ¨javaä¸­åˆ™æ˜¯ä½¿ç”¨CASæ“ä½œå…·ä½“å®ç°ã€‚</p></blockquote><p>åœ¨<code>java.util.concurrent.atomic</code>åŒ…ä¸‹æä¾›äº†ä¸€ç»„åŸå­æ“ä½œç±»ï¼š</p><ul><li>åŸºæœ¬ç±»å‹ï¼š<code>AtomicIntegerã€AtomicLongã€AtomicBoolean</code></li><li>å¼•ç”¨ç±»å‹ï¼š<code>AtomicReferenceã€AtomicStampedRerenceã€AtomicMarkableReference</code></li><li>æ•°ç»„ç±»å‹ï¼š<code>AtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArray</code></li><li>å¯¹è±¡å±æ€§åŸå­ä¿®æ”¹å™¨ï¼š<code>AtomicIntegerFieldUpdaterã€AtomicLongFieldUpdaterã€ AtomicReferenceFieldUpdater</code></li><li>åŸå­ç±»å‹ç´¯åŠ å™¨(jdk1.8è¿‡åå‡ºæ¥çš„)ï¼š<code>DoubleAccumulatorã€DoubleAdderã€ LongAccumulatorã€LongAdderã€Striped64</code></li></ul><h3 id="åŸå­æ›´æ–°åŸºæœ¬æ•°æ®"><a class="header-anchor" href="#åŸå­æ›´æ–°åŸºæœ¬æ•°æ®">Â¶</a>åŸå­æ›´æ–°åŸºæœ¬æ•°æ®</h3><p>ä»¥<code>AtomicInteger</code>æ€»ç»“ä¸‹å¸¸ç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ä»¥åŸå­çš„æ–¹å¼å°†å®ä¾‹ä¸­çš„åŸå€¼åŠ 1ï¼Œè¿”å›çš„æ˜¯è‡ªå¢å‰çš„æ—§å€¼ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getAndSet(int newValue)ï¼šå°†å®ä¾‹ä¸­çš„å€¼æ›´æ–°ä¸ºæ–°å€¼ï¼Œå¹¶è¿”å›æ—§å€¼ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">getAndSet</span><span class="params">(<span class="type">boolean</span> newValue)</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> prev;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        prev = get();</span><br><span class="line">    &#125; <span class="keyword">while</span> (!compareAndSet(prev, newValue));</span><br><span class="line">    <span class="keyword">return</span> prev;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//incrementAndGet() ï¼šä»¥åŸå­çš„æ–¹å¼å°†å®ä¾‹ä¸­çš„åŸå€¼è¿›è¡ŒåŠ 1æ“ä½œï¼Œå¹¶è¿”å›æœ€ç»ˆç›¸åŠ åçš„ç»“æœï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">incrementAndGet</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//addAndGet(int delta) ï¼šä»¥åŸå­æ–¹å¼å°†è¾“å…¥çš„æ•°å€¼ä¸å®ä¾‹ä¸­åŸæœ¬çš„å€¼ç›¸åŠ ï¼Œå¹¶è¿”å›æœ€åçš„ç»“æœï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">int</span> delta)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> unsafe.getAndAddInt(<span class="built_in">this</span>, valueOffset, delta) + delta;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä¸€ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;<span class="comment">// åŸå­è‡ªå¢ CAS</span></span><br><span class="line">                    sum.incrementAndGet();</span><br><span class="line">                    <span class="comment">//TODO</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            thread.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(sum.get());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œå®Œè¿‡åï¼Œå€¼ä¸º10000çš„ç»“æœå‘ˆç°åœ¨é¢å‰â€¦â€¦</p><blockquote><p><code>incrementAndGet()</code>æ–¹æ³•é€šè¿‡CASè‡ªå¢å®ç°ï¼Œå¦‚æœCASå¤±è´¥ï¼Œè‡ªæ—‹ç›´åˆ°æˆåŠŸ+1ã€‚</p></blockquote><h3 id="åŸå­æ›´æ–°æ•°ç»„ç±»å‹"><a class="header-anchor" href="#åŸå­æ›´æ–°æ•°ç»„ç±»å‹">Â¶</a>åŸå­æ›´æ–°æ•°ç»„ç±»å‹</h3><p>ä»¥<code>AtomicIntegerArray</code>ä¸ºä¾‹æ€»ç»“å¸¸ç”¨çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//addAndGet(int i, int delta)ï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼å°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„å…ƒç´ ä¸è¾“å…¥å€¼ç›¸åŠ ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">addAndGet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> delta)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getAndAdd(i, delta) + delta;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//getAndIncrement(int i)ï¼šä»¥åŸå­æ›´æ–°çš„æ–¹å¼å°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„å…ƒç´ è‡ªå¢åŠ 1ï¼›</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">int</span> <span class="title function_">getAndIncrement</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getAndAdd(i, <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//compareAndSet(int i, int expect, int update)ï¼šå°†æ•°ç»„ä¸­ç´¢å¼•ä¸ºiçš„ä½ç½®çš„å…ƒç´ è¿›è¡Œæ›´</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">compareAndSet</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> expect, <span class="type">int</span> update)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> compareAndSetRaw(checkedByteOffset(i), expect, update);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ä¸€ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é¦–å…ˆåˆ›å»ºæ•°ç»„</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span>[] value = <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line"><span class="comment">//å°†å…¶æ”¾åœ¨AtomicIntegerArrayæ„é€ å™¨ä¸­</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">AtomicIntegerArray</span> <span class="variable">atomicIntegerArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicIntegerArray</span>(value);</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="comment">//è®¾ç½®ç´¢å¼•0çš„å…ƒç´ ä¸º100</span></span><br><span class="line">    atomicIntegerArray.set(<span class="number">0</span>, <span class="number">100</span>);</span><br><span class="line">    System.out.println(atomicIntegerArray.get(<span class="number">0</span>));</span><br><span class="line">    <span class="comment">//ä»¥åŸå­æ›´æ–°çš„æ–¹å¼å°†æ•°ç»„ä¸­ç´¢å¼•ä¸º1çš„å…ƒç´ ä¸è¾“å…¥å€¼ç›¸åŠ </span></span><br><span class="line">    atomicIntegerArray.getAndAdd(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">    System.out.println(atomicIntegerArray);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°è¾“å‡ºç»“æœ</p><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">100</span><br><span class="line">[100, 7, 3, 4, 5]</span><br></pre></td></tr></table></figure><h3 id="åŸå­æ›´æ–°å¼•ç”¨ç±»å‹"><a class="header-anchor" href="#åŸå­æ›´æ–°å¼•ç”¨ç±»å‹">Â¶</a>åŸå­æ›´æ–°å¼•ç”¨ç±»å‹</h3><p><code>AtomicReference</code>ä½œç”¨æ˜¯å¯¹æ™®é€šå¯¹è±¡çš„å°è£…ï¼Œä»–å¯ä»¥ä¿è¯ä½ åœ¨ä¿®æ”¹å¯¹è±¡æ—¶çš„çº¿ç¨‹å®‰å…¨æ€§</p><p><strong>æµ‹è¯•ä¸€ä¸‹</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;å¼ ä¸‰&quot;</span>, <span class="number">23</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;æå››&quot;</span>, <span class="number">25</span>);</span><br><span class="line">    <span class="type">User</span> <span class="variable">user3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;ç‹äº”&quot;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–ä¸º user1</span></span><br><span class="line">    AtomicReference&lt;User&gt; atomicReference = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;();</span><br><span class="line">    atomicReference.set(user1);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŠŠ user2 èµ‹ç»™ atomicReference</span></span><br><span class="line">    atomicReference.compareAndSet(user1, user2);</span><br><span class="line">    System.out.println(atomicReference.get());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŠŠ user3 èµ‹ç»™ atomicReference</span></span><br><span class="line">    atomicReference.compareAndSet(user1, user3);</span><br><span class="line">    System.out.println(atomicReference.get());</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User&#123;name=<span class="string">&#x27;æå››&#x27;</span>, age=<span class="number">25</span>&#125;</span><br><span class="line">User&#123;name=<span class="string">&#x27;æå››&#x27;</span>, age=<span class="number">25</span>&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹è±¡å±æ€§åŸå­ä¿®æ”¹å™¨"><a class="header-anchor" href="#å¯¹è±¡å±æ€§åŸå­ä¿®æ”¹å™¨">Â¶</a>å¯¹è±¡å±æ€§åŸå­ä¿®æ”¹å™¨</h3><p><code>AtomicIntegerFieldUpdater</code>å¯ä»¥çº¿ç¨‹å®‰å…¨åœ°æ›´æ–°å¯¹è±¡ä¸­çš„æ•´å½¢å˜é‡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicIntegerFieldUpdaterTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Candidate</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">volatile</span> <span class="type">int</span> <span class="variable">score</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">AtomicInteger</span> <span class="variable">score2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicIntegerFieldUpdater&lt;Candidate&gt; scoreUpdater =</span><br><span class="line">            AtomicIntegerFieldUpdater.newUpdater(Candidate.class, <span class="string">&quot;score&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">realScore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">final</span> <span class="type">Candidate</span> <span class="variable">candidate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Candidate</span>();</span><br><span class="line"></span><br><span class="line">        Thread[] t = <span class="keyword">new</span> <span class="title class_">Thread</span>[<span class="number">10000</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            t[i] = <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (Math.random() &gt; <span class="number">0.4</span>) &#123;</span><br><span class="line">                        candidate.score2.incrementAndGet();</span><br><span class="line">                        scoreUpdater.incrementAndGet(candidate);</span><br><span class="line">                        realScore.incrementAndGet();</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            t[i].start();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">            t[i].join();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;AtomicIntegerFieldUpdater Score=&quot;</span> + candidate.score);</span><br><span class="line">        System.out.println(<span class="string">&quot;AtomicInteger Score=&quot;</span> + candidate.score2.get());</span><br><span class="line">        System.out.println(<span class="string">&quot;realScore=&quot;</span> + realScore.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äº <code>AtomicIntegerFieldUPdater</code>çš„ä½¿ç”¨ç¨å¾®æœ‰ä¸€äº›é™åˆ¶å’Œçº¦æŸï¼š</p><ol><li>å­—æ®µå¿…é¡»æ˜¯volatileç±»å‹çš„ï¼Œåœ¨çº¿ç¨‹ä¹‹é—´å…±äº«å˜é‡æ—¶ä¿è¯ç«‹å³å¯è§</li><li>å­—æ®µçš„æè¿°ç±»å‹(ä¿®é¥°ç¬¦public/protect/default/private)ä¸è°ƒç”¨è€…ä¸æ“ä½œå¯¹è±¡å­—æ®µçš„å…³ç³»ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨è€…èƒ½å¤Ÿç›´æ¥æ“ä½œå¯¹è±¡å­—æ®µï¼Œé‚£ä¹ˆå°±å¯ä»¥åå°„è¿›è¡ŒåŸå­æ“ä½œã€‚ä½†æ˜¯å¯¹äºçˆ¶ç±»çš„å­—æ®µï¼Œå­ç±»æ˜¯ä¸èƒ½ç›´æ¥æ“ä½œçš„ï¼Œå°½ç®¡å­ç±»å¯ä»¥è®¿é—®çˆ¶ç±»çš„å­—æ®µ</li><li>åªèƒ½æ˜¯å®ä¾‹å˜é‡ï¼Œä¸èƒ½æ˜¯ç±»å˜é‡ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸èƒ½åŠ <code>static</code>å…³é”®å­—</li><li>åªèƒ½æ˜¯å¯ä¿®æ”¹å˜é‡ï¼Œä¸èƒ½æ˜¯<code>final</code>å˜é‡ï¼Œå› ä¸º<code>final</code>çš„è¯­ä¹‰å°±æ˜¯ä¸å¯ä¿®æ”¹ã€‚å®é™…ä¸Š<code>final</code>çš„è¯­ä¹‰å’Œ<code>volatile</code>æ˜¯æœ‰å†²çªçš„ï¼Œè¿™ä¸¤ä¸ªå…³é”®å­—ä¸èƒ½åŒæ—¶å­˜åœ¨ã€‚</li><li>å¯¹äº<code>AtomicIntegerFieldUpdatert</code>å’Œ<code>AtomicLongFIeldUpdater</code>åªèƒ½ä¿®æ”¹int/longç±»å‹å­—æ®µï¼Œä¸èƒ½ä¿®æ”¹å™¨åŒ…è£…ç±»å‹(Integer/Long)ã€‚å¦‚æœè¦ä¿®æ”¹åŒ…è£…ç±»å‹å°±éœ€è¦ä½¿ç”¨<code>AtomicReferenceFieldUpdater</code></li></ol><blockquote><p><code>LongAdder</code>è¿˜æ²¡ç ”ç©¶ï¼Œç­‰ä»¥åæœ‰æ—¶é—´äº†æ¥å†ç ”ç©¶(ğŸ’©)</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> TODO-LIST </category>
          
          <category> CAS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TODO-LIST </tag>
            
            <tag> CAS </tag>
            
            <tag> åŸå­ç±»æ“ä½œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JMMä¸å¹¶å‘ä¸‰å¤§ç‰¹æ€§</title>
      <link href="/2022/12/12/JMM%E4%B8%8E%E5%B9%B6%E5%8F%91%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7/"/>
      <url>/2022/12/12/JMM%E4%B8%8E%E5%B9%B6%E5%8F%91%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7/</url>
      
        <content type="html"><![CDATA[<h2 id="å¹¶å‘å’Œå¹¶è¡Œ"><a class="header-anchor" href="#å¹¶å‘å’Œå¹¶è¡Œ">Â¶</a>å¹¶å‘å’Œå¹¶è¡Œ</h2><p>è¿™ä¸¤ç§åŠ¨ä½œçš„ç›®æ ‡æ€»çš„æ¥è¯´å°±æ˜¯</p><blockquote><p>æœ€å¤§åŒ–CPUçš„ä½¿ç”¨ç‡</p></blockquote><h3 id="å¹¶è¡Œ"><a class="header-anchor" href="#å¹¶è¡Œ">Â¶</a>å¹¶è¡Œ</h3><p>å¹¶è¡ŒæŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶åˆ»ï¼Œæœ‰<strong>å¤šæ¡æŒ‡ä»¤</strong>åœ¨<strong>å¤šä¸ªå¤„ç†å™¨</strong>ä¸ŠåŒæ—¶æ‰§è¡Œï¼Œæ‰€ä»¥æ— è®ºæ˜¯åœ¨å®è§‚è¿˜æ˜¯åœ¨å¾®è§‚ä¸Šï¼Œä¸¤è€…éƒ½æ˜¯ä¸€èµ·æ‰§è¡Œçš„</p><h3 id="å¹¶å‘-Concurrency"><a class="header-anchor" href="#å¹¶å‘-Concurrency">Â¶</a>å¹¶å‘(Concurrency)</h3><p>å¹¶å‘æŒ‡çš„æ˜¯åœ¨åŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œï¼Œä½†å¤šä¸ªçº¿ç¨‹æŒ‡ä»¤è¢«è¿…é€Ÿçš„è½®æ¢æ‰§è¡Œï¼Œä½¿å¾—åœ¨å®è§‚ä¸Šå¥½åƒæ˜¯å…·æœ‰å¤šä¸ªè¿›ç¨‹åœ¨åŒæ—¶æ‰§è¡Œçš„æ•ˆæœï¼Œä½†æ˜¯åœ¨å¾®è§‚ä¸Šå¹¶ä¸æ˜¯å¤šä¸ªåœ¨åŒæ—¶æ‰§è¡Œï¼Œåªæ˜¯æ—¶é—´åˆ†æˆè‹¥å¹²æ®µï¼Œæ˜¯å¤šä¸ªè¿›ç¨‹å¿«é€Ÿäº¤æ›¿çš„æ‰§è¡Œ</p><hr><p>çœ‹çš„å‡ºï¼Œå¹¶è¡Œæ˜¯çœŸçš„æœ‰ä¸¤ä¸ªCPUåœ¨è·‘ï¼Œè€Œå¹¶å‘æ˜¯åªæœ‰ä¸€ä¸ªCPUåœ¨è·‘ï¼Œåªæ˜¯è·‘çš„è¿›ç¨‹åœ¨å¿«é€Ÿçš„äº¤æ›¿æ‰§è¡Œã€‚</p><p>å¹¶è¡Œåœ¨å¤šCPUç³»ç»Ÿä¸­å­˜åœ¨ï¼Œè€Œå¹¶å‘å¯ä»¥åœ¨å•å¤„ç†å™¨ç³»ç»Ÿå’Œå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­éƒ½å­˜åœ¨ã€‚</p><p>å¹¶å‘èƒ½å¤Ÿåœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­å­˜åœ¨æ˜¯å› ä¸ºå¹¶å‘æ˜¯å¹¶è¡Œçš„å‡è±¡ï¼Œå¹¶è¡Œè¦æ±‚ç¨‹åºèƒ½å¤ŸåŒæ—¶æ‰§è¡Œå¤šä¸ªæ“ä½œï¼Œè€Œå¹¶å‘åªæ˜¯è¦æ±‚ç¨‹åºå‡è£…åŒæ—¶åªæ‰§è¡Œå¤šä¸ªæ“ä½œ</p><h2 id="å¹¶å‘ä¸‰å¤§ç‰¹æ€§"><a class="header-anchor" href="#å¹¶å‘ä¸‰å¤§ç‰¹æ€§">Â¶</a>å¹¶å‘ä¸‰å¤§ç‰¹æ€§</h2><p>å¹¶å‘ç¼–ç¨‹Bugçš„æºå¤´ï¼šå¯è§æ€§ã€åŸå­æ€§ã€æœ‰åºæ€§</p><h3 id="å¯è§æ€§"><a class="header-anchor" href="#å¯è§æ€§">Â¶</a>å¯è§æ€§</h3><blockquote><p>å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†<strong>å…±äº«èµ„æº</strong>çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿçœ‹åˆ°ä¿®æ”¹çš„å€¼</p></blockquote><p>Javaå†…å­˜æ¨¡å‹ (<code>JMM</code>)æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥ä¼šä¸»å­˜ï¼Œåœ¨å˜é‡è¯»å–ä¹‹å‰ä»ä¸»å­˜åˆ·æ–°å˜é‡å€¼è¿™ç§ä¾èµ–ä¸»å­˜ä½œä¸ºä¼ é€’åª’ä»‹çš„æ–¹æ³•æ¥å®ç°å¯è§æ€§çš„</p><h4 id="å¦‚ä½•ä¿è¯å¯è§æ€§"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯å¯è§æ€§">Â¶</a>å¦‚ä½•ä¿è¯å¯è§æ€§</h4><ul><li>é€šè¿‡<code>volatile</code>å…³é”®å­—ä¿è¯å¯è§æ€§</li><li>é€šè¿‡å†…å­˜å±éšœä¿è¯å¯è§æ€§</li><li>é€šè¿‡<code>synchronized</code>å…³é”®å­—ä¿è¯å¯è§æ€§</li><li>é€šè¿‡Lockä¿è¯å¯è§æ€§</li><li>é€šè¿‡<code>final</code>å…³é”®å­—ä¿è¯å¯è§æ€§</li></ul><h3 id="æœ‰åºæ€§"><a class="header-anchor" href="#æœ‰åºæ€§">Â¶</a>æœ‰åºæ€§</h3><blockquote><p>å³ç¨‹åºæ‰§è¡Œä»£ç çš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</p></blockquote><p>ç”±äº<code>JVM</code>å­˜åœ¨<strong>æŒ‡ä»¤é‡æ’</strong>ï¼Œæ‰€ä»¥å­˜åœ¨æœ‰åºæ€§é—®é¢˜</p><h4 id="å¦‚ä½•ä¿è¯æœ‰åºæ€§"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯æœ‰åºæ€§">Â¶</a>å¦‚ä½•ä¿è¯æœ‰åºæ€§</h4><ul><li>é€šè¿‡<code>volatile</code>å…³é”®å­—ä¿è¯æœ‰åºæ€§</li><li>é€šè¿‡å†…å­˜å±éšœä¿è¯æœ‰åºæ€§</li><li>é€šè¿‡<code>synchronized</code>å…³é”®å­—ä¿è¯æœ‰åºæ€§</li><li>é€šè¿‡Lockä¿è¯æœ‰åºæ€§</li></ul><h3 id="åŸå­æ€§"><a class="header-anchor" href="#åŸå­æ€§">Â¶</a>åŸå­æ€§</h3><blockquote><p>ä¸€ä¸ªæˆ–å¤šä¸ªæ“ä½œ</p><p>è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œä¸”åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸èƒ½è¢«ä»»ä½•å…ƒç´ æ‰“æ–­</p><p>è¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œ</p><hr><p>æ¢¦å›å¼€å“¥â€¦â€¦(<strong>LBWNB(æ’•å¿ƒè£‚è‚º)</strong>)</p><p>ï¼šä¸€ä¸ªäººè°ˆæ‹çˆ±</p><p>ï¼šå‡ºè½¨çš„æ¬¡æ•°åªæœ‰</p><p>ï¼š0</p><p>ï¼šå’Œ</p><p>ï¼šN</p></blockquote><p>åœ¨Javaå½“ä¸­ï¼Œå¯¹åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡çš„è¯»å–å’Œèµ‹å€¼çš„æ“ä½œæ˜¯åŸå­æ€§æ“ä½œ(64ä½)ï¼Œå¦‚æœä¸é‡‡å–ä»»ä½•åŸå­æ€§ä¿éšœæªæ–½çš„è‡ªå¢æ“ä½œå¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œå­˜åœ¨åŸå­æ€§é—®é¢˜</p><h3 id="å¦‚ä½•ä¿è¯åŸå­æ€§"><a class="header-anchor" href="#å¦‚ä½•ä¿è¯åŸå­æ€§">Â¶</a>å¦‚ä½•ä¿è¯åŸå­æ€§</h3><ul><li>é€šè¿‡<code>synchronized</code>å…³é”®å­—ä¿è¯åŸå­æ€§</li><li>é€šè¿‡Lockä¿è¯åŸå­æ€§</li><li>é€šè¿‡CASä¿è¯åŸå­æ€§</li></ul><h2 id="Javaå†…å­˜æ¨¡å‹-JMM"><a class="header-anchor" href="#Javaå†…å­˜æ¨¡å‹-JMM">Â¶</a>Javaå†…å­˜æ¨¡å‹(JMM)</h2><blockquote><p>JVMè§„èŒƒå®šä¹‰äº†ä¸€ä¸ªJavaå†…å­˜æ¨¡å‹(Java Memory Model)ï¼Œå³JMMã€‚</p><p>ç”¨äºå±è”½æ‰å„ç§ç¡¬ä»¶çš„OSçš„å†…å­˜è®¿é—®å·®å¼‚ï¼Œä»¥è®©Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸‹éƒ½èƒ½è¾¾åˆ°ä¸€è‡´çš„å¹¶å‘æ•ˆæœï¼ŒJMMè§„èŒƒäº†JVMå’Œè®¡ç®—æœºå†…å­˜æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ï¼š</p><p>è§„å®šäº†ä¸€ä¸ªçº¿ç¨‹å¦‚ä½•ã€ä»¥åŠä½•æ—¶å¯ä»¥çœ‹åˆ°æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹è¿‡åçš„å…±äº«å˜é‡çš„å€¼ï¼Œä»¥åŠåœ¨å¿…é¡»æ—¶å¦‚ä½•åŒæ­¥çš„è®¿é—®å…±äº«å˜é‡</p></blockquote><p>è¿™é‡Œç»™å‡ºJMMçš„æ¨¡å‹å›¾</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221214091941422.png" alt="image-20221214091941422"></p><h3 id="å†…å­˜äº¤äº’æ“ä½œ"><a class="header-anchor" href="#å†…å­˜äº¤äº’æ“ä½œ">Â¶</a>å†…å­˜äº¤äº’æ“ä½œ</h3><p>å…³äº<strong>ä¸»å†…å­˜</strong>å’Œ<strong>å·¥ä½œå†…å­˜</strong>ä¹‹é—´çš„äº¤äº’åè®®ï¼Œå³ï¼š</p><ul><li>ä¸€ä¸ªå˜é‡å¦‚ä½•å­˜ä¸»å†…å­˜ä¸­æ‹·è´åˆ°å·¥ä½œå†…å­˜ã€</li><li>å¦‚ä½•ä»å·¥ä½œå†…å­˜åŒæ­¥åˆ°ä¸»å†…å­˜ä¹‹é—´çš„å®ç°ç»†èŠ‚</li></ul><p>JMMå®šä¹‰äº†å…«ç§æ“ä½œæ¥å®Œæˆï¼š</p><ul><li>lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çŠ¶æ€ã€‚</li><li>unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼ŒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚</li><li>readï¼ˆè¯»å–ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜å˜é‡ï¼ŒæŠŠä¸€ä¸ªå˜é‡å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„loadåŠ¨ä½œä½¿ç”¨</li><li>loadï¼ˆè½½å…¥ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„å˜é‡å€¼æ”¾å…¥å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</li><li>useï¼ˆä½¿ç”¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡å€¼ä¼ é€’ç»™æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦<strong>ä½¿ç”¨å˜é‡çš„å€¼</strong>çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li><li>assignï¼ˆèµ‹å€¼ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“æ¥æ”¶åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ª<strong>ç»™å˜é‡èµ‹å€¼</strong>çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li><li>storeï¼ˆå­˜å‚¨ï¼‰ï¼šä½œç”¨äºå·¥ä½œå†…å­˜çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿éšåçš„writeçš„æ“ä½œã€‚</li><li>writeï¼ˆå†™å…¥ï¼‰ï¼šä½œç”¨äºä¸»å†…å­˜çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚</li></ul><p>å°†ä¸Šå›¾æ”¹é€ ä¸€ä¸‹ï¼š</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221214092607126.png" alt="image-20221214092607126"></p><p>JVMè¿˜è§„å®šäº†ï¼Œå†æ‰§è¡Œä¸Šè¿°8ç§æ“ä½œçš„æ—¶å€™ï¼Œå¿…é¡»æ»¡è¶³ä¸€ä¸‹è§„åˆ™ï¼š</p><ul><li>å¦‚æœè¦æŠŠä¸€ä¸ªå˜é‡ä»ä¸»å†…å­˜ä¸­å¤åˆ¶åˆ°å·¥ä½œå†…å­˜ï¼Œå°±éœ€è¦æŒ‰é¡ºå¯»åœ°æ‰§è¡Œreadå’Œloadæ“ä½œï¼Œ å¦‚æœæŠŠå˜é‡ä»å·¥ä½œå†…å­˜ä¸­åŒæ­¥å›ä¸»å†…å­˜ä¸­ï¼Œå°±è¦æŒ‰é¡ºåºåœ°æ‰§è¡Œ<code>store</code>å’Œ<code>write</code>æ“ä½œã€‚ ä½†Javaå†…å­˜æ¨¡å‹åªè¦æ±‚ä¸Šè¿°æ“ä½œå¿…é¡»æŒ‰é¡ºåºæ‰§è¡Œï¼Œè€Œæ²¡æœ‰ä¿è¯å¿…é¡»æ˜¯è¿ç»­æ‰§è¡Œã€‚</li><li>ä¸å…è®¸<code>read</code>å’Œ<code>load</code>ã€<code>store</code>å’Œ<code>write</code>æ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹ä¸¢å¼ƒå®ƒçš„æœ€è¿‘<code>assign</code>çš„æ“ä½œï¼Œå³å˜é‡åœ¨å·¥ä½œå†…å­˜ä¸­æ”¹å˜äº†ä¹‹åå¿…é¡»åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ã€‚</li><li>ä¸å…è®¸ä¸€ä¸ªçº¿ç¨‹æ— åŸå› åœ°ï¼ˆæ²¡æœ‰å‘ç”Ÿè¿‡ä»»ä½•<code>assign</code>æ“ä½œï¼‰æŠŠæ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥å›ä¸»å†…å­˜ä¸­ã€‚</li><li>ä¸€ä¸ªæ–°çš„å˜é‡åªèƒ½åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸åœ¨å·¥ä½œå†…å­˜ä¸­ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–ï¼ˆ<code>load</code>æˆ–<code>assign</code>ï¼‰çš„å˜é‡ã€‚å³å°±æ˜¯å¯¹ä¸€ä¸ªå˜é‡å®æ–½<code>use</code>å’Œ<code>store</code>æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæ‰§è¡Œè¿‡ äº†<code>assign</code>å’Œ<code>load</code>æ“ä½œã€‚</li><li>ä¸€ä¸ªå˜é‡åœ¨åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€æ¡çº¿ç¨‹å¯¹å…¶è¿›è¡Œ<code>lock</code>æ“ä½œï¼Œä½†<code>lock</code>æ“ä½œå¯ä»¥è¢«åŒä¸€æ¡çº¿ç¨‹é‡å¤æ‰§è¡Œå¤šæ¬¡ï¼Œå¤šæ¬¡æ‰§è¡Œ<code>lock</code>åï¼Œåªæœ‰æ‰§è¡Œç›¸åŒæ¬¡æ•°çš„<code>unlock</code>æ“ä½œï¼Œå˜é‡æ‰ä¼šè¢«è§£é”ã€‚</li><li><code>lock</code>å’Œ<code>unlock</code>å¿…é¡»æˆå¯¹å‡ºç°</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ<code>lock</code>æ“ä½œï¼Œå°†ä¼šæ¸…ç©ºå·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ï¼Œåœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨ è¿™ä¸ªå˜é‡å‰éœ€è¦é‡æ–°æ‰§è¡Œloadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼</li><li>å¦‚æœä¸€ä¸ªå˜é‡äº‹å…ˆæ²¡æœ‰è¢«<code>lock</code>æ“ä½œé”å®šï¼Œåˆ™ä¸å…è®¸å¯¹å®ƒæ‰§è¡Œ<code>unlock</code>æ“ä½œï¼›ä¹Ÿä¸å…è®¸å»<code>unlock</code>ä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”å®šçš„å˜é‡ã€‚</li><li>å¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ<code>unlock</code>æ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥åˆ°ä¸»å†…å­˜ä¸­ï¼ˆæ‰§è¡Œstoreå’Œ writeæ“ä½œï¼‰ã€‚</li></ul><h2 id="volatile"><a class="header-anchor" href="#volatile">Â¶</a>volatile</h2><h3 id="volatileçš„ç‰¹æ€§"><a class="header-anchor" href="#volatileçš„ç‰¹æ€§">Â¶</a>volatileçš„ç‰¹æ€§</h3><ul><li>å¯è§æ€§ï¼šå¯¹äºä¸€ä¸ª<code>volatile</code>å˜è„¸çš„è¯»æ“ä½œï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°(ä»»æ„çº¿ç¨‹)å¯¹è¿™ä¸ª<code>volatile</code>å˜é‡æœ€åçš„å†™æ“ä½œ</li><li>åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ª<code>volatile</code>å˜é‡çš„è¯»/å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äºvolatile++è¿™ç§ç¬¦åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ï¼Œ<strong>(åŸºäºè¿™ç‚¹ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè®¤ä¸ºvolatileä¸å…·æœ‰åŸå­æ€§)</strong>ã€‚volatileä»…ä»…ä¿éšœå¯¹å•ä¸ªvolatileå˜é‡çš„è¯»/å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè€Œé”çš„äº’æ–¥æ‰§è¡Œhçš„ç‰¹æ€§å¯ä»¥ç¡®ä¿å¯¹æ•´ä¸ªä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§</li><li>æœ‰åºæ€§ï¼šå¯¹volatileä¿®é¥°çš„å˜é‡çš„è¯»å†™æ“ä½œå‰ååŠ ä¸Šå„ç§ç‰¹å®šçš„<strong>å†…å­˜å±éšœ</strong>æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’åºæ¥ä¿è¯æœ‰åºæ€§</li></ul><h3 id="volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰"><a class="header-anchor" href="#volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰">Â¶</a>volatileå†™-è¯»çš„å†…å­˜è¯­ä¹‰</h3><ul><li>å½“<strong>å†™</strong>ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„<strong>æœ¬åœ°å†…å­˜</strong>ä¸­çš„<strong>å…±äº«å˜é‡å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜</strong></li><li>å½“<strong>è¯»</strong>ä¸€ä¸ªvolatileå˜é‡æ—¶ï¼ŒJMMä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„<strong>æœ¬åœ°å†…å­˜</strong>ç½®ä¸º<strong>æ— æ•ˆ</strong>ï¼Œçº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡</li></ul><h3 id="volatileçš„å¯è§æ€§å®ç°"><a class="header-anchor" href="#volatileçš„å¯è§æ€§å®ç°">Â¶</a>volatileçš„å¯è§æ€§å®ç°</h3><p>volatileä¿®é¥°çš„å˜é‡çš„readã€loadã€useæ“ä½œå’Œassignã€storeã€writeæ“ä½œå¿…é¡»æ˜¯è¿ç»­çš„<br>å³ä¿®æ”¹åå¿…é¡»ç«‹å³åŒæ­¥å›ä¸»å†…å­˜ï¼Œä½¿ç”¨æ—¶å¿…é¡»ä»ä¸»å†…å­˜åˆ·æ–°ã€‚</p><p>ç”±æ­¤ä¿è¯volatileå˜é‡æ“ä½œå¯¹å¤šçº¿ç¨‹çš„å¯è§æ€§</p><h4 id="ç¡¬ä»¶å±‚é¢çš„å®ç°"><a class="header-anchor" href="#ç¡¬ä»¶å±‚é¢çš„å®ç°">Â¶</a>ç¡¬ä»¶å±‚é¢çš„å®ç°</h4><p>é€šè¿‡lockå‰ç¼€æŒ‡ä»¤ï¼Œvolatileå˜é‡çš„æ“ä½œä¼šé”å®šå˜é‡<strong>ç¼“å­˜è¡Œ</strong>åŒºåŸŸå¹¶å†™å›ä¸»å†…å­˜ï¼Œè¿™ä¸ªæ“ä½œè¢«ç§°ä¹‹ä¸ºï¼šâ€œç¼“å­˜é”å®šâ€ã€‚ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶ä¼šé˜»æ­¢åŒæ—¶ä¿®æ”¹è¢«ä¸¤ä¸ªä»¥ä¸Šå¤„ç†å™¨ç¼“å­˜çš„å†…å­˜åŒºåŸŸæ•°æ®ã€‚ä¸€ä¸ªå¤„ç†å™¨çš„ç¼“å­˜å›å†™åˆ°å†…å­˜ä¼šå¯¼è‡´å…¶ä»–å¤„ç†å™¨çš„ç¼“å­˜æ— æ•ˆ</p><h4 id="lockå‰ç¼€æŒ‡ä»¤çš„ä½œç”¨"><a class="header-anchor" href="#lockå‰ç¼€æŒ‡ä»¤çš„ä½œç”¨">Â¶</a>lockå‰ç¼€æŒ‡ä»¤çš„ä½œç”¨</h4><ol><li>ç¡®ä¿åç»­æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ã€‚åœ¨PentiumåŠå…¶ä¹‹å‰çš„å¤„ç†å™¨ä¸­ï¼Œå¸¦æœ‰lockå‰ç¼€çš„æŒ‡ä»¤åœ¨æ‰§è¡ŒæœŸé—´ä¼šé”ä½æ€»çº¿ï¼Œä½¿å¾—å…¶ä»–çº¿ç¨‹æ— æ³•å¯¹æ€»çº¿ç¨‹è¿›è¡Œè®¿é—®ï¼Œå¾ˆæ˜¾ç„¶è¿™æ ·åšçš„å¼€é”€ååˆ†å·¨å¤§ã€‚<br>åœ¨æ–°çš„å¤„ç†å™¨ä¸­ï¼ŒInterä½¿ç”¨ç¼“å­˜é”å®šæ¥ä¿è¯æŒ‡ä»¤æ‰§è¡Œçš„åŸå­æ€§ï¼Œç¼“å­˜é”å®šå°†å¤§å¤§åœ°å‡ä½äº†lockå‰ç¼€æŒ‡ä»¤çš„æ‰§è¡Œå¼€é”€ã€‚å› ä¸ºï¼Œä¸é”ä½æ€»çº¿ä¸åŒï¼Œç¼“å­˜é”å®šåªæ˜¯<strong>é”å®šå˜é‡ç¼“å­˜è¡ŒåŒºåŸŸ</strong>â€¦â€¦</li><li>lockå‰ç¼€æŒ‡ä»¤å…·æœ‰ç±»ä¼¼äºå†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œç¦æ­¢æŒ‡ä»¤ä¸å‰é¢å’Œåé¢çš„è¯»å†™æŒ‡ä»¤é‡æ’åº(æŒ‡ä»¤é‡æ’)</li><li>lockå‰ç¼€æŒ‡ä»¤ä¼šç­‰å¾…ä»–ä¹‹å‰æ‰€æœ‰çš„æŒ‡ä»¤å®Œæˆã€å¹¶ä¸”æ‰€æœ‰ç¼“å†²çš„çš„å†™æ“ä½œå†™å›å†…å­˜(ä¹Ÿå°±æ˜¯å°†store bufferä¸­çš„å†…å®¹å†™å…¥å†…å­˜)ä¹‹åæ‰å¼€å§‹æ‰§è¡Œï¼Œå¹¶ä¸”æ ¹æ®ç¼“å­˜ä¸€è‡´æ€§åè®®ï¼Œåˆ·æ–°store bufferçš„æ“ä½œä¼šå¯¼è‡´å…¶ä»–cacheä¸­çš„å‰¯æœ¬å¤±æ•ˆ</li></ol><blockquote><p>è¿™é‡Œçš„lockå‰ç¼€æŒ‡ä»¤ï¼š</p><p><a href="https://www.cnblogs.com/sunddenly/articles/14829255.html">LockæŒ‡ä»¤ä½œç”¨</a></p><p><a href="https://www.jianshu.com/p/2171e180bdbd">LockæŒ‡ä»¤å‰ç¼€</a></p></blockquote><h2 id="æŒ‡ä»¤é‡æ’åº"><a class="header-anchor" href="#æŒ‡ä»¤é‡æ’åº">Â¶</a>æŒ‡ä»¤é‡æ’åº</h2><blockquote><p>Javaè¯­è¨€è§„èŒƒè§„å®š<code>JVMçº¿ç¨‹å†…éƒ¨ç»´æŒé¡ºåºåŒ–è¯­ä¹‰</code>(ä»€ä¹ˆé€†å¤©å‘½å)<br>å³ï¼Œåªè¦ç¨‹åºçš„æœ€ç»ˆç»“æœä¸å®ƒé¡ºåºè¯æƒ…å†µçš„ç»“æœç›¸ç­‰ï¼Œé‚£ä¹ˆæŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºå¯ä¸ä»£ç é¡ºåºä¸ä¸€è‡´ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åšæŒ‡ä»¤çš„é‡æ’åºâ€”â€”ä¹Ÿå«æŒ‡ä»¤é‡æ’</p></blockquote><p>æŒ‡ä»¤é‡æ’çš„æ„ä¹‰ï¼š</p><blockquote><p>JVMèƒ½æ ¹æ®å¤„ç†å™¨çš„ç‰¹æ€§(CPUå¤šçº§ç¼“å­˜ç³»ç»Ÿã€å¤šæ ¸å¤„ç†å™¨â€¦â€¦)é€‚å½“çš„å¯¹æœºå™¨æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œæ˜¯çš„æœºå™¨æŒ‡ä»¤èƒ½æ›´ç¬¦åˆCPUçš„æ‰§è¡Œç‰¹æ€§ï¼Œæœ€å¤§é™åº¦çš„å‘æŒ¥æœºå™¨æ€§èƒ½ã€‚</p><p>åœ¨ç¼–è¯‘å™¨ä¸CPUå¤„ç†å™¨ä¸­éƒ½èƒ½æ‰§è¡ŒæŒ‡ä»¤é‡æ’ä¼˜åŒ–</p><p>å³ä¸‹å›¾</p></blockquote><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221214192330065.png" alt="image-20221214192330065"></p><h3 id="volatileæŒ‡ä»¤é‡æ’è§„åˆ™"><a class="header-anchor" href="#volatileæŒ‡ä»¤é‡æ’è§„åˆ™">Â¶</a>volatileæŒ‡ä»¤é‡æ’è§„åˆ™</h3><table><thead><tr><th>æ˜¯å¦èƒ½é‡æ’åº</th><th>ç¬¬äºŒä¸ªæ“ä½œ</th><th></th><th></th></tr></thead><tbody><tr><td>ç¬¬ä¸€ä¸ªæ“ä½œ</td><td>æ™®é€šè¯»/å†™</td><td>volatileè¯»</td><td>volatileå†™</td></tr><tr><td>æ™®é€šè¯»/å†™</td><td></td><td></td><td>NO</td></tr><tr><td>volatileè¯»</td><td>NO</td><td>NO</td><td>NO</td></tr><tr><td>volatileå†™</td><td></td><td>NO</td><td>NO</td></tr></tbody></table><p>volatileç¦æ­¢æŒ‡ä»¤é‡åºçš„åœºæ™¯ï¼š</p><ol><li>ç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œéƒ½ä¸ä¼šå‡ºç°æŒ‡ä»¤é‡æ’</li><li>ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileè¯»ï¼Œéƒ½ä¸ä¼šå‡ºç°æŒ‡ä»¤é‡æ’</li><li>ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯volatileå†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯volatileè¯»ï¼Œä¸ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’</li></ol><p>æ€»ç»“ï¼š</p><p>è¿™æ¬¡å†™çš„å¾ˆå¤šä¸œè¥¿å…¶å®éƒ½æŒºæµ…çš„ï¼Œæ²¡æœ‰å‘å±•åˆ°æ±‡ç¼–å±‚é¢ï¼Œ(æœ‰æ²¡æœ‰å¯èƒ½æ˜¯è‡ªå·±éƒ½æ²¡æœ‰è®°ä½ğŸ’©)ï¼Œè¿˜æœ‰å†…å­˜å±éšœï¼ŒMESIâ€¦â€¦</p><p>ç­‰ä»¥åæ²‰æ·€å¤Ÿäº†å†æ¥è¡¥</p><p>è½ï¼š2022-12-14 19:34:45</p><blockquote><p>å¯ä»¥çœ‹çœ‹CoderWçš„è¿™ç¯‡æ–‡ç« ï¼š<a href="https://juejin.cn/post/7109464558783168526">å…³äºç¼“å­˜ä¸€è‡´æ€§åè®®ã€MESIã€StoreBufferã€InvalidateQueueã€å†…å­˜å±éšœã€LockæŒ‡ä»¤å’ŒJMMçš„é‚£ç‚¹äº‹</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> TODO-LIST </category>
          
          <category> å¹¶å‘ç¼–ç¨‹ </category>
          
          <category> å…«è‚¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TODO-LIST </tag>
            
            <tag> JMM </tag>
            
            <tag> å¹¶å‘ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WebFluxâ€”â€”å“åº”å¼ç¼–ç¨‹</title>
      <link href="/2022/12/10/WebFlux/"/>
      <url>/2022/12/10/WebFlux/</url>
      
        <content type="html"><![CDATA[<p>å“åº”å¼ç¼–ç¨‹æ‰“ç ´äº†ä¼ ç»Ÿçš„<strong>åŒæ­¥é˜»å¡å¼ç¼–ç¨‹æ¨¡å‹</strong>ï¼Œè€Œè¿™æ ·å¾€å¾€å¯¹æ€§èƒ½çš„æ¶ˆè€—æ˜¯è¿‡å¤§çš„ï¼ˆç›¸å¯¹æ¥è¯´å˜›ï¼‰ï¼Œä½†æ˜¯åŸºäº<strong>å“åº”å¼æ•°æ®æµ</strong>å’Œ<strong>èƒŒå‹æœºåˆ¶</strong>å®ç°äº†<strong>å¼‚æ­¥éé˜»å¡å¼</strong>çš„ç½‘ç»œé€šè®¯ã€æ•°æ®è®¿é—®å’Œäº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œèƒ½å‡è½»æœåŠ¡å™¨èµ„æºä¹‹é—´çš„ç«äº‰å…³ç³»ï¼Œä»è€Œæé«˜æœåŠ¡çš„å“åº”èƒ½åŠ›ã€‚</p><p>è¿™ä¹Ÿæ˜¯<strong>WebFlux</strong>â€”â€”Springå‡ºäº§çš„åŸºäºå“åº”å¼ç¼–ç¨‹çš„ä¸€å¥—<strong>åº”ç”¨ç¨‹åºæ¡†æ¶æ¨¡å‹</strong>ï¼Œçš„è¯ç”Ÿä¹‹é™…â€¦â€¦</p><h2 id="èƒŒå‹"><a class="header-anchor" href="#èƒŒå‹">Â¶</a>èƒŒå‹</h2><p>é¦–å…ˆå…ˆè®²è®²<strong>èƒŒå‹</strong></p><p>æˆ‘ä»¬æ˜ç¡®ï¼Œçº¯â€œæ¨â€çš„æ¨¡å¼ä¸‹ï¼Œæ•°æ®æµä¼šæœ‰å¾ˆå¤šä¸å¯æ§åˆ¶çš„å› ç´ ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®ç°æµé‡æ§åˆ¶ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒèƒŒå‹å°±å‡ºæ¥äº†</p><p>èƒŒå‹ï¼Œç®€å•æ¥è¯´å°±æ˜¯ä¸‹æ¸¸èƒ½å¤Ÿå‘ä¸Šæ¸¸åé¦ˆæµé‡è¯·æ±‚çš„æœºåˆ¶ã€‚å¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹æ•°æ®çš„é€Ÿåº¦ &lt; ç”Ÿäº§è€…ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦æ—¶ï¼Œä»–å°±ä¼šæŒç»­æ¶ˆè€—ç³»ç»Ÿçš„èµ„æºï¼ŒçŸ¥é“è¿™äº›èµ„æºè¢«æ¶ˆè€—æ®†å°½ã€‚è¿™é‡ŒæŒ‡çš„æ˜¯ç”Ÿäº§è€…æ¶ˆè€—èµ„æºã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ä¸€ç§æœºåˆ¶æ¥ä½¿å¾—æ¶ˆè´¹è€…å¯æ ¹æ®è‡ªèº«å½“å‰çš„å¤„ç†èƒ½åŠ›é€šçŸ¥ç”Ÿäº§è€…æ¥è°ƒæ•´ç”Ÿäº§æ•°æ®çš„é€Ÿåº¦ï¼Œè¿™ç§æœºåˆ¶å°±æ˜¯èƒŒå‹ã€‚</p><p>æ¶ˆè´¹è€…ä¼šæ ¹æ®è‡ªèº«çš„å¤„ç†èƒ½åŠ›æ¥è¯·æ±‚æ•°æ®ï¼Œè€Œç”Ÿäº§è€…ä¹Ÿä¼šä»¥æ ¹æ®æ¶ˆè´¹è€…çš„æ¶ˆè´¹é€Ÿåº¦æ¥ç”Ÿäº§æ•°æ®ï¼Œä»è€Œåœ¨ä¸¤è€…ä¹‹é—´è¾¾æˆä¸€ç§åŠ¨æ€çš„å¹³è¡¡ï¼Œç¡®ä¿ç³»ç»Ÿçš„åŠæ—¶å“åº”æ€§ã€‚</p><h2 id="åº”ç”¨åœºæ™¯"><a class="header-anchor" href="#åº”ç”¨åœºæ™¯">Â¶</a>åº”ç”¨åœºæ™¯</h2><p>æœ¬è´¨ä¸Šï¼Œå“åº”å¼ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹æŠ€æœ¯ï¼Œè¿˜æ›´æ˜¯ä¸€ç§æ¶æ„è®¾è®¡çš„ç³»ç»Ÿæ–¹æ³•ã€‚æ‰€ä»¥å¯ä»¥åº”ç”¨äºä»»ä½•åœ°æ–¹ï¼Œç®€å•çš„Webåº”ç”¨ç¨‹åºï¼Œå¤§å‹ä¼ä¸šçš„è§£å†³æ–¹æ¡ˆã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå®Œå…¨å¯ä»¥åŸºäºä»–æ¥æ„å»ºæµå¼ç³»ç»Ÿæˆ–è€…å¤§æ•°æ®ç³»ç»Ÿ</p><h3 id="Netflix-Hystrix-ä¸­çš„æ»‘åŠ¨çª—å£"><a class="header-anchor" href="#Netflix-Hystrix-ä¸­çš„æ»‘åŠ¨çª—å£">Â¶</a>Netflix Hystrix ä¸­çš„æ»‘åŠ¨çª—å£</h3><p>åœ¨Spring Cloudä¸­ï¼ŒHystrix æ˜¯å¥ˆé£çš„ä¸€ä¸ªå¼€æºå®¹é”™åº“ï¼Œä½¿ç”¨äº†<code>HystrixCircuitBreaker</code>è¿™ä¸ªç±»æ¥å®ç°ç†”æ–­å™¨ã€‚</p><p>è¿™ä¸ªç±»æ˜¯é€šè¿‡ä¸€ä¸ª<code>circuitOpen</code>çŠ¶æ€ä½æ¥æ§åˆ¶ç€æ•´ä¸ªç†”æ–­è¿‡ç¨‹ï¼Œè€Œè¿™ä¸ªçŠ¶æ€ä½æœ¬èº«çš„çŠ¶æ€å€¼åˆ™å–å†³äºç³»ç»Ÿç›®å‰çš„æ‰§è¡Œæ•°æ®å’Œå¥åº·æŒ‡æ ‡</p><p>é‚£ä¹ˆå¦‚ä½•æ¥å®ç°ç€æ»‘åŠ¨çª—å£å‘¢ï¼Ÿç³»ç»Ÿè¿è¡Œæ—¶çš„æ¯ä¸€ä¸ªæ•°æ®éƒ½è¢«è§†ä¸ºä¸€ä¸ªä¸ªçš„<code>event</code>ï¼Œæ»‘åŠ¨çª—å£ä¸­çš„æ¯ä¸€ä¸ªæ¡¶â€”â€”<code>Bucket</code> éƒ½æ¥è‡ªæºæºä¸æ–­çš„äº‹ä»¶ã€‚åœ¨æŠ€æœ¯å®ç°çš„é€‰å‹ä¸Šï¼ŒHystrix é‡‡ç”¨çš„åŸºäºå“åº”å¼ç¼–ç¨‹æ€æƒ³çš„<strong>RxJava</strong>ã€‚</p><p>â€¦â€¦</p><p>ä½œä¸ºæ€»ç»“ï¼ŒHystrixå·§å¦™çš„ä½¿ç”¨äº†RxJavaçš„ <code>window</code>ã€<code>flatMap</code> ç­‰æ“ä½œç¬¦æ¥å°†å•ä½çª—å£æ—¶é—´å†…çš„äº‹ä»¶ï¼Œä»¥åŠå°†ä¸€ä¸ªçª—å£å¤§å°å†…çš„<code>Bucket</code>èšé›†åˆ°ä¸€èµ·å½¢æˆæ»‘åŠ¨çª—å£ï¼Œå¹¶åŸºäºæ»‘åŠ¨çª—å£ç»§æ‰¿æŒ‡æ ‡æ•°æ®ï¼Œ</p><h2 id="Flux-Mono"><a class="header-anchor" href="#Flux-Mono">Â¶</a>Flux &amp; Mono</h2><p><img src="https://img-blog.csdnimg.cn/3570da1e74d0443cb298fc0df5f824ec.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3loal85MTE=,size_16,color_FFFFFF,t_70" alt=""></p><blockquote><p>Flux æ˜¯ä¸€ä¸ªå‘å‡º(emit)0-Nä¸ªå…ƒç´ ç»„æˆçš„å¼‚æ­¥åºåˆ—çš„Publisher<T>,å¯ä»¥è¢«onCompleteä¿¡å·æˆ–è€…onErrorä¿¡å·æ‰€ç»ˆæ­¢ã€‚åœ¨å“åº”æµè§„èŒƒä¸­å­˜åœ¨ä¸‰ç§ç»™ä¸‹æ¸¸æ¶ˆè´¹è€…è°ƒç”¨çš„æ–¹æ³• onNext, onComplete, å’ŒonErrorã€‚</p><p>Mono æ˜¯ä¸€ä¸ªå‘å‡º(emit)0-1ä¸ªå…ƒç´ çš„Publisher<T>,å¯ä»¥è¢«onCompleteä¿¡å·æˆ–è€…onErrorä¿¡å·æ‰€ç»ˆæ­¢ã€‚<br>è¿™é‡Œå°±ä¸ç¿»è¯‘äº†ï¼Œæ•´ä½“å’ŒFluxå·®ä¸å¤šï¼Œåªä¸è¿‡è¿™é‡Œåªä¼šå‘å‡º0-1ä¸ªå…ƒç´ ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸æ˜¯æœ‰å°±æ˜¯æ²¡æœ‰ã€‚</p></blockquote><p>Fluxå’ŒMonoæ˜¯Javaå“åº”å¼ä¸­çš„é‡è¦æ¦‚å¿µï¼Œè¿™å…¶å®æ˜¯è§„å®šäº†ä¸¤ç§æµå¼èŒƒå¼ï¼Œè¿™ç§èŒƒå¼è®©æ•°æ®å…·æœ‰ä¸€äº›æ–°çš„ç‰¹æ€§ï¼Œæ¯”å¦‚åŸºäºå‘å¸ƒè®¢é˜…çš„äº‹ä»¶é©±åŠ¨ï¼Œå¼‚æ­¥æµã€èƒŒå‹ç­‰ç­‰ã€‚å¦å¤–æ•°æ®æ˜¯æ¨é€ï¼ˆPushï¼‰ç»™æ¶ˆè´¹è€…çš„ä»¥åŒºåˆ«äºå¹³æ—¶æˆ‘ä»¬çš„æ‹‰ï¼ˆPullï¼‰æ¨¡å¼ã€‚åŒæ—¶æˆ‘ä»¬å¯ä»¥åƒStream Apiä¸€æ ·ä½¿ç”¨ç±»ä¼¼mapã€flatmapç­‰æ“ä½œç¬¦ï¼ˆoperatorï¼‰æ¥æ“ä½œå®ƒä»¬ã€‚</p><h3 id="åˆ›å»ºFlux-Mono"><a class="header-anchor" href="#åˆ›å»ºFlux-Mono">Â¶</a>åˆ›å»ºFlux&amp;Mono</h3><blockquote><p>2022-12-10 22:23:21 å…ˆrunï¼Œç­‰æ˜å¤©èµ·æ¥å†å†™(æ˜å¤©æ¡Œå­å’Œé¼ æ ‡å«å°±åˆ°äº†ï¼Œåˆ°æ—¶å€™ç›´æ¥åŸåœ°èµ·é£ğŸš€)</p></blockquote><blockquote><p>2022-12-11 08:26:25 èµ·æ¥äº†ï¼Œåæ¶ˆæ¯ï¼Œä»Šå¤©æ¡Œå­å¾ˆæœ‰å¯èƒ½åˆ°ä¸äº†ã€‚ï¼ˆä»¥åä¹°ä¸œè¥¿æ­»éƒ½ä¸ä¹°å—äº¬å‘è´§çš„çš„äº†ï¼‰</p></blockquote><p>è¿™é‡Œåˆ†ä¸ºé™æ€ä»¥åŠåŠ¨æ€åˆ›å»º</p><h4 id="é™æ€åˆ›å»º"><a class="header-anchor" href="#é™æ€åˆ›å»º">Â¶</a>é™æ€åˆ›å»º</h4><p>é™æ€åˆ›å»ºFluxå’ŒMonoçš„æ–¹å¼éƒ½æ˜¯ä¸€æ ·çš„</p><h5 id="just"><a class="header-anchor" href="#just">Â¶</a>just</h5><p><strong>Flux</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.just(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line"><span class="comment">//è§‚å¯Ÿè€…ç›‘å¬è¢«è§‚å¯Ÿè€…(æ¶ˆè´¹è€…)</span></span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨å¯å˜å‚æ•°åˆ›å»ºFlux</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨juståˆ›å»ºMono</span></span><br><span class="line">Mono.just(<span class="string">&quot;1s&quot;</span>)</span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"> Mono.just(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line">.subscribe(System.out::println);</span><br></pre></td></tr></table></figure><p><strong>Mono</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.just(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line"><span class="comment">//è§‚å¯Ÿè€…ç›‘å¬è¢«è§‚å¯Ÿè€…(æ¶ˆè´¹è€…)</span></span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨å¯å˜å‚æ•°åˆ›å»ºFlux</span></span><br><span class="line">Flux.just(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä½¿ç”¨juståˆ›å»ºMono</span></span><br><span class="line">Mono.just(<span class="string">&quot;1s&quot;</span>)</span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"> Mono.just(<span class="keyword">new</span> <span class="title class_">Integer</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line">.subscribe(System.out::println);</span><br></pre></td></tr></table></figure><p>åƒè¿™æ ·ä½¿ç”¨<code>just</code>é™æ€åˆ›å»ºFluxå’ŒMonoï¼Œå‰æéœ€è¦çŸ¥é“å†…å®¹å’Œå¤§å°çš„æ•°æ®</p><h5 id="fromIterable"><a class="header-anchor" href="#fromIterable">Â¶</a>fromIterable</h5><p>ä½¿ç”¨fromIteratbleä»å¯è¿­ä»£å¯¹è±¡ä¸­åˆ›å»ºFlux</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="comment">//ä»å¯è¿­ä»£çš„å¯¹è±¡ä¸­åˆ›å»ºFlux</span></span><br><span class="line">Flux.fromIterable(Arrays.asList(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">.subscribe(System.out::println);</span><br><span class="line"></span><br><span class="line">ArrayList&lt;Integer&gt; list = Lists.newArrayList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">Flux&lt;Integer&gt; flux = Flux.fromIterable(list);</span><br><span class="line"><span class="comment">//åœ¨åˆ›å»ºFluxåè¿½åŠ å…ƒç´ </span></span><br><span class="line">list.add(<span class="number">5</span>);</span><br><span class="line">flux.subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h5 id="fromStream"><a class="header-anchor" href="#fromStream">Â¶</a>fromStream</h5><p>ä½¿ç”¨fromStreamä»é›†åˆæµä¸­åˆ›å»ºFlux</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.fromStream(Stream.of(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>))</span><br><span class="line">               .subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h5 id="range"><a class="header-anchor" href="#range">Â¶</a>range</h5><p>åˆ›å»ºä¸€ä¸ªèŒƒå›´å†…è¿­ä»£çš„Flux</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.range(<span class="number">0</span>,<span class="number">10</span>)</span><br><span class="line">.subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h4 id="åŠ¨æ€åˆ›å»º"><a class="header-anchor" href="#åŠ¨æ€åˆ›å»º">Â¶</a>åŠ¨æ€åˆ›å»º</h4><p>åŠ¨æ€åˆ›å»ºæœ‰æ—¶å€™æ›´å®¹æ˜“æ»¡è¶³æˆ‘ä»¬å‘å¼€æ—¶çš„éœ€æ±‚</p><h5 id="generate"><a class="header-anchor" href="#generate">Â¶</a>generate</h5><p><code>generate()</code>æ–¹æ³•ç”ŸæˆFluxåºåˆ—ä¾èµ–äºReactoræ‰€æä¾›çš„<code>SynchronousSink</code>ç»„ä»¶ï¼Œä»–çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Flux&lt;T&gt; <span class="title function_">generate</span><span class="params">(Consumer&lt;SynchronousSink&lt;T&gt;&gt; generator)</span></span><br></pre></td></tr></table></figure><p><code>SynchronousSink</code>ç»„ä»¶ï¼Œçœ‹åå­—å°±èƒ½çŸ¥é“ä»–æ˜¯ä¸€ä¸ªåŒæ­¥çš„Sinkç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯è¯´å…ƒç´ çš„ç”Ÿæˆè¿‡ç¨‹æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚</p><p>è¿™ä¸ªç»„ä»¶åŒ…æ‹¬ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š</p><ol><li><code>next()</code></li><li><code>complete()</code></li><li><code>error()</code></li></ol><p>ä½¿ç”¨<code>generate()</code>æ–¹æ³•åˆ›å»ºFluxçš„å®ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// åŒæ­¥åŠ¨æ€åˆ›å»ºï¼Œ next() æ–¹æ³•åªèƒ½æœ€å¤šè¢«è°ƒç”¨ä¸€æ¬¡</span></span><br><span class="line">Flux.generate(sink -&gt; &#123;</span><br><span class="line">sink.next(<span class="string">&quot;1&quot;</span>);</span><br><span class="line"><span class="comment">//ç¬¬äºŒæ¬¡ä¼šæŠ¥é”™:</span></span><br><span class="line"><span class="comment">//java.lang.IllegalStateException: More than one call to onNext</span></span><br><span class="line"><span class="comment">//sink.next(&quot;2&quot;);</span></span><br><span class="line"><span class="comment">//å¦‚æœä¸è°ƒç”¨ complete() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±ä¼šç”Ÿæˆä¸€ä¸ªæ‰€æœ‰å…ƒç´ å‡ä¸ºâ€œ1â€çš„æ— ç•Œæ•°æ®æµ</span></span><br><span class="line">sink.complete();</span><br><span class="line">&#125;).subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h5 id="create"><a class="header-anchor" href="#create">Â¶</a>create</h5><p><code>create()</code>æ–¹æ³•å’Œ<code>generate()</code>æ˜¯æ–¹æ³•æ¯”è¾ƒç±»ä¼¼ï¼Œä½†æ˜¯ä»–ä½¿ç”¨çš„æ˜¯ä¸€ä¸ª<code>FluxSink</code>ç»„ä»¶ï¼Œä»–çš„å®šä¹‰ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Flux&lt;T&gt; <span class="title function_">create</span><span class="params">(Consumer&lt;? <span class="built_in">super</span> FluxSink&lt;T&gt;&gt; emitter)</span></span><br></pre></td></tr></table></figure><p>ä¸<code>generate()</code>ä¸åŒçš„æ˜¯ï¼Œ<code>create()</code>æ–¹æ³•å®šä¹‰äº†æˆ‘ä»¬ä¸Šé¢æ‰€è®²åˆ°çš„èƒŒå‹æœºåˆ¶ï¼Œå¹¶ä¸”ä¸€æ¬¡è°ƒç”¨å¯ä»¥äº§ç”Ÿå¤šä¸ªå…ƒç´ ã€‚ä½¿ç”¨å®ƒåˆ›å»ºFluxçš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.create(sink -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">                sink.next(<span class="string">&quot;Tang&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">            sink.complete();</span><br><span class="line">&#125;).subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h3 id="æ“ä½œç¬¦"><a class="header-anchor" href="#æ“ä½œç¬¦">Â¶</a>æ“ä½œç¬¦</h3><p>è¿™é‡Œåªåˆ—ä¸¾å‡ºä¸€äº›ç®€å•å¸¸ç”¨çš„æ“ä½œç¬¦ï¼ŒåŒ…æ‹¬<code>buffer</code>ï¼Œ<code>window</code>ï¼Œ<code>take</code>â€¦â€¦</p><h4 id="buffer"><a class="header-anchor" href="#buffer">Â¶</a>buffer</h4><p><code>buffer</code>ä»¥åŠå…¶ç›¸å…³çš„æ“ä½œç¬¦éƒ½æ˜¯å°†å½“å‰æµä¸­çš„å…ƒç´ æ”¶é›†åˆ°é›†åˆä¸­ï¼Œå¹¶æŠŠé›†åˆå¯¹è±¡ä½œä¸ºæµä¸­çš„æ–°å…ƒç´ ã€‚buffer ç›¸å…³æ“ä½œç¬¦çš„ä½¿ç”¨ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).buffer(<span class="number">20</span>).subscribe(System.out::println);</span><br><span class="line">Flux.intervalMillis(<span class="number">100</span>).bufferMillis(<span class="number">1001</span>).take(<span class="number">2</span>).toStream().forEach(System.out::println);</span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).bufferUntil(i -&gt; i % <span class="number">2</span> == <span class="number">0</span>).subscribe(System.out::println);</span><br><span class="line">Flux.range(<span class="number">1</span>, <span class="number">10</span>).bufferWhile(i -&gt; i % <span class="number">2</span> == <span class="number">0</span>).subscribe(System.out::println);</span><br></pre></td></tr></table></figure><h4 id="filter"><a class="header-anchor" href="#filter">Â¶</a>filter</h4><p>å“åº”å¼æµä¸­çš„<code>filter</code>æ“ä½œç¬¦å’Œstreamæµä¸­çš„<code>filter</code>æ“ä½œç¬¦çš„ä½œç”¨ä»¥åŠä½¿ç”¨æ˜¯å·®ä¸å¤šç”šè‡³æ˜¯ä¸€æ ·çš„ï¼Œå°±ä¸åœ¨èµ˜è¿°äº†</p><h4 id="window"><a class="header-anchor" href="#window">Â¶</a>window</h4><p><code>window</code>æ“ä½œç¬¦çš„ä½œç”¨ç±»ä¼¼äº<code>buffer</code>ï¼Œæ‰€ä¸åŒçš„æ˜¯<code>window</code>æ“ä½œç¬¦æ˜¯å°†å½“å‰æµä¸­çš„å…ƒç´ æ”¶é›†åˆ°å¦å¤–çš„Fluxåºåˆ—æ±‡æ€»ï¼Œä¸€æ¬¡è¿”å›å€¼ç±»å‹æ˜¯<code>Flux&lt;Flux&gt;</code>ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.range(<span class="number">1</span>, <span class="number">100</span>).window(<span class="number">20</span>).subscribe(System.out::println);</span><br><span class="line">Flux.intervalMillis(<span class="number">100</span>).windowMillis(<span class="number">1001</span>).take(<span class="number">2</span>).toStream().forEach(System.out::println);</span><br></pre></td></tr></table></figure><h4 id="take"><a class="header-anchor" href="#take">Â¶</a>take</h4><p><code>take</code>ç³»åˆ—æ“ä½œç¬¦ç”¨æ¥ä»å½“å‰æµä¸­æå–å…ƒç´ ï¼Œæå–çš„æ–¹å¼å¯ä»¥ç”¨å¾ˆå¤šç§</p><p>è¿™é‡Œçš„æå–ï¼Œæ— éå°±æ˜¯ä¸€äº›æ¶ˆè´¹</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">takeLast(<span class="type">long</span> n)ï¼šæå–æµä¸­çš„æœ€å N ä¸ªå…ƒç´ ã€‚</span><br><span class="line">takeUntil(Predicate&lt;? <span class="built_in">super</span> T&gt; predicate)ï¼šæå–å…ƒç´ ç›´åˆ° Predicate è¿”å› <span class="literal">true</span>ã€‚</span><br><span class="line">takeWhile(Predicate&lt;? <span class="built_in">super</span> T&gt; continuePredicate)ï¼š å½“ Predicate è¿”å› <span class="literal">true</span> æ—¶æ‰è¿›è¡Œæå–ã€‚</span><br><span class="line">takeUntilOther(Publisher&lt;?&gt; other)ï¼šæå–å…ƒç´ ç›´åˆ°å¦å¤–ä¸€ä¸ªæµå¼€å§‹äº§ç”Ÿå…ƒç´ ã€‚</span><br></pre></td></tr></table></figure><h4 id="flatMap"><a class="header-anchor" href="#flatMap">Â¶</a>flatMap</h4><p><code>flatMap</code>å¯ä»¥è¯´æ˜¯ç»å¸¸ä½¿ç”¨çš„æ“ä½œç¬¦äº†</p><p><code>flatMap</code>å’Œ<code>flatMapSequential</code>æ“ä½œç¬¦å§æµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è½¬æ¢æˆä¸€ä¸ªæµï¼Œåœ¨å§æ‰€æœ‰æµä¸­çš„å…ƒç´ è¿›è¡Œåˆå¹¶</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Flux.just(<span class="number">5</span>, <span class="number">10</span>)</span><br><span class="line">        .flatMap(x -&gt; Flux.intervalMillis(x * <span class="number">10</span>, <span class="number">100</span>).take(x))</span><br><span class="line">        .toStream()</span><br><span class="line">        .forEach(System.out::println);</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œå“åº”å¼æµçš„æ“ä½œç¬¦(API)ï¼Œå°±å·®ä¸å¤š(å…¶å®å·®çš„è¿˜æ˜¯æœ‰ç‚¹å¤š~ . ~)äº†</p><h2 id="RSocket"><a class="header-anchor" href="#RSocket">Â¶</a>RSocket</h2><h3 id="ä»‹ç»"><a class="header-anchor" href="#ä»‹ç»">Â¶</a>ä»‹ç»</h3><p>æˆ‘ä»¬çŸ¥é“å¸¸ç”¨çš„HTTPåè®®çš„ä¼˜åŠ¿åœ¨äºå…¶å¹¿æ³›çš„é€‚ç”¨æ€§ï¼Œæœ‰å¾ˆå¤šçš„æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯å®ç°å·¥å…·çš„æ”¯æŒï¼Œä½†æ˜¯HTTPåè®®æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œåªæ”¯æŒ<strong>è¯·æ±‚-å“åº”</strong>æ¨¡å¼ï¼Œè€Œè¿™ç§æ¨¡å¼å¯¹äºå¾ˆå¤šåº”ç”¨åœºæ™¯æ¥è¯´æ˜¯ä¸åˆé€‚çš„</p><p>æ¯”å¦‚è¯´æ¶ˆæ¯æ¨é€</p><blockquote><p>ä»¥HTTPä¸ºä¾‹ï¼Œå¦‚æœå®¢æˆ·ç«¯éœ€è¦è·å–æœ€æ–°çš„æ¨é€æ¶ˆæ¯ï¼Œå°±å¿…é¡»ä½¿ç”¨è½®è¯¢ã€‚å®¢æˆ·ç«¯ä¸æ–­åœ°å‘é€è¯·æ±‚åˆ°æœåŠ¡å™¨æ¥æ£€æŸ¥æ›´æ–°ï¼Œè¿™æ— ç–‘é€ æˆäº†å¤§é‡çš„èµ„æºæµªè´¹ã€‚</p></blockquote><p>è¿™ä¸ªæ—¶å€™ï¼Œå“åº”å¼è§„èŒƒåé¢çš„å¼€å‘å›¢é˜Ÿç†è§£äº†</p><ol><li>è·¨ç½‘ç»œ</li><li>å¼‚æ­¥</li><li>ä½å»¶è¿Ÿé€šä¿¡</li></ol><p>çš„å¿…è¦æ€§äº†ã€‚</p><p>2015å¹´ï¼Œ<strong>RSocket</strong>åè®®å°±åœ¨è¿™æ ·çš„èƒŒæ™¯ä¸‹ï¼Œç ´å£³â€¦â€¦</p><p>RSocketæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶çš„åè®®ï¼Œä»¥å¼‚æ­¥æ¶ˆæ¯çš„æ–¹å¼æä¾›4ç§äº¤äº’æ¨¡å¼</p><ul><li>è¯·æ±‚-å“åº”æ¨¡å¼ï¼šè¿™ä¸ªä¹Ÿæ˜¯æœ€ç»å…¸ä¹Ÿæœ€å¸¸è§çš„æ¨¡å¼ï¼Œå‘é€æ–¹åœ¨å‘é€æ¶ˆæ¯ç»™æ¥æ”¶æ–¹ä¹‹åï¼Œç­‰å¾…ä¸ä¹‹å¯¹åº”çš„å“åº”æ¶ˆæ¯</li><li>è¯·æ±‚-å“åº”<strong>æµ</strong>æ¨¡å¼ï¼šä»¥æ¶ˆæ¯æµä½œä¸ºå“åº”</li><li>å³å‘-å³å¿˜æ¨¡å¼ï¼šå‘é€æ–¹çš„è¯·æ±‚æ¶ˆæ¯æ²¡æœ‰ä¸ä¹‹å¯¹åº”çš„å“åº”</li><li>é€šé“æ¨¡å¼ï¼šåœ¨å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¹‹é—´å»ºç«‹ä¸€ä¸ªåŒå‘ä¼ è¾“çš„é€šé“</li></ul><h3 id="å¦‚ä½•ä½¿ç”¨"><a class="header-anchor" href="#å¦‚ä½•ä½¿ç”¨">Â¶</a>å¦‚ä½•ä½¿ç”¨</h3><p>å¼•å…¥ä¾èµ–ï¼š</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.rsocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rsocket-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.rsocket<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rsocket-transport-netty<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæƒ³ä»¥Springæ¡†æ¶é›†æˆ</p><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">Â Â Â  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-rsocket<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ„å»ºä¸€ä¸ªç®€å•çš„<code>DemoController</code></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line">Â </span><br><span class="line">Â  <span class="meta">@MessageMapping(&quot;hello&quot;)</span></span><br><span class="line">Â  <span class="keyword">public</span> Mono&lt;String&gt; <span class="title function_">hello</span><span class="params">(String input)</span> &#123;</span><br><span class="line">Â Â Â  <span class="keyword">return</span> Mono.just(<span class="string">&quot;Hello: &quot;</span> + input);</span><br><span class="line">Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>@MassageMapping</code>æ˜¯Springæä¾›çš„ä¸€ä¸ªæ³¨è§£ï¼Œç”¨æ¥æŒ‡å®šWebSocketã€RSocketç­‰åè®®ä¸­æ¶ˆæ¯å¤„ç†çš„ç›®çš„åœ°</p><p>ä¸ºäº†è®¿é—®è¿™ä¸ªRSocketç«¯ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª<code>RSocketRequester</code>å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RSocketRequester.Builder builder;</span><br><span class="line">&#123;Â </span><br><span class="line">    <span class="type">RSocketRequester</span> <span class="variable">requester</span> <span class="operator">=</span> builder.dataMimeType(MimeTypeUtils.TEXT_PLAIN)</span><br><span class="line">                .connect(TcpClientTransport.create(<span class="number">7000</span>)).block();</span><br><span class="line"></span><br><span class="line">    Mono&lt;String&gt; response = requester.route(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">            .data(<span class="string">&quot;World&quot;</span>)</span><br><span class="line">            .retrieveMono(String.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é›†æˆä¸­é—´ä»¶"><a class="header-anchor" href="#é›†æˆä¸­é—´ä»¶">Â¶</a>é›†æˆä¸­é—´ä»¶</h2><ul><li>MongoDBé›†æˆ</li><li>Redisé›†æˆ</li><li>R2DBCé›†æˆ</li><li>MQé›†æˆ</li><li>â€¦â€¦</li></ul><p>è¿™é‡Œå…³äºä¸­é—´ä»¶çš„é›†æˆï¼Œæˆ‘æ›´æ„¿æ„ç»™å‡ºç±»ä¼¼äºå®˜æ–¹çš„å®˜æ–¹<a href="https://hantsy.github.io/spring-reactive-sample/">æ–‡æ¡£</a></p><p>è¿™é‡Œé¢åŒ…å«äº†ä¸­é—´ä»¶çš„ç»§æ‰¿è¿‡ç¨‹</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221211091923548.png" alt="image-20221211091923548"></p><h2 id="ç»“è¯­"><a class="header-anchor" href="#ç»“è¯­">Â¶</a>ç»“è¯­</h2><p>ç›¸å¯¹äºWebMVCè¿™æ ·ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„ï¼Œåœ¨å…¨ä¸–ç•Œæœ‰è¶…è¿‡åå¹´ä»¥ä¸Šçš„å¹¿æ³›åº”ç”¨çš„æ¡†æ¶ï¼ŒWebFluxå€’æ˜¯æ˜¾å¾—æœ‰ç‚¹ä¹³è‡­äº†ã€‚</p><p>æ¯•ç«Ÿï¼Œå¯¹å¼‚æ­¥ã€éé˜»å¡çš„ç¼–ç¨‹ï¼Œä¸ç®¡æ˜¯åœ¨ç¼–ç ä¸Šï¼Œç»´æŠ¤ä¸Šï¼Œè¿˜æ˜¯åœ¨è°ƒè¯•ä¸Šéƒ½æ˜¯ä¸€ä»¶å¾ˆå›°éš¾çš„äº‹æƒ…ã€‚å› ä¸ºå¼‚æ­¥ç¼–ç¨‹æ˜¯åŸºäºå›è°ƒçš„ï¼Œç”±ä¸€ä¸ªæ—¶é—´å¾ªç¯é©±åŠ¨ï¼Œåœ¨å°è¯•è·Ÿè¸ªè¯·æ±‚æ—¶ï¼Œäº‹ä»¶å¾ªç¯çš„å †æ ˆè·Ÿè¸ªæ¯«æ— æ„ä¹‰ã€‚æ­£æ˜¯å› ä¸ºå¤„ç†çš„æ˜¯äº‹ä»¶å’Œå›è°ƒï¼Œå¾ˆå°‘ç”¨å·¥å…·å¯ä»¥å¸®åŠ©è°ƒè¯•ã€‚</p><p>è¾¹ç•Œæƒ…å†µã€æœªå¤„ç†çš„å¼‚å¸¸ä»¥åŠé”™è¯¯å¤„ç†çš„çŠ¶æ€æ›´æ”¹ä¼šåˆ›å»ºæ‚¬ç©ºèµ„æºï¼Œä»è€Œå¯¼è‡´å†…å­˜æ³„æ¼ã€æ–‡ä»¶æè¿°ç¬¦æ³„æ¼æˆ–ä¸¢å¤±å“åº”ç­‰â€¦â€¦</p><p>ä»¥åï¼š</p><blockquote><p>å°½å¯èƒ½çš„é€‚åº”ï¼Œå¹¶é‡‡ç”¨å“åº”å¼ç¼–ç¨‹æ¥ä»£æ›¿ç›®å‰çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè¾¾åˆ°å…¨æ ˆå¼çš„å“åº”å¼åº”ç”¨ç¨‹åºçš„ç¼–å†™ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> TODO-LIST </category>
          
          <category> å“åº”å¼ç¼–ç¨‹ </category>
          
          <category> WebFlux </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TODO-LIST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§äºŒå¯’å‡TOTO-LIST</title>
      <link href="/2022/12/07/%E5%A4%A7%E4%BA%8C%E5%AF%92%E5%81%87TOTO-LIST/"/>
      <url>/2022/12/07/%E5%A4%A7%E4%BA%8C%E5%AF%92%E5%81%87TOTO-LIST/</url>
      
        <content type="html"><![CDATA[<h1>å¤§äºŒå¯’å‡TOTO-LIST</h1><p>2022-12-7 19:08:45</p><h2 id="æŠ€æœ¯æ ˆ"><a class="header-anchor" href="#æŠ€æœ¯æ ˆ">Â¶</a>æŠ€æœ¯æ ˆ</h2><ul><li><p>[x] WebFlux</p><ul><li>[x] Reactoræ“ä½œ</li><li>[x] é›†æˆç»„ä»¶<ul><li>[ ] Redis</li><li>[x] MongoDB</li><li>[ ] R2DBC</li><li>[ ] MQ</li></ul></li></ul></li><li><p>[ ] å¹¶å‘ç¼–ç¨‹</p><ul><li>[ ] Javaå¹¶å‘çº¿ç¨‹æ± åº•å±‚åŸç†</li><li>[ ] JUCå¹¶å‘é›†åˆåº•å±‚åŸç†</li><li>[ ] CASAtomic</li><li>[ ] JMMå¹¶å‘ä¸‰å¤§ç‰¹æ€§</li><li>[ ] é”æœºåˆ¶</li></ul></li><li><p>[ ] Mysql-Tomcat</p><ul><li>[ ] Mysqlæ€§èƒ½ä¼˜åŒ–</li><li>[ ] Tomcatæ•´ä½“æœºæ„</li><li>[ ] Tomcatçº¿ç¨‹æ¨¡å‹</li></ul></li><li><p>[ ] Jvm</p><ul><li>[ ] JVMç±»åŠ è½½æœºåˆ¶</li><li>[ ] JVMå¯¹è±¡åˆ›å»ºå’Œå†…å­˜åˆ†é…æœºåˆ¶</li><li>[ ] classå­—èŠ‚ç æ–‡ä»¶ç»“æ„</li><li>[ ] åƒåœ¾å›æ”¶</li><li>[ ] JVMè°ƒä¼˜</li><li>[ ] JTM</li><li>[ ] Cloud-Native Javaè™šæ‹Ÿ</li><li>[ ] Hotspot</li></ul></li><li><p>[ ] Redis</p><ul><li>[ ] Clusteré›†ç¾¤</li><li>[ ] æ ¸å¿ƒæ•°æ®ç»“æ„</li><li>[ ] åˆ†å¸ƒå¼é”</li></ul></li><li><p>[ ] MongoDB(æš‚å®š)</p></li><li><p>[ ] Sharding-Sphere</p><ul><li>[ ] ç®€å•å®æ“â€”â€”ä¸å‡†å¤‡ç ”ç©¶æºç ä»¥åŠäºåŸç†</li><li>[ ] Sharding-Proxy ï¼ˆ?æš‚å®šï¼‰</li></ul></li><li><p>[ ] Netty</p><ul><li>[ ] å¸¸è§çš„ç»„ä»¶ä½¿ç”¨</li><li>[ ] æ ¸å¿ƒçº¿ç¨‹æ¨¡å‹</li><li>[ ] åº•å±‚æ•°æ®äº¤äº’</li></ul></li></ul><p>æˆ‘ä¸å‡†å¤‡åœ¨è¿™ä¸ªæ—¶é—´æ®µå»ç ”ç©¶æºç ï¼Œä¸€æ˜¯å› ä¸ºæˆ‘æœ¬æ¥å°±æ˜¯ä¸ªä¸çˆ±çœ‹ä¹¦çš„äººï¼Œç›´æ¥å–Šæˆ‘å»çœ‹æºç ï¼Œç ”ç©¶åˆ«äººæ€ä¹ˆå®ç°çš„å¤§æ¦‚ç‡ä¼šæ‰“çŒç¡ï¼ŒäºŒæ˜¯é¡¾è™‘åˆ°æ€•æœ¬æ¥åº•å±‚éƒ½æ²¡ç ”ç©¶æ¸…æ¥šå°±å»çœ‹æºç çš„è¯ï¼Œåˆ°æ—¶å€™è¯´ä¸å®šä¼šæœ¬æœ«å€’ç½®â€¦â€¦</p><h2 id="è¯¾ç¨‹å­¦ä¹ "><a class="header-anchor" href="#è¯¾ç¨‹å­¦ä¹ ">Â¶</a>è¯¾ç¨‹å­¦ä¹ </h2><p>è¯´æ¥å¥½ç¬‘ï¼Œæœ¬å°±å·²ç»ä¸å¬è¯¾äº†ï¼Œä½†å¥ˆä½•nmmdé‚®ä¸“éå¾—ä¸‹å­¦æœŸæ¥äº†æ‰è€ƒè¯•ï¼Œéæš‘å‡å¤ä¹ ä¸å¯ï¼Œä¸ç„¶å¾—æŒ‚äº†ï¼Œæˆ‘è¿˜æ˜¯æƒ³æ˜å¹´çš„è¿™ä¸ªæ—¶å€™è¿˜æ˜¯æœ‰è‡³å°‘1000çš„æ…°è—‰å§ã€‚</p><ul><li>çº¿æ€§ä»£æ•°</li><li>æ•°æ®ç»“æ„</li><li>å¤§å­¦ç‰©ç†</li><li>ç¼–ç¨‹åŸºç¡€</li><li>ç¦»æ•£æ•°å­¦</li><li>CET6</li><li>å·¥ç¨‹ä¼¦ç†</li><li>å·¥ç¨‹ç®¡ç†ä¸ç»æµå†³ç­–</li></ul><h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2><p>ç­‰åˆ°æ—¶å€™è¦å¼€å­¦äº†æˆ‘å†æ¥å†™â€¦â€¦</p>]]></content>
      
      
      <categories>
          
          <category> TODO-LIST </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TODO-LIST </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è“å±±2022Javaç¬¬å››èŠ‚è¯¾</title>
      <link href="/2022/12/04/%E8%93%9D%E5%B1%B12022Java%E7%AC%AC%E5%9B%9B%E8%8A%82%E8%AF%BE/"/>
      <url>/2022/12/04/%E8%93%9D%E5%B1%B12022Java%E7%AC%AC%E5%9B%9B%E8%8A%82%E8%AF%BE/</url>
      
        <content type="html"><![CDATA[<h1>ğŸŒŸè“å±±2022Javaç¬¬å››æ¬¡è¯¾ğŸŒŸ</h1><p>å¦‚æœåœ¨åœºçš„å„ä½åšæŒåˆ°æˆ‘è¿™èŠ‚è¯¾äº†çš„è¯ï¼Œæ­å–œä½ ä»¬ï¼Œåœ¨Javaè¿™é—¨ç¼–ç¨‹è¯­è¨€çš„å­¦ä¹ æš‚æ—¶å‘Šä¸€æ®µè½äº†(bushi)ï¼Œå½“ç„¶ï¼Œä¸€äº›å·ç‹è¯·è‡ªä¾¿<strong>Deep Learning</strong></p><p>ä»ç¬¬ä¸€èŠ‚è¯¾ï¼Œç½—ç¥çš„è®²çš„Javaè¯­æ³•åŸºç¡€</p><p>åˆ°ç¬¬äºŒèŠ‚è¯¾ï¼Œç±æ¥ å§å§è®²çš„é¢å‘å¯¹è±¡åŸºç¡€ï¼Œ</p><p>åˆ°ç¬¬ä¸‰èŠ‚è¯¾ï¼Œæµ·ç¥ä»‹ç»çš„é¢å‘å¯¹è±¡è¿›é˜¶ï¼Œç›¸ä¿¡å„ä½åšæŒä¸‹æ¥çš„å·ç‹ä»¬ï¼Œè‚¯å®šå¯¹Javaè¿™é—¨è¯­è¨€ï¼Œæœ‰äº†å®Œå…¨ä¸åŒçš„è®¤è¯†</p><p>é‚£ä¹ˆJavaç¬¬å››èŠ‚è¯¾ï¼Œä¸»è¦å°±æ˜¯ä»‹ç»ä¸€äº›Javaçš„ä¸€äº›é«˜çº§ç‰¹æ€§</p><ul><li>IO</li><li>å¼‚å¸¸å¤„ç†</li><li>åå°„</li><li>æ³›å‹</li><li>çº¿ç¨‹</li><li>â€¦</li></ul><p>é¦–å…ˆè®²è®²å¼‚å¸¸å¤„ç†å§</p><p>è‰¹ï¼Œèµ°ï¼Œå¿½ç•¥</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122222714567.png" alt="image-20221122222714567" align="left" style="zoom:80%;" /><h2 id="ğŸ’¥å¼‚å¸¸å¤„ç†"><a class="header-anchor" href="#ğŸ’¥å¼‚å¸¸å¤„ç†">Â¶</a>ğŸ’¥å¼‚å¸¸å¤„ç†</h2><p>åœ¨æ—¥å¸¸ç”Ÿæ´»ä¸­ï¼Œå¾ˆå¤šäº‹æƒ…å¹¶éæ€»æ˜¯æŒ‰ç…§äººä»¬è‡ªå·±è®¾è®¡æ„æ„¿é¡ºåˆ©å‘å±•çš„ï¼Œç»å¸¸å‡ºç°è¿™æ ·é‚£æ ·çš„å¼‚å¸¸æƒ…å†µã€‚</p><blockquote><p>ä¾‹å¦‚ï¼šæ²ƒæ—¥ï¼Œä»Šå¤©éƒ¨é—¨è¦å¼€ä¾‹ä¼šï¼Œæˆ‘tmä¸­åˆå›å¯å®¤å°±ç¡è§‰äº†ã€‚éƒ¨é•¿æ‰“è¿‡æ¥ç”µè¯éƒ½æ²¡æ¥åˆ°ï¼Œä¸‹æ¬¡æŒ‡å®šæ²¡æˆ‘å¥½æœæ±åƒâ€¦</p></blockquote><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221028204320223.png" alt="image-20221028204320223" align="left" alignstyle="zoom:100%;" /><p>è®¡ç®—æœºç¨‹åºçš„ç¼–å†™å…¶å®æœ‰æ—¶å€™ä¹Ÿéœ€è¦è€ƒè™‘å¤„ç†è¿™äº›å¼‚å¸¸æƒ…å†µï¼Œ<code>å¼‚å¸¸(Exception)</code>ï¼Œå°±æ˜¯åœ¨è¿è¡Œç¨‹åºçš„æ—¶å€™äº§ç”Ÿçš„ä¸€ç§å¼‚å¸¸æƒ…å†µ</p><p>åŒæ—¶è¿™ä¹Ÿå·²ç»æˆä¸ºäº†è¡¡é‡ä¸€é—¨è¯­è¨€æ˜¯å¦æˆç†Ÿçš„æ ‡å‡†ã€‚ç›®å‰çš„ä¸»æµç¼–ç¨‹è¯­è¨€ï¼Œå¦‚ï¼šC++ã€C#ã€Rubyã€Rustã€Pythonâ€¦ç­‰å¤§éƒ½æä¾›äº†å¼‚å¸¸å¤„ç†æœºåˆ¶</p><p>æ‰€ä»¥æœ¬èŠ‚æˆ‘ä»¬æ¥ä»‹ç»Javaå¼‚å¸¸å¤„ç†çš„ç›¸å…³çŸ¥è¯†</p><hr><h3 id="å¼‚å¸¸ä»‹ç»"><a class="header-anchor" href="#å¼‚å¸¸ä»‹ç»">Â¶</a>å¼‚å¸¸ä»‹ç»</h3><p>Javaä¸­çš„å¼‚å¸¸åˆç§°ï¼š<strong>â€œä¾‹å¤–â€</strong>ï¼Œæ˜¯ä¸€ä¸ªåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å‘ç”Ÿçš„æ—¶é—´ï¼Œä»–ä¸­æ–­æ­£åœ¨æ‰§è¡Œç¨‹åºçš„<strong>æ­£å¸¸æŒ‡ä»¤</strong>ï¼Œæˆ–è€…<strong>æŒ‡ä»¤æµ</strong>ï¼Œ(ä¹Ÿå°±æ˜¯ä¸€ä¸²æŒ‡ä»¤)ã€‚ä¸ºäº†èƒ½å¤ŸåŠæ—¶ã€æœ‰æ•ˆç¬¬å¤„ç†ç¨‹åºä¸­çš„è¿è¡Œé”™è¯¯ï¼Œè¿™ä¸ªæ—¶å€™å¿…é¡»ä½¿ç”¨å¼‚å¸¸ç±»ï¼Œè¿™å¯ä»¥è®©ç¨‹åºå…·æœ‰æå…¶å¯è§‚çš„<strong>å®¹é”™æ€§å’Œå¥å£®æ€§</strong>ã€‚</p><p>åœ¨Javaä¸­ï¼Œä¸€ä¸ªå¼‚å¸¸çš„äº§ç”Ÿï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸­æƒ…å†µï¼š</p><ul><li>Javaå†…éƒ¨é”™è¯¯å‘ç”Ÿå¼‚å¸¸ï¼ŒJavaè™šæ‹Ÿæœºäº§ç”Ÿçš„å¼‚å¸¸</li><li>ç¼–å†™çš„ç¨‹åºä»£ç ä¸­çš„é”™è¯¯æ‰€äº§ç”Ÿçš„çš„å¼‚å¸¸ï¼Œä¾‹å¦‚<code>NullPointException</code>ç©ºæŒ‡é’ˆå¼‚å¸¸ã€<code>IndexBoundException</code>æ•°ç»„è¶Šç•Œå¼‚å¸¸ç­‰ç­‰</li><li>é€šè¿‡<code>throw</code>è¯­å¥æ‰‹åŠ¨ç”Ÿæˆçš„å¼‚å¸¸ï¼Œä¸€èˆ¬ç”¨æ¥å‘ŠçŸ¥è¯¥æ–¹æ³•çš„è°ƒç”¨è€…ä¸€äº›å¿…è¦ä¿¡æ¯<br><code>throw</code>è¿™ä¸ªå…³é”®å­—ç­‰ä¸‹ä¼šè®²ï¼Œæˆ‘çŸ¥é“ä½ å¾ˆæ€¥ï¼Œä½†ä½ å…ˆåˆ«æ€¥â€¦<br><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221028205457764.png" align="left" alt="image-20221028205457764" style="zoom:80%;" /></li></ul><h3 id="Javaä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸è¯­æ³•"><a class="header-anchor" href="#Javaä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸è¯­æ³•">Â¶</a>Javaä¸­çš„å¼‚å¸¸å¤„ç†æœºåˆ¶ä¸è¯­æ³•</h3><p>è¯­æ³•æ ¼å¼ï¼š</p><blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line"><span class="comment">//å¯èƒ½å‡ºç°å¼‚å¸¸çš„çš„ä»£ç </span></span><br><span class="line"> <span class="comment">//if (tryä¸­çš„ä»£ç å‡ºç°é—®é¢˜äº† &amp;&amp; è¿™é‡Œcatchæ•è·çš„æ—¶å€™å¼‚å¸¸ç±»å‹ä¸tryä¸­è·‘å‡ºçš„å¼‚å¸¸ç±»å‹ä¸€è‡´çš„æ—¶å€™ï¼Œæˆ–è€…æ˜¯tryä¸­æŠ›å‡ºå¼‚å¸¸çš„çˆ¶ç±»çš„æ—¶å€™ï¼Œ) â€”â€”&gt;  å°±ä¼šå¯¹å¼‚å¸¸è¿›è¡Œå¼‚å¸¸å¤„ç†</span></span><br><span class="line"> <span class="comment">//å¤„ç†å®Œæˆåï¼Œå°±è·³å‡º try-catch è¯­å¥ï¼Œç»§ç»­æ‰§è¡Œåç»­çš„ä»£ç </span></span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">catch</span>(Exception e)&#123;<span class="comment">//Exception æ˜¯éœ€è¦æ•è·çš„å¼‚å¸¸ç±»å‹</span></span><br><span class="line">e.printStackTrance();</span><br><span class="line"> <span class="comment">//...å…¶ä»–çš„ä¸€äº›å¼‚å¸¸å¤„ç†</span></span><br><span class="line">&#125;<span class="keyword">finally</span>&#123;</span><br><span class="line"><span class="comment">//ä¸ç®¡tryä»£ç é‡Œé¢æ˜¯å¦å‡ºç°äº†å¼‚å¸¸ï¼Œ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></blockquote><p>ä¸€é¦–å°æ‚Ÿç»“æŸå¼‚å¸¸å¤„ç†ï¼š</p><ul><li>ä¸–ç•Œä¸Šæœ€é¥è¿œçš„è·ç¦»ï¼Œæ˜¯æˆ‘åœ¨ifé‡Œä½ åœ¨elseé‡Œï¼Œ<br>ä¼¼ä¹ä¸€ç›´ç›¸ä¼´æœ‰æ°¸è¿œåˆ†ç¦»ï¼›</li><li>ä¸–ç•Œä¸Šæœ€ç—´å¿ƒçš„ç­‰å¾…ï¼Œæ˜¯æˆ‘å½“caseä½ æ˜¯switchï¼Œ<br>æˆ–è®¸æ°¸è¿œéƒ½é€‰ä¸ä¸Šè‡ªå·±ï¼›</li><li>ä¸–ç•Œä¸Šæœ€çœŸæƒ…çš„ç›¸ä¾ï¼Œæ˜¯ä½ åœ¨tryæˆ‘åœ¨catch<br>æ— è®ºä½ å‘ä»€ä¹ˆä»€ä¹ˆè„¾æ°”ï¼Œ<br>æˆ‘éƒ½é»˜é»˜æ‰¿å—ï¼Œé™é™å¤„ç†<br>åˆ°é‚£æ—¶å€™ï¼Œå†æ¥æœŸå¾…æˆ‘ä»¬çš„finally</li></ul><p>â€”â€”æ¥è‡ªBIlibiliå°šç¡…è°·å®‹çº¢åº·è€å¸ˆçš„ç¬”è®°</p><hr><h3 id="å¼‚å¸¸çš„ç±»å‹"><a class="header-anchor" href="#å¼‚å¸¸çš„ç±»å‹">Â¶</a>å¼‚å¸¸çš„ç±»å‹</h3><p>ä¸ºäº†èƒ½å¤ŸåŠæ—¶æœ‰æ•ˆçš„å¤„ç†å‡ºç°çš„å¼‚å¸¸ï¼ŒJavaä¸“é—¨å¼•å…¥äº†å¼‚å¸¸ç±»<code>(Exceptoin)</code>ï¼Œåœ¨Javaä¸­æ‰€æœ‰å¼‚å¸¸ç±»å‹éƒ½æ˜¯å†…ç½®<code>java.lang.Throwable</code>ç±»çš„å­ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>Throwable</code>æ˜¯ç«™åœ¨<strong>å¼‚å¸¸é“¾é¡¶ç«¯çš„ç”·äºº</strong></p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221029081055771.png" align="left" alt="image-20221029081055771" style="zoom: 90%;" /><p><strong>å¸¸è§çš„å¼‚å¸¸ç±»å‹</strong></p><table><thead><tr><th>å¼‚å¸¸ç±»å‹åç§°</th><th>å¼‚å¸¸ç±»å‹è¯´æ˜</th></tr></thead><tbody><tr><td>ArithmeticException</td><td>ç®—æ•°å¼‚å¸¸</td></tr><tr><td>IndexOutOfBoundsException</td><td>è§’æ ‡è¶Šç•Œå¼‚å¸¸</td></tr><tr><td>ClassCastException</td><td>ç±»å‹è½¬æ¢å¼‚å¸¸</td></tr><tr><td>NullPointException</td><td>ç©ºæŒ‡é’ˆå¼‚å¸¸</td></tr><tr><td>NumberFormatException</td><td>æ•°å­—æ ¼å¼åŒ–å¼‚å¸¸</td></tr><tr><td>â€¦</td><td>â€¦</td></tr></tbody></table><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Courseware-Backend-Java-2022</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¸¸è§å¼‚å¸¸ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-11-22 19:20</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CommonException</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//NullPointerException</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        System.out.println(<span class="string">&quot;integer.toString() = &quot;</span> + integer.toString());</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ClassCastException</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">x</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">0</span>);</span><br><span class="line">        System.out.println((String)x);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//IndexOutOfBoundsException</span></span><br><span class="line">        <span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        System.out.println(list.get(<span class="number">0</span>));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="è‡ªå®šä¹‰å¼‚å¸¸ç±»"><a class="header-anchor" href="#è‡ªå®šä¹‰å¼‚å¸¸ç±»">Â¶</a>è‡ªå®šä¹‰å¼‚å¸¸ç±»</h3><p>ä¸ºä»€ä¹ˆè¦è‡ªå®šä¹‰å¼‚å¸¸ç±»å‘¢ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p><p>å½“æˆ‘ä»¬çš„æ–‡ä»¶ä¸­å‡ºç°å¤šä¸ªå¼‚å¸¸çš„æ—¶å€™ï¼Œæ˜¾ç„¶<code>RuntimeException</code>å°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚äº†</p><p>ä»ä¸šåŠ¡è§’åº¦å»ç†è§£çš„è¯ï¼Œå°±æ¯”å¦‚å¤„ç†ä¸€ä¸ªæ–‡ä»¶ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ç½‘ç»œå¼‚å¸¸ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°æ•°æ®åº“å¼‚å¸¸ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°â€¦â€¦</p><p>è¿™ä¸ªæ—¶å€™è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå°±ç›¸å½“äºå°†ä»–ä»¬ç»†åŒ–äº†</p><p>æ‰‹æ“ä¸€ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Courseware-Backend-Java-2022</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è‡ªå®šä¹‰å¼‚å¸¸ç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-11-22 19:31</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MeiQianException</span> <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Double money;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MeiQianException</span><span class="params">(Double money)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(<span class="string">&quot;ä½™é¢ä¸è¶³ï¼Œè¿˜å·®ï¼š&quot;</span> + money);</span><br><span class="line">        <span class="built_in">this</span>.money = money;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">AccountAdmin</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> Double balance;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">AccountAdmin</span><span class="params">(Double balance)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.balance = balance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å­˜é’±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deposit</span><span class="params">(<span class="type">double</span> money)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.balance += money;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å–é’±çš„æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(<span class="type">double</span> money)</span> <span class="keyword">throws</span> MeiQianException &#123;</span><br><span class="line">            <span class="keyword">if</span> (balance &gt;= money) &#123;</span><br><span class="line">                balance -= money;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">double</span> <span class="variable">needMoney</span> <span class="operator">=</span> money - balance;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">MeiQianException</span>(needMoney);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AccountAdmin</span> <span class="variable">accountAdmin</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AccountAdmin</span>(<span class="number">100.0</span>);</span><br><span class="line">        accountAdmin.deposit(<span class="number">200</span>);<span class="comment">//å…ˆå­˜äºŒä¼¯å—</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//å†å–å››ä¼¯å—</span></span><br><span class="line">            accountAdmin.withdraw(<span class="number">400</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MeiQianException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Throwã€Throws"><a class="header-anchor" href="#Throwã€Throws">Â¶</a>Throwã€Throws</h3><h4 id="ä»€ä¹ˆæ˜¯Throw"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯Throw">Â¶</a>ä»€ä¹ˆæ˜¯Throw</h4><p>throwæ˜¯javaä¸­å…³äºå¼‚å¸¸çš„ä¸€ç§æ“ä½œå¦‚æœåœ¨<code>try&#123;&#125;catch&#123;&#125;</code>ä¸­ä½¿ç”¨äº†throwï¼Œå³ä»£è¡¨è‡ªå·±å»ä¹¦å†™è¿™ä¸ªæ–¹æ³•â€”â€”è‡ªå·±å¤„ç†å¼‚å¸¸ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª<strong>æ‰‹åŠ¨æŠ“å–</strong>çš„åŠ¨ä½œï¼Œå¯ä»¥ä½¿ç¨‹åºåœæ­¢å¹¶æŠ¥å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚</p><p><strong>å…¶å¥½å¤„æ˜¯ï¼š</strong></p><ul><li>å¯ä»¥åœ¨è‡ªå·±å®šä¹‰çš„åœ°æ–¹æŠ¥å‡ºå¼‚å¸¸åœæ­¢ç¨‹åºï¼›</li><li>è€Œä¸æ˜¯åœ¨é”™è¯¯çš„åœ°æ–¹æŠ¥å‡ºå¼‚å¸¸åœæ­¢ç¨‹åº</li></ul><p>å¯ä»¥æ˜¯è‡ªå·±ä¹¦å†™çš„ç¨‹åºè‡ªå·±ç›‘æµ‹é”™è¯¯ï¼Œè€Œä¸éœ€è¦æœ€åä¸€é“é˜²çº¿JVMæ¥å¤„ç†é”™è¯¯</p><p>å¦‚æœæ²¡æœ‰ä½¿ç”¨çš„è¯ï¼ŒæŠ¥é”™çš„æ—¶å€™åªèƒ½æ˜¯JVMè™šæ‹Ÿæœºæ¥é»˜è®¤çš„æŠ¥é”™å¤„ç†(ç«‹å³åœ¨æŠ¥é”™ä½ç½®åœæ­¢ç¨‹åºçš„è¿è¡Œï¼ŒæŠ¥å‡ºå¼‚å¸¸åŸå› )</p><h4 id="ä»€ä¹ˆæ˜¯Throws"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯Throws">Â¶</a>ä»€ä¹ˆæ˜¯Throws</h4><p><code>throws</code>æ˜¯ä¸€ä¸ªjavaçš„å…³é”®å­—ï¼Œé€šå¸¸è¢«åº”ç”¨åœ¨å£°æ˜æ–¹æ³•çš„æ—¶å€™ï¼Œç”¨æ¥æŒ‡å®šå¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚å£°æ˜ä¹‹åï¼Œå¯ä»¥è®©Javaçš„ç¼–è¯‘å™¨å¯¹è¿™ä¸ªjavaæ–‡ä»¶è¿›è¡Œæ­£å¸¸çš„ç¼–è¯‘classæ–‡ä»¶(æ¼”ç¤ºä¸€ä¸‹)ï¼Œè¿™ä¹Ÿæ˜¯å¹³å¸¸æˆ‘ä»¬æ‰€è¯´çš„<strong>è‡ªåŠ¨æŠ›å‡º</strong>çš„åŠ¨ä½œã€‚ä¸€æ—¦è¿è¡Œclassæ–‡ä»¶æœŸé—´å‡ºç°é”™è¯¯ï¼ŒJVMè™šæ‹Ÿæœºå°±ä¼šæ£€æµ‹é”™è¯¯ï¼Œåœæ­¢ç¨‹åºçš„è¿è¡Œï¼Œå¹¶æŠ¥å‡ºå¼‚å¸¸ä¿¡æ¯</p><h4 id="ä¸¤è€…çš„åŒºåˆ«"><a class="header-anchor" href="#ä¸¤è€…çš„åŒºåˆ«">Â¶</a>ä¸¤è€…çš„åŒºåˆ«</h4><ul><li>ä½ç½®ï¼šthrowsæ”¾åœ¨æ–¹æ³•å£°æ˜çš„åé¢ï¼Œè¡¨ç¤ºæŠ¥å‡ºå¼‚å¸¸ï¼Œç”±è¯¥æ–¹æ³•çš„è°ƒç”¨è€…æ¥å¤„ç†ï¼›throwä½œç”¨åœ¨æ–¹æ³•å†…éƒ¨ï¼Œåé¢è·Ÿç€çš„æ˜¯å¼‚å¸¸çš„å¯¹è±¡</li><li>åŠŸèƒ½ï¼š<br>throwsç”¨æ¥å£°æ˜æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„å¼‚å¸¸ï¼Œä»¥ä¾¿è°ƒç”¨è€…æ ¹æ®ä¸åŒçš„å¼‚å¸¸ç±»å‹é¢„å…ˆå®šä¹‰ä¸åŒçš„å¤„ç†æ–¹å¼ï¼›<br>throwç”¨æ¥æŠ›å‡ºå°è£…äº†å¼‚å¸¸ä¿¡æ¯çš„å¯¹è±¡ï¼Œç¨‹åºåœ¨æ‰§è¡Œåˆ°throwæ—¶åç»­çš„ä»£ç å°†ä¸åœ¨æ‰§è¡Œï¼Œè€Œæ˜¯è·³è½¬åˆ°è°ƒç”¨è€…ï¼Œå¹¶å°†å¼‚å¸¸ä¿¡æ¯æŠ›ç»™è°ƒç”¨è€…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œthrowåé¢ç™¾åº¦è¯­å¥å°†æ— æ³•è¢«æ‰§è¡Œ(finallyè¯­å¥å—é™¤å¤–)</li></ul><h3 id="ç”±ä»¥ä¸Šæ€»ç»“å‡ºï¼šJavaå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼š"><a class="header-anchor" href="#ç”±ä»¥ä¸Šæ€»ç»“å‡ºï¼šJavaå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼š">Â¶</a>ç”±ä»¥ä¸Šæ€»ç»“å‡ºï¼šJavaå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼š</h3><ul><li>æ–¹å¼ä¸€ï¼štry-catch-finally</li><li>æ–¹å¼äºŒï¼šthrows+å¼‚å¸¸ç±»å‹</li></ul><h2 id="ğŸ”§IOæµ"><a class="header-anchor" href="#ğŸ”§IOæµ">Â¶</a>ğŸ”§IOæµ</h2><h3 id="ä»€ä¹ˆæ˜¯IOæµ"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯IOæµ">Â¶</a>ä»€ä¹ˆæ˜¯IOæµ</h3><p>è¿™é‡Œå¼•ç”¨ç™¾åº¦çš„å›ç­”ï¼š</p><blockquote><p>æµæ˜¯ä¸€ç§æŠ½è±¡æ¦‚å¿µï¼Œå®ƒä»£è¡¨äº†æ•°æ®çš„æ— ç»“æ„åŒ–ä¼ é€’ã€‚æŒ‰ç…§æµçš„æ–¹å¼è¿›è¡Œè¾“å…¥è¾“å‡ºï¼Œæ•°æ®è¢«å½“æˆæ— ç»“æ„çš„å­—èŠ‚åºæˆ–å­—ç¬¦åºåˆ—ã€‚ä»æµä¸­å–å¾—æ•°æ®çš„æ“ä½œç§°ä¸ºæå–æ“ä½œï¼Œè€Œå‘æµä¸­æ·»åŠ æ•°æ®çš„æ“ä½œç§°ä¸ºæ’å…¥æ“ä½œã€‚ç”¨æ¥è¿›è¡Œè¾“å…¥è¾“å‡ºæ“ä½œçš„æµå°±ç§°ä¸ºIOæµã€‚æ¢å¥è¯è¯´ï¼ŒIOæµå°±æ˜¯ä»¥æµçš„æ–¹å¼è¿›è¡Œè¾“å…¥è¾“å‡º</p></blockquote><p>ç®€è€Œè¨€ä¹‹å°±æ˜¯ï¼šä½ çš„ç¨‹åºå’Œç³»ç»Ÿä¹‹é—´è¯»å†™æ–‡ä»¶çš„æ“ä½œå°±æ˜¯IOæ“ä½œï¼Œå’Œç³»ç»Ÿä¹‹é—´è¯»å†™ç”¨çš„ä¸œè¥¿å°±æ˜¯IOæµ</p><p>æ‰€ä»¥ï¼ŒJava IOæµå°±æ˜¯Javaç¨‹åºå’Œæ“ä½œç³»ç»Ÿä¹‹é—´é€šä¿¡ç”¨çš„æ–¹æ³•</p><p>è¿™é‡Œå‡ºäºç¯‡å¹…ï¼Œæ—¶é—´åŸå› ï¼Œåªç®€å•ä»‹ç»Java IOæµä¸­çš„<strong>å­—èŠ‚æµ</strong>å’Œ<strong>å­—ç¬¦æµ</strong>ï¼Œå…¶ä»–æµï¼Œåƒ<strong>NIO</strong>ï¼Œ<strong>AIO</strong>ï¼Œ<strong>BIO</strong>è¿™äº›ï¼Œå„ä½å·ç‹æœ‰ä½™åŠ›çš„è¯å¯ä»¥è‡ªå·±å»å­¦ä¹ ã€‚</p><h3 id="å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«"><a class="header-anchor" href="#å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«">Â¶</a>å­—èŠ‚æµå’Œå­—ç¬¦æµçš„åŒºåˆ«</h3><p>å­—èŠ‚æµå’Œå­—ç¬¦æµæ“ä½œçš„æœ¬è´¨åŒºåˆ«åªæœ‰ä¸€ä¸ªï¼š</p><blockquote><p>å­—èŠ‚æµæ˜¯åŸç”Ÿçš„æ“ä½œï¼Œå­—ç¬¦æµæ˜¯å¤„ç†åçš„æ“ä½œ</p></blockquote><p>æ“ä¸ªå›¾ï¼Œå­—èŠ‚æµåœ¨æ“ä½œçš„æ—¶å€™ä¸ä¼šç”¨åˆ°ç¼“å†²åŒºï¼Œä¹Ÿå°±æ˜¯ä¸ä¼šç”¨åˆ°å†…å­˜ï¼Œç›´æ¥æ“ä½œæ–‡ä»¶æœ¬èº«ï¼›</p><p>è€Œå­—ç¬¦æµåœ¨æ“ä½œçš„æ—¶å€™ä½¿å‹‡äº†ç¼“å†²åŒºï¼Œé€šè¿‡ç¼“å†²åŒºå†æ“ä½œæ–‡ä»¶ï¼š</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122081522641.png" alt="image-20221122081522641" style="zoom: 200%;" align="left" /><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰å­—ç¬¦æµè€Œä¸ç›´æ¥ä½¿ç”¨å­—èŠ‚æµå‘¢ï¼Ÿéå¾—æä¸ªå­—ç¬¦æµå‡ºæ¥ã€‚</p><p>æˆ‘çš„ç†è§£æ˜¯ï¼Œå­—èŠ‚æµå¤„ç†æœºå¤šä¸ªå­—èŠ‚è¡¨ç¤ºçš„ä¸œè¥¿çš„æ—¶å€™ï¼Œæœ‰å¯èƒ½ä¼šå‡ºç°ä¹±ç çš„é—®é¢˜</p><p>æ¯”å¦‚è¯´æ±‰å­—ï¼Œç”¨å­—èŠ‚æµè¯»å–çš„æ—¶å€™æœ‰å¯èƒ½å› ä¸ºä»¥ä¸ºå­—èŠ‚æ²¡æœ‰è¯»åˆ°å°±å˜æˆäº†ä¹±ç ï¼Œå­—ç¬¦æµå‘¢ï¼Œå°±å®Œç¾çš„è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>è¿™æ ·ç†è§£ï¼Œ<code>å­—èŠ‚æµ+ç¼–ç è¡¨=å­—ç¬¦è·¯</code>å› ä¸ºæœ‰äº†ç¼–ç è¡¨ï¼Œå¤šä»¥å¯ä»¥ç¡®å®šè¿™ä¸ªæ±‰å­—æœ‰å¤šå°‘ä¸ªå­—èŠ‚ï¼Œè¿™æ ·å­—èŠ‚æµå°±å¯ä»¥æ ¹æ®ä½æ•°å‡†ç¡®çš„å†™æ±‰å­—äº†</p><h3 id="å­—èŠ‚æµ"><a class="header-anchor" href="#å­—èŠ‚æµ">Â¶</a>å­—èŠ‚æµ</h3><p>å­—èŠ‚æµé¡¾åæ€ä¹‰ã€‚å°±æ˜¯é€šè¿‡å­—èŠ‚ç›´æ¥æ“ä½œå­—ç¬¦ï¼Œæ›´ä¸ºçš„åº•å±‚</p><p>å­—èŠ‚æµæœ€åŸºç¡€çš„ä¸¤ä¸ªç±»å°±æ˜¯<code>InputStream</code>å’Œ<code>OutputStream</code>ã€‚æ ¹æ®è¿™ä¸¤ä¸ªæ´¾ç”Ÿè€Œæ¥ç±»éƒ½å«æœ‰<code>read()</code>å’Œ<code>write()</code>çš„åŸºæœ¬æ–¹æ³•ï¼Œç”¨æ¥è¯»å†™å•ä¸ªå­—èŠ‚æˆ–è€…å­—èŠ‚æ•°ç»„</p><ul><li>InputStreamç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±» ,æ˜¯æ‰€æœ‰å­—èŠ‚è¾“å…¥æµç±»çš„çˆ¶ç±»ã€‚</li><li>OutputStreamç±»æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œæ˜¯æ‰€æœ‰å­—èŠ‚è¾“å‡ºæµçš„çˆ¶ç±»</li></ul><p>ä»–ä¿©å¸¸è§çš„å­ç±»æœ‰ï¼š</p><table><thead><tr><th>InputStreamçš„å¸¸è§å­ç±»</th><th>æè¿°</th></tr></thead><tbody><tr><td>FileInputStream</td><td>ç”¨äºä»æ–‡ä»¶ä¸­è¯»å–ä¿¡æ¯</td></tr><tr><td>ByteArrayInputStream</td><td>å­—èŠ‚æ•°ç»„è¾“å…¥æµ</td></tr><tr><td>ObjectInputStream</td><td>åºåˆ—åŒ–æ—¶ä½¿ç”¨ ä¸€èˆ¬å’ŒObjectOutputStreamä¸€èµ·ä½¿ç”¨</td></tr><tr><td>FilterInputStream</td><td>è¿‡æ»¤è¾“å…¥æµ,ä¸ºåŸºç¡€çš„è¾“å…¥æµæä¾›ä¸€äº›é¢å¤–çš„æ“ä½œ</td></tr></tbody></table><table><thead><tr><th>OutputStreamçš„å¸¸è§å­ç±»</th><th>æè¿°</th></tr></thead><tbody><tr><td>FileOutPutStream</td><td>æ–‡ä»¶è¾“å‡ºæµå¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œ</td></tr><tr><td>ByteArrayOutputStream</td><td>å­—èŠ‚æ•°ç»„è¾“å‡ºæµ</td></tr><tr><td>ObjectOutputStream</td><td>åºåˆ—åŒ–æ—¶ä½¿ç”¨ ä¸€èˆ¬å’ŒOjbectInputStreamä¸€èµ·ä½¿ç”¨</td></tr><tr><td>FilterOutputStream</td><td>è¿‡æ»¤è¾“å‡ºæµ,ä¸ºåŸºç¡€çš„è¾“å‡ºæµæä¾›ä¸€äº›é¢å¤–çš„æ“ä½œ</td></tr></tbody></table><p>ä¸¾ä¸ªæ —å­ï¼Œæˆ‘ä»¬å¾€Fç›˜ä¸‹é¢hello.txté‡Œé¢è¾“å…¥â€œhello worldâ€ï¼Œå†å°†ä»–è¯»å‡ºæ¥ï¼Œåœ¨ç¨‹åºé‡Œé¢è¾“å‡º</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Courseware-Backend-Java-2022</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å­—èŠ‚æµTest</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-11-22 09:02</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Byte</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">//æ ¹æ®æ–‡ä»¶å¤¹çš„åå­—æ¥åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fileOutputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;F:\\hello.txt&quot;</span>);</span><br><span class="line">        <span class="comment">//å¾€æ–‡ä»¶é‡Œé¢ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„å†™å…¥æ•°æ®</span></span><br><span class="line">        fileOutputStream.write((<span class="type">int</span>)<span class="string">&#x27;h&#x27;</span>);</span><br><span class="line">        fileOutputStream.write((<span class="type">int</span>)<span class="string">&#x27;e&#x27;</span>);</span><br><span class="line">        fileOutputStream.write((<span class="type">int</span>)<span class="string">&#x27;l&#x27;</span>);</span><br><span class="line">        fileOutputStream.write((<span class="type">int</span>)<span class="string">&#x27;l&#x27;</span>);</span><br><span class="line">        fileOutputStream.write((<span class="type">int</span>)<span class="string">&#x27;o&#x27;</span>);</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å…¥æ–‡ä»¶é‡Œé¢ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„å†™å…¥æ–‡ä»¶</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot; world&quot;</span>;</span><br><span class="line">        fileOutputStream.write(s.getBytes());</span><br><span class="line">        fileOutputStream.close();</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¼ æ–‡ä»¶å¤¹çš„åå­—æ¥åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fileInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;F:\\hello.txt&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚çš„è¯»å‡ºæ•°æ®</span></span><br><span class="line">        <span class="keyword">while</span>((len = fileInputStream.read()) != -<span class="number">1</span>)&#123;</span><br><span class="line">            System.out.println((<span class="type">char</span>)len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…³é—­æµ</span></span><br><span class="line">        fileInputStream.close();</span><br><span class="line">        <span class="comment">//é€šè¿‡Fileå¯¹è±¡æ¥åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        fileInputStream = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;F:\\hello.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="type">byte</span> []bytes = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">//ä¸€ä¸ªå­—èŠ‚æ•°ç»„çš„è¯»å‡ºæ•°æ®</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fileInputStream.read(bytes)) != -<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt; len ; i++)&#123;</span><br><span class="line">                System.out.print((<span class="type">char</span>) bytes[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//å…³é—­æµ</span></span><br><span class="line">        fileInputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†æ¥ä¸ªæ —å­ï¼Œå¤åˆ¶æŸä¸ªä½ç½®çš„å›¾ç‰‡ï¼Œåˆ°æŒ‡å®šä½ç½®ä¸‹ã€‚å¹³å¸¸æˆ‘ä»¬éƒ½æ˜¯ç”¨CVæ¥å¤åˆ¶ç²˜è´´ï¼Œè¿™æ¬¡æˆ‘ä»¬ç”¨ç¨‹åºæ¥æ“ä½œï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Courseware-Backend-Java-2022</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: å¤åˆ¶å›¾ç‰‡Test</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-11-22 09:05</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyPhoto</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1.åˆ›å»ºæµå¯¹è±¡</span></span><br><span class="line">        <span class="comment">// 1.1 æŒ‡å®šæ•°æ®æº</span></span><br><span class="line">        <span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;F:\\å…ƒå¸…çš„è‰ºæœ¯.jpg&quot;</span>);</span><br><span class="line">        <span class="comment">// 1.2 æŒ‡å®šç›®çš„åœ°</span></span><br><span class="line">        <span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;test_copy.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.è¯»å†™æ•°æ®</span></span><br><span class="line">        <span class="comment">// 2.1 å®šä¹‰æ•°ç»„</span></span><br><span class="line">        <span class="type">byte</span>[] b = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="comment">// 2.2 å®šä¹‰é•¿åº¦</span></span><br><span class="line">        <span class="type">int</span> len;</span><br><span class="line">        <span class="comment">// 2.3 å¾ªç¯è¯»å–</span></span><br><span class="line">        <span class="keyword">while</span> ((len = fis.read(b))!=-<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// 2.4 å†™å‡ºæ•°æ®</span></span><br><span class="line">            fos.write(b, <span class="number">0</span> , len);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.å…³é—­èµ„æº</span></span><br><span class="line">        fos.close();</span><br><span class="line">        fis.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸºæœ¬ä¸Šæˆ‘ä»¬å¹³å¸¸å¦‚æœæœ‰ä½¿ç”¨åˆ°IOæµçš„åœ°æ–¹ï¼Œå¸¸ç”¨çš„æ–¹æ³•å°±ä¸Šé¢æ —å­é‡Œé¢ä½¿ç”¨åˆ°çš„å‡ ä¸ªï¼Œè¯¦ç»†çš„æ–¹æ³•å„ä½å¯ä»¥å‚ç…§å®˜æ–¹æ–‡æ¡£ï¼Œæˆ–è€…CSDNä¸Šåšä¸»ä»¬æ€»ç»“çš„ã€‚è¿™é‡Œå°±ä¸é€ èµ˜è¿°äº†ã€‚</p><p>é™¤äº†<code>FileInputStream</code>å‰©ä¸‹3ä¸ª<code>InputStream</code>çš„å­ç±»ï¼Œå¹³å¸¸å¼€å‘ä¸­ä¸ç»å¸¸ç”¨åˆ°ï¼Œæœ‰å…´è¶£çš„å¯ä»¥è‡ªè¡Œäº†è§£ã€‚</p><h2 id="ğŸ“æ³›å‹T-R"><a class="header-anchor" href="#ğŸ“æ³›å‹T-R">Â¶</a>ğŸ“æ³›å‹T\R</h2><h3 id="æ³›å‹çš„è§£é‡Š"><a class="header-anchor" href="#æ³›å‹çš„è§£é‡Š">Â¶</a>æ³›å‹çš„è§£é‡Š</h3><blockquote><p>æ³›å‹å±äºä¸€ç§ç¨‹åºè¯­è¨€çš„æ ‡å‡†å’Œè§„èŒƒï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¯´ä¸ºç‰¹æ€§</p></blockquote><p>é€šä¿—è§£é‡Šå°±æ˜¯ï¼šæ³›å‹å…¶å®å°±æ˜¯æˆ‘ä»¬å‚æ•°åŒ–ç±»å‹ï¼Œå°±æ¯”å¦‚åœ¨å®šä¹‰Listçš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä½œ<code>List&lt;String&gt;</code>è¿™æ ·æˆ‘ä»¬å°±åœ¨ç¼–ç é˜¶æ®µï¼Œå°†Listå­˜æ”¾çš„ç±»å‹å®šä¹‰å¥½ã€‚è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨æ“ä½œListçš„æ—¶å€™å°±å¯ä»¥é€šè¿‡æ³›å‹å¯¹æˆ‘ä»¬é›†åˆå†…çš„å€¼è¿›è¡Œè§„èŒƒå’Œçº¦æŸï¼Œå¦‚æœæˆ‘ä»¬ä¼ å…¥éæ³•çš„ç±»å‹æ—¶ç¨‹åºåœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½å¸®æˆ‘ä»¬æ‰¾å‡ºé—®é¢˜ï¼Œå°±ä¸ä¼šå‡ºç°éšå½¢çš„å¼‚å¸¸ã€‚</p><p>å°±æ¯”å¦‚ä¸‹é¢çš„æ¢¨å­ï¼Œå¦‚æœæˆ‘ä»¬ä¸é€šè¿‡æ³›å‹è¿›è¡Œçº¦æŸï¼Œç›´æ¥å¼€å†™ï¼Œåœ¨è¿è¡Œä»£ç çš„æ—¶å€™æˆ‘ä»¬éƒ½æ˜¯ä¸çŸ¥é“ä¼šå‡ºé”™çš„ï¼Œåªæœ‰å½“ç¨‹åºrunåˆ°è¿™å¥è¯çš„æ—¶å€™æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">list.add(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">list.add(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i&lt; list.size();i++)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;æ‰§è¡Œåˆ°ç¬¬ &quot;</span> + (i+<span class="number">1</span>) + <span class="string">&quot; æ¬¡å¾ªç¯ã€‚&quot;</span>);</span><br><span class="line"> Â  Â <span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> (String) list.get(i);</span><br><span class="line"> Â  Â System.out.println(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>runè¿‡åï¼Œæ‰§è¡Œç»“æœï¼š</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">æ‰§è¡Œåˆ°ç¬¬ 1 æ¬¡å¾ªç¯ã€‚</span><br><span class="line">abc</span><br><span class="line">æ‰§è¡Œåˆ°ç¬¬ 2 æ¬¡å¾ªç¯ã€‚</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ClassCastException: java.lang.Integer cannot be cast to java.lang.String</span><br><span class="line">    at com.zhj.business.test.Test01.main(Test01.java:18)</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹å‡ºç¨‹å®Œæ•´çš„å®Œæˆäº†ç¬¬ä¸€æ¬¡for</p><p>ä½†æ˜¯åœ¨ç¬¬äºŒæ¬¡forçš„æ—¶å€™è§¦å‘äº†ç±»è½¬æ¢å¼‚å¸¸<code>ClassCastException</code></p><p>å½“é¡¹ç›®å¾ˆå¤§çš„æ—¶å€™ï¼Œåƒè¿™æ ·çš„ç»†èŠ‚æ˜¯å¾ˆå®¹æ˜“è¢«å¿½ç•¥çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡æ³›å‹ï¼Œçº¦æŸç±»å‹ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æä¾›æ•°æ®ä¿å­˜æ˜¯å¯¹åº”ç±»å‹å³å¯ï¼Œä¸éœ€è¦è¿›è¡Œå¼ºè½¬ï¼Œå°±ä¸ä¼šå‡ºç°ä¸Šè¿°é—®é¢˜</p><h3 id="æ³›å‹çš„ç”¨æ³•"><a class="header-anchor" href="#æ³›å‹çš„ç”¨æ³•">Â¶</a>æ³›å‹çš„ç”¨æ³•</h3><p>æ³›å‹ä¸€å…±æœ‰ä¸‰ç§ç”¨æ³•ï¼Œåˆ†åˆ«ä¸ºï¼š</p><ul><li><p>æ³›å‹ç±»</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@program</span>: Courseware-Backend-Java-2022</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span>: è¿”å›ç»“æœç±»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>: YxYL</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@create</span>: 2022-11-22 09:32</span></span><br><span class="line"><span class="comment"> **/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * çŠ¶æ€ç </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¶ˆæ¯</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¿”å›æ•°æ®</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Result</span><span class="params">(Integer code, String msg, T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCode</span><span class="params">(Integer code)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMsg</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMsg</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> T <span class="title function_">getData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setData</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ªï¼Œç”±æˆ‘ä»¬è‡ªå·±    å®šä¹‰ç±»å‹çš„æ•°æ®åŸŸ   çš„å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Result&lt;String&gt; r1 = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">r1.setData(<span class="string">&quot;111&quot;</span>);</span><br><span class="line"></span><br><span class="line">Result&lt;Integer&gt; r2 = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">r2.setData(<span class="number">111</span>);</span><br><span class="line"></span><br><span class="line">Result&lt;Boolean&gt; r3 = <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;();</span><br><span class="line">r3.setData(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure></li><li><p>æ³›å‹æ¥å£</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">List</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">Collection</span>&lt;E&gt; &#123;</span><br><span class="line">......</span><br><span class="line">&#125; Â  Â </span><br></pre></td></tr></table></figure></li><li><p>æ³›å‹æ–¹æ³•<br>Listæ¥å£ä¸­çš„<code>toArray()</code>æ–¹æ³•å°±æ˜¯ç»å…¸çš„æ³›å‹æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ³›å‹æ–¹æ³•çš„åŸºæœ¬ä»‹ç»</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> T[] ä¼ å…¥çš„æ³›å‹å®å‚</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> T[] è¿”å›å€¼ä¸ºT[]ç±»å‹</span></span><br><span class="line"><span class="comment"> * è¯´æ˜ï¼š</span></span><br><span class="line"><span class="comment"> * Â  Â  1ï¼‰publicä¸è¿”å›å€¼ä¸­é—´çš„&lt;T&gt;ï¼Œå¯ä»¥ç†è§£ä¸ºå£°æ˜æ­¤æ–¹æ³•ä¸ºæ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> * Â  Â  2ï¼‰åªæœ‰å£°æ˜äº†&lt;T&gt;çš„æ–¹æ³•æ‰æ˜¯æ³›å‹æ–¹æ³•ï¼Œæ³›å‹ç±»ä¸­çš„ä½¿ç”¨äº†æ³›å‹çš„æˆå‘˜æ–¹æ³•å¹¶ä¸æ˜¯æ³›å‹æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="comment"> * Â  Â  3ï¼‰&lt;T&gt;è¡¨æ˜è¯¥æ–¹æ³•å°†ä½¿ç”¨æ³›å‹ç±»å‹Tï¼Œæ­¤æ—¶æ‰å¯ä»¥åœ¨æ–¹æ³•ä¸­ä½¿ç”¨æ³›å‹ç±»å‹Tã€‚</span></span><br><span class="line"><span class="comment"> * Â  Â  4ï¼‰ä¸æ³›å‹ç±»çš„å®šä¹‰ä¸€æ ·ï¼Œæ­¤å¤„Tå¯ä»¥éšä¾¿å†™ä¸ºä»»æ„æ ‡è¯†ï¼Œå¸¸è§çš„å¦‚Tã€Eã€Kã€Vç­‰å½¢å¼çš„å‚æ•°å¸¸ç”¨äºè¡¨ç¤ºæ³›å‹ã€‚</span></span><br><span class="line"><span class="comment"> * Â  Â  5ï¼‰å¿…é¡»åœ¨æƒé™å£°æ˜publicä¸è¿”å›å€¼ä¹‹é—´çš„&lt;T&gt;ä¸Šæ·»åŠ ä¸Šä¸‹è¾¹ç•Œï¼Œå³åœ¨æ³›å‹å£°æ˜çš„æ—¶å€™æ·»åŠ </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; T[] toArray(T[] a) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> size();</span><br><span class="line">    <span class="keyword">if</span> (a.length &lt; size)</span><br><span class="line"> Â       <span class="keyword">return</span> Arrays.copyOf(<span class="built_in">this</span>.a, size,(Class&lt;? <span class="keyword">extends</span> <span class="title class_">T</span>[]&gt;) a.getClass());</span><br><span class="line"> Â  Â System.arraycopy(<span class="built_in">this</span>.a, <span class="number">0</span>, a, <span class="number">0</span>, size);</span><br><span class="line"> Â  Â <span class="keyword">if</span> (a.length &gt; size)</span><br><span class="line"> Â  Â  Â  Â a[size] = <span class="literal">null</span>;</span><br><span class="line"> Â  Â <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>ä½¿ç”¨æ³›å‹æ–¹æ³•çš„æ—¶å€™ï¼Œé€šå¸¸ä¸å¿…æŒ‡æ˜ç±»å‹å‚æ•°ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¼šä¸ºæˆ‘ä»¬æ‰¾å‡ºå…·ä½“çš„ç±»å‹ã€‚</p><p>è¿™ç§°ä¸ºç±»å‹å‚æ•°æ¨æ–­<code>(type argument inference)</code>ç±»å‹æ¨æ–­åªå¯¹èµ‹å€¼æ“ä½œæœ‰æ•ˆï¼Œå…¶ä»–æ—¶å€™å¹¶ä¸èµ·ä½œç”¨</p><blockquote><p>å…³äºæ³›å‹æ•°ç»„ï¼šåœ¨Javaä¸­ï¼Œåœ¨runningæ—¶åœ¨æ•°æ®ä¸­æ¨é€ä»»ä½•ä¸å…¼å®¹çš„ç±»å‹å°†æŠ›å‡º<code>ArrayStoreException</code></p><p>è¿™æ„å‘³ç€æ•°æ®åœ¨runningæ—¶ä¿ç•™æœŸç±»å‹ä¿¡æ¯ï¼Œè€Œæ³›å‹åœ¨runningæ—¶ä½¿ç”¨ç±»å‹æ“¦é™¤ï¼Œç”±äºä¸Šè¿°å†²çªï¼Œä¸å…è®¸åœ¨Javaä¸­å®ä¾‹åŒ–æ³›å‹æ•°ç»„</p></blockquote><h3 id="ç±»å‹é€šé…"><a class="header-anchor" href="#ç±»å‹é€šé…">Â¶</a>ç±»å‹é€šé…</h3><p>åœ¨æ³›å‹ä»£ç ä¸­ï¼Œ<code>?</code>é€šé…ç¬¦è¡¨ç¤ºä½ç½®ç±»å‹ã€‚ä¾‹å¦‚<code>List&lt;?&gt;</code>ï¼Œåœ¨é€»è¾‘ä¸Šæ˜¯Listã€Listç­‰æ‰€æœ‰List&lt;ç±»å‹å®å‚&gt;çš„çˆ¶ç±»</p><h4 id="æ— ç•Œé€šé…ç¬¦"><a class="header-anchor" href="#æ— ç•Œé€šé…ç¬¦">Â¶</a>æ— ç•Œé€šé…ç¬¦</h4><p><code>&lt;?&gt;</code>å«åšæ— ç•Œé€šé…ç¬¦ï¼Œæ„å‘³ç€å¯¹ç±»å‹å®å‚æ²¡æœ‰ä»»ä½•é™åˆ¶</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ArrayList&lt;?&gt;  list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Long&gt;();  </span><br><span class="line">ArrayList&lt;?&gt;  list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();  </span><br><span class="line">ArrayList&lt;?&gt;  list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Employee&gt;();  </span><br></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨æ— ç•Œé€šé…ç¬¦æ¥ç¼©å°ç±»å‹å‚æ•°çš„ç±»å‹èŒƒå›´</p><h4 id="ä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦"><a class="header-anchor" href="#ä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦">Â¶</a>ä¸Šç•Œé€šé…ç¬¦å’Œä¸‹ç•Œé€šé…ç¬¦</h4><p>è¿™é‡Œå°±ä¸è®²ä¸Šä¸‹ç•Œé€šé…ç¬¦äº†ï¼Œä¸€æ˜¯å¹³å¸¸å¼€å‘çš„æ—¶å€™ä¸€èˆ¬æ¥è¯´ä¸ç”¨æˆ‘ä»¬æ‰‹å†™é€šé…ç¬¦ï¼›äºŒæ˜¯ç¡®å®æœ‰ç‚¹éš¾ä»¥ç†è§£ï¼Œå„ä½å¦‚æœæœ‰ä½™åŠ›çš„å¯ä»¥è‡ªå·±ä¸‹æ¥é’»ç ” â€”â€”&gt; <a href="https://juejin.cn/post/7126717331522191368">è¿™é‡Œ</a></p><h3 id="æ³›å‹ä¸è¢«å…è®¸çš„é‚£äº›äº‹å„¿"><a class="header-anchor" href="#æ³›å‹ä¸è¢«å…è®¸çš„é‚£äº›äº‹å„¿">Â¶</a>æ³›å‹ä¸è¢«å…è®¸çš„é‚£äº›äº‹å„¿</h3><ul><li><p><strong>ä¸èƒ½åœ¨ç±»ä¸­å®šä¹‰æ³›å‹å‚æ•°åŒ–çš„é™æ€å±æ€§ã€‚</strong><br>ä»»ä½•è¿™æ ·åšçš„å°è¯•éƒ½ä¼šäº§ç”Ÿç¼–è¯‘æ—¶é”™è¯¯ï¼š<code>Cannot make a static reference to the non-static type T.</code><br>æ¯”å¦‚åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsExample</span>&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">static</span> T member; <span class="comment">//ç¼–è¯‘ä¸é€šè¿‡</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="C:/Users/%E9%9B%B7%E7%A5%9E%E6%88%98%E6%9C%BA/AppData/Roaming/Typora/typora-user-images/image-20221122191241756.png" align="left" alt="image-20221122191241756" style="zoom:150%;" /></li><li><p><strong>ä¸èƒ½åˆ›å»ºç±»å‹å‚æ•°çš„å®ä¾‹ã€‚</strong><br>ä»»ä½•åˆ›å»ºTå®ä¾‹çš„å°è¯•éƒ½å°†å¤±è´¥<br>æŠ›å‡ºç¼–è¯‘é”™è¯¯ï¼š<code>Cannot instantiate the type T</code><br>æ¯”å¦‚åƒè¿™æ ·</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericsExample</span>&lt;T&gt;</span><br><span class="line">&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">GenericsExample</span><span class="params">()</span>&#123;</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">T</span>();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122191414631.png" align="left" alt="image-20221122191414631" style="zoom:150%;" /></li><li><p><strong>æ³›å‹çš„ç±»å‹å‚æ•°ä¸èƒ½æ˜¯åŸºç¡€ç±»å‹</strong><br>æ³›å‹çš„ç±»å‹å‚æ•°ä¸èƒ½ä½¿ç”¨<code>int</code> <code>double</code>è¿™æ ·çš„åŸºæœ¬ç±»å‹ï¼Œå¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¦‚æœéœ€è¦ï¼Œè¯·ä½¿ç”¨èµ·å¯¹åº”çš„åŒ…è£…ç±»å‹<code>Integer</code> <code>Double</code>ç­‰<br>æ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;<span class="type">int</span>&gt; list1 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();    <span class="comment">// ä¸å…è®¸</span></span><br><span class="line">List&lt;Integer&gt; list2 = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">//å¯ä»¥</span></span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122191324448.png" align="left" alt="image-20221122191324448" style="zoom:150%;" /></li><li><p><strong>ä¸èƒ½åˆ›å»ºæ³›å‹çš„å¼‚å¸¸ç±»</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenericException</span>&lt;T&gt; <span class="keyword">extends</span> <span class="title class_">Exception</span> &#123;&#125;</span><br></pre></td></tr></table></figure><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122191100836.png" align="left" alt="image-20221122191100836" style="zoom: 150%;" /></li></ul><h2 id="ğŸ°çº¿ç¨‹"><a class="header-anchor" href="#ğŸ°çº¿ç¨‹">Â¶</a>ğŸ°çº¿ç¨‹</h2><p><strong>ä»€ä¹ˆæ˜¯çº¿ç¨‹ï¼Ÿ</strong></p><blockquote><p>çº¿ç¨‹æ˜¯ç¨‹åºæ‰§è¡Œçš„æ—¶å€™æœ€å°å•ä½ï¼Œä»–æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½</p></blockquote><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰å¾ˆå¤šä¸ªçº¿ç¨‹ç»„æˆï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«è¿›ç¨‹çš„æ‰€æœ‰èµ„æºï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„å †æ ˆå’Œå±€éƒ¨å˜é‡</p><p>çº¿ç¨‹æœ‰CPUç‹¬ç«‹è°ƒåº¦æ‰§è¡Œï¼Œåœ¨å¤šCPUç¯å¢ƒä¸‹å°±å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œã€‚åŒæ ·å¤šçº¿ç¨‹ä¹Ÿå¯ä»¥å®ç°å¹¶å‘æ“ä½œï¼Œæ¯ä¸ªè¯·æ±‚åˆ†é…ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122195404294.png" align="left" alt="image-20221122195356392" style="zoom:80%;" /><p><strong>ä»€ä¹ˆæ˜¯è¿›ç¨‹ï¼Ÿ</strong></p><blockquote><p>è¿›ç¨‹æ˜¯èµ„æº(CPUã€å†…å­˜ç­‰ç­‰)åˆ†é…çš„æœ€å°ï¼Œæˆ–è€…è¯´åŸºæœ¬å•ä½ï¼Œä»–æ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹</p></blockquote><p>ç¨‹åºrunçš„æ—¶å€™ç³»ç»Ÿå°±ä¼šåˆ›å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œå¹¶ä¸ºä»–åˆ†é…èµ„æºï¼Œç„¶åå§è¿™ä¸ªè¿›ç¨‹æ”¾åˆ°è¿›ç¨‹å°±ç»ªé˜Ÿåˆ—ï¼Œè¿›ç¨‹è°ƒåº¦å™¨é€‰ä¸­å®ƒçš„æ—¶å€™ï¼Œå°±ä¼šä¸ºä»–åˆ†é…CPUæ—¶é—´ï¼Œç¨‹åºçœŸæ­£å¼€å§‹run</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221122195356392.png" align="left" alt="image-20221122195356392" style="zoom:80%;" /><p><strong>çº¿ç¨‹å’Œè¿›ç¨‹çš„åŒºåˆ«</strong></p><p>æ ¹æ®ä¸Šé¢çš„ä¸€äº›ä»‹ç»ï¼Œæˆ‘ä»¬çŸ¥é“çš„æ˜¯è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µæ˜¯åœ¨å»ºç«‹åœ¨æ“ä½œç³»ç»Ÿå±‚é¢ä¸Šçš„</p><p>è¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œï¼Œè¿›ç¨‹æ˜¯èµ„æºï¼ˆCPUã€å†…å­˜ç­‰ï¼‰åˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç¨‹åºæ‰§è¡Œæ—¶çš„ä¸€ä¸ªå®ä¾‹ã€‚</p><p>çº¿ç¨‹æ˜¯ CPU çš„åŸºæœ¬è°ƒåº¦å•ä½ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªæ‰§è¡Œæµã€‚</p><p>åœ¨ Java ç¨‹åºä¸­ä½“ç°åœ¨ main æ–¹æ³•çš„æ‰§è¡Œæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬åœ¨ main æ–¹æ³•ä¸­é€šè¿‡ Thread ç±»æ¥åˆ›å»ºå¤šä¸ªçº¿ç¨‹è¿›è€Œè¿è¡Œä»–ä»¬ï¼Œä¹Ÿå°±è¾¾åˆ°å¤šçº¿ç¨‹çš„ç›®çš„ã€‚</p><h3 id="åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼"><a class="header-anchor" href="#åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼">Â¶</a>åˆ›å»ºçº¿ç¨‹çš„å‡ ç§æ–¹å¼</h3><p>é‚£ä¹ˆæˆ‘ä»¬æ¥å¦‚ä½•å®ç°å¤šçº¿ç¨‹å‘¢ï¼š</p><ul><li>ç»§æ‰¿Threadå¯¹è±¡</li><li>é‡å†™runæ–¹æ³•</li><li>åˆ›å»ºçº¿ç¨‹å¯¹è±¡</li><li>è°ƒç”¨start()æ–¹æ³•</li></ul><p>è¿™é‡Œæˆ‘ä»¬ä»‹ç»4ç§æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹</p><h4 id="å®ç°Runableæ¥å£"><a class="header-anchor" href="#å®ç°Runableæ¥å£">Â¶</a>å®ç°Runableæ¥å£</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">          System.out.println(Thread.currentThread().getName()+<span class="string">&quot;çº¿ç¨‹è·‘èµ·æ¥äº†!!!&quot;</span>);        </span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><h4 id="Callable-Future-Taskæ–¹æ³•"><a class="header-anchor" href="#Callable-Future-Taskæ–¹æ³•">Â¶</a>Callable+Future Taskæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;String&gt; &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> n;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">MyCallable</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">       <span class="built_in">this</span>.n = n;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//é‡å†™callæ–¹æ³•(ä»»åŠ¡æ–¹æ³•)(æ±‚nçš„åŠ å’Œ)</span></span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> String <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">           sum += i;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;å­çº¿ç¨‹æ‰§è¡Œçš„ç»“æœæ˜¯ï¼š&quot;</span> + sum;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="åŒ¿åå†…éƒ¨ç±»"><a class="header-anchor" href="#åŒ¿åå†…éƒ¨ç±»">Â¶</a>åŒ¿åå†…éƒ¨ç±»</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">new</span> <span class="title class_">Thread</span>(</span><br><span class="line">     () -&gt; &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å­çº¿ç¨‹æ‰§è¡Œè¾“å‡º&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">).start();</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬æ¥å¯¹æ¯”ä¸€ä¸‹è¿™3ç§æ–¹å¼</p><table><thead><tr><th style="text-align:left">æ–¹å¼</th><th style="text-align:center">ä¼˜ç‚¹</th><th style="text-align:center">ç¼ºç‚¹</th></tr></thead><tbody><tr><td style="text-align:left">ç»§æ‰¿Threadç±»</td><td style="text-align:center">ç¼–ç¨‹æ¯”è¾ƒç®€å•</td><td style="text-align:center">æ‰©å±•æ€§å·®</td></tr><tr><td style="text-align:left">å®ç°Runnableæ¥å£</td><td style="text-align:center">æ‰©å±•æ€§å¼º</td><td style="text-align:center">ç›¸å¯¹å¤æ‚ï¼Œæ²¡æœ‰è¿”å›ç»“æœ</td></tr><tr><td style="text-align:left">å®ç°Callable+FutureTaskæ¥å£</td><td style="text-align:center">æ‰©å±•æ€§å¼ºï¼Œå¯å¾—åˆ°ç»“æœ</td><td style="text-align:center">ç¼–ç¨‹å¤æ‚</td></tr></tbody></table><p>ç»†å¿ƒçš„ä½ è‚¯å®šå·²ç»å‘ç°äº†ï¼Œæ˜æ˜ä¸Šé¢è¯´çš„æ˜¯ã€Šå››ç§æ–¹å¼ã€‹ï¼Œä½†è¿™é‡Œåªè®²äº†ä¸‰ç§ï¼Œè¯¶~ä½ åˆ«æ€¥</p><p>é™¤äº†ç»§æ‰¿Threadç±»ï¼Œå®ç°Runnableæ¥å£ï¼Œå®ç°Callableæ¥å£ä¹‹å¤–ï¼Œæœ€åä¸€ç§åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼å°±æ˜¯ç”¨çº¿ç¨‹æ± çš„æ–¹å¼ï¼Œåˆ›å»ºç®¡ç†çº¿ç¨‹ã€‚</p><h3 id="çº¿ç¨‹æ± "><a class="header-anchor" href="#çº¿ç¨‹æ± ">Â¶</a>çº¿ç¨‹æ± </h3><blockquote><ul><li>çº¿ç¨‹æ± é‡Œå›ºå®šä¾ä¸€äº›çº¿ç¨‹ï¼Œå¹¶é‡å¤åˆ©ç”¨è¿™äº›çº¿ç¨‹</li><li>æœ‰åˆ©äºç³»ç»Ÿè¿›ç¨‹ï¼Œé˜²æ­¢èµ„æºçš„è€—å°½</li></ul></blockquote><p>â€‹<strong>å¦‚ä½•å¾—åˆ°çº¿ç¨‹æ± å¯¹è±¡ï¼š</strong></p><blockquote><ul><li>ä½¿ç”¨**ExecutorServiceï¼ˆæ¥å£ï¼‰**çš„å®ç°ç±»ï¼š<strong>TreadPollExecutor</strong> è‡ªåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="type">ExecutorService</span> <span class="variable">pools</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">            <span class="number">3</span>,<span class="comment">//æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•° corePoolSize</span></span><br><span class="line">            <span class="number">5</span>,<span class="comment">//æœ€å¤§çº¿ç¨‹é‡ maximumPoolSize</span></span><br><span class="line">            <span class="number">8</span>,<span class="comment">//æœ€å¤§æ—¶é—´ keepAliveTime</span></span><br><span class="line">            TimeUnit.SECONDS,<span class="comment">//</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">6</span>),<span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">            Executors.defaultThreadFactory(),<span class="comment">//çº¿ç¨‹å·¥å‚</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());<span class="comment">//ä»»åŠ¡æ‹’ç»ç­–ç•¥</span></span><br></pre></td></tr></table></figure><ul><li>è¿™ä¸ƒä¸ªå‚æ•°ä¾¿æ˜¯</li></ul><ol><li>int <code>corePoolSize</code>ï¼š<strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong></li><li>int <code>maximumPoolSize</code>ï¼š<strong>æœ€å¤§åˆ›å»ºçº¿ç¨‹æ•°</strong></li><li>long <code>keepAliveTime</code>ï¼š<strong>å­˜æ´»æ—¶é—´</strong></li><li>TimeUnit <code>unit</code>ï¼š<strong>Timeç±»ç®¡ç†å·¥å…·</strong></li><li>BlockingQueue<Runnable> <code>workQueue</code>ï¼šæŒ‡å®šé˜»å¡é˜Ÿåˆ—</li><li>ThreadFactory <code>threadFactory</code>ï¼š<strong>çº¿ç¨‹å·¥å‚</strong></li><li>RejectedExecutionHandler <code>handler</code>ï¼š<strong>æ‹’ç»ç­–ç•¥</strong></li></ol><ul><li>ä½¿ç”¨ <strong>Executor</strong> ï¼ˆçº¿ç¨‹æ± å¯¹è±¡çš„å·¥å…·ç±»ï¼‰è°ƒç”¨æ–¹æ³•è¿”å›ä¸åŒç‰¹ç‚¹çš„çº¿ç¨‹æ± å¯¹è±¡</li></ul></blockquote><h4 id="å¤„ç†Runnableä»»åŠ¡"><a class="header-anchor" href="#å¤„ç†Runnableä»»åŠ¡">Â¶</a>å¤„ç†Runnableä»»åŠ¡</h4><blockquote><p><strong>å¦‚ä½•ä¸¢å…¥çº¿ç¨‹æ± (å¦‚ä½•å¤„ç†Runnableä»»åŠ¡)ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="comment">// ä½¿ç”¨é™æ€å˜é‡è®°ä½ä¸€ä¸ªçº¿ç¨‹æ± å¯¹è±¡</span></span><br><span class="line">&gt;<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ExecutorService</span> <span class="variable">pool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, TimeUnit.SECONDS,</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">2</span>),</span><br><span class="line">                                  Executors.defaultThreadFactory(),</span><br><span class="line">                                  <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="type">ExecutorService</span> <span class="variable">pools</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">          <span class="number">3</span>,<span class="comment">//æ ¸å¿ƒçº¿ç¨‹ä¸ªæ•° corePoolSize</span></span><br><span class="line">          <span class="number">5</span>,<span class="comment">//æœ€å¤§çº¿ç¨‹é‡ maximumPoolSize</span></span><br><span class="line">          <span class="number">8</span>,<span class="comment">//æœ€å¤§æ—¶é—´ keepAliveTime</span></span><br><span class="line">          TimeUnit.SECONDS,<span class="comment">//</span></span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">6</span>),<span class="comment">//ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line">          Executors.defaultThreadFactory(),<span class="comment">//çº¿ç¨‹å·¥å‚</span></span><br><span class="line">          <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());<span class="comment">//ä»»åŠ¡æ‹’ç»ç­–ç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// pool çš„ execute æ–¹æ³•</span></span><br><span class="line">  pools.execute(() -&gt; &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">          System.out.println(Thread.currentThread() + <span class="string">&quot;èµ·é£ï¼ï¼ï¼&quot;</span> + <span class="string">&quot;ç¬¬&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  pools.execute(() -&gt; &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">          System.out.println(Thread.currentThread() + <span class="string">&quot;GGGGGG&quot;</span> + <span class="string">&quot;ç¬¬&quot;</span> + i + <span class="string">&quot;æ¬¡&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  pools.shutdown();</span><br></pre></td></tr></table></figure></blockquote><blockquote><p><strong>å¦‚ä½•å…³é—­çº¿ç¨‹æ± ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="comment">//(å¼€å‘ä¸­ä¸€èˆ¬ä¸ä¼šä½¿ç”¨)ã€‚</span></span><br><span class="line">&gt;pool.shutdownNow();<span class="comment">//ç«‹åˆ»å…³é—­ï¼Œå³ä½¿ä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œä¸¢å¤±ä»»åŠ¡çš„ã€‚</span></span><br><span class="line">&gt;pool.shutdowm();<span class="comment">//ä¼šç­‰å¾…å…¨éƒ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå†å…³é—­</span></span><br></pre></td></tr></table></figure></blockquote><p>ä¸ºä»€ä¹ˆå¤§å‹å¹¶å‘ç³»ç»Ÿç¯å¢ƒä¸­ä½¿ç”¨ <strong>Executors</strong> å¦‚æœä¸æ³¨æ„å¯èƒ½ä¼šå‡ºç°ç³»ç»Ÿé£é™©æï¼Ÿï¼Ÿï¼Ÿ</p><p>è¿™ä¸ªå°±ä½œä¸ºä½œä¸šï¼Œç•™ç»™å„ä½å•¦</p><h3 id="çº¿ç¨‹å®‰å…¨é—®é¢˜"><a class="header-anchor" href="#çº¿ç¨‹å®‰å…¨é—®é¢˜">Â¶</a>çº¿ç¨‹å®‰å…¨é—®é¢˜</h3><p>ä»€ä¹ˆæ˜¯çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼š</p><blockquote><p>å¤šä¸ªçº¿ç¨‹åŒæ—¶å…±å…±äº«ä¸€ä¸ªèµ„æºï¼Œå¹¶å¯¹ä»–è¿›è¡Œä¿®æ”¹</p></blockquote><p>æœ‰ä¸€å¤©ï¼Œè€å¸ˆå¸ƒç½®äº†è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š</p><p>ä½¿ç”¨ä¸¤ä¸ªçº¿ç¨‹å°†å˜é‡<code>count</code>è‡ªå¢<code>10</code>ä¸‡æ¬¡ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰¿æ‹…<code>5</code>ä¸‡æ¬¡çš„è‡ªå¢ä»»åŠ¡ï¼Œ</p><p>å˜é‡<code>count</code>çš„åˆå§‹å€¼ä¸º<code>0</code>ã€‚</p><p>è¿™ä¸ªé—®é¢˜å¾ˆç®€å•ï¼Œæœ€ç»ˆçš„ç»“æœæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿå£ç®—å‡ºæ¥ï¼Œç­”æ¡ˆå°±æ˜¯<code>10</code>ä¸‡ã€‚<br>å°æ˜åŒå­¦åšäº‹éå¸¸è¿…é€Ÿï¼Œå¾ˆå¿«å°±å†™å‡ºäº†ä¸‹é¢çš„ä¸€æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span> &#123;<span class="comment">//å®šä¹‰ä¸€ä¸ªèµ„æºç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span> &#123;</span><br><span class="line">        ++<span class="built_in">this</span>.count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">CNT</span> <span class="operator">=</span> <span class="number">50000</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Counter</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Counter</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; CNT; i++) &#123;</span><br><span class="line">                counter.increase();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; CNT; j++) &#123;</span><br><span class="line">                counter.increase();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        thread1.join();</span><br><span class="line">        thread2.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(counter.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œçš„ç»“æœæ¯”<code>10</code>ä¸‡è¦å°ï¼Œä½ å¯ä»¥è¯•ç€è¿è¡Œè¯¥ç¨‹åºä½ ä¼šå‘ç°æ¯æ¬¡è¿è¡Œçš„ç»“æœéƒ½ä¸ä¸€æ ·ï¼Œä½†ç»å¤§éƒ¨åˆ†æƒ…å†µï¼Œç»“æœéƒ½ä¼šæ¯”é¢„æœŸçš„å€¼è¦å°ï¼Œ</p><p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹è¿è¡Œäº†ä¸€ä¸ªç¨‹åºï¼Œå°†ä¸€ä¸ªå˜é‡å€¼ä¸º0çš„å˜é‡è‡ªå¢10ä¸‡æ¬¡ï¼Œä½†æ˜¯æœ€ç»ˆå®é™…ç»“æœæ¯”æˆ‘ä»¬é¢„æœŸç»“æœè¦å°ï¼Œ</p><p><strong>åŸå› å°±æ˜¯çº¿ç¨‹è°ƒåº¦çš„é¡ºåºæ˜¯éšæœºçš„ï¼Œé€ æˆçº¿ç¨‹é—´è‡ªå¢çš„æŒ‡ä»¤é›†äº¤å‰ï¼Œå¯¼è‡´è¿è¡Œæ—¶å‡ºç°ä¸¤æ¬¡è‡ªå¢ä½†å€¼åªè‡ªå¢ä¸€æ¬¡çš„æƒ…å†µï¼Œæ‰€ä»¥å¾—åˆ°çš„ç»“æœä¼šåå°ã€‚</strong></p><h4 id="è§£å†³æ–¹æ³•-çº¿ç¨‹åŒæ­¥"><a class="header-anchor" href="#è§£å†³æ–¹æ³•-çº¿ç¨‹åŒæ­¥">Â¶</a>è§£å†³æ–¹æ³• -&gt; çº¿ç¨‹åŒæ­¥</h4><p>çº¿ç¨‹åŒæ­¥çš„æ€æƒ³ï¼š</p><blockquote><p>åŠ é”ï¼šè®©å¤šä¸ªçº¿ç¨‹ä¾æ¬¡è®¿é—®åŒä¸€ä¸ªèµ„æº</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (someObject)&#123;</span><br><span class="line">  <span class="comment">//someObject ä¸º é”å¯¹è±¡ -&gt; å”¯ä¸€</span></span><br><span class="line">  <span class="comment">//æ­¤å¤„çš„ä»£ç åªæœ‰å æœ‰äº†someObjectåæ‰å¯ä»¥æ‰§è¡Œ</span></span><br><span class="line">  <span class="comment">//è¡Œä¸º</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">    <span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span> &#123;</span><br><span class="line">        ++<span class="built_in">this</span>.count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>é”å¯¹è±¡ä¸º <strong>ä»»æ„çš„</strong> å”¯ä¸€å¯¹è±¡åˆ°åº•å¥½ä¸å¥½å‘¢ï¼š</p><ul><li>ä¸å¥½ï¼Œ<strong>å½±å“å…¶çº¿ç¨‹çš„è¿›è¡Œ</strong></li></ul><p>è§„èŒƒä¸Šï¼š</p><ul><li>å»ºè®®ä½¿ç”¨<strong>å…±äº«èµ„æº</strong>ä½œä¸ºé”å¯¹è±¡ï¼š</li><li>å¯¹äºå®ä¾‹æ–¹æ³•å»ºè®®ä½¿ç”¨<strong>this</strong>ä½œä¸ºé”å¯¹è±¡</li><li>å¯¹äºé™æ€æ–¹æ³•å»ºè®®ä½¿ç”¨**å­—èŠ‚ç ï¼ˆç±»åï¼šclassï¼‰**å¯¹è±¡ä½œä¸ºé”å¯¹è±¡</li></ul><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">synchronized</span> (<span class="built_in">this</span>)&#123;<span class="comment">//è¿™é‡Œå°±ç›´æ¥ç”¨thiså…³é”®å­—</span></span><br><span class="line">          ++<span class="built_in">this</span>.count;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>.count;</span><br><span class="line">  &#125;</span><br><span class="line">&gt;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></blockquote><h4 id="åŒæ­¥æ–¹æ³•"><a class="header-anchor" href="#åŒæ­¥æ–¹æ³•">Â¶</a>åŒæ­¥æ–¹æ³•</h4><blockquote><p>ç›´æ¥åœ¨è¿”å›å€¼ç±»å‹(int void longÂ·Â·Â·)å‰é¢ +  <strong>synchronized</strong>å°±å¯ä»¥äº†</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;<span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">&gt;<span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> count;</span><br><span class="line"> <span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">increase</span><span class="params">()</span> &#123;</span><br><span class="line">     ++count;</span><br><span class="line">&gt;&#125;</span><br><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">this</span>.count;</span><br><span class="line">   &#125;</span><br><span class="line">&gt;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªç±»ï¼Œå…¶<strong>æ–¹æ³•éƒ½æ˜¯æœ‰synchronizedä¿®é¥°çš„</strong>ï¼Œé‚£ä¹ˆè¯¥ç±»å°±å«åš<strong>çº¿ç¨‹å®‰å…¨çš„ç±»</strong></p><p>åŒä¸€æ—¶é—´ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥ <strong>è¿™ç§ç±»çš„ä¸€ä¸ªå®ä¾‹</strong> çš„å»ä¿®æ”¹æ•°æ®ï¼Œè¿›è€Œä¿è¯äº†è¿™ä¸ªå®ä¾‹ä¸­çš„æ•°æ®çš„å®‰å…¨(ä¸ä¼šåŒæ—¶è¢«å¤šçº¿ç¨‹ä¿®æ”¹è€Œå˜æˆè„æ•°æ®)</p></blockquote><p>å¸¸è§çš„ç”¨æ³•å·®ä¸å¤šå°±æ˜¯è¿™äº›ï¼Œå¯¹äºçº¿ç¨‹åŠ é”ï¼ˆçº¿ç¨‹æ‹¿é”ï¼‰ï¼Œå¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‹¿ä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œå°±ä¼šäº§ç”Ÿé”ç«äº‰ï¼Œä¸¤ä¸ªçº¿ç¨‹åŒæ—¶æ‹¿ä¸¤ä¸ªä¸åŒå¯¹è±¡çš„é”ä¸ä¼šäº§ç”Ÿé”ç«äº‰ã€‚</p><p>å¯¹äº<code>synchronized</code>è¿™ä¸ªå…³é”®å­—ï¼Œå®ƒçš„è‹±æ–‡æ„æ€æ˜¯åŒæ­¥ï¼Œä½†æ˜¯åŒæ­¥åœ¨è®¡ç®—æœºä¸­æ˜¯å­˜åœ¨å¤šç§æ„æ€çš„ï¼Œæ¯”å¦‚åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œè¿™é‡ŒåŒæ­¥çš„æ„æ€æ˜¯â€œäº’æ–¥â€ï¼›è€Œåœ¨IOæˆ–ç½‘ç»œç¼–ç¨‹ä¸­åŒæ­¥æŒ‡çš„æ˜¯â€œå¼‚æ­¥â€ï¼Œä¸å¤šçº¿ç¨‹æ²¡æœ‰åŠç‚¹çš„å…³ç³»ã€‚</p><h4 id="ğŸŒŸsynchronizedçš„å·¥ä½œåŸç†"><a class="header-anchor" href="#ğŸŒŸsynchronizedçš„å·¥ä½œåŸç†">Â¶</a>ğŸŒŸsynchronizedçš„å·¥ä½œåŸç†</h4><ol><li>è·å–äº’æ–¥é”<code>lock</code></li><li>ä»ä¸»å†…å­˜æ‹·è´å˜é‡åˆ°å·¥ä½œçš„å†…å­˜</li><li>æ‰§è¡Œä»£ç </li><li>å°†æ›´æ”¹åé¢çš„å…±äº«å˜é‡çš„å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜</li><li>é‡Šæ”¾äº’æ–¥é”<code>unlock</code></li></ol><p><code>synchronized</code>åŒæ­¥å—åœ¨å¯¹åŒä¸€æ¡çº¿ç¨‹æ¥è¯´æ˜¯å¯é‡å…¥çš„ï¼Œä¸ä¼šå‡ºç°è‡ªå·±å§è‡ªå·±é”æ­»çš„é—®é¢˜   â€”â€”   æ­»é”é—®é¢˜ï¼Œè¿™ä¸ªä»¥åå†åšä»‹ç»</p><p>ç»¼ä¸Šï¼š<code>synchronized</code>å…³é”®å­—åŠ é”æœ‰å¦‚ä¸‹æ€§è´¨ï¼šäº’æ–¥æ€§ï¼Œåˆ·æ–°å†…å­˜æ€§ï¼Œå¯é‡å…¥æ€§</p><p>è‡³äºåé¢çš„ç”¨<code>Locké”</code>çš„æ–¹å¼ï¼Œæˆ‘ä»¬ç•™åˆ°åé¢çš„JUCâ€¦</p><h2 id="ğŸ“°åå°„"><a class="header-anchor" href="#ğŸ“°åå°„">Â¶</a>ğŸ“°åå°„</h2><h3 id="åå°„æ¦‚è¿°"><a class="header-anchor" href="#åå°„æ¦‚è¿°">Â¶</a>åå°„æ¦‚è¿°</h3><blockquote><p>Javaç¨‹åºåœ¨runningçŠ¶æ€çš„æ—¶å€™ï¼Œ</p><p>å¯¹äºä»»ä½•ä¸€ä¸ªç±»ï¼Œæˆ‘ä»¬éƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›</p><p>å¯¹äºä»»ä½•ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»ä½•å±æ€§å’Œæ–¹æ³•ï¼Œ</p><p>è¿™ç§åŠ¨æ€è·å–ä¿¡æ¯ï¼›ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡æ–¹æ³•çš„åŠŸèƒ½ï¼Œè¢«æˆ‘ä»¬ç§°ä¹‹ä¸ºJavaè¯­è¨€çš„åå°„æœºåˆ¶</p></blockquote><p>æ¥ä¸‹æ¥è¯´è¯´æ€ä¹ˆä½¿ç”¨åå°„</p><h3 id="åå°„çš„ä½¿ç”¨"><a class="header-anchor" href="#åå°„çš„ä½¿ç”¨">Â¶</a>åå°„çš„ä½¿ç”¨</h3><p>é¦–å…ˆæ¥ä»‹ç»ä¸€ä¸‹ç›¸å…³çš„<strong>API</strong></p><ul><li><p><strong>è·å–Classå¯¹è±¡ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class.forName(<span class="string">&quot;å…¨ç±»å&quot;</span>);</span><br><span class="line">ç±»å.class;</span><br><span class="line">å¯¹è±¡.getClass();</span><br></pre></td></tr></table></figure></li></ul><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221121223935141.png" alt="image-20221121223935141" style="zoom: 150%;" align="left" /><ul><li><p><strong>åå°„è·å–æ„é€ æ–¹æ³•ï¼š</strong><br>Classç±»ä¸­ç”¨äºè·å–æ„é€ æ–¹æ³•çš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•å</th><th>æè¿°</th></tr></thead><tbody><tr><td>Constructor&lt;?&gt;[] getConstructors()</td><td>è¿”å›æ‰€æœ‰å…¬å…±æ„é€ æ–¹æ³•å¯¹è±¡çš„æ•°ç»„</td></tr><tr><td>Constructor&lt;?&gt;[] getDeclaredConstructors()</td><td>è¿”å›æ‰€æœ‰æ„é€ æ–¹æ³•å¯¹è±¡çš„æ•°ç»„</td></tr><tr><td>Constructor<T> getConstructor(Class&lt;?&gt;â€¦ parameterTypes)</td><td>è¿”å›å•ä¸ªå…¬å…±æ„é€ æ–¹æ³•å¯¹è±¡</td></tr><tr><td>Constructor<T> getDeclaredConstructor(Class&lt;?&gt;â€¦ parameterTypes)</td><td>è¿”å›å•ä¸ªæ„é€ æ–¹æ³•å¯¹è±¡</td></tr></tbody></table><p>Constructorç±»ä¸­ç”¨äºåˆ›å»ºå¯¹è±¡çš„æ–¹æ³•</p><table><thead><tr><th>æ–¹æ³•å</th><th>æè¿°</th></tr></thead><tbody><tr><td>T newInstance(Objectâ€¦ initargs)</td><td>æ ¹æ®æŒ‡å®šçš„æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡</td></tr><tr><td>void setAccessible(boolean flag)</td><td>è®¾ç½®ä¸ºtrue,è¡¨ç¤ºå–æ¶ˆè®¿é—®æ£€æŸ¥</td></tr></tbody></table></li><li><p><strong>åå°„è·å–æˆå‘˜å˜é‡</strong></p><table><thead><tr><th>æ–¹æ³•å</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td>Field[] getFields()</td><td style="text-align:left">è¿”å›æ‰€æœ‰å…¬å…±æˆå‘˜å˜é‡å¯¹è±¡çš„æ•°ç»„</td></tr><tr><td>Field[] getDeclaredFields()</td><td style="text-align:left">è¿”å›æ‰€æœ‰æˆå‘˜å˜é‡å¯¹è±¡çš„æ•°ç»„</td></tr><tr><td>Field getField(String name)</td><td style="text-align:left">è¿”å›å•ä¸ªå…¬å…±æˆå‘˜å˜é‡å¯¹è±¡</td></tr><tr><td>Field getDeclaredField(String name)</td><td style="text-align:left">è¿”å›å•ä¸ªæˆå‘˜å˜é‡å¯¹è±¡</td></tr><tr><td>void set(Object obj, Object value)</td><td style="text-align:left">ç»™æŒ‡å®šå¯¹è±¡çš„æˆå‘˜å˜é‡èµ‹å€¼</td></tr><tr><td>Object get(Object obj)</td><td style="text-align:left">è¿”å›æŒ‡å®šå¯¹è±¡çš„Fieldçš„å€¼</td></tr></tbody></table></li><li><p><strong>åå°„è·å–æˆå‘˜æ–¹æ³•å¹¶è¿è¡Œ</strong><br><code>Object invoke(Object obj,Object ... args)</code></p></li></ul><p>çœ‹å®Œä¸Šé¢çš„APIè¿‡åï¼Œå¯èƒ½å¤§å®¶å¤´éƒ½å¤§äº†</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221121213629013.png" alt="image-20221121213629013" style="zoom:80%;" align="left" /><p>æ¥ä¸‹æ¥è¯´è¯´è¯¥å¦‚ä½•åšå§ï¼š</p><ol><li><p>å¾—åˆ°Classå¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//é™æ€æ–¹æ³•ï¼šforName(æƒé™åï¼šåŒ…å + ç±»å );</span></span><br><span class="line"><span class="comment">//æ–¹æ³•1</span></span><br><span class="line">Class&lt;?&gt; class1 = Class.forName(<span class="string">&quot;entity.Student&quot;</span>);</span><br><span class="line"><span class="comment">//æ–¹æ³•2</span></span><br><span class="line"><span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line"><span class="type">Class</span> <span class="variable">class2</span> <span class="operator">=</span> student.getClass();</span><br><span class="line"><span class="comment">//æ–¹æ³•3</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">class3</span> <span class="operator">=</span> Student.class;</span><br></pre></td></tr></table></figure></li><li><p>è·å–Constructorå¯¹è±¡ï¼š</p><ul><li><p>æ‰€æœ‰æ„é€ å™¨</p></li><li><p>æœ‰å‚æ„é€ å™¨</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">class1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;entity.Student&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; constructor = class1.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">System.out.println(constructor.getName() +<span class="comment">//æå–æ„é€ å™¨åç§°</span></span><br><span class="line">        <span class="string">&quot;===&gt;&quot;</span> +</span><br><span class="line">        constructor.getParameterCount());<span class="comment">//æå–æ„é€ å™¨å‚æ•°ä¸ªæ•°</span></span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»ºå¯¹è±¡ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">class1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;entity.Student&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; constructor = class1.getDeclaredConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        System.out.println(constructor.getName() +<span class="comment">//æå–æ„é€ å™¨åç§°</span></span><br><span class="line">                <span class="string">&quot;===&gt;&quot;</span> +</span><br><span class="line">                constructor.getParameterCount());<span class="comment">//æå–æ„é€ å™¨å‚æ•°ä¸ªæ•°</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;yxy;&quot;</span>,<span class="number">19</span>);</span><br></pre></td></tr></table></figure></li><li><p>æˆå‘˜å˜é‡å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//æ–¹æ³•1</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">class1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;entity.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;yxyl&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å­—æ®µå¯¹è±¡</span></span><br><span class="line"><span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> class1.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">field.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="comment">//è·å–å­—æ®µå€¼</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> field.get(o);</span><br><span class="line">System.out.println(<span class="string">&quot;value = &quot;</span> + value);</span><br><span class="line"><span class="comment">//è®¾ç½®å­—æ®µå€¼</span></span><br><span class="line">field.set(o,<span class="string">&quot;æ¨æ™¨&quot;</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">overwriteValue</span> <span class="operator">=</span> field.get(o);</span><br><span class="line">System.out.println(<span class="string">&quot;overwriteValue = &quot;</span> + overwriteValue);</span><br></pre></td></tr></table></figure></li><li><p>æˆå‘˜æ–¹æ³•æå–</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//è¿™é‡Œç»™Studentç±»æ·»åŠ ä¸€ä¸ªæˆå‘˜æ–¹æ³•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">...</span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">eat</span><span class="params">(String food)</span>&#123;</span><br><span class="line">        System.out.println(<span class="built_in">this</span>.name+<span class="string">&quot;åƒäº†&quot;</span>+food);</span><br><span class="line">    &#125;</span><br><span class="line">...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ–¹æ³•1</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">class1</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;entity.Student&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–å¯¹è±¡</span></span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;yxyl&quot;</span>,<span class="number">19</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> class1.getDeclaredMethod(<span class="string">&quot;eat&quot;</span>, String.class);</span><br><span class="line"></span><br><span class="line">method.invoke(o, <span class="string">&quot;å­¦æ ¡çš„é€†å¤©é¥­èœ&quot;</span>);</span><br></pre></td></tr></table></figure></li></ol><h3 id="åå°„çš„ä½œç”¨"><a class="header-anchor" href="#åå°„çš„ä½œç”¨">Â¶</a>åå°„çš„ä½œç”¨</h3><p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæ•²äº†è¿™ä¹ˆå¤šï¼Œä¸ºä»€ä¹ˆè¦æœ‰åå°„è¿™ä¸ªä¸œè¥¿å‘¢ï¼Œæ˜æ˜æˆ‘ä»¬å¹³å¸¸ç›´æ¥newï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªå¯¹è±¡</p><blockquote><p>å¯¹ï¼Œæ²¡å¯¹è±¡ï¼Œå°±newä¸€ä¸ªå§</p></blockquote><p>åŸå› æ˜¯ï¼šé€šè¿‡åå°„å¯ä»¥æ˜¯ç¨‹åºä»£ç è®¿é—®è£…è½½åˆ°JVMä¸­çš„ç±»çš„å†…éƒ¨ä¿¡æ¯ï¼Œä»¥æ­¤æ¥ï¼š</p><ul><li>è·å–å·²è£…è½½ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯</li><li>è·å–å·²è£…è½½ç±»çš„æ–¹æ³•</li><li>è·å–ä¸€è£…è½½ç±»çš„æ„é€ æ–¹æ³•ä¿¡æ¯</li></ul><p>è¿™é‡Œå°±ä»¥æˆ‘ç›®å‰åšçš„ä¸€ä¸ªé¡¹ç›®ä¸€å°å—æ¥è¯´å§ï¼Œå…·ä½“çš„å°±ä¸åœ¨è¯¾ä»¶é‡Œé¢å±•ç¤ºï¼Œåˆ°æ—¶å€™ä¸Šè¯¾çš„æ—¶å€™è¯´ã€‚</p><hr><p>ä½†æ˜¯ä¸‡ç‰©éƒ½æœ‰ä¸¤é¢æ€§ï¼Œ</p><blockquote><p>æ¯•ç«Ÿnewå‡ºæ¥çš„å¯¹è±¡å§‹ç»ˆçœ‹å¾—åˆ°ï¼Œä½†æ˜¯æ‘¸ä¸ç€ï¼Œåå°„ä¹Ÿå½“ç„¶æ˜¯</p></blockquote><p>å…¶æœ€çªå‡ºçš„ä¾¿æ˜¯å…¶æ€§èƒ½é—®é¢˜ï¼š</p><p>æ˜¯ç”¨åå°„åŸºæœ¬ä¸Šæ˜¯ä¸€ç§è§£é‡Šæ“ä½œï¼Œç”¨äºå­—æ®µå’Œæ–¹æ³•æ¥å…¥æ—¶è¦è¿œæ…¢äºç›´æ¥ä»£ç (æ„æ€å°±æ˜¯ï¼Œé€šè¿‡åå°„å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œè¿œè¿œä¸å¦‚ç›´æ¥new)ã€‚å› æ­¤ï¼ŒJavaåå°„æœºåˆ¶ä¸»è¦æ˜¯åº”ç”¨åœ¨å¯¹çµæ´»æ€§å’Œæ‰©å±•æ€§è¦æ±‚å¾ˆé«˜çš„ç³»ç»Ÿæ¡†æ¶ä¸Šï¼ŒåŸºæœ¬ç¨‹åºä¸å»ºè®®ä½¿ç”¨ã€‚</p><p>ä½¿ç”¨åå°„ä¼šæ¨¡ç³Šç¨‹åºå†…éƒ¨é€»è¾‘</p><p>ç¨‹åºäººå‘˜å¸Œæœ›åœ¨æºä»£ç ä¸­çœ‹åˆ°ç¨‹åºçš„é€»è¾‘ï¼Œè€Œåå°„ç­‰æŠ€æœ¯ç»•è¿‡äº†æºä»£ç çš„æŠ€æœ¯ï¼Œå› è€Œä¼šå¸¦æ¥ç»´æŠ¤é—®é¢˜ï¼Œåå°„ä»£ç æ¯”ç›¸åº”çš„ç›´æ¥ä»£ç æ›´å¤æ‚</p><p>è‡³äºåå°„çš„ä»£ç†æ¨¡å¼ï¼Œå„ä½å·ç‹è¯·ä¾¿ â€”â€”&gt; <a href="https://blog.csdn.net/weixin_43438052/article/details/117292687?ops_request_misc=%7B%22request%5Fid%22%3A%22164172376316781683959885%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fall.%22%7D&amp;request_id=164172376316781683959885&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-14-117292687.pc_search_insert_ulrmf&amp;utm_term=Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E9%87%8D%E8%A6%81%E5%90%97&amp;spm=1018.2226.3001.4187">è¿™é‡Œ</a></p><h2 id="ğŸ’¬ç½‘ç»œç¼–ç¨‹"><a class="header-anchor" href="#ğŸ’¬ç½‘ç»œç¼–ç¨‹">Â¶</a>ğŸ’¬ç½‘ç»œç¼–ç¨‹</h2><p>è¿™é‡Œå‡ºäºæ—¶é—´åŸå› å’Œç¯‡å¹…åŸå› ï¼Œå°±ä¸è®²ç½‘ç»œç¼–ç¨‹çš„ç›¸å…³çŸ¥è¯†ï¼Œç­‰åé¢è®²<strong>è®¡ç½‘çŸ¥è¯†</strong>çš„æ—¶å€™ä¼šè¯¦ç»†è®²</p><p><strong>â€¦</strong></p><h1>Mysql</h1><h1>Navicat</h1>]]></content>
      
      
      <categories>
          
          <category> è“å±± </category>
          
          <category> JavaSE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è¯¾ä»¶ </tag>
            
            <tag> è“å±± </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘ç»œé€šè®¯ä¸TPC/IP</title>
      <link href="/2022/10/16/%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E4%B8%8ETPC-IP/"/>
      <url>/2022/10/16/%E7%BD%91%E7%BB%9C%E9%80%9A%E8%AE%AF%E4%B8%8ETPC-IP/</url>
      
        <content type="html"><![CDATA[<h1>ç½‘ç»œé€šä¿¡ä¸TCP/IP</h1><p>ä»€ä¹ˆæ˜¯è®¡ç®—æœºçš„ç½‘ç»œï¼Ÿ<br>è€å¥—è·¯ã€å®˜æ–¹è¯ï¼š</p><blockquote><p>åˆ©ç”¨é€šä¿¡çº¿è·¯å°†åœ°ç†ä¸Šåˆ†æ•£çš„ã€å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„è®¡ç®—æœºç³»ç»Ÿå’Œé€šä¿¡è®¾å¤‡æŒ‰ä¸åŒçš„å½¢å¼è¿æ¥èµ·æ¥ï¼Œä»¥åŠŸèƒ½å®Œå–„çš„ç½‘ç»œè½¯ä»¶åŠåè®®å®ç°èµ„æºå…±äº«å’Œä¿¡æ¯ä¼ é€’çš„ç³»ç»Ÿã€‚</p></blockquote><p><strong>ä¸»è¦çš„ç½‘ç»œ</strong>ï¼š</p><ol><li>å±€åŸŸç½‘</li><li>åŸåŸŸç½‘</li><li>å¹¿åŸŸç½‘</li><li>æ— çº¿ç½‘</li><li>â€¦</li></ol><p>Pè¯å°±ä¸å¤šè¯´äº†ï¼Œç›´æ¥è¿›å…¥ä¸»é¢˜å§</p><p>é¦–å…ˆæ˜¯ï¼Œç½‘ç»œé€šè®¯çš„é¼»ç¥–ã€<strong>OSIä¸ƒå±‚æ¨¡å‹</strong>ï¼š</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015165435767.png" alt="image-20221015165435767" align="left" style="zoom: 50%;" /><p>å†åˆ°æˆ‘ä»¬ç°åœ¨çš„<strong>TCP/IPäº”å±‚æ¨¡å‹</strong>ï¼š</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015165526473.png" alt="image-20221015165526473"  align="left" style="zoom:71%;" /><p>ä»å›¾ç‰‡ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼ŒTCPIPåªæ˜¯æŠŠOSIçš„ä¸Šä¸‰å±‚åˆå¹¶ä¸ºäº†ä¸€å±‚ï¼Œåº”ç”¨å±‚ã€‚</p><p>æ–¹ä¾¿è®°å¿†ï¼š</p><ul><li>åº”ç”¨å±‚ï¼šå¹³æ—¶æˆ‘ä»¬è®¿é—®ä½¿ç”¨çš„http(bushi)ã€httpsåè®®ï¼›æˆ–è€…è¿œç¨‹è¿æ¥çš„Mysqlï¼›è¿œç¨‹è¿æ¥çš„SSHâ€¦</li><li>ä¼ è¾“å±‚ï¼š<ul><li>TCPåè®®ï¼šé¢å‘è¿æ¥çš„ã€å¯é çš„æµåè®®</li><li>UDPåè®®ï¼šé¢å‘æ— è¿æ¥çš„é€šè®¯åè®®</li></ul></li><li>ç½‘ç»œå±‚ï¼šIPåœ°å€</li><li>æ•°æ®é“¾è·¯å±‚ï¼šç¡¬ä»¶é©±åŠ¨ç¨‹åºï¼Œè¿½ç©¶åˆ°åº•è¿˜æ˜¯</li><li>ç‰©ç†å±‚ï¼šç½‘å¡</li></ul><p>æœ‰äº›è¯´æ³•æ˜¯å§æœ€åº•å±‚çš„ç‰©ç†å±‚+æ•°æ®é“¾è·¯å±‚åˆæˆä¸€å±‚ï¼Œä½†å…¶å®ä¸æ˜¯â€¦</p><h2 id="æµ…è°ˆTCP-UDP"><a class="header-anchor" href="#æµ…è°ˆTCP-UDP">Â¶</a>æµ…è°ˆTCP/UDP</h2><p>ä»ä¸Šæ–‡çœ‹åˆ°ï¼ŒTCPåè®®æ˜¯é¢å‘è¿æ¥çš„ã€å¯é çš„æµåè®®ï¼›è€ŒUDPæ˜¯é¢å‘æ— è¿æ¥çš„é€šè®¯åè®®</p><p>TCPé¦–å…ˆæ˜¯è¦å»ºç«‹è¿æ¥çš„ï¼Œä»–ä¼šæœ‰æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„3æ¬¡æ¡æ‰‹ï¼Œ</p><p>ä¸ºä»€ä¹ˆè¦å»ºç«‹è¿æ¥å‘¢ï¼Ÿ</p><blockquote><p>1.æ›´å¥½çš„ä¿è¯å¯é æ€§: å»ºç«‹è¿æ¥çš„è¿‡ç¨‹å…¶å®å°±æ˜¯è®©é€šä¿¡åŒæ–¹éªŒè¯å„è‡ªçš„å‘é€èƒ½åŠ›å’Œæ¥å—èƒ½åŠ›æ˜¯å¦æ­£å¸¸<br>2.åå•†ä¸€äº›é‡è¦å‚æ•° (å¦‚: åºå·çš„åˆå§‹å€¼)</p></blockquote><p>å…·ä½“æ€ä¹ˆå»ºç«‹è¿æ¥ï¼Ÿ</p><blockquote><p>æ —å­ï¼š</p><p>Aç»™Bæ‰“ç”µè¯ï¼Œæ‰“ç”µè¯åŒæ ·è¦åŒæ ·ç»™è‡ªå·±ä»¥åŠå¯¹æ–¹çš„è¯ç­’æ˜¯å¦æ­£å¸¸å·¥ä½œ</p><p>ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼šåˆšå¼€å§‹ï¼ŒAä¸çŸ¥é“è‡ªå·±å’ŒBä¹¦ç±çš„å¬ç­’çš„è¯ç­’æ˜¯å¦æ­£å¸¸ï¼Œæ‰€ä»¥Aè¯´ï¼šâ€œå–‚å–‚å–‚ï¼Ÿï¼Ÿï¼Ÿâ€</p><p>ç¬¬äºŒæ¬¡æ¡æ‰‹ï¼šBå¬åˆ°è¿‡åï¼Œè¯´æ˜Açš„è¯ç­’å’ŒBçš„å¬ç­’æ­£å¸¸ï¼Œä½†Bè¿˜éœ€è¦è¿›ä¸€æ­¥çš„æ£€æŸ¥è‡ªå·±çš„è¯ç­’æ˜¯å¦æ­£å¸¸ï¼›åŒæ—¶Bå§Aè¯ç­’æ­£å¸¸å’Œè‡ªå·±å¬ç­’æ­£å¸¸çš„æ¶ˆæ¯ä¼ ç»™Aï¼›äºæ˜¯Bï¼šâ€å¹²å˜›ï¼Ÿä½ çˆ¹ï¼â€</p><p>ç¬¬ä¸‰æ¬¡æ¡æ‰‹ï¼šAæ”¶åˆ°äº†Bçš„æ¶ˆæ¯åï¼Œå°±è¯æ˜äº†Aå¬ç­’æ­£å¸¸ï¼ŒBå¬ç­’æ­£å¸¸</p></blockquote><p>è¿™å°±ç±»ä¼¼äºç½‘ç»œå»ºç«‹è¿æ¥çš„ä¸‰æ¬¡æ¡æ‰‹â€¦</p><p>æ‰€ä»¥ï¼Œç½‘ç»œä¸­ä¼ è¾“æ•°æ®æ•´ä½“è¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>åˆæ˜¯ä¸€ä¸ªæ —å­ï¼šåœ¨æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ä¸­</p><p>é¦–å…ˆæˆ‘ä»¬å§æ¶ˆæ¯ç¼–è¾‘å¥½ï¼Œç‚¹å‡»å‘é€buttonï¼Œæ­¤æ—¶ï¼Œè¿™ä¸ªæ¶ˆæ¯è¿˜å¤„äº<strong>åº”ç”¨å±‚</strong>ã€‚ç‚¹å‡»buttonåï¼Œè¿›å…¥ä¼ è¾“å±‚ï¼Œè¢«è§£ææˆï¼Œè®¡ç®—æœºå”¯ä¸€è®¤è¯†çš„01äºŒè¿›åˆ¶ï¼Œå†åŠ ä¸Šå¤§æ¦‚20ä¸ªå­—èŠ‚çš„TCPé¦–éƒ¨ï¼Œå½¢æˆ<strong>æŠ¥æ–‡</strong>ï¼Œæˆ–è€…æ˜¯æ‰€è°“çš„<strong>æ¶ˆæ¯</strong>ï¼›</p><p>ç„¶åï¼Œä¼ è¿›ç½‘ç»œå±‚ï¼ŒåŠ ä¸ŠIPåŒ…é¦–éƒ¨â€”â€”&gt;æŠ¥æ–‡æ®µ</p><p>ä¼ è¿›æ•°æ®é“¾è·¯å±‚ï¼ŒåŠ ä¸Šä»¥å¤ªç½‘é¦–éƒ¨â€”â€”&gt;æ•°æ®æŠ¥</p><p>æœ€åè¿›å…¥ç‰©ç†å±‚ï¼Œé€šè¿‡ç½‘å¡ç­‰ç¡¬ä»¶ï¼Œå¸¦ä¸Šå‹ä¿¡å·ï¼Œä¼ è¿›ä»¥å¤ªç½‘ç”µç¼†ã€‚</p><p>ç­‰è¿™ä¸ª<strong>å¸§</strong>ï¼Œè¢«ç”²æ–¹æ¥æ”¶åˆ°è¿‡åï¼Œé€šè¿‡ä»¥ä¸Šçš„é¡ºåºçš„åè§£æï¼Œä¸€æ­¥ä¸€æ­¥è„±å£³æˆæœ€åˆæˆ‘ä»¬æ‰€ç¼–è¾‘çš„æ•°æ®åŒ…ï¼Œå±•ç¤ºåœ¨ç”²æ–¹çš„åº”ç”¨å±‚ä¸Šã€‚è¿™æ—¶ï¼Œç”²æ–¹æ‰‹æœºä¸Šæ˜¾ç°ä¸€ä¸ªï¼šâ€œæˆ‘æ˜¯ä½ çˆ¹â€<br>çš„æ—¶å€™å°±</p><p>å®Œæˆçš„æ•°æ®(æ¶ˆæ¯)çš„ä¼ è¾“</p></blockquote><hr><p><strong>è€ŒUDP</strong></p><p>ä»–æœ€ä¸»è¦çš„ç‰¹ç‚¹å°±æ˜¯ã€UDPæ˜¯æ— è¿æ¥çš„ï¼Œå°±æ˜¯å‘é€æ•°æ®ä¹‹å‰ä¸éœ€è¦å»ºç«‹è¿æ¥ï¼Œè¿™ä¹Ÿæ˜¯ä¸TCPåè®®çš„æœ¬è´¨åŒºåˆ«ï¼Œå½“ç„¶ï¼Œå‘é€æ•°æ®ç»“æŸçš„æ—¶å€™ä¹Ÿæ²¡æœ‰è¿æ¥å¯ä»¥é‡Šæ”¾ï¼Œä¸€æ¬¡ï¼Œå°±å‡å°‘äº†å¼€é”€å’Œå‘é€æ•°æ®ä¹‹å‰çš„å»¶è¿Ÿï¼Œ</p><p>ç›®å‰QQï¼Œå¾®ä¿¡ï¼Œè¯­éŸ³ç”µè¯ã€è§†é¢‘â€¦â€¦ä¹‹ç±»çš„é€šè®¯å¤§éƒ½åŸºäºUDPçš„é€šä¿¡åè®®ï¼Œå› ä¸ºå¤§éƒ½äººä¸ä¼šå› ä¸ºä½ é‚£ä¸€ä¸ªåƒç´ ç‚¹ï¼Œä¸€å¥è¯ä¸¤å¥è¯å¬ä¸æ¸…æ¥šå°±æŠ±æ€¨ä»€ä¹ˆ(æ²¡æœ‰é’ˆå¯¹ä¸€äº›æ¯”è¾ƒç´§æ€¥çš„åœºæ™¯)</p><h2 id="ç½‘ç»œé€šè®¯ä¸­çš„åœ°å€ä¸ç«¯å£å·"><a class="header-anchor" href="#ç½‘ç»œé€šè®¯ä¸­çš„åœ°å€ä¸ç«¯å£å·">Â¶</a>ç½‘ç»œé€šè®¯ä¸­çš„åœ°å€ä¸ç«¯å£å·</h2><h3 id="åœ°å€Address"><a class="header-anchor" href="#åœ°å€Address">Â¶</a>åœ°å€Address</h3><ul><li>IPåœ°å€å’ŒMACåœ°å€</li></ul><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015185133497.png" alt="image-20221015185133497" align="left" style="zoom:60%; " /><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015185221395.png" alt="image-20221015185221395" align="left" style="zoom:50%; " /><p>æ‰“å¼€<strong>win</strong>çš„<strong>powerShell</strong>ï¼Œè¾“å…¥ï¼š<code>ipconfig</code>å¯ä»¥çœ‹åˆ°è‡ªå·±è®¾å¤‡ä¿¡æ¯</p><p>è¿™é‡Œçš„ç‰©ç†åœ°å€å°±æ˜¯MACåœ°å€ã€‚MACåœ°å€æ˜¯å‚å•†å¼€å§‹åˆ›å»ºè¿™ä¸ªè®¾å¤‡çš„æ—¶å€™å°±å°†å…¶å†™åœ¨ç‚¹çš„ç¡¬ä»¶ä¸Šçš„ã€‚æ‰€ä»¥æ¯ä¸ªè®¾å¤‡åªæœ‰ä¸€ä¸ªMACåœ°å€ï¼Œè¿˜æ˜¯ä¸èƒ½ä¿®æ”¹çš„(é™¤éè¯´æ˜¯ä½ é€šè¿‡ç‰©ç†æ‰‹æ®µï¼Œä¿®æ”¹BIOSï¼Œä¿®æ”¹MACåœ°å€)ï¼Œæ‰€ä»¥MACåœ°å€å®åœ¨TCPçš„æ•°æ®é“¾è·¯å±‚ä¸Šç”¨çš„ï¼Œä¹Ÿå¯ä»¥ç†è§£æˆæ•°æ®é“¾è·¯å±‚çš„åœ°å€ã€‚</p><p>çœ‹åˆ°æˆ‘ç”µè„‘ä¸Šæ— çº¿å±€å±€åŸŸç½‘Adapter (WALN) ä¸‹çš„MACåœ°å€æ˜¯ï¼šE0-D4-64-31-CA-13ï¼Œå‰ä¸€åŠæ˜¯<a href="https://zh.wikipedia.org/wiki/%E7%94%B5%E6%B0%94%E7%94%B5%E5%AD%90%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%AD%A6%E4%BC%9A">IEEE</a>ç»™æ¯ä¸ªå‚å•†ä¸€ä¸ªï¼Œåé¢ä¸€åŠç”±å‚å•†è‡ªå·±åˆ†é…</p><p>IPV4å°±ä¸ç”¨è¯´äº†ï¼Œæ²¡æœ‰IPV4æ˜¯æ²¡æ³•ä¸Šç½‘çš„ï¼Œè¿™ä¸ªä¸œè¥¿è¦ä¹ˆæ‰‹åŠ¨è·å–ï¼Œè¦ä¹ˆDHCPæœåŠ¡å™¨ç»™åˆ†é…IPV4</p><ul><li><p>MACåœ°å€ä¸IPV4çš„åŒºåˆ«</p><blockquote><ol><li>MACåœ°å€ä¸èƒ½éšæ„æ›´æ¢ï¼ŒIPV4å¯ä»¥</li><li>MACåœ°å€48ä½ï¼ŒIPV4æ˜¯32ä½</li><li>MACåœ°å€å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚ï¼ŒIPV4å·¥ä½œåœ¨ç½‘ç»œå±‚</li></ol></blockquote></li></ul><h3 id="ç«¯å£Port"><a class="header-anchor" href="#ç«¯å£Port">Â¶</a>ç«¯å£Port</h3><p>å®˜æ–¹ï¼š</p><blockquote><p>ç”¨æ¥è¯†åˆ«åŒä¸€å°è®¡ç®—æœºè®¾å¤‡è®¾å¤‡ä¸­ä¸åŒçš„åº”ç”¨ç¨‹åºï¼Œä¹Ÿè¢«ç§°ä¹‹ä¸ºåº”ç”¨ç¨‹åºåœ°å€</p></blockquote><ul><li><p>ä¸ºä»€ä¹ˆç«¯å£å·æœ‰65535ä¸ªï¼Ÿ</p><blockquote><p>å› ä¸ºTCPå’ŒUDPåè®®é‡Œé¢æŠ¥æ–‡å¤´ä¸­å—ï¼Œæœ‰ä¸“é—¨çš„çš„å­—æ®µæ¥å­˜è¿™ä¸ªç«¯å£å·ï¼Œè¿™ä¸ªå­—æ®µå¤´åªæœ‰2ä¸ªå­—èŠ‚ï¼Œ2^16 = 65536 ï¼Œä½†æ˜¯ä¸€èˆ¬ç«¯å£0åªå¸¦æœ¬è®¾å¤‡ä¸Šæ‰€æœ‰çš„ç«¯å£ã€‚</p><p>æ‰€ä»¥ç«¯å£å·åªæœ‰65536 - 1 =  65535ä¸ª</p></blockquote></li><li><p>ä¸€å°è®¾å¤‡ä¸Šæœ€å¤šåªèƒ½æœ‰65535ä¸ªTCPè¿æ¥å˜›ï¼Ÿ</p><blockquote><p>è¿™æ˜¯å¯ç¬‘çš„ï¼Œ</p><p>ä¸€ä¸ªæ —å­ï¼šç°æœ‰10ä¸ªå®¢æˆ·ç«¯è¿æ¥ä¸€å°æœºå™¨ä¸Šçš„Mysqlï¼ŒMysqlä¹Ÿåªæ˜¯æ¥æ”¶åˆ°äº†3306è¿™ä¸ªç«¯å£ä¸Šå‘é€æ¥çš„æ•°æ®ï¼Œ</p><p>æ‰€ä»¥ï¼Œä¸€å°è®¾å¤‡ä¸Šæ‰€èƒ½æ¥æ”¶åˆ°çš„é“¾æ¥ï¼Œä¸ç«¯å£å·æ•°æ²¡æœ‰å¿…ç„¶å…³ç³»ã€‚</p></blockquote></li></ul><p>å†è€…ï¼Œä¸€ä¸ªé€šè®¯åœ¨ç½‘ç»œä¸­æ˜¯ç”±5ä¸ªå…ƒç»„è¯†åˆ«ï¼š</p><ol><li>æºIP</li><li>ç›®æ ‡IP</li><li>TCPåè®®å·</li><li>æºç«¯å£</li><li>ç›®æ ‡ç«¯å£</li></ol><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015200329440.png" alt="image-20221015200329440"></p><h3 id="TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥"><a class="header-anchor" href="#TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥">Â¶</a>TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥</h3><p>å›¾ç‰‡æ¥è‡ªï¼š<a href="https://www.bilibili.com/video/BV1c4411d7jb?p=65&amp;vd_source=61258a05469482a4381c086011c25c18">https://www.bilibili.com/video/BV1c4411d7jb?p=65&amp;vd_source=61258a05469482a4381c086011c25c18</a></p><p>TCPæŠ¥æ–‡çš„é¦–éƒ¨æ ¼å¼</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015203150879.png" alt="image-20221015203150879"></p><p>è‡³äºä¸‰æ¬¡æ¡æ‰‹çš„æµç¨‹æˆ‘å°±æ‡’å¾—ç”¨æ–‡å­—æ¥æè¿°äº†ï¼Œç”¨å›¾ç‰‡çš„æ–¹å¼å¯èƒ½æ›´å¥½è®°å¿†ä¸€ç‚¹(å¯èƒ½çº¯ç²¹å°±æ˜¯æ‡’å§â€¦)</p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20221015204050802.png" alt="image-20221015204050802" align="left" style="zoom:70%;" /><p>å…¶ä¸­SYNæ˜¯TCPæŠ¥æ–‡é‡Œé¢æŸä¸€ä¸ªbitçš„ç«™ä½æ ‡å¿—ã€‚</p><p>å‡ºäºè¿™æ ·çš„è¿æ¥æ–¹å¼ï¼ŒTCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¹Ÿæ˜¯ä¼šæœ‰æ¼æ´ï¼Œâ€”â€”SYNæ´ªæ³›æ”»å‡»</p><p><strong>SYNæ´ªæ³›æ”»å‡»</strong>ï¼Œæ˜¯é€šè¿‡ç½‘ç»œæœåŠ¡æ‰€åœ¨çš„ç«¯å£å‘é€å¤§é‡ä¼ªé€ æºåœ°å€çš„æ”»å‡»æŠ¥æ–‡ï¼Œå‘é€åˆ°æœåŠ¡ç«¯ï¼Œé€ æˆæœåŠ¡ç«¯ä¸Šçš„<strong>åŠå¼€è¿æ¥</strong>ï¼Œé˜Ÿåˆ—è¢«å æ»¡ï¼Œä»è€Œç»„ç»‡å…¶ä»–ç”¨æˆ·è¿›è¡Œè®¿é—®ã€‚</p><p><strong>åŸç†</strong></p><blockquote><p>æ”»å‡»è€…å®¢æˆ·ç«¯åˆ©ç”¨ä¸ºä¼ªé€ çš„IPåœ°å€æƒ³æœåŠ¡ç«¯å‘å‡ºè¯·æ±‚(ç¬¬ä¸€æ¬¡)ã€‚è€ŒæœåŠ¡ç«¯çš„å“åº”(ç¬¬äºŒæ¬¡)çš„æŠ¥æ–‡å°†æ°¸è¿œå‘é€ä¸åˆ°çœŸå®çš„å®¢æˆ·ç«¯ï¼ŒæœåŠ¡ç«¯åœ¨ç­‰å¾…å®¢æˆ·ç«¯çš„ç¬¬ä¸‰æ¬¡æ¡æ‰‹(å…¶å®æ°¸è¿œä¸ä¼šæœ‰çš„ï¼Œæ¯•ç«Ÿæ˜¯ä¼ªé€ çš„)ï¼ŒæœåŠ¡ç«¯åœ¨è¿™ç§åŠå¼€çš„é“¾æ¥è¿‡ç¨‹ä¸­å°å·äº†èµ„æºï¼Œå¦‚æœæœ‰æˆåƒä¸Šä¸‡çš„è¿™æ ·é“¾æ¥ï¼Œä¸»æœºèµ„æºå°†è¢«è€—å°½ï¼Œä»è€Œå‘è¾¾åˆ°æ”»å‡»çš„ç›®çš„ï¼Œå°±æœ‰ç‚¹åƒDDOSæ”»å‡»ï¼Œéƒ½æ˜¯å‘é€å¤§é‡çš„æ•°æ®åŒ…ã€‚</p></blockquote><p><strong>è§£å†³æ–¹æ¡ˆ</strong></p><blockquote><ul><li>æ— æ•ˆè¿æ¥ç›‘æ§é‡Šæ”¾</li><li>å»¶ç¼“TCBåˆ†é…æ–¹æ³•</li><li>é˜²ç«å¢™</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> è®¡ç½‘ </category>
          
          <category> å…«è‚¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> TCP/IP </tag>
            
            <tag> ç½‘ç»œç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rust-æ‰€æœ‰æƒ</title>
      <link href="/2022/10/03/Rust-%E6%89%80%E6%9C%89%E6%9D%83/"/>
      <url>/2022/10/03/Rust-%E6%89%80%E6%9C%89%E6%9D%83/</url>
      
        <content type="html"><![CDATA[<p>åœ¨æ‰€æœ‰ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸è®¡ç®—æœºå†…å­˜çš„æš§æ˜§è¡Œä¸ºæ—©å·²è¢«é»˜è®¤ã€‚ä½†å¦‚ä½•ä¸å…¶ä¿æŒç€æ•Œè¿›æˆ‘é€€ï¼Œæ•Œé€€æˆ‘è¿›çš„è·ç¦»ï¼Œâ€”â€”åœ¨å†…å­˜ä¸­ç”³è¯·å†…å­˜æ¥æ‰§è¡Œç¨‹åºï¼›åœ¨æ‰§è¡Œå®Œè¿‡åï¼Œä¸éœ€è¦çš„æ—¶å€™å†é‡Šæ”¾è¿™æ®µå†…å­˜ï¼Œæˆä¸ºäº†é‡ä¸­ä¹‹é‡ã€‚è¿™ä¹Ÿæ˜¯è®¾è®¡ç¼–ç¨‹è¯­è¨€è¿‡ç¨‹ä¸­çš„ä¸€åº§é«˜å±±ã€‚äºæ˜¯ï¼Œä¸‰ç§ä¸»æµçš„æ¨¡å¼åº”è¿è€Œç”Ÿï¼š</p><ul><li><p>GCï¼šåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œåœ¨ç¨‹åºè¿è¡Œçš„åŒæ—¶ï¼Œæ— æ—¶æ— åˆ»çš„æƒ³åŠæ³•æ‰¾é‚£äº›ä¸è¢«åˆ©ç”¨ï¼Œå¹¶ä¸”ä»¥åä¹Ÿä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œå›æ”¶èµ·æ¥ï¼Œä¾‹å¦‚æœ€ç»å…¸çš„Java(Jvm)ï¼ŒGoï¼ŒC#</p></li><li><p>æ˜¾ç¤ºæ“ä½œï¼šå›æ”¶ï¼Œç”³è¯·å†…å­˜è¿™äº›æ“ä½œæ”¹æˆäº†ç”±ç¨‹åºå‘˜è‡ªå·±æ‰‹åŠ¨æ“ä½œï¼Œ(æ¯”èµ·GCçš„è€—æ€§èƒ½ï¼Œæˆ‘æœç„¶è¿˜æ˜¯æ¥æ”¶ä¸äº†è‡ªå·±æ‰‹åŠ¨æ“ä½œå¯¹è±¡ç©ºé—´çš„ç”³è¯·ä¸é‡Šæ”¾)ï¼ŒC++</p></li><li><blockquote><p><strong>é€šè¿‡æ‰€æœ‰æƒæ¥ç®¡ç†å†…å­˜</strong>ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—è§„åˆ™è¿›è¡Œæ£€æŸ¥(è¿™é‡Œå°±ç›´æ¥æŠŠåŸè¯å¤åˆ¶è¿‡æ¥å§)</p></blockquote></li></ul><p>è€ŒRustæ­£å¥½å°±æ˜¯ç¬¬ä¸‰ç§ï¼Œå¯¹å†…å­˜çš„ç®¡ç†æœºåˆ¶â€”â€”<strong>æ‰€æœ‰æƒ</strong></p><p>è¿™ç§æœºåˆ¶ï¼Œæ—©åœ¨ç¼–è¯‘çš„æ—¶å€™å°±ç¡®ç«‹å¥½äº†è¿™æ®µå†…å­˜ç”±è°æ¥æ”¯é…ï¼Œå¤§å¤§çš„æŒ½å›äº†å†…å­˜çš„æŸå¤±ã€‚</p><hr><p>åœ¨è¯´æ‰€æœ‰æƒä¹‹å‰å…ˆè°ˆè°ˆæ ˆå’Œå †å§</p><h3 id="æ ˆã€å †"><a class="header-anchor" href="#æ ˆã€å †">Â¶</a>æ ˆã€å †</h3><ul><li><p>æ ˆ</p><blockquote><p>è¿™ä¸ªä¸œè¥¿ï¼Œæ•°æ®ç»“æ„çš„è§’åº¦çœ‹æ ˆå’Œé˜Ÿåˆ—ä¹Ÿæ˜¯çº¿æ€§è¡¨ï¼Œå…¶ç‰¹æ®Šæ€§åœ¨äºæ ˆå’Œé˜Ÿåˆ—çš„åŸºæœ¬æ“ä½œæ˜¯çº¿æ€§è¡¨çš„å­é›†ã€‚ä»–ä»¬æ˜¯æ“ä½œå—é™çš„çº¿æ€§è¡¨â€¦</p><p>æ ˆæŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åé¡ºåºå–å‡ºå€¼ï¼Œè¿™ä¹Ÿè¢«ç§°ä½œ<strong>åè¿›å…ˆå‡º</strong>ã€‚å‡ºäºè¿™æ ·çš„å­˜å‚¨æ–¹å¼ï¼Œåœ¨æ ˆä¸­çš„æ•°æ®å¿…é¡»æœ‰æ˜ç¡®çš„å¤§å°ï¼Œå¹¶ä¸”åœ¨ä¹‹åçš„æ“ä½œä¸­ä¸å¾—æ”¹å˜(æ˜ç¡®ï¼Œå›ºå®š)ï¼Œå‡è®¾æ•°æ®æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆåœ¨å–å‡ºæ•°æ®æ—¶ï¼Œå°†æ— æ³•è·å–æƒ³è¦çš„æ•°æ®ã€‚</p></blockquote></li><li><p>å †</p><blockquote><p>ç›¸å¯¹äºæ ˆï¼Œæˆ‘ä»¬(å“ªå„¿æ¥çš„ä»¬ğŸŸ)å¯¹å †çš„è®¤è¯†å¾€å¾€å¹¶ä¸å¤šï¼Œå¯èƒ½æ˜¯å‡ºäºå¹³å¸¸ä½¿ç”¨çš„ç¼–ç¨‹è¯­è¨€å¹¶ä¸è¦æ±‚æˆ‘ä»¬å¯¹æ ˆå †æœ‰å¤šå¤§çš„æŒæ¡ã€‚æ‰¯è¿œäº†â€¦</p><p>ä¸æ ˆä¸åŒï¼Œå¯¹äºæœªçŸ¥æ•°æ®çš„å­˜å‚¨ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒå­˜åˆ°å †ä¸­ã€‚åœ¨å­˜æ•°æ®çš„è¿‡ç¨‹ä¸­ï¼ŒOSé¦–å…ˆåœ¨å †ä¸­æ‰¾åˆ°ä¸€ä»½å®ƒè§‰å¾—åˆé€‚å¤§å°çš„ç©ºé—´ï¼Œå°†å®ƒæ ‡è®°ä¸ºâ€”â€”&gt;å·²ä½¿ç”¨ï¼Œå¹¶è¿”å›è¿™æ®µç©ºé—´çš„æŒ‡é’ˆåœ°å€ï¼Œè¯¥è¿‡ç¨‹ç§°ä¹‹ä¸ºâ€”â€”&gt;<strong>åˆ†é…</strong>ã€‚æ¥ç€ï¼Œè®©æ•°æ®å ç”¨è¿™æ®µç©ºé—´ã€‚</p><p>å½“æˆ‘ä»¬è®¿é—®è¿™æ®µç©ºé—´æƒ³æ‹¿åˆ°æ•°æ®æ—¶ï¼Œåªéœ€è¦æ‰¾åˆ°åˆšåˆšè¢«åˆ†é…åˆ°æ ˆä¸­çš„æŒ‡é’ˆï¼Œå»æ‰¾åœ°å€å°±å¥½äº†ã€‚</p><p>(è¿™ä¸ªä¾‹å­ä»¥åè¿˜ä¼šæåˆ°)å°±å¥½åƒæˆ‘ä»¬å»é¤å…åƒé¥­ï¼ŒæœåŠ¡å‘˜é—®æˆ‘ä»¬å‡ ä¸ªäººï¼Œæˆ‘ä»¬è¯´6ä¸ªï¼Œé‚£å¥¹å°±ä¼šå¸¦æˆ‘ä»¬å»å¤§æ¦‚6 7ä¸ªä½ç½®å·¦å³çš„é¤æ¡Œï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ†é…ã€‚å®Œäº†è¿‡åï¼Œè¦æ˜¯æœ‰äººè¿Ÿåˆ°äº†ï¼Œæƒ³æ‰¾åˆ°æˆ‘ä»¬ï¼Œåªéœ€è¦æˆ‘ä»¬å‘çŸ­ä¿¡ç»™ä»–ä¸€ä¸ªé¤æ¡Œå·ï¼Œä»–å°±å¯ä»¥é¡ºåˆ©çš„æ‰¾åˆ°æˆ‘ä»¬ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±æ˜¯æ‹¿æ•°æ®ã€‚</p></blockquote></li></ul><h3 id="æ‰€æœ‰æƒæœºåˆ¶"><a class="header-anchor" href="#æ‰€æœ‰æƒæœºåˆ¶">Â¶</a><strong>æ‰€æœ‰æƒæœºåˆ¶</strong></h3><blockquote><ul><li>Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…</li><li>ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œæˆ–è€…è¯´ä¸€ä¸ªå€¼åªèƒ½æ‹¥æœ‰ä¸€ä¸ªæ‰€æœ‰è€…</li><li>å½“æ‰€æœ‰è€…(å˜é‡)ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒ(drop)</li></ul></blockquote><h3 id="æµ…è°ˆä¸€ä¸‹String"><a class="header-anchor" href="#æµ…è°ˆä¸€ä¸‹String">Â¶</a>æµ…è°ˆä¸€ä¸‹String</h3><p>åœ¨rusté‡Œé¢ï¼Œå½“æˆ‘ä»¬åœ¨ç¼–è¯‘å™¨é‡Œè¾“å…¥<code>let s =&quot;hello&quot;</code>æ—¶ï¼Œsè¿™ä¸ªå˜é‡æ˜¯ç›´æ¥è¢«ç¡¬ç¼–ç åˆ°ç¨‹åºé‡Œé¢å»çš„(ç±»å‹ä¸ºï¼š<code>&amp;str</code>)ï¼Œä¹Ÿå«ä½œ<strong>å­—ç¬¦ä¸²å­—é¢é‡</strong>ï¼Œå­—ç¬¦ä¸²å­—é¢é‡æ˜¯å¾ˆæ–¹ä¾¿çš„ï¼Œä½†æ˜¯åœ¨æœ‰äº›æ—¶å€™ï¼Œè¿™ä¸ªæ–¹ä¾¿å¹¶æ²¡æœ‰ä½“ç°åˆ°ä½ï¼ŒåŸå› æ˜¯ï¼š</p><ul><li>ç”±äºæ˜¯ç›´æ¥è¢«ç¡¬ç¼–ç åˆ°ç¨‹åºå½“ä¸­å»ï¼Œæ‰€ä»¥ä»–æ˜¯ä¸å¯å˜çš„</li><li>å¹¶éæ‰€æœ‰å­—é¢é‡éƒ½èƒ½åœ¨ç¼–å†™ä»£ç çš„æ—¶å€™å¾—çŸ¥ä»–çš„å€¼</li></ul><p>äºæ˜¯å°±æœ‰äº†åŠ¨æ€å­—ç¬¦ä¸²ç±»å‹ï¼š<code>String</code></p><p>è¿™ä¸ªç±»å‹è¢«åˆ†é…åˆ°å †ç©ºé—´ä¸Šï¼Œæ‰€ä»¥å¯ä»¥åŠ¨æ€çš„ä¼¸ç¼©ï¼Œä¹Ÿå°±å¯ä»¥å­˜å‚¨ä½ç½®å¤§å°çš„æ–‡æœ¬ã€‚</p><p>åœ¨rustä¸­ï¼Œæƒ³è¦å¾—åˆ°ä¸€ä¸ªStringç±»å‹çš„å˜é‡å¾ˆç®€å•ï¼š<code>let s = String::new(&quot;yxyl&quot;);</code></p><h3 id="æµ…æ‹·è´å’Œæ·±æ‹·è´"><a class="header-anchor" href="#æµ…æ‹·è´å’Œæ·±æ‹·è´">Â¶</a>æµ…æ‹·è´å’Œæ·±æ‹·è´</h3><h4 id="æ‹·è´-æµ…æ‹·è´"><a class="header-anchor" href="#æ‹·è´-æµ…æ‹·è´">Â¶</a>(æ‹·è´)æµ…æ‹·è´</h4><p>å…ˆè®²è®²æµ…æ‹·è´å§ï¼Œæµ…æ‹·è´åªæ˜¯å‘ç”Ÿåœ¨æ ˆä¸Šï¼Œå› æ­¤ï¼Œæ€§èƒ½å¾ˆé«˜ï¼Œå°±æ¯”å¦‚ï¼š</p><figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="variable">x</span> = <span class="number">5</span>;</span><br><span class="line"><span class="keyword">let</span> <span class="variable">y</span> = x;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç å°±æ˜¯å¾ˆå®åœ¨çš„æµ…æ‹·è´ï¼Œå› ä¸ºæ•´å½¢è¿™ä¸ªæ•°æ®ç±»å‹å¤§å°æ˜¯å·²çŸ¥çš„ï¼Œä¼šè¢«å­˜å‚¨åœ¨æ ˆä¸Šï¼Œæ‰€ä»¥æµ…æ‹·è´ä¹Ÿæ˜¯å¿«é€Ÿçš„ã€è¿™æ„å‘³ç€æ²¡æœ‰ç†ç”±åœ¨åˆ›å»º<code>y</code>è¿‡åï¼Œ<code>x</code>å¤±æ•ˆ</p><h4 id="å…‹éš†-æ·±æ‹·è´"><a class="header-anchor" href="#å…‹éš†-æ·±æ‹·è´">Â¶</a>(å…‹éš†)æ·±æ‹·è´</h4><p>æ²¡æœ‰äººä¼šåšå‡ºæœ‰æŸè‡ªå·±åˆ©ç›Šçš„äº‹æƒ…ï¼Œrustä¹Ÿä¸€æ ·ï¼Œrustä¸ä¼šä¸»åŠ¨è¿›è¡Œæ•°æ®çš„æ·±æ‹·è´ï¼Œä»–æ˜¯ä½æ•ˆä¸”è€—æ€§èƒ½çš„ï¼Œå°±åƒå¦‚æœæƒ³è¦å¤åˆ¶Stringç±»å‹çš„å˜é‡æ—¶å€™ï¼Œé€šå¸¸ä¼šç”¨<code>clone()</code>è¿™æ ·ä¸€ä¸ªæ–¹æ³•ï¼Œä»–ä¸ä»…ä»…æ˜¯å¤åˆ¶æ ˆä¸Šçš„æ•°æ®ï¼Œæ·±åº¦copyäº†å †ä¸Šçš„æ•°æ®ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
          <category> å­¦ä¹ ç¬”è®° </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rust </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¾®æœåŠ¡ç®€å•éƒ¨ç½²</title>
      <link href="/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2/"/>
      <url>/2022/09/18/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%AE%80%E5%8D%95%E9%83%A8%E7%BD%B2/</url>
      
        <content type="html"><![CDATA[<h1>å¾®æœåŠ¡ç®€å•éƒ¨ç½²</h1><h2 id="ğŸ“‹ï¼šDocker-Conpose"><a class="header-anchor" href="#ğŸ“‹ï¼šDocker-Conpose">Â¶</a>ğŸ“‹ï¼šDocker-Conpose</h2><ul><li>Docker-Composeæ˜¯ä¸€ä¸ªç”¨æ¥å®šä¹‰å’Œè¿è¡Œå¤æ‚åº”ç”¨çš„dockerå·¥å…·ã€‚ä¸€ä¸ªä½¿ç”¨Dockerå®¹å™¨çš„åº”ç”¨ï¼Œä¸€èˆ¬æ˜¯ç”±å¤šä¸ªå®¹å™¨ç»„æˆã€‚ä½¿ç”¨Docker-Composeå°±ä¸ç”¨å†™å¤šä¸ªshellè„šæœ¬æ¥å¯åŠ¨ç®¡ç†å®¹å™¨äº†ã€‚</li></ul><ol><li>æŸ¥çœ‹dockerç‰ˆæœ¬ï¼š<br><code>docker -version </code></li><li>å®‰è£…docker-compose<br><code>sudo apt install docker-compose</code></li><li>æŸ¥çœ‹docker-composeç‰ˆæœ¬<br><code>docker-compose -version</code></li></ol><h2 id="â°ï¼šæ‰“åŒ…"><a class="header-anchor" href="#â°ï¼šæ‰“åŒ…">Â¶</a>â°ï¼šæ‰“åŒ…</h2><ul><li>åœ¨é¡¹ç›®ç›®å½•ä¸‹åˆ›å»ºimageåŒ…ï¼Œæ”¾æ¯ä¸ªå¾®æœåŠ¡æ‰“åŒ…å¥½çš„é•œåƒï¼Œå¯é€‰æ‹©æ¯ä¸ªå¾®æœåŠ¡å•ç‹¬ä¸€ä¸ªåŒ…ï¼Œä»¥ä¾¿äºä»¥åå¾®æœåŠ¡ç‰ˆæœ¬çš„ç»´æŠ¤ï¼Œå›æ»šã€‚</li></ul><h2 id="ğŸš‰ï¼šDockerfile"><a class="header-anchor" href="#ğŸš‰ï¼šDockerfile">Â¶</a>ğŸš‰ï¼šDockerfile</h2><ul><li><p>åœ¨æ¯ä¸ªå¾®æœåŠ¡åŒ…ä¸‹ç¼–å†™Dockerfile</p><figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="keyword">FROM</span> openjdk:<span class="number">8</span>-jre</span><br><span class="line"><span class="keyword">ENV</span> APP_PATH=/apps</span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$APP_PATH</span></span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> xxx-1.0-SNAPSHOT.jar <span class="variable">$APP_PATH</span>/app.jar</span></span><br><span class="line"><span class="keyword">EXPOSE</span> $&#123;PORT&#125;</span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;java&quot;</span>,<span class="string">&quot;-jar&quot;</span>]</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;app.jar&quot;</span>]</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="ä¸Šä¼ Docker-Composeæ–‡ä»¶"><a class="header-anchor" href="#ä¸Šä¼ Docker-Composeæ–‡ä»¶">Â¶</a>ä¸Šä¼ Docker-Composeæ–‡ä»¶</h2><ul><li><p>åœ¨<code>Docker-Compose</code>æ–‡ä»¶ä¸­ç¼–å†™æœåŠ¡ï¼š</p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3.3&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span> <span class="comment">#å®šä¹‰dockerç½‘ç»œ</span></span><br><span class="line">  <span class="attr">yingxue_network:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span> <span class="comment">#æŒ‚è½½æ•°æ®å·</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">  <span class="attr">redisdata:</span></span><br><span class="line">  <span class="attr">mqdata:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"><span class="comment">#æ¯ä¸ªæœåŠ¡</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server:2.0.2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;JVM_XMS=256m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;JVM_XMX=256m&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MODE=standalone&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">yingxue_network</span></span><br><span class="line">        </span><br><span class="line">  <span class="attr">mysql:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">yingxue_network</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">data:/var/lib/mysql</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./yingxue.sql:/docker-entrypoint-initdb.d/yingxue.sql</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MYSQL_ROOT_PASSWORD=&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;MYSQL_DATABASE=yingxue&quot;</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;6379:6379&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">redisdata:/data</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">redis-server</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">  <span class="string">xxxæœåŠ¡:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">  <span class="attr">context:</span> <span class="string">./images/xxx</span></span><br><span class="line">  <span class="attr">dockerfile:</span> <span class="string">Dockerfile</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;xxxx:xxxx&quot;</span></span><br><span class="line">  <span class="attr">depends_on:</span></span><br><span class="line">  <span class="string">-mysql</span></span><br><span class="line">  <span class="string">-redis</span></span><br><span class="line">  <span class="string">-rebbitmq</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">....</span></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯å°†æ¯ä¸ªè½¯ä»¶æœåŠ¡å’Œå†™çš„å¾®æœåŠ¡å†™åœ¨åŒä¸€ä¸ª<code>docker-compose</code>æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çš„åˆ†æˆä¸¤ä¸ª<code>docker-compose</code>ï¼Œå¯å°†å…¶åˆ’åˆ†æˆï¼š</p><ol><li>docker-compose-app.ymlï¼šå¾®æœåŠ¡</li><li>docker-compose-env.ymlï¼šç¯å¢ƒæœåŠ¡</li></ol></li></ul><h2 id="ğŸš€ï¼šç‚¹ç«"><a class="header-anchor" href="#ğŸš€ï¼šç‚¹ç«">Â¶</a>ğŸš€ï¼šç‚¹ç«</h2><ul><li>cdåˆ°docker-composeæ–‡ä»¶ï¼Œ</li><li><code>docker-compose up -d</code></li></ul>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
          <category> Micro-Serve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å¾®æœåŠ¡ </tag>
            
            <tag> éƒ¨ç½² </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Gatewayè‡ªå®šä¹‰ç½‘å…³Filter</title>
      <link href="/2022/09/18/Gateway%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3Filter/"/>
      <url>/2022/09/18/Gateway%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E5%85%B3Filter/</url>
      
        <content type="html"><![CDATA[<h1>SpringCloud-Gatewayè‡ªå®šä¹‰ç½‘å…³Filter</h1><p>è‡ªå®šä¹‰filterå¯ä»¥å®ç°ä¸¤ç§ï¼Œä¸€ç§æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ï¼Œä¸€ç§æ˜¯å±€éƒ¨ç”Ÿæ•ˆçš„ï¼Œéœ€è¦é…ç½®ã€‚</p><p>ğŸ–•ï¼šè¿™è¾¹è‡ªå®šä¹‰ä¸‹å±€éƒ¨çš„</p><ol><li><p>é¦–å…ˆå‘½åä¸ºï¼š<code>xxxGatewayFilterFactory</code>æ¯”å¦‚<code>TokenGatewayFilterFactory</code>ï¼Œ<code>AddLogGatewayFilterFactory</code>ç­‰ç­‰ï¼Œå†æ³¨å…¥IOCç®¡ç†</p></li><li><p>ç„¶åï¼Œé€šè¿‡çœ‹å…¶ä»–è‡ªå¸¦çš„å±€éƒ¨(å…¨å±€)Filterç±»å¯ä»¥çœ‹å‡ºï¼Œä»–ä»¬éƒ½ç»§æ‰¿äº†<code>AbstractGatewayFilterFactory</code>è¿™ä¸ªæŠ½è±¡ç±»ï¼Œ</p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TokenGatewayFilterFactory</span> <span class="keyword">extends</span> <span class="title class_">AbstractGatewayFilterFactory</span>&lt;TokenGatewayFilterFactory.Config&gt;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„æ³›å‹æ˜¯Filterç±»ä¸­è‡ªå®šä¹‰çš„å†…éƒ¨ç±»<code>Config</code></p></li><li><p>é‡å†™<code>apply()</code>ï¼Œ<code>shortcutFieldOrder()</code>æ–¹æ³•ï¼Œ</p><ul><li>å…¶ä¸­applyæ˜¯æ ¸å¿ƒæ–¹æ³•ï¼Œå®ƒå†³å®šç€æˆ‘ä»¬éœ€è¦çš„è¿‡æ»¤ä¸šåŠ¡ï¼Œ</li><li>shortcutFieldOrder()æ–¹æ³•å¯æ ¹æ®è‡ªå®šä¹‰é¡ºåºæ¥æ”¶æˆ‘ä»¬ä»é…ç½®æ–‡ä»¶ä¼ è¿‡æ¥çš„value</li></ul></li><li><p>åˆ›å»ºFilteræ„é€ æ–¹æ³•ï¼Œå¯ä»¥ä¼ è¿›æ¥éœ€è¦ç”¨åˆ°çš„å·¥å…·ç±»ç­‰ç­‰â€¦</p></li></ol><p>ğŸ†—ï¼šFilter overåï¼Œéœ€è¦æˆ‘ä»¬åœ¨ç½‘å…³é…ç½®æ–‡ä»¶ä¸­æ¯ä¸ªéœ€è¦Filterçš„è·¯ç”±ä¸­è¿›è¡Œé…ç½®äº†ï¼Œå¯ä¼ çš„å‚æ•°ç”±shortcutFieldOrderå†³å®šã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
          <category> Micro-Serve </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Filter </tag>
            
            <tag> Gateway </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUC</title>
      <link href="/2022/09/17/JUC/"/>
      <url>/2022/09/17/JUC/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸŒ -JUCæ˜¯ä»€ä¹ˆ"><a class="header-anchor" href="#ğŸŒ -JUCæ˜¯ä»€ä¹ˆ">Â¶</a>ğŸŒ :JUCæ˜¯ä»€ä¹ˆ</h2><p>JUCæ˜¯<code>java.util.concurrent</code>åŒ…çš„ç¼©å†™ï¼Œè¿™ä¸ªåŒ…é‡ŒåŒ…å«äº†å„ç§å„æ ·çš„å…³äºçº¿ç¨‹é€šè®¯ï¼Œæ§åˆ¶åŒæ­¥çš„å·¥å…·ç±»â€”â€”&gt;å³Javaå¹¶å‘å·¥å…·åŒ…ã€‚</p><p>å¦å¤–ï¼ŒJUCçš„æ¡†æ¶ç»“æ„ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬å¸¸è§çš„ç»§æ‰¿å®ç°æ¡†æ¶ç»“æ„ã€‚JUCåº•å±‚åœ¨Javaä¸­æ˜¯unsafeï¼Œunsafeæ˜¯jvmçš„å®ç°ã€‚æœ‰äº†unsafeçš„æ”¯æŒï¼Œæ‰å‡ºç°å¯ä»¥è¿›è¡ŒåŸå­æ“ä½œçš„AtomicåŸå­ç±»â€¦æœ€åæ‰åˆ°æˆ‘ä»¬çš„Utilsã€‚</p><h2 id="ğŸš€-è¿›ç¨‹å’Œçº¿ç¨‹"><a class="header-anchor" href="#ğŸš€-è¿›ç¨‹å’Œçº¿ç¨‹">Â¶</a>ğŸš€:è¿›ç¨‹å’Œçº¿ç¨‹</h2><blockquote><p>å®˜æ–¹ï¼šè¿›ç¨‹æ˜¯CPUåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯CPUè°ƒåº¦èµ„æºçš„æœ€å°å•ä½</p></blockquote><p>Javaé»˜è®¤æœ‰2ä¸ªçº¿ç¨‹ï¼šmian(ä¸»çº¿ç¨‹)ã€GC(å®ˆæŠ¤çº¿ç¨‹)</p><h2 id="ğŸš¢-å¹¶å‘å’Œå¹¶è¡Œ"><a class="header-anchor" href="#ğŸš¢-å¹¶å‘å’Œå¹¶è¡Œ">Â¶</a>ğŸš¢:å¹¶å‘å’Œå¹¶è¡Œ</h2><ul><li>å¹¶å‘ï¼ˆå¤šä¸ªçº¿ç¨‹æ“ä½œä¸€ä¸ªèµ„æºï¼‰ï¼šCPUä¸€æ ¸ï¼Œæ¨¡æ‹Ÿå‡ºæ¥å¤šä¸ªçº¿ç¨‹</li><li>å¹¶è¡Œï¼ˆå¤šä¸ªäººä¸€èµ·è¡Œèµ°ï¼‰ï¼šCPUå¤šæ ¸ï¼Œæ‰§è¡Œå¤šæ¡çº¿ç¨‹</li></ul><blockquote><p>çº¿ç¨‹æœ‰6ä¸ªçŠ¶æ€ï¼š</p></blockquote><ol><li><strong>NEW-&gt;æ–°ç”Ÿ</strong></li><li><strong>RUNNABLE-&gt;è¿è¡Œ</strong></li><li><strong>BLOCKED-&gt;é˜»å¡</strong></li><li><strong>WAITING-&gt;ç­‰å¾…</strong></li><li><strong>TIMED_WAITING-&gt;æ­»ç­‰</strong></li><li><strong>TERMINATED-&gt;ç»ˆç»“</strong></li></ol><blockquote><p>wait/sleepåŒºåˆ«</p></blockquote><ul><li>waitï¼š<br>è¦é‡Šæ”¾é”<br>ä¸éœ€è¦æ•è·å¼‚å¸¸<br>åªèƒ½åœ¨é™æ€ä»£ç å—ä¸­(<code>static</code>)</li><li>sleepï¼š<br>ä¸é‡Šæ”¾é”<br>éœ€è¦æ•è·å¼‚å¸¸<br>ä»»æ„åœ°æ–¹éƒ½å¯ä»¥<strong>ç¡</strong></li></ul><h2 id="ğŸ”’-Lock-é”"><a class="header-anchor" href="#ğŸ”’-Lock-é”">Â¶</a>ğŸ”’:Lock(é”)</h2><blockquote><p>ä¼ ç»Ÿsynchronized æœ¬è´¨ï¼šé˜Ÿåˆ—+é” â€”â€”&gt; æ’é˜Ÿ</p></blockquote><p><code>java.util.concurrent.locks.Lock</code></p><p>å…¶å­ç±»ï¼š</p><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220915205227492.png" alt="image-20220915205227492"></p><blockquote><p>synchronizedå’Œlockçš„åŒºåˆ«</p></blockquote><ul><li>synchronized  æ˜¯å…³é”®å­—ï¼›lockæ˜¯ç±»</li><li>synchronized  ä¸èƒ½åˆ¤æ–­é”çš„çŠ¶æ€ï¼›lockå¯ä»¥åˆ¤æ–­é”</li><li>synchronized  è‡ªåŠ¨é‡Šæ”¾é”ï¼›lockå¿…é¡»æ‰‹åŠ¨é‡Šæ”¾é”ï¼Œä¸é‡Šæ”¾çš„è¯â€“&gt;æ­»é”</li><li>synchronized  Thread1å µå¡â€“&gt;Thread2ç­‰å¾…ï¼›lockä¸ä¸€å®šç­‰</li><li>synchronized  é€‚åˆå°‘ä»£ç åŒæ­¥ï¼›locké€‚åˆå¤§é‡ä»£ç åŒæ­¥</li><li><strong>â€¦</strong></li></ul><h2 id="â­-JUCç‰ˆçš„PCé—®é¢˜"><a class="header-anchor" href="#â­-JUCç‰ˆçš„PCé—®é¢˜">Â¶</a>â­:JUCç‰ˆçš„PCé—®é¢˜</h2><blockquote><p>é€šè¿‡lockæ‰¾åˆ°Condition<br>conditionæ¥å¯¹çº¿ç¨‹è¿›è¡Œç›‘è§†æ“ä½œ(ç­‰å¾…ï¼Œå”¤é†’â€¦)<br>conditionæ“ä½œçº¿ç¨‹ï¼Œå¯ä»¥ç²¾å‡†çš„å¯¹çº¿ç¨‹çš„å”¤é†’</p></blockquote><p><strong>èµ„æºç±»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tea3</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition1</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition2</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition3</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printA</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition1.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">2</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition2.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printB</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition2.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">3</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition3.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">printC</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="comment">//ä¸šåŠ¡</span></span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//ç­‰å¾…</span></span><br><span class="line">                condition3.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;&quot;</span> + number);</span><br><span class="line">            number = <span class="number">1</span>;</span><br><span class="line">            <span class="comment">//é€šçŸ¥</span></span><br><span class="line">            condition1.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è¿™é‡Œçœ‹åˆ°åˆ¤æ–­çº¿ç¨‹æ“ä½œèµ„æºç­‰å¾…çš„æ¡ä»¶ä½¿ç”¨<code>while</code>åˆ¤æ–­è€Œä¸ç”¨<code>if</code>ï¼Œä¸ºäº†é˜²æ­¢è™šå‡å”¤é†’çš„é—®é¢˜ã€‚</strong></p><h2 id="ğŸ’¦-é›†åˆç±»ä¸å®‰å…¨"><a class="header-anchor" href="#ğŸ’¦-é›†åˆç±»ä¸å®‰å…¨">Â¶</a>ğŸ’¦:é›†åˆç±»ä¸å®‰å…¨</h2><p>æˆ‘ä»¬çŸ¥é“åœ¨å¤šçº¿ç¨‹ä¸‹è¿›è¡Œä»»ä½•æ“ä½œéƒ½æ˜¯ä»¤äººèƒ†æˆ˜å¿ƒæƒŠçš„ã€‚</p><p>å¤šçº¿ç¨‹ä¸‹ï¼Œå¯¹é›†åˆCRUDï¼Œéš¾å…ä¼šé‡åˆ°<code>ConcurrentModificationException</code>çº¿ç¨‹æ“ä½œå¼‚å¸¸ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¹³å¸¸ä½¿ç”¨çš„ArrayListåº•å±‚çš„æ•°æ®æ“ä½œæ–¹æ³•éƒ½æ˜¯å•çº¿ç¨‹çš„ï¼Œæ²¡æœ‰å¯¹çº¿ç¨‹è¿›è¡Œå¤„ç†ã€‚</p><p>é’ˆå¯¹è¿™ç‚¹ï¼Œæœ‰3ä¸ªå¸¸è§çš„è§£å†³æ–¹æ¡ˆ(ä»…åŸºäºJavaå±‚é¢)ï¼š</p><ol><li>ä½¿ç”¨Vectoré›†åˆç±»ï¼ŒVectoré›†åˆç±»åº•å±‚å¯¹é›†åˆæ“ä½œè¿›è¡Œäº†synchronizedé”å¤„ç†ï¼Œä½†ç›¸å¯¹æ¥è¯´æ•ˆç‡è¾ƒä½<br><code>List list = new Vector&lt;&gt;();</code></li><li>ä½¿ç”¨é›†åˆå·¥å…·ç±»ä¸­çš„**â€œé”é›†åˆâ€**ï¼Œ<code>Collections.synchronizedList(....);</code></li><li>ä½¿ç”¨<strong>è¯»å†™é”é›†åˆ(JUC)</strong>ï¼Œ<code>CopyOnWriteArrayList</code>åº•å±‚å¯¹æ•°æ®çš„é›†åˆæ“ä½¿ç”¨äº†JUCä¸­çš„Locké”ç±»ï¼Œæ•ˆç‡è¾ƒVectorè‡ªç„¶<strong>upup</strong><br><code>List list = new CopyOnWriteArrayList();</code></li></ol><h2 id="ğŸ¶-çº¿ç¨‹æ± "><a class="header-anchor" href="#ğŸ¶-çº¿ç¨‹æ± ">Â¶</a>ğŸ¶:çº¿ç¨‹æ± </h2><p>å†™åˆ°è¿™é‡Œçªç„¶æƒ³èµ·æ¥é‚£å¤©å­¦é•¿é¢è¯•çš„é—®é¢˜â€”â€”è¯´ä¸‹çº¿ç¨‹çš„åˆ›å»ºæ–¹æ³•å§</p><p>å¤´ä¸€æ¬¡æ„Ÿå—åˆ°å½“æ—¶å¼€å­¦ç”¨ä¸€ä¸ªæœˆå­¦Javaè¿™é—¨ç¼–ç¨‹è¯­è¨€çš„æ—¶å€™åˆ°å¦‚ä»Šè¿™æ ·ä¸€ä¸ªä¸å¤ªæ­£å¼çš„é¢è¯•ï¼Œé¢ä¸´å¦‚æ­¤åŸºç¡€ç®€å•çš„é—®é¢˜ æ—¶æ˜¯å¤šä¹ˆçš„æ— åŠ›â€¦</p><p>åˆ›å»ºçº¿ç¨‹ä¸€å…±æœ‰4ä¸ªæ–¹æ³•ï¼Œä½†ä¸‡å˜ä¸ç¦»å…¶å®—ï¼Œå®Œå…¨å¯ä»¥æ€»ç»“ä¸ºä¸€ä¸ªæ–¹æ³•â€”â€”å…¶æœ€ç»ˆéƒ½æ˜¯æ‰§è¡Œçš„<code>Thread.start()</code>å½“ä¸­çš„<code>run()</code>æ–¹æ³•</p><ol><li><p>å®ç°<code>Runable</code>æ¥å£ï¼Œé‡å†™<code>Run()</code>æ–¹æ³•</p></li><li><p>å®ç°<code>Callable</code>æ¥å£ï¼Œé‡å†™<code>Call()</code>æ–¹æ³•</p><ul><li><blockquote><p>ä¸ï¼ˆ1ï¼‰ä¸åŒçš„æ˜¯ï¼Œ<code>Call()</code>æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œå…¶ç±»å‹ç”±æˆ‘ä»¬åˆ›å»ºåŒ¿åå†…éƒ¨ç±»çš„æ—¶å€™æŒ‡å®šæ³›å‹ã€‚è€Œ<code>Callableæ¥å£</code>æœ¬èº«å¹¶ä¸æ˜¯<code>Runable</code>çš„å­ç±»ï¼Œåˆ›å»ºçº¿ç¨‹å¯ä»¥é€šè¿‡è¯¥æ–¹æ³•æ˜¯å› ä¸ºï¼šThreadåœ¨åˆ›å»ºçš„æ—¶å€™æ˜¯éœ€è¦å°†<code>Runable</code>æˆ–å…¶å­ç±»ä¼ å…¥ï¼Œå…¶ä¸­åŒ…å«äº†å­ç±»<code>FutureTask</code>è¿™æ ·ä¸€ä¸ªç±»ï¼Œåœ¨åˆ›å»ºè¿™ä¸ªç±»æ—¶å¯å°†Callableæ¥å£çš„å®ç°å½“åšæ„é€ å‚æ•°ä¼ è¿›å»ï¼Œä»¥è¾¾åˆ°åˆ›å»ºçº¿ç¨‹çš„ç›®çš„â€¦</p></blockquote></li></ul></li><li><p>ğŸ’©ç›´æ¥New Thread</p></li><li><p>é€šè¿‡çº¿ç¨‹æ± åˆ›å»ºâ€¦</p></li></ol><hr><p><strong>æ± åŒ–æŠ€æœ¯</strong></p><blockquote><p>ç¨‹åºè¿è¡Œçš„æœ¬è´¨æ˜¯ï¼šå ç”¨OSçš„èµ„æºï¼Œè€Œä¼˜åŒ–èµ„æºçš„ä½¿ç”¨â€”â€”&gt;æ± åŒ–æŠ€æœ¯</p><p>äº‹å…ˆå‡†å¤‡å¥½ä¸€äº›èµ„æºï¼Œéœ€è¦ç”¨çš„è¯ä»æˆ‘è¿™å„¿æ‹¿ï¼Œç”¨å®Œè¿˜æˆ‘</p></blockquote><p>å…¶ä¼˜ç‚¹ï¼š</p><ul><li>é™ä½èµ„æºçš„æ¶ˆè€—ï¼šæœ¬è´¨å³ä¼˜åŒ–èµ„æºçš„ä½¿ç”¨æ•ˆç‡</li><li>æ–¹ä¾¿çº¿ç¨‹ç®¡ç†ï¼šåˆ›å»ºçº¿ç¨‹æ± åˆå§‹åŒ–äº‹å…ˆçº¿ç¨‹</li><li>æé«˜å“åº”é€Ÿåº¦ï¼šä¸ç”¨é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹</li></ul><h3 id="çº¿ç¨‹æ± çš„3ä¸ªFunc"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„3ä¸ªFunc">Â¶</a>çº¿ç¨‹æ± çš„3ä¸ªFunc</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Executor</span> <span class="variable">executor1</span> <span class="operator">=</span> Executors.newSingleThreadExecutor(); -- å•ä¾‹çº¿ç¨‹</span><br><span class="line"><span class="type">Executor</span> <span class="variable">executor2</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>); -- å›ºå®šçº¿ç¨‹</span><br><span class="line"><span class="type">Executor</span> <span class="variable">executor3</span> <span class="operator">=</span> Executors.newCachedThreadPool(); --å¼¹æ€§</span><br></pre></td></tr></table></figure><h3 id="çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°">Â¶</a>çº¿ç¨‹æ± çš„7ä¸ªå‚æ•°</h3><p>é€šè¿‡ä¸‰ä¸ªFuncå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>Executors.newCachedThreadPool(); --å¼¹æ€§</code>è¿™æ ·ä¸€ä¸ªæ–¹æ³•æ˜¯å€¼å¾—æˆ‘ä»¬é’ççš„ï¼Œ</p><p>å…¶æ„é€ æ–¹æ³•ï¼š</p><img src="C:/Users/%E9%9B%B7%E7%A5%9E%E6%88%98%E6%9C%BA/AppData/Roaming/Typora/typora-user-images/image-20220918095441793.png" alt="image-20220918095441793" style="zoom: 65%;" /><blockquote><p>ä½†æ˜¯è¯»æºç æˆ‘ä»¬å¯ä»¥çœ‹åˆ°</p></blockquote><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220918094909666.png" alt="image-20220918094909666" style="zoom: 80%;" /><blockquote><p>è¿™é‡Œ<strong>å…è®¸çš„åˆ›å»ºçº¿ç¨‹æ•°é‡</strong>æ˜¯ï¼š<code>Integer.MAX_VALUE</code> = 2^31 - 1 â€”â€”&gt;<strong>å¯èƒ½ä¼šå †ç§¯å¤§é‡çš„è¯·æ±‚ï¼Œä»è€Œå¯¼è‡´ OOMï¼</strong></p></blockquote><p><img src="https://raw.githubusercontent.com/YxYL6125/imgBad/main/img/image-20220918095025854.png" alt="image-20220918095025854"></p><blockquote><p>è¿™ä¹Ÿæ˜¯é˜¿é‡Œå·´å·´å¼€å‘æ‰‹å†Œé‡Œé¢æåˆ°çš„ï¼Œçº¿ç¨‹æ± ä¸å…è®¸ä½¿ç”¨ <code>Executors</code> å»åˆ›å»ºï¼Œè€Œæ˜¯é€šè¿‡ <code>ThreadPoolExecutor</code> è¿™æ ·ä¸€ä¸ªåŸç”Ÿçš„æ–¹å¼æ¥åˆ›å»ºçº¿ç¨‹ã€‚</p></blockquote><hr><p>å½’è¨€ï¼šå…¶7ä¸ªå‚æ•°åˆ†åˆ«ï¼š</p><ol><li>int <code>corePoolSize</code>ï¼š<strong>æ ¸å¿ƒçº¿ç¨‹æ•°</strong></li><li>int <code>maximumPoolSize</code>ï¼š<strong>æœ€å¤§åˆ›å»ºçº¿ç¨‹æ•°</strong></li><li>long <code>keepAliveTime</code>ï¼š<strong>å­˜æ´»æ—¶é—´</strong></li><li>TimeUnit <code>unit</code>ï¼š<strong>Timeç±»ç®¡ç†å·¥å…·</strong></li><li>BlockingQueue<Runnable> <code>workQueue</code>ï¼šæŒ‡å®šé˜»å¡é˜Ÿåˆ—</li><li>ThreadFactory <code>threadFactory</code>ï¼š<strong>çº¿ç¨‹å·¥å‚</strong></li><li>RejectedExecutionHandler <code>handler</code>ï¼š<strong>æ‹’ç»ç­–ç•¥</strong></li></ol><h3 id="çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥"><a class="header-anchor" href="#çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥">Â¶</a>çº¿ç¨‹æ± çš„4ä¸­æ‹’ç»ç­–ç•¥</h3><ul><li><code>new ThreadPoolExecutor.AbortPolicy()</code> // é“¶è¡Œæ»¡äº†ï¼Œè¿˜æœ‰äººè¿›æ¥ï¼Œä¸å¤„ç†è¿™ä¸ªäººçš„ï¼ŒæŠ›å‡ºå¼‚å¸¸</li><li><code>new ThreadPoolExecutor.CallerRunsPolicy()</code> //å“ªæ¥çš„å»å“ªé‡Œ!</li><li><code>new ThreadPoolExecutor.DiscardPolicy()</code> //é˜Ÿåˆ—æ»¡äº†ï¼Œä¸¢æ‰ä»»åŠ¡ï¼Œä¸ä¼šæŠ›å‡ºå¼‚å¸¸!</li><li><code>new ThreadPoolExecutor.DiscardoldestPolicyO()</code> //é˜Ÿåˆ—æ»¡äº†ï¼Œå°è¯•å»å’Œæœ€æ—©çš„ç«äº‰ï¼Œä¹Ÿä¸ä¼šæŠ›å‡ºå¼‚å¸¸!</li></ul><h2 id="ğŸ“¼-JMM"><a class="header-anchor" href="#ğŸ“¼-JMM">Â¶</a>ğŸ“¼:JMM</h2><blockquote><p>JMM(Java Memory Model)ï¼šJavaå†…å­˜æ¨¡å‹</p></blockquote><p>å®ƒå®ç°äº†Javaç¨‹åºåœ¨å„ç§å¹³å°ä¸Šéƒ½èƒ½è¾¾åˆ°ä¸€å®šçš„å¹¶å‘æ•ˆæœ</p><p>æ¯ä¸ªJavaç¨‹åºéƒ½æœ‰<strong>ä¸»å†…å­˜</strong>ï¼Œä»¥åŠ<strong>æ¯æ¡çº¿ç¨‹çš„å·¥ä½œå†…å­˜</strong></p><p>æ¯å¤©çº¿ç¨‹è·å–èµ„æºéƒ½ä¼šæœ‰ç›¸åº”çš„äº¤äº’æ“ä½œè§„èŒƒï¼š</p><h3 id="8ç§å†…å­˜äº¤äº’æ¨¡å‹"><a class="header-anchor" href="#8ç§å†…å­˜äº¤äº’æ¨¡å‹">Â¶</a>8ç§å†…å­˜äº¤äº’æ¨¡å‹</h3><ul><li>lock(é”å®š)ï¼Œä½œç”¨äº<strong>ä¸»å†…å­˜</strong>ä¸­çš„å˜é‡ï¼ŒæŠŠå˜é‡æ ‡è¯†ä¸ºçº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚</li><li>read(è¯»å–)ï¼Œä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼ŒæŠŠå˜é‡çš„å€¼ä»ä¸»å†…å­˜ä¼ è¾“åˆ°çº¿ç¨‹çš„å·¥ä½œå†…å­˜ä¸­ï¼Œä»¥ä¾¿ä¸‹ä¸€æ­¥çš„loadæ“ä½œä½¿ç”¨ã€‚</li><li>load(åŠ è½½)ï¼Œä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼ŒæŠŠreadæ“ä½œä¸»å­˜çš„å˜é‡æ”¾å…¥åˆ°å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ã€‚</li><li>use(ä½¿ç”¨)ï¼Œä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼ŒæŠŠå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ä¼ è¾“åˆ°æ‰§è¡Œå¼•æ“ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦ä½¿ç”¨åˆ°å˜é‡çš„å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li><li>assign(èµ‹å€¼)ï¼Œä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»æ‰§è¡Œå¼•æ“ä¸­æ¥å—åˆ°çš„å€¼èµ‹å€¼ç»™å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬ä¸­ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡èµ‹å€¼çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚</li><li>store(å­˜å‚¨)ï¼Œä½œç”¨äº<strong>å·¥ä½œå†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªä»å·¥ä½œå†…å­˜ä¸­ä¸€ä¸ªå˜é‡çš„å€¼ä¼ é€åˆ°ä¸»å†…å­˜ä¸­ï¼Œä»¥ä¾¿åç»­çš„writeä½¿ç”¨ã€‚</li><li>write(å†™å…¥)ï¼šä½œç”¨äº<strong>ä¸»å†…å­˜</strong>ä¸­çš„å˜é‡ï¼Œå®ƒæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼æ”¾å…¥ä¸»å†…å­˜çš„å˜é‡ä¸­ã€‚</li><li>unlock(è§£é”)ï¼šä½œç”¨äº<strong>ä¸»å†…å­˜</strong>çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚</li></ul><p>JMMå¯¹8ç§å†…å­˜äº¤äº’æ“ä½œåˆ¶å®šçš„è§„åˆ™ï¼š</p><ul><li>ä¸å…è®¸readã€loadã€storeã€writeæ“ä½œä¹‹ä¸€å•ç‹¬å‡ºç°ï¼Œä¹Ÿå°±æ˜¯readæ“ä½œåå¿…é¡»loadï¼Œstoreæ“ä½œåå¿…é¡»writeã€‚</li><li>ä¸å…è®¸çº¿ç¨‹ä¸¢å¼ƒä»–æœ€è¿‘çš„assignæ“ä½œï¼Œå³å·¥ä½œå†…å­˜ä¸­çš„å˜é‡æ•°æ®æ”¹å˜äº†ä¹‹åï¼Œå¿…é¡»å‘ŠçŸ¥ä¸»å­˜ã€‚</li><li>ä¸å…è®¸çº¿ç¨‹å°†æ²¡æœ‰assignçš„æ•°æ®ä»å·¥ä½œå†…å­˜åŒæ­¥åˆ°ä¸»å†…å­˜ã€‚</li><li>ä¸€ä¸ªæ–°çš„å˜é‡å¿…é¡»åœ¨ä¸»å†…å­˜ä¸­è¯ç”Ÿï¼Œä¸å…è®¸å·¥ä½œå†…å­˜ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæœªè¢«åˆå§‹åŒ–çš„å˜é‡ã€‚å°±æ˜¯å¯¹å˜é‡å®æ–½useã€storeæ“ä½œä¹‹å‰ï¼Œå¿…é¡»ç»è¿‡loadå’Œassignæ“ä½œã€‚</li><li>ä¸€ä¸ªå˜é‡åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œlockæ“ä½œã€‚å¤šæ¬¡lockä¹‹åï¼Œå¿…é¡»æ‰§è¡Œç›¸åŒæ¬¡æ•°unlockæ‰å¯ä»¥è§£é”ã€‚</li><li>å¦‚æœå¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œlockæ“ä½œï¼Œä¼šæ¸…ç©ºæ‰€æœ‰å·¥ä½œå†…å­˜ä¸­æ­¤å˜é‡çš„å€¼ã€‚åœ¨æ‰§è¡Œå¼•æ“ä½¿ç”¨è¿™ä¸ªå˜é‡å‰ï¼Œå¿…é¡»é‡æ–°loadæˆ–assignæ“ä½œåˆå§‹åŒ–å˜é‡çš„å€¼ã€‚</li><li>å¦‚æœä¸€ä¸ªå˜é‡æ²¡æœ‰è¢«lockï¼Œå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œunlockæ“ä½œã€‚ä¹Ÿä¸èƒ½unlockä¸€ä¸ªè¢«å…¶ä»–çº¿ç¨‹é”ä½çš„å˜é‡ã€‚</li><li>ä¸€ä¸ªçº¿ç¨‹å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œunlockæ“ä½œä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠæ­¤å˜é‡åŒæ­¥å›ä¸»å†…å­˜ã€‚</li></ul><h2 id="Volatile"><a class="header-anchor" href="#Volatile">Â¶</a>Volatile</h2><blockquote><p><code>Volatile</code>æ˜¯Jvmè™šæ‹Ÿæœºæä¾›çš„è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</p></blockquote><p>ç‰¹ç‚¹ï¼š</p><ol><li>ä¸ä¿è¯åŸå­æ€§<ul><li>è¿™é‡Œçš„åŸå­æ€§ï¼š<strong>å³ä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚åŸå­æ€§å°±åƒæ•°æ®åº“é‡Œé¢çš„äº‹åŠ¡ä¸€æ ·ï¼Œä»–ä»¬æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼ŒåŒç”Ÿå…±æ­»ã€‚</strong></li></ul></li><li>ç¦æ­¢æŒ‡ä»¤é‡æ’<ul><li>åˆ©ç”¨CPUçš„å†…å­˜å±éšœï¼Œé¿å…æŒ‡ä»¤é‡æ’ç°è±¡å‡ºç°</li></ul></li><li>æŒ‡ä»¤å¯è§æ€§<ul><li>å½“çº¿ç¨‹è¿˜æ­£åœ¨æ¶ˆè´¹ä¸»çº¿ç¨‹èµ„æºæ—¶ï¼Œèµ„æºå‘ç”Ÿæ›´æ”¹ï¼Œ<code>volatile</code>ä¿è¯<strong>è¿™ä¸ªæ›´æ”¹</strong>åŠæ—¶<strong>é€šçŸ¥</strong>åˆ°çº¿ç¨‹</li></ul></li></ol><h2 id="CAS"><a class="header-anchor" href="#CAS">Â¶</a>CAS</h2><blockquote><p>CASçš„å…¨ç§°ä¸º<code>compare and swap</code> æˆ–è€…<code>compare and exchange</code>,æ„æ€ä¸ºæ¯”è¾ƒå’Œäº¤æ¢</p><ul><li>æ¯”è¾ƒï¼šæ¯”è¾ƒå½“å‰çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å€¼&lt;â€”â€”&gt;å’Œä¸»å†…å­˜ä¸­çš„å€¼</li><li>äº¤æ¢ï¼šè‹¥ä¸ºæœŸæœ›â€”â€”&gt;åˆ™æ‰§è¡Œæ“ä½œï¼›è‹¥ä¸æ˜¯æœŸæœ›ï¼Œç”±äºåº•å±‚æ˜¯è‡ªæ—‹é”ï¼Œä¼šæ— çº¿å¾ªç¯</li></ul><p><strong>æœ¬è´¨</strong>ä¸Šå³æ˜¯ï¼Œå¯¹ä¹è§‚é”æ€æƒ³çš„å®é™…å®ç°â€¦</p></blockquote><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="type">AtomicInteger</span> <span class="variable">integer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">1000</span>);<span class="comment">//åŸå­ç±»</span></span><br><span class="line"><span class="comment">//CASæ“ä½œ</span></span><br><span class="line">System.out.println(integer.compareAndSet(<span class="number">1000</span>, <span class="number">2000</span>));<span class="comment">//true</span></span><br><span class="line">System.out.println(integer.getAndIncrement());<span class="comment">//2000</span></span><br><span class="line">System.out.println(integer);<span class="comment">//2001</span></span><br><span class="line">System.out.println(integer.compareAndSet(<span class="number">1000</span>, <span class="number">2000</span>));<span class="comment">//false</span></span><br></pre></td></tr></table></figure><h3 id="CASå®ç°åŸå­æ“ä½œçš„é—®é¢˜"><a class="header-anchor" href="#CASå®ç°åŸå­æ“ä½œçš„é—®é¢˜">Â¶</a>CASå®ç°åŸå­æ“ä½œçš„é—®é¢˜</h3><p>ABAé—®é¢˜ï¼š</p><blockquote><p>å› ä¸ºCASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™ï¼Œæ£€æŸ¥å€¼æœ‰æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœæ²¡æœ‰å‘ç”Ÿå˜åŒ–åˆ™æ›´æ–°ï¼Œä½†æ˜¯å¦‚æœä¸€ä¸ªå€¼åŸæ¥æ˜¯Aï¼Œå˜æˆäº†Bï¼Œåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆä½¿ç”¨CASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å®ƒçš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šå´å˜åŒ–äº†</p></blockquote><p>è§£å†³ABAé—®é¢˜ï¼šä½¿ç”¨å¸¦ç‰ˆæœ¬å·æœºåˆ¶çš„â€”â€”&gt;åŸå­åº”ç”¨ç±»</p><p><strong>è¿™é‡Œä»…æ¬å‡ºç®€å•çš„ä¸€ç±»è§£å†³æ–¹æ¡ˆï¼Œç±»ä¼¼äºä¹è§‚é”çš„æ€æƒ³â€”â€”&gt;åŸºäºç‰ˆæœ¬å·æ§åˆ¶</strong></p><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AtomicStampedReference&lt;Integer&gt; atomicReference</span><br><span class="line">                = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;Integer&gt;(<span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> atomicReference.getStamp();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">    &#125;</span><br><span class="line">    atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">102</span></span><br><span class="line">            , atomicReference.getStamp(), atomicReference.getStamp() + <span class="number">1</span>);</span><br><span class="line">    System.out.println(atomicReference.getStamp());</span><br><span class="line">    System.out.println(atomicReference.getReference());</span><br><span class="line"></span><br><span class="line">    atomicReference.compareAndSet(<span class="number">102</span>, <span class="number">100</span></span><br><span class="line">            , atomicReference.getStamp(), atomicReference.getStamp() + <span class="number">1</span>);</span><br><span class="line">    System.out.println(atomicReference.getStamp());</span><br><span class="line">    System.out.println(atomicReference.getReference());</span><br><span class="line"></span><br><span class="line">&#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line"></span><br><span class="line">    atomicReference.compareAndSet(<span class="number">100</span>, <span class="number">105</span></span><br><span class="line">            , stamp, stamp + <span class="number">1</span>);</span><br><span class="line">    System.out.println(atomicReference.getStamp());</span><br><span class="line">    System.out.println(atomicReference.getReference());</span><br><span class="line">&#125;, <span class="string">&quot;B&quot;</span>).start();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Tech-Stuck </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JUC </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
