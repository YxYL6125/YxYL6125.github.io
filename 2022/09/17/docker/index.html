<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>docker | YxYL</title><meta name="keywords" content="docker"><meta name="author" content="YxYL,yxyl6125@gmail.com"><meta name="copyright" content="YxYL"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="了解阿里云 阿里云，阿里巴巴集团旗下云计算品牌，全球卓越的云计算技术和服务提供商。创立于2009年，在杭州、北京、硅谷等地设有研发中心和运营机构。 阿里云创立于2009年，是全球领先的云计算及人工智能科技公司，致力于以在线公共服务的方式，提供安全、可靠的计算和数据处理能力，让计算和人工智能成为普惠科技。阿里云服务着制造、金融、政务、交通、医疗、电信、能源等众多领域的领军企业，包括中国联通、1230">
<meta property="og:type" content="article">
<meta property="og:title" content="docker">
<meta property="og:url" content="https://www.yxyl6125.eu.org/2022/09/17/docker/index.html">
<meta property="og:site_name" content="YxYL">
<meta property="og:description" content="了解阿里云 阿里云，阿里巴巴集团旗下云计算品牌，全球卓越的云计算技术和服务提供商。创立于2009年，在杭州、北京、硅谷等地设有研发中心和运营机构。 阿里云创立于2009年，是全球领先的云计算及人工智能科技公司，致力于以在线公共服务的方式，提供安全、可靠的计算和数据处理能力，让计算和人工智能成为普惠科技。阿里云服务着制造、金融、政务、交通、医疗、电信、能源等众多领域的领军企业，包括中国联通、1230">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dmoe.cc/random.php">
<meta property="article:published_time" content="2022-09-17T11:38:06.000Z">
<meta property="article:modified_time" content="2022-09-17T11:39:13.101Z">
<meta property="article:author" content="YxYL">
<meta property="article:tag" content="docker">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dmoe.cc/random.php"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://www.yxyl6125.eu.org/2022/09/17/docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'docker',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-09-17 19:39:13'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ��ҳ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> Ŀ¼</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> ʱ����</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> ��ǩ</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ����</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ���԰�</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> ����</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://www.dmoe.cc/random.php')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">YxYL</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> ��ҳ</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-compass"></i><span> Ŀ¼</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> ʱ����</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> ��ǩ</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> ����</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-comment-dots"></i><span> ���԰�</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> ����</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">docker</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-09-17T11:38:06.000Z" title="发表于 2022-09-17 19:38:06">2022-09-17</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-09-17T11:39:13.101Z" title="更新于 2022-09-17 19:39:13">2022-09-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Tech-Stuck/">Tech-Stuck</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="docker"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1>了解阿里云</h1>
<p>阿里云，阿里巴巴集团旗下云计算品牌，全球卓越的云计算技术和服务提供商。创立于2009年，在杭州、北京、硅谷等地设有研发中心和运营机构。</p>
<p>阿里云创立于2009年，是全球领先的云计算及人工智能科技公司，致力于以在线公共服务的方式，提供安全、可靠的计算和数据处理能力，让计算和人工智能成为普惠科技。阿里云服务着制造、金融、政务、交通、医疗、电信、能源等众多领域的领军企业，包括中国联通、12306、中石化、中石油、飞利浦、华大基因等大型企业客户，以及微博、知乎、锤子科技等明星互联网公司。在天猫双11全球狂欢节、12306春运购票等极富挑战的应用场景中，阿里云保持着良好的运行纪录  。<br>
阿里云在全球各地部署高效节能的绿色数据中心，利用清洁计算为万物互联的新世界提供源源不断的能源动力，目前开服的区域包括中国（华北、华东、华南、香港）、新加坡、美国（美东、美西）、欧洲、中东、澳大利亚、日本。<br>
2014年，阿里云曾帮助用户抵御全球互联网史上最大的DDoS攻击，峰值流量达到每秒453.8Gb  。在Sort Benchmark 2016 排序竞赛 CloudSort项目中，阿里云以1.44$/TB的排序花费打破了AWS保持的4.51$/TB纪录 [3]  。在Sort Benchmark 2015，阿里云利用自研的分布式计算平台ODPS，377秒完成100TB数据排序，刷新了Apache Spark 1406秒的世界纪录 。<br>
2019年3月3日凌晨，阿里云深夜出现故障，阿里云官方回复，华北2地域可用区C部分ECS服务器等实例出现IO HANG [4]  持续了三个小时左右， [5]  经紧急排查处理后逐步恢复。   2019年6月11日，阿里云入选“2019福布斯中国最具创新力企业榜”。</p>
<h2 id="阿里云注册"><a class="header-anchor" href="#阿里云注册">¶</a>阿里云注册</h2>
<p>阿里云注册十分简单，可以用支付宝和手机号进行注册。</p>
<p>官方地址：<a target="_blank" rel="noopener" href="https://www.aliyun.com/?utm_content=se_1003105888">https://www.aliyun.com/?utm_content=se_1003105888</a></p>
<p>按照提示步骤进行注册即可。</p>
<h1>docker学习</h1>
<h2 id="docker概述"><a class="header-anchor" href="#docker概述">¶</a>docker概述</h2>
<h3 id="docker为什么会出现"><a class="header-anchor" href="#docker为什么会出现">¶</a>docker为什么会出现</h3>
<p>一款产品：开发——上线 两套环境，应用环境，应用配置。</p>
<p>开发——运维。问题：我在我的电脑上可以运行。版本更新，导致服务不可用！对运维来说，考验就特别大。</p>
<p>环境配置是十分麻烦的事情，没一个机器都要部署环境（集群Redis、es、Hadoop……）费时费力。</p>
<p>发布一个项目（jar+（Redis MySQL jdk es Hadoop）），项目能不能都带上环境安装打包？</p>
<p>之前在一个服务器配置一个应用的环境Redis、MySQL、jdk、es、Hadoop，配置会很阿发，不能够跨平台。</p>
<p>Windows，最后发布到Linux！</p>
<p>传统：开发jar，运维来做。</p>
<p>现在：开发打包部署上线，一套流程走完。</p>
<p>java——apk——发布（应用商店）——张三使用APP——安装即可用</p>
<p>java——jar（环境）——打包项目带上环境（镜像）——（docker仓库：商店）——下载我们发布的镜像——直接运行即可</p>
<p>docker的出现给以上的问题，提出了解决方案。</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210310092958567.png" alt="image-20210310092958567"></p>
<p>docker的思想来源于集装箱！</p>
<p>JRE——多个应用（端口冲突）——原来都是交叉的</p>
<p>隔离：docker核心思想！打包装箱，每个箱子是互相隔离的。</p>
<p>docker通过隔离机制，可以将服务器利用到极致。</p>
<p>本质：所有的技术都是因为出现了一些问题，需要我们去解决，才去学习。</p>
<h3 id="docker的历史"><a class="header-anchor" href="#docker的历史">¶</a>docker的历史</h3>
<p>2010年，几个搞IT的年轻人，在美国成立了一家公司 DotCloud</p>
<p>做一些pass的云计算服务，LXC有关的容器技术。</p>
<p>他们将自己的技术（容器化技术）命名就是docker！</p>
<p>docker刚刚诞生的时候，没有引起行业的注意。DotCloud，就活不下去。</p>
<p>最后只能将docker开源。</p>
<p>2013年docker开源。</p>
<p>docker开源后让越来越多的人发现了docker的优点，docker就火了，此后docker每个月都会更新一个版本。</p>
<p>2014年4月9号，docker1.0发布。</p>
<p>docker为什么这么火，因为它十分的轻巧。</p>
<p>在容器技术出来之前，我们都是使用虚拟化技术！</p>
<p>虚拟机：在Windows中装一个VMware，通过这个软件我们可以虚拟出一台或多台电脑，比较笨重。</p>
<p>虚拟机也是属于虚拟化技术，docker容器技术，也是一种虚拟化技术。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vm ： liunx centos原生镜像（一个电脑！） 隔离，需要开启多个虚拟机！ 几个G 几分钟</span><br><span class="line">docker：隔离 镜像（最核心的环境 4M + jdk + mysql）十分的轻巧，运行镜像就可以了！小巧，几个M、KB 秒级启动</span><br></pre></td></tr></table></figure>
<p>到现在，docker是一项有必要去掌握的技能。</p>
<h4 id="聊聊docker"><a class="header-anchor" href="#聊聊docker">¶</a>聊聊docker</h4>
<p>docker是基于go语言开发的开源项目。</p>
<p>官网地址：<a target="_blank" rel="noopener" href="https://www.docker.com">https://www.docker.com</a></p>
<p>文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com">https://docs.docker.com</a></p>
<p>仓库地址：<a target="_blank" rel="noopener" href="https://hub.docker.com">https://hub.docker.com</a></p>
<h3 id="docker-能干嘛"><a class="header-anchor" href="#docker-能干嘛">¶</a>docker 能干嘛</h3>
<p>之前的虚拟技术</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE1Mzg1Mjk1NC5wbmc?x-oss-process=image/format,png" alt="image-20200515153852954"></p>
<blockquote>
<p><strong>虚拟机技术缺点</strong>：</p>
</blockquote>
<p>1、 资源占用十分多</p>
<p>2、 冗余步骤多</p>
<p>3、 启动很慢！</p>
<p>容器化技术</p>
<p>容器化技术不是模拟一个完整的操作系统</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTA5NDMzNjg0Ni5wbmc?x-oss-process=image/format,png" alt="image-20200515094336846"></p>
<p>比较Docker和虚拟机技术的不同：</p>
<p>传统虚拟机，虚拟出一条硬件，运行一个完整的操作系统，然后在这个系统上安装和运行软件</p>
<p>容器内的应用直接运行在宿主机的内容，容器是没有自己的内核的，也没有虚拟我们的硬件，所以就轻便了</p>
<p>每个容器间是互相隔离，每个容器内都有一个属于自己的文件系统，互不影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DevOps（开发、运维）</span><br></pre></td></tr></table></figure>
<p><strong>应用更快速的交付和部署</strong></p>
<p>传统：一堆帮助文档，安装程序</p>
<p>docker：打包镜像发布测试，一键运行</p>
<p><strong>更便捷的升级和扩缩容</strong></p>
<p>使用了docker之后，我们部署应用就和搭积木一样。</p>
<p>项目打包为一个镜像之后，拓展服务器A，服务器B</p>
<p><strong>更简单的系统运维</strong></p>
<p>在容器化之后，我们开发，测试环境都是高度一致的</p>
<p>更高效的计算资源利用：</p>
<p>docker是内核级别的虚拟化，可以在一个物理机上运行很多的容器实例。服务器的性能可以被压榨到极致。</p>
<h2 id="docker安装"><a class="header-anchor" href="#docker安装">¶</a>docker安装</h2>
<h3 id="docker的基本组成"><a class="header-anchor" href="#docker的基本组成">¶</a>docker的基本组成</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNDE5NTgwNTQwMC5wbmc?x-oss-process=image/format,png" alt="image-20200514195805400"></p>
<p><strong>镜像（image)：</strong></p>
<p>docker镜像就好比是一个目标，可以通过这个目标来创建容器服务，tomcat镜像==&gt;run==&gt;容器（提供服务器），通过这个镜像可以创建多个容器（最终服务运行或者项目运行就是在容器中的）。</p>
<p><strong>容器(container)：</strong></p>
<p>Docker利用容器技术，独立运行一个或者一组应用，通过镜像来创建的.<br>
启动，停止，删除，基本命令<br>
目前就可以把这个容器理解为就是一个简易的 Linux系统。</p>
<p><strong>仓库(repository)：</strong></p>
<p>仓库就是存放镜像的地方！<br>
仓库分为公有仓库和私有仓库。(很类似git)<br>
Docker Hub是国外的。<br>
阿里云…都有容器服务器(配置镜像加速!)</p>
<h3 id="安装docker"><a class="header-anchor" href="#安装docker">¶</a>安装docker</h3>
<p>环境准备</p>
<p>1、需要一点liunx基础</p>
<p>2、centos 7</p>
<p>3、我们使用Xshell连接远程服务器进行操作！（其它的工具也行）</p>
<p><a target="_blank" rel="noopener" href="https://www.netsarang.com/en/free-for-home-school/">https://www.netsarang.com/en/free-for-home-school/</a> 申请免费Xshell网址。</p>
<p>4、阿里云服务器</p>
<p>阿里云优惠购买地址：<a target="_blank" rel="noopener" href="https://www.aliyun.com/minisite/goods?userCode=0phtycgr">https://www.aliyun.com/minisite/goods?userCode=0phtycgr</a></p>
<p>购买之后需要创建安全组开放端口入口</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210310112823367.png" alt="image-20210310112823367"></p>
<p>刚创建的只默认三个端口。</p>
<p>我们可以开放一些常用的端口。</p>
<p>接着要修改实例名称和密码，重启系统，就可以了。</p>
<p>接着用Xshell远程阿里云服务器就可以了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">系统内核是3.10以上的</span></span><br><span class="line">[root@haimian /]# uname -r</span><br><span class="line">3.10.0-1062.18.1.el7.x86_64</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">系统版本</span></span><br><span class="line">[root@haimian /]# cat /etc/os-release</span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开始安装</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在官方文档查看安装流程</span></span><br><span class="line">yum -y install gcc</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、卸载旧的版本</span></span><br><span class="line">[root@haimian /]# yum remove docker \</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">                  docker-client \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-client-latest \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-common \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-latest \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-latest-logrotate \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-logrotate \</span></span><br><span class="line"><span class="language-bash">&gt;                   docker-engine</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">No Match for argument: docker</span><br><span class="line">No Match for argument: docker-client</span><br><span class="line">No Match for argument: docker-client-latest</span><br><span class="line">No Match for argument: docker-common</span><br><span class="line">No Match for argument: docker-latest</span><br><span class="line">No Match for argument: docker-latest-logrotate</span><br><span class="line">No Match for argument: docker-logrotate</span><br><span class="line">No Match for argument: docker-engine</span><br><span class="line">No Packages marked for removal</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卸载完毕</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、安装安装包</span></span><br><span class="line">[root@haimian /]# yum install -y yum-utils</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、设置镜像的仓库</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官方文档默认是从国外的，不推荐</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">推荐使用国内的，这个是阿里云的，十分的快。</span></span><br><span class="line">[root@haimian /]# yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">adding repo from: https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">grabbing file https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line">repo saved to /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、更新yum的索引</span></span><br><span class="line">[root@haimian /]# yum makecache fast</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">5、安装docker</span> </span><br><span class="line">docker-ce 社区版 docker-ee 企业版</span><br><span class="line">[root@haimian /]# yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">6、启动docker</span></span><br><span class="line">[root@haimian /]# systemctl start docker</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">7、查看版本 helloword测试是否成功</span></span><br><span class="line">[root@haimian /]# docker version</span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.5</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.13.15</span><br><span class="line"> Git commit:        55c4c88</span><br><span class="line"> Built:             Tue Mar  2 20:33:55 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      true</span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.5</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.13.15</span><br><span class="line">  Git commit:       363e9a8#8、测试Holleword</span><br><span class="line">  Built:            Tue Mar  2 20:32:17 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     false</span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.4</span><br><span class="line">  GitCommit:        05f951a3781f4f2c1911b05e61c160e9c30eaa8e</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.0-rc93</span><br><span class="line">  GitCommit:        12644e614e25b05da6fd08a38ffa0cfe1903fdec</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">8、测试Holle—word</span></span><br><span class="line">[root@haimian /]# docker run hello-world</span><br><span class="line">Unable to find image &#x27;hello-world:latest&#x27; locally</span><br><span class="line">latest: Pulling from library/hello-world</span><br><span class="line">b8dfde127a29: Pull complete </span><br><span class="line">Digest: sha256:89b647c604b2a436fc3aa56ab1ec515c26b085ac0c15b0d105bc475be15738fb</span><br><span class="line">Status: Downloaded newer image for hello-world:latest</span><br><span class="line"></span><br><span class="line">Hello from Docker!</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br><span class="line"></span><br><span class="line">[root@haimian /]# docker run hello-world</span><br><span class="line"></span><br><span class="line">Hello from Docker!#出现这句话表示成功了</span><br><span class="line">This message shows that your installation appears to be working correctly.</span><br><span class="line"></span><br><span class="line">To generate this message, Docker took the following steps:</span><br><span class="line"> 1. The Docker client contacted the Docker daemon.</span><br><span class="line"> 2. The Docker daemon pulled the &quot;hello-world&quot; image from the Docker Hub.</span><br><span class="line">    (amd64)</span><br><span class="line"> 3. The Docker daemon created a new container from that image which runs the</span><br><span class="line">    executable that produces the output you are currently reading.</span><br><span class="line"> 4. The Docker daemon streamed that output to the Docker client, which sent it</span><br><span class="line">    to your terminal.</span><br><span class="line"></span><br><span class="line">To try something more ambitious, you can run an Ubuntu container with:</span><br><span class="line"><span class="meta prompt_"> $ </span><span class="language-bash">docker run -it ubuntu bash</span></span><br><span class="line"></span><br><span class="line">Share images, automate workflows, and more with a free Docker ID:</span><br><span class="line"> https://hub.docker.com/</span><br><span class="line"></span><br><span class="line">For more examples and ideas, visit:</span><br><span class="line"> https://docs.docker.com/get-started/</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">9、查看刚刚下载的holle-word镜像</span></span><br><span class="line">[root@haimian /]# docker images</span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED      SIZE</span><br><span class="line">hello-world   latest    d1165f221234   4 days ago   13.3kB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">10、卸载docker</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第一步卸载Docker Engine，CLI和Containerd软件包：</span></span><br><span class="line">sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">第二步主机上的映像，容器，卷或自定义配置文件不会自动删除。要删除所有图像，容器和卷：</span></span><br><span class="line"></span><br><span class="line"> sudo rm -rf /var/lib/docker</span><br><span class="line"> sudo rm -rf /var/lib/containerd</span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<h3 id="阿里云镜像加速"><a class="header-anchor" href="#阿里云镜像加速">¶</a>阿里云镜像加速</h3>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210310152106473.png" alt="image-20210310152106473"></p>
<p>登录阿里云，找到这个菜单。</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210310152407391.png" alt="image-20210310152407391"></p>
<p>点击镜像加速器，选择centOS系统 cape 代码运行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /etc/docker#创建目录</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">添加修改配置</span></span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://2m22qn0c.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line">systemctl daemon-reload#关闭</span><br><span class="line">systemctl restart docker#重启</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">加速就配置好了</span></span><br></pre></td></tr></table></figure>
<h3 id="回顾HelloWorld流程"><a class="header-anchor" href="#回顾HelloWorld流程">¶</a>回顾HelloWorld流程</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTEwMjUwMzcyMi5wbmc?x-oss-process=image/format,png" alt="image-20200515102503722"></p>
<h4 id="docker-run-流程图"><a class="header-anchor" href="#docker-run-流程图">¶</a><strong>docker run 流程图</strong></h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTEwMjYzNzI0Ni5wbmc?x-oss-process=image/format,png" alt="image-20200515102637246"></p>
<h3 id="底层原理"><a class="header-anchor" href="#底层原理">¶</a>底层原理</h3>
<p><strong>docker是怎么工作的？</strong></p>
<p>Docker是一个Client-Server结构的系统，Docker的守护进程运行在主机上。通过Socket从客户端访问！</p>
<p>Docker-Server接收到Docker-Client的指令，就会执行这个命令！</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTEwMjk0OTU1OC5wbmc?x-oss-process=image/format,png" alt="image-20200515102949558"></p>
<h3 id="docker为什么比VM快"><a class="header-anchor" href="#docker为什么比VM快">¶</a>docker为什么比VM快</h3>
<p>1、docker有着比虚拟机更少的抽象层。由于docker不需要Hypervisor实现硬件资源虚拟化,运行在docker容器上的程序直接使用的都是实际物理机的硬件资源。因此在CPU、内存利用率上docker将会在效率上有明显优势。<br>
2、docker利用的是宿主机的内核,而不需要Guest OS。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTEwNDExNzMyOS5wbmc?x-oss-process=image/format,png" alt="image-20200515104117329"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GuestOS： VM（虚拟机）里的的系统（OS）</span><br><span class="line">HostOS：物理机里的系统（OS）</span><br></pre></td></tr></table></figure>
<p>因此,当新建一个 容器时,docker不需要和虚拟机一样重新加载一个操作系统内核。仍而避免引导、加载操作系统内核返个比较费时费资源的过程,当新建一个虚拟机时,虚拟机软件需要加载GuestOS,返个新建过程是分钟级别的。而docker由于直接利用宿主机的操作系统,则省略了这个复杂的过程,因此新建一个docker容器只需要几秒钟。</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210310155518622.png" alt="image-20210310155518622"></p>
<p>之后学习完所有的命令再回过头来看这段理论，就会很清晰。</p>
<h2 id="docker命令"><a class="header-anchor" href="#docker命令">¶</a>docker命令</h2>
<h3 id="基本命令"><a class="header-anchor" href="#基本命令">¶</a>基本命令</h3>
<p>命令帮助文档地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker version    #查看docker的版本信息</span><br><span class="line">docker info       #显示docker的系统信息，包括镜像和容器的数量</span><br><span class="line">docker 命令 ——help #帮助命令</span><br></pre></td></tr></table></figure>
<h3 id="镜像命令"><a class="header-anchor" href="#镜像命令">¶</a>镜像命令</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian /]# docker images </span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED      SIZE</span><br><span class="line">hello-world   latest    d1165f221234   4 days ago   13.3kB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">镜像的仓库源  镜像的标签   镜像的ID         镜像创建的时间 镜像的大</span></span><br><span class="line">小</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可选项(常用)</span></span><br><span class="line">  -a, --all   # 列出所有镜像         </span><br><span class="line">  -q, --quiet # 只显示镜像的ID</span><br><span class="line"><span class="meta prompt_">  </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">搜索命令 search</span></span><br><span class="line">[root@haimian /]# docker search mysql</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可选项</span></span><br><span class="line">[root@haimian /]# docker search --help</span><br><span class="line"></span><br><span class="line">Usage:  docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">Search the Docker Hub for images</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print search using a Go template</span><br><span class="line">      --limit int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don&#x27;t truncate output</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--filter 只搜索stars大于500以上的</span></span><br><span class="line">[root@haimian /]# docker search mysql --filter=STARS=500</span><br><span class="line">NAME                 DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">mysql                MySQL is a widely used, open-source relation…   10593     [OK]       </span><br><span class="line">mariadb              MariaDB Server is a high performing open sou…   3968      [OK]       </span><br><span class="line">mysql/mysql-server   Optimized MySQL Server Docker images. Create…   778                  [OK]</span><br><span class="line">percona              Percona Server is a fork of the MySQL relati…   528       [OK]   </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载镜像 docker pull 镜像名[:tag]，tag是docker-hub 商店里面应用存在的版本号，商店中没有的版本无法下载</span></span><br><span class="line">[root@haimian /]# docekr pull mysql</span><br><span class="line">-bash: docekr: command not found</span><br><span class="line">[root@haimian /]# docker pull mysql</span><br><span class="line">Using default tag: latest #不写tag，默认就是latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Pull complete #分层下载，docker images 核心 联合文件系统</span><br><span class="line">f6c208f3f991: Pull complete </span><br><span class="line">88a9455a9165: Pull complete </span><br><span class="line">406c9b8427c6: Pull complete </span><br><span class="line">7c88599c0b25: Pull complete </span><br><span class="line">25b5c6debdaf: Pull complete </span><br><span class="line">43a5816f1617: Pull complete </span><br><span class="line">1a8c919e89bf: Pull complete </span><br><span class="line">9f3cf4bd1a07: Pull complete </span><br><span class="line">80539cea118d: Pull complete </span><br><span class="line">201b3cad54ce: Pull complete </span><br><span class="line">944ba37e1c06: Pull complete </span><br><span class="line">Digest: sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c # 签名</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  #真实地址</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">指定版本下载</span></span><br><span class="line">[root@haimian /]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">a076a628af6f: Already exists #文件共用，已存在已下载的文件不再重复下载，极大地节省内存</span><br><span class="line">f6c208f3f991: Already exists </span><br><span class="line">88a9455a9165: Already exists </span><br><span class="line">406c9b8427c6: Already exists </span><br><span class="line">7c88599c0b25: Already exists </span><br><span class="line">25b5c6debdaf: Already exists </span><br><span class="line">43a5816f1617: Already exists </span><br><span class="line">1831ac1245f4: Pull complete </span><br><span class="line">37677b8c1f79: Pull complete </span><br><span class="line">27e4ac3b0f6e: Pull complete </span><br><span class="line">7227baa8c445: Pull complete </span><br><span class="line">Digest: sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"></span><br><span class="line">[root@haimian /]# docker images </span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED       SIZE</span><br><span class="line">hello-world   latest    d1165f221234   4 days ago    13.3kB</span><br><span class="line">mysql         5.7       a70d36bc331a   7 weeks ago   449MB</span><br><span class="line">mysql         latest    c8562eaf9d81   7 weeks ago   546MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除指定镜像</span></span><br><span class="line">[root@haimian /]# docker rmi -f a70d36bc331a</span><br><span class="line">Untagged: mysql:5.7</span><br><span class="line">Untagged: mysql@sha256:b3d1eff023f698cd433695c9506171f0d08a8f92a0c8063c1a4d9db9a55808df</span><br><span class="line">Deleted: sha256:a70d36bc331a13d297f882d3d63137d24b804f29fa67158c40ad91d5050c39c5</span><br><span class="line">Deleted: sha256:50c77bf7bcddd1f1d97789d80ac2404eec22c860c104e858620d2a2e321f0ef7</span><br><span class="line">Deleted: sha256:14244329b83dfc8982398ee4104a548385652d2bffb957798ff86a419013efd6</span><br><span class="line">Deleted: sha256:6d990477f90af28473eb601a9bca22253f6381e053c5a8edda0a4f027e124a3c</span><br><span class="line">Deleted: sha256:ee0449796df204071589162fc16f8d65586312a40c68d1ba156c93c56f5e5ce8</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">[root@haimian /]<span class="comment"># docker rmi -f 镜像id1 镜像id2 镜像id3</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">删除全部镜像</span></span><br><span class="line">[root@haimian /]# docker rmi -f $(docker images -aq)</span><br><span class="line">Untagged: hello-world:latest</span><br><span class="line">Untagged: hello-world@sha256:89b647c604b2a436fc3aa56ab1ec515c26b085ac0c15b0d105bc475be15738fb</span><br><span class="line">Deleted: sha256:d1165f2212346b2bab48cb01c1e39ee8ad1be46b87873d9ca7a4e434980a7726</span><br><span class="line">Untagged: mysql:latest</span><br><span class="line">Untagged: mysql@sha256:feada149cb8ff54eade1336da7c1d080c4a1c7ed82b5e320efb5beebed85ae8c</span><br><span class="line">Deleted: sha256:c8562eaf9d81c779cbfc318d6e01b8e6f86907f1d41233268a2ed83b2f34e748</span><br><span class="line">Deleted: sha256:1b649b85960473808c6b812fc30c3f6a3ff1c0ffdcba5c9435daf01cf7d5373a</span><br><span class="line">Deleted: sha256:19cc889447050c16c797fd209fa114ee219de23facb37c00d4137a4ed4aad922</span><br><span class="line">Deleted: sha256:3c793c06a026d276cf56a6a6a75527026ed9eafa7a7d21a438f7d5ed2314148e</span><br><span class="line">Deleted: sha256:1e1cd89a2bc183a7fea3dab0b543e9924278321ad0921c22cc088adbf3c2e77b</span><br><span class="line">Deleted: sha256:83b2015dfd000588c7c947b2d89b3be7a8e5a3abc6ab562668c358033aa779ec</span><br><span class="line">Deleted: sha256:d08533f1e2acc40ad561a46fc6a76b54c739e6b24f077c183c5709e0a6885312</span><br><span class="line">Deleted: sha256:4f9d91a4728e833d1062fb65a792f06e22e425f63824f260c8b5a64b776ddc38</span><br><span class="line">Deleted: sha256:20bf4c759d1b0d0e6286d2145453af4e0e1b7ba3d4efa3b8bce46817ad4109de</span><br><span class="line">Deleted: sha256:a9371bbdf16ac95cc72555c6ad42f79b9f03a82d964fe89d52bdc5f335a5f42a</span><br><span class="line">Deleted: sha256:5b02130e449d94f51e8ff6e5f7d24802246198749ed9eb064631e63833cd8f1d</span><br><span class="line">Deleted: sha256:ab74465b38bc1acb16c23091df32c5b7033ed55783386cb57acae8efff9f4b37</span><br><span class="line">Deleted: sha256:cb42413394c4059335228c137fe884ff3ab8946a014014309676c25e3ac86864</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查询全部都已经删除完毕</span></span><br><span class="line">[root@haimian /]# docker images </span><br><span class="line">REPOSITORY   TAG       IMAGE ID   CREATED   SIZE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="容器命令"><a class="header-anchor" href="#容器命令">¶</a>容器命令</h3>
<p><strong>说明：我们有了镜像才可以创建容器，liunx，下载一个centos镜像来测试学习</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">之间讲过的 直接 pull就行了</span></span><br><span class="line">[root@haimian /]# docker pull centos</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">7a0437f04f83: Pull complete </span><br><span class="line">Digest: sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line">docker.io/library/centos:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>新建容器并启动</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">docker run [可选参数] </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">参数说明 基本常用 全部请查看 --<span class="built_in">help</span>或者官方文档</span></span><br><span class="line">--name=“name” 容器名字 MySQL01 MySQL02，用来区分容器</span><br><span class="line">-d 后台方式运行</span><br><span class="line">-it 使用交互方式运行，进入容器进行查看内容</span><br><span class="line">-P  指定容器的端口 -P 8080：8080</span><br><span class="line">   -P ip：主机端口：容器端口</span><br><span class="line">   -P 主机端口：容器端口（常用）</span><br><span class="line">   -P 容器端口</span><br><span class="line">   直接指定容器端口也行</span><br><span class="line">-p  随机指定端口    </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">测试启动并进入容器</span></span><br><span class="line">[root@haimian /]# docker run -it centos /bin/bash</span><br><span class="line">[root@eafb3befb9a5 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出容器</span></span><br><span class="line">[root@eafb3befb9a5 /]# exit</span><br><span class="line">exit</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器内的centos，基础版本，很多命令没有完善。</span></span><br><span class="line">[root@haimian /]# ls </span><br><span class="line">bin  boot  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>列出所有运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker ps 命令</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出当前正在运行的容器</span></span><br><span class="line">-a # 列出当前正在运行的容器+带出历史运行过的容器</span><br><span class="line">-n=? #显示最近创建的容器，？表示显示的数量。</span><br><span class="line">-q #显示容器编号</span><br><span class="line">[root@haimian /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@haimian /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">eafb3befb9a5   centos         &quot;/bin/bash&quot;   3 minutes ago   Exited (0) 2 minutes ago             kind_sanderson</span><br><span class="line">bb9ddcf15a43   d1165f221234   &quot;/hello&quot;      2 hours ago     Exited (0) 2 hours ago               boring_noyce</span><br><span class="line">2598a89d1827   d1165f221234   &quot;/hello&quot;      5 hours ago     Exited (0) 5 hours ago               zen_bouman</span><br><span class="line">[root@haimian /]# docker ps -n=1</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED         STATUS                     PORTS     NAMES</span><br><span class="line">eafb3befb9a5   centos    &quot;/bin/bash&quot;   9 minutes ago   Exited (0) 7 minutes ago             kind_sanderson</span><br><span class="line">[root@haimian /]# docker ps -aq</span><br><span class="line">eafb3befb9a5</span><br><span class="line">bb9ddcf15a43</span><br><span class="line">2598a89d1827</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>退出容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exit #直接容器停止退出</span><br><span class="line">Ctrl + P + Q #容器不停止退出</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>删除容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker rm 容器id #删除指定的容器，不能删除正在运行的容器，如需强制删除加上参数 -f</span><br><span class="line">docker rm $(docker ps -aq) # 删除所有的容器</span><br><span class="line">docker ps -a -q|xqrgs docker rm #删除所有的容器</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@haimian /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED              STATUS                      PORTS     NAMES</span><br><span class="line">8c476eb7ac6e   centos         &quot;/bin/bash&quot;   About a minute ago   Up About a minute                     practical_cerf</span><br><span class="line">eafb3befb9a5   centos         &quot;/bin/bash&quot;   15 minutes ago       Exited (0) 14 minutes ago             kind_sanderson</span><br><span class="line">bb9ddcf15a43   d1165f221234   &quot;/hello&quot;      2 hours ago          Exited (0) 2 hours ago                boring_noyce</span><br><span class="line">2598a89d1827   d1165f221234   &quot;/hello&quot;      5 hours ago          Exited (0) 5 hours ago                zen_bouman</span><br><span class="line">[root@haimian /]# docker rm eafb3befb9a5 </span><br><span class="line">eafb3befb9a5</span><br><span class="line">[root@haimian /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND       CREATED         STATUS                   PORTS     NAMES</span><br><span class="line">8c476eb7ac6e   centos         &quot;/bin/bash&quot;   2 minutes ago   Up 2 minutes                       practical_cerf</span><br><span class="line">bb9ddcf15a43   d1165f221234   &quot;/hello&quot;      2 hours ago     Exited (0) 2 hours ago             boring_noyce</span><br><span class="line">2598a89d1827   d1165f221234   &quot;/hello&quot;      5 hours ago     Exited (0) 5 hours ago             zen_bouman</span><br><span class="line">[root@haimian /]# docker rm -f $(docker ps -aq)</span><br><span class="line">8c476eb7ac6e</span><br><span class="line">bb9ddcf15a43</span><br><span class="line">2598a89d1827</span><br><span class="line">[root@haimian /]# docker ps -a</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>启动和停止容器的操作</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker start 容器id   #启动容器</span><br><span class="line">docker restart 容器id #重启容器</span><br><span class="line">docker stop 容器id    #停止当前正在运行的容器</span><br><span class="line">docker kill 容器id    #强制停止当前容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="常用的其它命令"><a class="header-anchor" href="#常用的其它命令">¶</a>常用的其它命令</h3>
<p><strong>后台启动容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令 docker run -d 镜像名</span></span><br><span class="line">[root@haimian /]# docker run -d centos</span><br><span class="line">c4c3fe45386a572b76b110a521481f7d165f1e8c32a3aa359870f9364e829134</span><br><span class="line">[root@haimian /]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line">[root@haimian /]# </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">问题docker PS，发现centos停止了。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker 容器使用后台运行，就必行要有一个前台进程，docker发现没有应用，就会自动停止。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Nginx，容器启动后，发现自己没有提供服务，就会立刻停止，就是没有程序了</span></span><br></pre></td></tr></table></figure>
<p><strong>查看日志</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过shell脚本模拟日志</span></span><br><span class="line">[root@haimian /]# docker run -d centos /bin/sh -c &quot;while true;do echo 6666;sleep 1;done&quot;</span><br><span class="line">e598481e2c11f12fa301d29f361e7d2247985fba54620e81757f09f2c3c423fd</span><br><span class="line">[root@haimian /]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">e598481e2c11   centos    &quot;/bin/sh -c &#x27;while t…&quot;   19 seconds ago   Up 18 seconds             strange_tharp</span><br><span class="line">[root@haimian /]# docker logs -tf --tail 10 e598481e2c11</span><br><span class="line">2021-03-10T10:33:01.016503726Z 6666</span><br><span class="line">2021-03-10T10:33:02.018478185Z 6666</span><br><span class="line">2021-03-10T10:33:03.020801113Z 6666</span><br><span class="line">2021-03-10T10:33:04.022784436Z 6666</span><br><span class="line">2021-03-10T10:33:05.024788114Z 6666</span><br><span class="line">2021-03-10T10:33:06.026739830Z 6666</span><br><span class="line">2021-03-10T10:33:07.028655993Z 6666</span><br><span class="line">2021-03-10T10:33:08.031886421Z 6666</span><br><span class="line">2021-03-10T10:33:09.034487008Z 6666</span><br><span class="line">2021-03-10T10:33:10.036418498Z 6666</span><br><span class="line">2021-03-10T10:33:11.038581752Z 6666</span><br><span class="line">2021-03-10T10:33:12.040528786Z 6666</span><br><span class="line">2021-03-10T10:33:13.042594899Z 6666</span><br><span class="line">2021-03-10T10:33:14.050412235Z 6666</span><br><span class="line">2021-03-10T10:33:15.052447800Z 6666</span><br><span class="line">2021-03-10T10:33:16.054290434Z 6666</span><br><span class="line">2021-03-10T10:33:17.056320440Z 6666</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">显示日志</span></span><br><span class="line">-tf           #显示日志</span><br><span class="line">--tail number #要显示日志的条数</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>查看容器中进程信息</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian ~]# docker top 容器id</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD</span><br><span class="line">root                4253                4233                0                   08:56               pts/0               00:00:00            /bin/bash</span><br></pre></td></tr></table></figure>
<p><strong>查看元数据</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian ~]# docker inspect 容器id</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-03-11T00:56:04.357924839Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 4253,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2021-03-11T00:56:04.620762643Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2/9b04278c721c6a32280f5a6b2cfca4d09695197e0eb054334eff32fa9d34f4c2-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/nervous_tharp&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;CgroupnsMode&quot;: &quot;host&quot;,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/71d8502f96fe3491087c496beed13c2a556440cd645343baf6324630f1758ef4-init/diff:/var/lib/docker/overlay2/b250fa3307e25d8fe349fc1ab141f9e17a65b53f7dd1efd8ae77a85d6a2c2f34/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/71d8502f96fe3491087c496beed13c2a556440cd645343baf6324630f1758ef4/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/71d8502f96fe3491087c496beed13c2a556440cd645343baf6324630f1758ef4/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/71d8502f96fe3491087c496beed13c2a556440cd645343baf6324630f1758ef4/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;9b04278c721c&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: true,</span><br><span class="line">            &quot;AttachStdout&quot;: true,</span><br><span class="line">            &quot;AttachStderr&quot;: true,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: true,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;433bb847363bdb8e427808cba6ab8c4ec393a7cc47c581ca46a809c56147c465&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/433bb847363b&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;946467ddce58eea2929f97f93987f75556f53e7dca2d81300e210942e6248643&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;090280e003617c467adbb6fba6bcb1342a5b5e419a82a6d1f2eb8deec3d89933&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;946467ddce58eea2929f97f93987f75556f53e7dca2d81300e210942e6248643&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong>进入当前正在运行的容器</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们通常容器都是使用后台方式运行的，需要进入容器，进行一些修改</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令</span></span><br><span class="line">docker exec -it 容器id /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@haimian ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">9b04278c721c   centos    &quot;/bin/bash&quot;   18 minutes ago   Up 18 minutes             nervous_tharp</span><br><span class="line">[root@haimian ~]# docker exec -it 9b04278c721c /bin/bash</span><br><span class="line">[root@9b04278c721c /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@9b04278c721c /]# ps -ef</span><br><span class="line">UID        PID  PPID  C STIME TTY          TIME CMD</span><br><span class="line">root         1     0  0 00:56 pts/0    00:00:00 /bin/bash</span><br><span class="line">root        15     0  0 01:15 pts/1    00:00:00 /bin/bash</span><br><span class="line">root        30    15  0 01:15 pts/1    00:00:00 ps -ef</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">方式二</span></span><br><span class="line">docker attach 容器id</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试</span></span><br><span class="line">[root@haimian ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">9b04278c721c   centos    &quot;/bin/bash&quot;   24 minutes ago   Up 24 minutes             nervous_tharp</span><br><span class="line">[root@haimian ~]# docker attach 9b04278c721c</span><br><span class="line">正在执行当前的代码...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker <span class="built_in">exec</span>   <span class="comment">#进入容器后开启一个新的终端，可以在里面操作（常用）</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker attach <span class="comment">#进入容器正在执行的终端，不会启动新的进程。</span></span></span><br></pre></td></tr></table></figure>
<p><strong>从容器内拷贝文件到主机上</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器id:容器目录地址 主机地址</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看当前主机下目录文件</span></span><br><span class="line">[root@haimian home]# ls</span><br><span class="line">paidaxing.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器</span></span><br><span class="line">[root@haimian home]# docker attach e5dfa59ded55</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建测试文件</span></span><br><span class="line">[root@e5dfa59ded55 /]# touch test.txt</span><br><span class="line">[root@e5dfa59ded55 /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  paidaxing.txt  proc  root  run  sbin  srv  sys  test.txt	tmp  usr  var</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">退出容器cope到主机目录上</span></span><br><span class="line">[root@haimian home]# docker cp e5dfa59ded55:/test.txt /home</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看文件，cope到了</span></span><br><span class="line">[root@haimian home]# ls</span><br><span class="line">paidaxing.txt  test.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>学习方式：将所有的命令全部敲一遍，自己记录笔记！</strong></p>
<h3 id="小结"><a class="header-anchor" href="#小结">¶</a>小结</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNDIxNDMxMzk2Mi5wbmc?x-oss-process=image/format,png" alt="image-20200514214313962"></p>
<h4 id="常用代码合集"><a class="header-anchor" href="#常用代码合集">¶</a>常用代码合集</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">attach    attach to a running container        #当前 shell下attach连接指定运行镜像</span><br><span class="line">build     build an image from a dockerfile     #通过dockerfile定制镜像</span><br><span class="line">commit    create a new image from a container  #提交当前容器为新的镜像</span><br><span class="line">cp        cope files/folders from the containers filesystem to the host path #从容器中拷贝指定文件或目录到宿主机</span><br><span class="line">create    create a new container               #创建一个新的容器，同run，但不启动容器</span><br><span class="line">diff      inspect changes on a container’s filesystem #查看docker容器变化</span><br><span class="line">events    get real time events from the server #从docker服务获取容器实时事件</span><br><span class="line">exec      run a command in an existing container #在已存在的容器上运行命令</span><br><span class="line">export    stream the contents of a container as a tar archive #导出容器的内容流作为一个tar归档文件[对应import]</span><br><span class="line">history   show the history of an image        #展示一个镜像形成历史</span><br><span class="line">images    list images                          #列出当前镜像</span><br><span class="line">import    create a new filesystem image from the contents of a tarball #从tar包中的内容创建一个新的文件系统映像[对应export]</span><br><span class="line">info      display system-wide information # 显示系统相关信息</span><br><span class="line">inspect   return low-level information on a container #查看容器详细信息</span><br><span class="line">kill kill a running container #kill 指定docker容器</span><br><span class="line">load      load an image from a tar archive #从一个tar包中加载一个镜像[对应save]</span><br><span class="line">login     register or login to the docker registry server #注册或者登陆一个docker源服务器</span><br><span class="line">logout    log out from a docker registry server #从当前docker registry 退出</span><br><span class="line">logs      fetch the logs of a container #输出当前容器日期信息</span><br><span class="line">port      lookup the public-facing port which is nat-ed to private_port #查看映射端口对应的容器内部端口</span><br><span class="line">pause     pause all processes within a container #暂停容器</span><br><span class="line">PS        list continues #列出容器列表</span><br><span class="line">pull      pull an image or a repository from the docker registry server #从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push      push an image or a repository from the docker registry server #推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">restart   restart a running container #重启运行容器</span><br><span class="line">rm        remove one or more containers #移除一个或者多个容器</span><br><span class="line">rmi       remove one or more images #移除一个或者多个镜像[无容器使用改镜像才可删除，否则删除相关内容才可继续或 -f 强制删除]</span><br><span class="line">run       run a command in a new container #创建一个新的容器并运行一个命令</span><br><span class="line">save      save 按 image to a tar archive #保存一个镜像为一个tar包[对应load]</span><br><span class="line">search    search for an image on the docker hub #在docker hub中搜索镜像</span><br><span class="line">start     start a stopped containers #启动容器</span><br><span class="line">stop      stop a running processes of a container #停止容器</span><br><span class="line">top       lookup the running processes of container #查看容器中运行的进程信息</span><br><span class="line">tag       tag an image info a repository # 给源中镜像打标签</span><br><span class="line">UNpause   UNpause a paused container #取消暂停容器</span><br><span class="line">version   show the docker version information #查看docker版本号</span><br><span class="line">wait      block until a container stops，then print its exit code #截取容器停止时的退出状态值</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="作业练习"><a class="header-anchor" href="#作业练习">¶</a>作业练习</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、搜索镜像</span></span><br><span class="line">[root@haimian ~]# docker search Nginx</span><br><span class="line">NAME                               DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                              Official build of Nginx.                        14547     [OK]       </span><br><span class="line">jwilder/nginx-proxy                Automated Nginx reverse proxy for docker con…   1982                 [OK]</span><br><span class="line">richarvey/nginx-php-fpm            Container running Nginx + PHP-FPM capable of…   810                  [OK]</span><br><span class="line">jc21/nginx-proxy-manager           Docker container for managing Nginx proxy ho…   158                  </span><br><span class="line">linuxserver/nginx                  An Nginx container, brought to you by LinuxS…   142                  </span><br><span class="line">tiangolo/nginx-rtmp                Docker image with Nginx using the nginx-rtmp…   115                  [OK]</span><br><span class="line">jlesage/nginx-proxy-manager        Docker container for Nginx Proxy Manager        97                   [OK]</span><br><span class="line">bitnami/nginx                      Bitnami nginx Docker Image                      94                   [OK]</span><br><span class="line">alfg/nginx-rtmp                    NGINX, nginx-rtmp-module and FFmpeg from sou…   89                   [OK]</span><br><span class="line">jasonrivers/nginx-rtmp             Docker images to host RTMP streams using NGI…   88                   [OK]</span><br><span class="line">nginxdemos/hello                   NGINX webserver that serves a simple page co…   67                   [OK]</span><br><span class="line">privatebin/nginx-fpm-alpine        PrivateBin running on an Nginx, php-fpm &amp; Al…   49                   [OK]</span><br><span class="line">nginx/nginx-ingress                NGINX Ingress Controller for Kubernetes         49                   </span><br><span class="line">nginxinc/nginx-unprivileged        Unprivileged NGINX Dockerfiles                  31                   </span><br><span class="line">schmunk42/nginx-redirect           A very simple container to redirect HTTP tra…   19                   [OK]</span><br><span class="line">staticfloat/nginx-certbot          Opinionated setup for automatic TLS certs lo…   19                   [OK]</span><br><span class="line">nginx/nginx-prometheus-exporter    NGINX Prometheus Exporter                       16                   </span><br><span class="line">centos/nginx-112-centos7           Platform for running nginx 1.12 or building …   15                   </span><br><span class="line">centos/nginx-18-centos7            Platform for running nginx 1.8 or building n…   13                   </span><br><span class="line">raulr/nginx-wordpress              Nginx front-end for the official wordpress:f…   13                   [OK]</span><br><span class="line">flashspys/nginx-static             Super Lightweight Nginx Image                   9                    [OK]</span><br><span class="line">bitnami/nginx-ingress-controller   Bitnami Docker Image for NGINX Ingress Contr…   8                    [OK]</span><br><span class="line">mailu/nginx                        Mailu nginx frontend                            8                    [OK]</span><br><span class="line">ansibleplaybookbundle/nginx-apb    An APB to deploy NGINX                          2                    [OK]</span><br><span class="line">wodby/nginx                        Generic nginx                                   1                    [OK]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、下载镜像 镜像名称不能大写。。。</span></span><br><span class="line">[root@haimian ~]# docker pull Nginx</span><br><span class="line">invalid reference format: repository name must be lowercase</span><br><span class="line">[root@haimian ~]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">a076a628af6f: Pull complete </span><br><span class="line">0732ab25fa22: Pull complete </span><br><span class="line">d7f36f6fe38f: Pull complete </span><br><span class="line">f72584a26f32: Pull complete </span><br><span class="line">7125e4df9063: Pull complete </span><br><span class="line">Digest: sha256:10b8cc432d56da8b61b070f4c7d2543a9ed17c2b23010b43af434fd40e2ca4aa</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、查看下载好的镜像</span></span><br><span class="line">[root@haimian ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx        latest    f6d0b4767a6c   8 weeks ago    133MB</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、运行容器测试</span></span><br><span class="line">[root@haimian ~]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">efb55f5c5ac7b696491a15e64b984e91c6c9868f92b2e85bc4a6439c2979c386</span><br><span class="line">[root@haimian ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS                  NAMES</span><br><span class="line">efb55f5c5ac7   nginx     &quot;/docker-entrypoint.…&quot;   10 seconds ago   Up 9 seconds   0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line">e5dfa59ded55   centos    &quot;/bin/bash&quot;              5 hours ago      Up 5 hours                            heuristic_lamport</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Welcome to nginx!表示没有问题</span></span><br><span class="line">[root@haimian ~]# curl localhost:3344</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">5、进入容器</span></span><br><span class="line">[root@haimian ~]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@efb55f5c5ac7:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@efb55f5c5ac7:/# cd /etc/nginx</span><br><span class="line">root@efb55f5c5ac7:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params	uwsgi_params  win-utf</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="端口映射"><a class="header-anchor" href="#端口映射">¶</a>端口映射</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-p 外部端口:容器端口</span><br></pre></td></tr></table></figure>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNDIxNTkxNTY1MC5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>通过公网地址访问也没有问题</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210311153418519.png" alt="image-20210311153418519"></p>
<h4 id="作业2"><a class="header-anchor" href="#作业2">¶</a>作业2</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker 来装一个Tomcat</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官方文档给出的代码：docker run -it --<span class="built_in">rm</span> tomcat:9.0</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们之前的启动都是后台，停止了容器之后，容器还是可以，--<span class="built_in">rm</span> 一般用来测试，用完即删</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们不用官方这个</span></span><br><span class="line">[root@haimian ~]# docker pull tomcat:9.0</span><br><span class="line">9.0: Pulling from library/tomcat</span><br><span class="line">Digest: sha256:94cc18203335e400dbafcd0633f33c53663b1c1012a13bcad58cced9cd9d1305</span><br><span class="line">Status: Image is up to date for tomcat:9.0</span><br><span class="line">docker.io/library/tomcat:9.0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载成功</span></span><br><span class="line">[root@haimian ~]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat       9.0       040bdb29ab37   8 weeks ago    649MB</span><br><span class="line">nginx        latest    f6d0b4767a6c   8 weeks ago    133MB</span><br><span class="line">centos       latest    300e315adb2f   3 months ago   209MB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装步骤就不多说了，和Nginx一样的，安装完成之后我们启动了容器通过端口映射，在公网范围的时候发现没有Tomcat初始界面。这是因为阿里云的原因，默认是最小的镜像，所有不必要的都剔除掉</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">保证最小的可运行环境</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">但是我们发现在WebApps.dist 有我们需要的文件，直接cope到WebApps目录下即可。</span></span><br><span class="line">[root@haimian ~]# docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line">[root@haimian ~]# docker exec -it tomcat01 /bin/bash</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt	 LICENSE  README.md	 RUNNING.txt  conf  logs	    temp     webapps.dist</span><br><span class="line">CONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin	      lib   native-jni-lib  webapps  work</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat# cd webapps.dist</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat/webapps.dist# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat/webapps.dist# cd ..</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat# cp -r webapps.dist/* webapps</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat# cd webapps</span><br><span class="line">root@a6ac70ea1018:/usr/local/tomcat/webapps# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>没有问题的。</strong></p>
<h4 id="作业3"><a class="header-anchor" href="#作业3">¶</a>作业3</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">部署es+kibana</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">es 十分耗内存</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">es 的数据一般需要放置到安全目录挂在！</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">--net somenetwork 网络配置</span></span><br><span class="line">docker network create somenetwork</span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">es下载好了</span></span><br><span class="line">[root@haimian ~]# docker images</span><br><span class="line">REPOSITORY      TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat          9.0       040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">tomcat          latest    040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">nginx           latest    f6d0b4767a6c   8 weeks ago     133MB</span><br><span class="line">centos          latest    300e315adb2f   3 months ago    209MB</span><br><span class="line">elasticsearch   7.6.2     f29a1ee41030   11 months ago   791MB</span><br><span class="line"></span><br><span class="line">[root@haimian ~]# docker network create somenetwork</span><br><span class="line">63d3626d7dc7dbe327bff56b01bceb072bb25e6eb6e1d05ab668343c825ab030</span><br><span class="line">[root@haimian ~]# docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line">7079aa33b1bea3526315c3ccdb2fd581f478e5f973096698202d0eacb3edffa7</span><br><span class="line">[root@haimian ~]# docker stats 内存已经使用了70%多</span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O   BLOCK I/O       PIDS</span><br><span class="line">7079aa33b1be   elasticsearch   0.38%     1.241GiB / 1.694GiB   73.25%    0B / 0B   265MB / 733kB   43</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">内存太大了，我们需要修改分配</span></span><br><span class="line">docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line">[root@haimian ~]# docker run -d --name elasticsearch --net somenetwork -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br><span class="line">43a90d0eee76f1776e450c639a9952ea7acdd7f2591025d264e3b2641e5db062</span><br><span class="line">[root@haimian ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                 COMMAND                  CREATED         STATUS         PORTS                                            NAMES</span><br><span class="line">43a90d0eee76   elasticsearch:7.6.2   &quot;/usr/local/bin/dock…&quot;   4 seconds ago   Up 3 seconds   0.0.0.0:9200-&gt;9200/tcp, 0.0.0.0:9300-&gt;9300/tcp   elasticsearch</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动之后我们发现比之前的内存小多了</span></span><br><span class="line">[root@haimian ~]# docker stats</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME            CPU %     MEM USAGE / LIMIT     MEM %     NET I/O   BLOCK I/O        PIDS</span><br><span class="line">43a90d0eee76   elasticsearch   0.02%     382.1MiB / 1.694GiB   22.03%    0B / 0B   82.9MB / 696kB   44</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">没有问题</span></span><br><span class="line">[root@haimian ~]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;43a90d0eee76&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;isNkwujwQbCW-kK5uPTZJw&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="可视化"><a class="header-anchor" href="#可视化">¶</a>可视化</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">portainer</span><br><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line">rancher（CI/CD用）</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">下载成功</span></span><br><span class="line">[root@haimian ~]# docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line">Unable to find image &#x27;portainer/portainer:latest&#x27; locally</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">d1e017099d17: Pull complete </span><br><span class="line">717377b83d5c: Pull complete </span><br><span class="line">Digest: sha256:f8c2b0a9ca640edf508a8a0830cf1963a1e0d2fd9936a64104b3f658e120b868</span><br><span class="line">Status: Downloaded newer image for portainer/portainer:latest</span><br><span class="line">b6cac10ec0295cafc5d3646bae7eb702ce05b843ba74c8eea1aef8fbe5a17c7c</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>通过公网地址访问portainer，创建好用户之后选择登陆</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210311172547505.png" alt="image-20210311172547505"></p>
<p>我们选择本地，可以看到一些基础的信息。其它的自行查看了。</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210311173835731.png" alt="image-20210311173835731"></p>
<p>平时用的比较少，用来测试玩玩就好了。</p>
<h3 id=""><a class="header-anchor" href="#">¶</a></h3>
<h2 id="docker镜像讲解"><a class="header-anchor" href="#docker镜像讲解">¶</a>docker镜像讲解</h2>
<h3 id="镜像是什么"><a class="header-anchor" href="#镜像是什么">¶</a>镜像是什么</h3>
<p>镜像是一种轻量级、可执行的独立软件保，用来打包软件运行环境和基于运行环境开发的软件，他包含运行某个软件所需的所有内容，包括代码、运行时库、环境变量和配置文件。所有应用，直接打包docker镜像，就可以直接跑起来！</p>
<p><strong>如何得到镜像</strong></p>
<ul>
<li>从远程仓库下载</li>
<li>别人拷贝给你</li>
<li>自己制作一个镜像 DockerFile</li>
</ul>
<h3 id="Docker镜像加载原理"><a class="header-anchor" href="#Docker镜像加载原理">¶</a><strong>Docker镜像加载原理</strong></h3>
<p><strong>UnionFs （联合文件系统）</strong></p>
<p>UnionFs（联合文件系统）：Union文件系统（UnionFs）是一种分层、轻量级并且高性能的文件系统，他支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下（ unite several directories into a single virtual filesystem)。Union文件系统是 Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像<br>
特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<p><strong>Docker镜像加载原理</strong></p>
<p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>
boots(boot file system）主要包含 bootloader和 Kernel, bootloader主要是引导加 kernel, Linux刚启动时会加bootfs文件系统，在 Docker镜像的最底层是 boots。这一层与我们典型的Linux/Unix系统是一样的，包含boot加載器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs转交给内核，此时系统也会卸载bootfs。</p>
<p>rootfs（root file system),在 bootfs之上。包含的就是典型 Linux系统中的/dev,/proc,/bin,/etc等标准目录和文件。 rootfs就是各种不同的操作系统发行版，比如 Ubuntu, Centos等等。<br>
<img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2MzA0OTk1OS5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>平时我们安装进虚拟机的CentOS都是好几个G，为什么Docker这里才200M？</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian ~]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat                9.0       040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   8 weeks ago     133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago    209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago    79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago   791MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>对于个精简的OS,rootfs可以很小，只需要包合最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的Linux发行版， boots基本是一致的， rootfs会有差別，因此不同的发行版可以公用bootfs.虚拟机是分钟级别，容器是秒级！</p>
<p><strong>分层理解</strong></p>
<p>分层的镜像</p>
<p>我们可以去下载一个镜像，注意观察下载的日志输出，可以看到是一层层的在下载</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2MzgzOTE4MC5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>思考：为什么Docker镜像要采用这种分层的结构呢？</p>
<p>最大的好处，我觉得莫过于资源共享了！比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过docker image inspect 命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian ~]# docker image inspect centos</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:300e315adb2f96afe5f0b2780b87f28ae95231fe3bdd1e16b9ba606307728f55&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;centos:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;centos@sha256:5528e8b1b1719d34604c87e11dcd1c0a20bedf46e83b5632cdeac91b8c04efc1&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-12-08T00:22:53.076477777Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;395e0bfa7301f73bc994efe15099ea56b8836c608dd32614ac5ae279976d33e4&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;395e0bfa7301&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;/bin/bash\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:6de05bdfbf9a9d403458d10de9e088b6d93d971dd5d48d18b4b6758f4554f451&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;19.03.12&quot;,</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:6de05bdfbf9a9d403458d10de9e088b6d93d971dd5d48d18b4b6758f4554f451&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20201204&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;Size&quot;: 209348104,</span><br><span class="line">        &quot;VirtualSize&quot;: 209348104,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/b250fa3307e25d8fe349fc1ab141f9e17a65b53f7dd1efd8ae77a85d6a2c2f34/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/b250fa3307e25d8fe349fc1ab141f9e17a65b53f7dd1efd8ae77a85d6a2c2f34/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/b250fa3307e25d8fe349fc1ab141f9e17a65b53f7dd1efd8ae77a85d6a2c2f34/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:2653d992f4ef2bfd27f94db643815aa567240c37732cae1405ad1c1309ee9859&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所有的 Docker镜像都起始于一个基础镜像层，当进行修改或培加新的内容时，就会在当前镜像层之上，创建新的镜像层。</p>
<p>举一个简单的例子，假如基于 Ubuntu Linux16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加 Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创健第三个镜像层该像当前已经包含3个镜像层，如下图所示（这只是一个用于演示的很简单的例子）。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2NTIzNDI3NC5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2NDk1ODkzMi5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>上图中的镜像层跟之前图中的略有区別，主要目的是便于展示文件<br>
下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2NTE0ODAwMi5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>文中情況下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统</p>
<p>Linux上可用的存储引撃有AUFS、 Overlay2、 Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于 Linux中对应的<br>
件系统或者块设备技术，井且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在 Windows上仅支持 windowsfilter 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW [1]。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2NTU1NzgwNy5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p><strong>特点</strong>Docker 镜像都是只读的，当容器启动时，一个新的可写层加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNTE2MTUwNTg5Ny5wbmc?x-oss-process=image/format,png" alt="img"></p>
<h3 id="commit镜像"><a class="header-anchor" href="#commit镜像">¶</a>commit镜像</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">docker commit 提交容器成为一个新的副本</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">命令和git原理类似</span></span><br><span class="line">docker commit -m &quot;提交的描述信息&quot; -a-&quot;作者&quot; 容器id 目标镜像名:[TAG]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">实战测试</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1、启动一个默认的tomcat</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2、发现这个默认的tomcat 是没有webapps应用，官方的镜像默认webapps下面是没有文件的！</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3、从webapps.dist拷贝文件进去webapp</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这几步都是之前作业里面的就不放代码了</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、上传之前修改过的Tomcat文件</span></span><br><span class="line">[root@haimian ~]# docker commit -a=&quot;paidaxing&quot; -m=&quot;add webapps app&quot; 87333a05a9f6 tomcat02:1.0</span><br><span class="line">sha256:2cef4ca7716dae5564ecf80124e60bd6a7b3a487541ab5855a4812da5a209955</span><br><span class="line">[root@haimian ~]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">tomcat02              1.0       2cef4ca7716d   6 seconds ago   654MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   8 weeks ago     649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   8 weeks ago     133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago    209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago    79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago   791MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果你想要保存当前容器的状态，就可以通过commit来提交，获得一个镜像，就好比我们我们使用虚拟机的快照。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">到这里才算入门。</span></span><br></pre></td></tr></table></figure>
<h2 id="数据容器卷"><a class="header-anchor" href="#数据容器卷">¶</a>数据容器卷</h2>
<h4 id="什么是容器数据卷"><a class="header-anchor" href="#什么是容器数据卷">¶</a>什么是容器数据卷</h4>
<p><strong>docker的理念回顾</strong></p>
<p>将应用和环境打包成一个镜像！</p>
<p>如果数据都在容器中，那么我们容器删除，数据就会丢失！ 需求：数据可以持久化。</p>
<p>MySQL，容器删了，删库跑路！需求：MySQL数据可以存储在本地！</p>
<p>容器之间可以有一个数据共享的技术！docker容器中产生的数据，同步到本地！</p>
<p>这就是卷技术！目录的挂载，将我们容器内的目录，挂载到Liunx上面。</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEwNTI1ODQ1Ni5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p><strong>总结一句话：容器的持久化和同步操作！容器间也是可以数据共享的！</strong></p>
<h4 id="使用数据卷"><a class="header-anchor" href="#使用数据卷">¶</a>使用数据卷</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">方式一：直接使用命令来挂载 -v</span></span><br><span class="line">docker run -it -v 主机目录:容器目录</span><br><span class="line">[root@haimian ~]# docker run -it -v /home/ceshi2:/home centos /bin/bash</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在容器内部创建测试文件</span></span><br><span class="line">[root@01615b769509 /]# cd /home</span><br><span class="line">[root@01615b769509 home]# ls</span><br><span class="line">[root@01615b769509 home]# touch ceshi.txt </span><br><span class="line">[root@01615b769509 home]# ls</span><br><span class="line">ceshi.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">在宿主机上查看挂载目录文件</span></span><br><span class="line">[root@haimian ceshi2]# docker inspect 容器id</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">看到目录已经对应上了</span></span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/ceshi2&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">[root@haimian home]# cd /home/ceshi2</span><br><span class="line">[root@haimian ceshi2]# ls</span><br><span class="line">ceshi.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以看到文件已经挂载到宿主机上面了</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试一下从宿主机到容器内是否可以</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">vim 进test.java编辑helloword！</span></span><br><span class="line">[root@haimian ceshi2]# vim test.java</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从容器上打印输出，没有问题，数据已经挂载过来/</span></span><br><span class="line">[root@01615b769509 home]# cat test.java</span><br><span class="line">hello word !</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">好处：我们以后修改只需要在本地修改即可，容器内会自动同步！</span></span><br></pre></td></tr></table></figure>
<h4 id="实战：安装MySQL"><a class="header-anchor" href="#实战：安装MySQL">¶</a>实战：安装MySQL</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官方文档</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们自己启动容器的命令</span></span><br><span class="line">docker run -d -p 3306:3306  -v /home/test1/mysql/conf:/etc/mysql/conf.d -v/home/test1/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=6125 --name mysql001 mysql:latest </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试连接：注意3310端口要在阿里云服务器的安全组中打开，否则无法连接。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过sqlyog来测试</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">接着我们在数据库上创建一个<span class="built_in">test</span>数据库，可以在宿主机data文件中看到这个<span class="built_in">test</span>文件，说明文件挂载是没有问题的。</span></span><br><span class="line">[root@haimian home]# cd /home/mysql</span><br><span class="line">[root@haimian mysql]# ls</span><br><span class="line">conf  data</span><br><span class="line">[root@haimian mysql]# cd data</span><br><span class="line">[root@haimian data]# ls</span><br><span class="line">auto.cnf    ca.pem           client-key.pem  ibdata1      ib_logfile1  mysql               private_key.pem  server-cert.pem  sys</span><br><span class="line">ca-key.pem  client-cert.pem  ib_buffer_pool  ib_logfile0  ibtmp1       performance_schema  public_key.pem   server-key.pem   test</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">把启动的MySQL01容器删掉之后，我们再去查看data目录数据也是存在的，不用再担心删库跑路了。</span></span><br></pre></td></tr></table></figure>
<p>可以看到远程连接MySQL服务没有问题</p>
<h4 id="具名和匿名挂载"><a class="header-anchor" href="#具名和匿名挂载">¶</a>具名和匿名挂载</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">匿名挂载</span></span><br><span class="line">-v 容器内路径!</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看所有的volume(卷)的情况</span></span><br><span class="line">[root@haimian /]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     8c4f2eaefebd32b784282a017216d9f95b9ed574686c53ad104baef5a2081f83</span><br><span class="line">local     22cc1a5276452507a161e1f439c5dd35e1342d48effccf4bde4459f82bee7bf8</span><br><span class="line">local     28f275a528a2e7b660a062ab76d61747607a662a565a648a3fa302ef66e5c0b1</span><br><span class="line">local     301f0fd19527fd0fc4c877aa5ac14401c7bd5ff144b26908fefcd7c989a03942</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">具名挂载 -P:表示随机映射端口</span></span><br><span class="line">docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">[root@haimian /]# docker volume ls</span><br><span class="line">DRIVER    VOLUME NAME</span><br><span class="line">local     8c4f2eaefebd32b784282a017216d9f95b9ed574686c53ad104baef5a2081f83</span><br><span class="line">local     22cc1a5276452507a161e1f439c5dd35e1342d48effccf4bde4459f82bee7bf8</span><br><span class="line">local     28f275a528a2e7b660a062ab76d61747607a662a565a648a3fa302ef66e5c0b1</span><br><span class="line">local     301f0fd19527fd0fc4c877aa5ac14401c7bd5ff144b26908fefcd7c989a03942</span><br><span class="line">local     juming-nginx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器内路径</span></span><br><span class="line">[root@haimian /]# docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2021-03-12T15:28:59+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">所有的docker容器内的卷，没有指定目录的情况下都是在/var/lib/docker/volumes/自定义的卷名/_data下，</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如果指定了目录，docker volume <span class="built_in">ls</span> 是查看不到的。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们通过具名挂载可以方便的找到我们的一个卷，大多数情况下我们使用具名挂载。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如何确定是具名挂载还是匿名挂载，还是指定路径挂载。</span></span><br><span class="line">-v 容器内路径   #匿名挂载</span><br><span class="line">-v 卷名：容器内路径 #具名挂载</span><br><span class="line">-v /宿主机路径：容器内路径 #指定路径挂载</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">拓展</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">通过 -v 容器内路径： ro rw 改变读写权限</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">一旦设置了容器权限，容器对我们挂载出来的内容就有限定了。</span></span><br><span class="line">ro #readonly 只读</span><br><span class="line">rw #readwrite 可读可写</span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</span></span><br></pre></td></tr></table></figure>
<h4 id="初识dockerfile"><a class="header-anchor" href="#初识dockerfile">¶</a>初识dockerfile</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Dockerfile 就是用来构建docker镜像的构建文件！命令脚本！先体验一下！</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过这个脚本可以生成镜像，镜像是一层一层的，脚本是一个个的命令，每个命令都是一层！</span></span><br><span class="line">[root@haimian home]# mkdir docker-test-volume</span><br><span class="line">[root@haimian home]# ls</span><br><span class="line">ceshi  ceshi2  docker-test-volume  mysql  test.txt</span><br><span class="line"></span><br><span class="line">[root@haimian docker-test-volume]# vim dockerfile1</span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">vim dockerfile1</span></span><br><span class="line">    FROM centos 					# 当前这个镜像是以centos为基础的</span><br><span class="line"></span><br><span class="line">    VOLUME [&quot;volume01&quot;,&quot;volume02&quot;] 	# 挂载卷的卷目录列表(多个目录)匿名挂载</span><br><span class="line"></span><br><span class="line">    CMD echo &quot;-----end-----&quot;		# 输出一下用于测试</span><br><span class="line">    CMD /bin/bash					# 默认走bash控制台</span><br><span class="line">[root@haimian docker-test-volume]# cat dockerfile1</span><br><span class="line">from centos</span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line">[root@haimian docker-test-volume]# docker build -f dockerfile1 -t paidaxing/centos:9.1 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 0063f9fc9fe7</span></span><br><span class="line">Removing intermediate container 0063f9fc9fe7</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">a3d86ee7e84e</span></span><br><span class="line">Step 3/4 : CMD echo &quot;----end----&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> c3cb71e4c615</span></span><br><span class="line">Removing intermediate container c3cb71e4c615</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">37a72a286603</span></span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> ec28fafc6700</span></span><br><span class="line">Removing intermediate container ec28fafc6700</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">3bb6b30650fe</span></span><br><span class="line">Successfully built 3bb6b30650fe</span><br><span class="line">Successfully tagged paidaxing/centos:9.1</span><br><span class="line">[root@haimian docker-test-volume]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED          SIZE</span><br><span class="line">paidaxing/centos      9.1       3bb6b30650fe   24 seconds ago   209MB</span><br><span class="line">tomcat02              1.0       2cef4ca7716d   7 hours ago      654MB</span><br><span class="line">mysql                 5.7       a70d36bc331a   7 weeks ago      449MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   8 weeks ago      649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   8 weeks ago      649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   8 weeks ago      133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago     209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago     79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago    791MB</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">开启我们自己打包镜像</span></span><br><span class="line">[root@haimian docker-test-volume]# docker run -it 3bb6b30650fe /bin/bash</span><br><span class="line">[root@41f048f757fe /]# ls -l</span><br><span class="line">total 56</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3 15:22 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  360 Mar 12 08:20 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 Mar 12 08:20 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 Nov  3 15:22 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 Nov  3 15:22 lib64 -&gt; usr/lib64</span><br><span class="line">drwx------   2 root root 4096 Dec  4 17:37 lost+found</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 media</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 mnt</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 opt</span><br><span class="line">dr-xr-xr-x 111 root root    0 Mar 12 08:20 proc</span><br><span class="line">dr-xr-x---   2 root root 4096 Dec  4 17:37 root</span><br><span class="line">drwxr-xr-x  11 root root 4096 Dec  4 17:37 run</span><br><span class="line">lrwxrwxrwx   1 root root    8 Nov  3 15:22 sbin -&gt; usr/sbin</span><br><span class="line">drwxr-xr-x   2 root root 4096 Nov  3 15:22 srv</span><br><span class="line">dr-xr-xr-x  13 root root    0 Mar 12 08:20 sys</span><br><span class="line">drwxrwxrwt   7 root root 4096 Dec  4 17:37 tmp</span><br><span class="line">drwxr-xr-x  12 root root 4096 Dec  4 17:37 usr</span><br><span class="line">drwxr-xr-x  20 root root 4096 Dec  4 17:37 var</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 12 08:20 volume01</span><br><span class="line">drwxr-xr-x   2 root root 4096 Mar 12 08:20 volume02</span><br><span class="line"></span><br><span class="line">[root@haimian data]# docker inspect 41f048f757fe</span><br><span class="line"></span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;63a7b1f1b480889a2f5b7a38538ae0fe639d27a621c2e575c12539bee009738f&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/63a7b1f1b480889a2f5b7a38538ae0fe639d27a621c2e575c12539bee009738f/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume01&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;85cbb117c2fdecccfce1d22290ecc6be05078e920911b7e7051418dca04755f1&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/85cbb117c2fdecccfce1d22290ecc6be05078e920911b7e7051418dca04755f1/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume02&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="数据卷容器"><a class="header-anchor" href="#数据卷容器">¶</a>数据卷容器</h4>
<p><strong>多个MySQL同步数据</strong></p>
<p>命名的容器挂载数据卷</p>
<p><img src="https://img-blog.csdnimg.cn/20200524154518325.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5MTk4MA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian /]<span class="comment"># docker run -it --name docker01 paidaxing/centos:9.1</span></span><br><span class="line">[root@haimian /]<span class="comment"># docker run -it --name docker02 --volumes-from docker01 paidaxing/centos:9.1</span></span><br><span class="line"><span class="comment">#docker01容器 volume01添加测试文件</span></span><br><span class="line">[root@9e22463611ea /]<span class="comment"># cd volume01</span></span><br><span class="line">[root@9e22463611ea volume01]<span class="comment"># ls</span></span><br><span class="line">[root@9e22463611ea volume01]<span class="comment"># touch ceshi.java</span></span><br><span class="line">[root@9e22463611ea volume01]<span class="comment"># ls</span></span><br><span class="line">ceshi.java</span><br><span class="line"><span class="comment">#docker02 volume01也同步了文件</span></span><br><span class="line">[root@ce169e4334d0 volume01]<span class="comment"># ls</span></span><br><span class="line">ceshi.java</span><br><span class="line"><span class="comment"># 测试：可以删除docker01，查看一下docker02是否可以访问这个文件</span></span><br><span class="line"><span class="comment"># 测试发现：数据依旧保留在docker02中没有被删除</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多个mysql实现数据共享</span></span><br><span class="line">docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line">docker run -d -p 3310:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01  mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="comment">#容器之间的配置信息的传递，数据卷容器的生命周期一直持续到没有容器使用为止。</span></span><br><span class="line"><span class="comment">#但是一旦你持久化到了本地，这个时候，本地的数据是不会删除的！</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="dockerfile"><a class="header-anchor" href="#dockerfile">¶</a>dockerfile</h4>
<p>DockerFile介绍<br>
dockerfile是用来构建docker镜像的文件！命令参数脚本！</p>
<p>构建步骤：</p>
<p>1、 编写一个dockerfile文件</p>
<p>2、 docker build 构建称为一个镜像</p>
<p>3、 docker run运行镜像</p>
<p>4、 docker push发布镜像（DockerHub 、阿里云仓库)</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEzMTQwMDQ1Ni5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>点击后跳到一个Dockerfile</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEzMTQ0MTc1MC5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>很多官方镜像都是基础包，很多功能没有，我们通常会自己搭建自己的镜像！</p>
<p>官方既然可以制作镜像，那我们也可以。</p>
<h4 id="DockerFile构建过程"><a class="header-anchor" href="#DockerFile构建过程">¶</a>DockerFile构建过程</h4>
<p><strong>基础知识</strong>：</p>
<p>1、每个保留关键字(指令）都是必须是大写字母</p>
<p>2、执行从上到下顺序</p>
<p>3、#表示注释</p>
<p>4、每一个指令都会创建提交一个新的镜像曾，并提交！</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjEzMTc1Njk5Ny5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>Dockerfile是面向开发的，我们以后要发布项目，做镜像，就需要编写dockerfile文件，这个文件十分简单！</p>
<p>Docker镜像逐渐成企业交付的标准，必须要掌握！</p>
<p>DockerFile：构建文件，定义了一切的步骤，源代码</p>
<p>DockerImages：通过DockerFile构建生成的镜像，最终发布和运行产品。</p>
<p>Docker容器：容器就是镜像运行起来提供服务。</p>
<h4 id="dockerfile的指令"><a class="header-anchor" href="#dockerfile的指令">¶</a>dockerfile的指令</h4>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span>				<span class="comment"># from:基础镜像，一切从这里开始构建</span></span><br><span class="line"><span class="keyword">MAINTAINER</span>			<span class="comment"># maintainer:镜像是谁写的， 姓名+邮箱</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash">					<span class="comment"># run:镜像构建的时候需要运行的命令</span></span></span><br><span class="line"><span class="keyword">ADD</span><span class="language-bash">					<span class="comment"># add:步骤，tomcat镜像，这个tomcat压缩包！添加内容 添加同目录</span></span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash">				<span class="comment"># workdir:镜像的工作目录</span></span></span><br><span class="line"><span class="keyword">VOLUME</span><span class="language-bash">				<span class="comment"># volume:挂载的目录</span></span></span><br><span class="line"><span class="keyword">EXPOSE</span>				<span class="comment"># expose:保留端口配置</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash">					<span class="comment"># cmd:指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代</span></span></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash">			<span class="comment"># entrypoint:指定这个容器启动的时候要运行的命令，可以追加命令</span></span></span><br><span class="line"><span class="keyword">ONBUILD</span>				<span class="comment"># onbuild:当构建一个被继承DockerFile这个时候就会运行onbuild的指令，触发指令</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash">				<span class="comment"># copy:类似ADD，将我们文件拷贝到镜像中</span></span></span><br><span class="line"><span class="keyword">ENV</span>					<span class="comment"># env:构建的时候设置环境变量！</span></span><br></pre></td></tr></table></figure>
<img src="https://blog.52itstyle.vip/usr/uploads/2018/05/501875919.jpg" alt="img"  />
<h4 id="实战测试"><a class="header-anchor" href="#实战测试">¶</a>实战测试</h4>
<p><strong>Docker Hub 中 99%的镜像都是从这个基础镜像过来的 FROM scratch</strong>，然后配置需要的软件和配置来进行构建。</p>
<p><img src="https://img-blog.csdnimg.cn/20200524154740467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzU5MTk4MA==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、编写dockerfile文件</span></span><br><span class="line">[root@haimian ~]# cd /home</span><br><span class="line">[root@haimian home]# ls</span><br><span class="line">ceshi  ceshi2  docker-test-volume  mysql  test.txt</span><br><span class="line">[root@haimian home]# </span><br><span class="line">[root@haimian home]# mkdir dockerfile</span><br><span class="line">[root@haimian home]# ls</span><br><span class="line">ceshi  ceshi2  dockerfile  docker-test-volume  mysql  test.txt</span><br><span class="line">[root@haimian home]# cd dockerfile</span><br><span class="line">[root@haimian dockerfile]# ls</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、编辑测试脚本</span></span><br><span class="line">[root@haimian dockerfile]# vim mydockerfile-centos</span><br><span class="line">[root@haimian dockerfile]# cat mydockerfile-centos</span><br><span class="line"></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER YxYL&lt;yxyl6125@gmail.com&gt;</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line">RUN cd /etc/yum.repos.d/</span><br><span class="line">RUN sed -i &#x27;s/mirrorlist/#mirrorlist/g&#x27; /etc/yum.repos.d/CentOS-*</span><br><span class="line">RUN sed -i &#x27;s|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g&#x27; /etc/yum.repos.d/CentOS-*</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装vim编辑器</span></span><br><span class="line">RUN yum -y install vim</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装ifconfig命令查看网络IP</span></span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、运行脚本生成</span></span><br><span class="line">[root@haimian dockerfile]# docker build -f mydockerfile-centos -t mycentos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/10 : FROM centos</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">300e315adb2f</span></span><br><span class="line">Step 2/10 : MAINTAINER paidaxing&lt;#邮箱</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span></span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">46c14b4b0ba2</span></span><br><span class="line">Step 3/10 : ENV MYPATH /use/local</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span></span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">f8fff150ed37</span></span><br><span class="line">Step 4/10 : WORKDIR $MYPATH</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Using cache</span></span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">bc1b77f2c74e</span></span><br><span class="line">Step 5/10 : RUN yum -y install vim</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 2f9d6e664a5c</span></span><br><span class="line">CentOS Linux 8 - AppStream                      1.8 MB/s | 6.3 MB     00:03    </span><br><span class="line">CentOS Linux 8 - BaseOS                         2.0 MB/s | 2.3 MB     00:01    </span><br><span class="line">CentOS Linux 8 - Extras                          10 kB/s | 9.2 kB     00:00    </span><br><span class="line">Last metadata expiration check: 0:00:01 ago on Mon Mar 15 02:54:49 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-15.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         appstream       48 k</span><br><span class="line"> which               x86_64      2.21-12.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-15.el8.x86_64.rpm        103 kB/s |  39 kB     00:00    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 396 kB/s |  48 kB     00:00    </span><br><span class="line">(3/5): which-2.21-12.el8.x86_64.rpm             185 kB/s |  49 kB     00:00    </span><br><span class="line">(4/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  856 kB/s | 1.4 MB     00:01    </span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    2.0 MB/s | 6.3 MB     00:03    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           1.6 MB/s | 7.8 MB     00:04     </span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-15.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-12.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-15.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-15.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 </span><br><span class="line">  Verifying        : which-2.21-12.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-15.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 2f9d6e664a5c</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">0de061ed713e</span></span><br><span class="line">Step 6/10 : RUN yum -y install net-tools</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 121a254d12c8</span></span><br><span class="line">Last metadata expiration check: 0:00:12 ago on Mon Mar 15 02:54:49 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   897 kB/s | 322 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                            90 kB/s | 322 kB     00:03     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 121a254d12c8</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">73dd2dec4a47</span></span><br><span class="line">Step 7/10 : EXPOSE 80</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> f77204136a2a</span></span><br><span class="line">Removing intermediate container f77204136a2a</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">4776c4559b03</span></span><br><span class="line">Step 8/10 : CMD echo $MYPATH</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> fc421ef0050e</span></span><br><span class="line">Removing intermediate container fc421ef0050e</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">cfbfd3bde115</span></span><br><span class="line">Step 9/10 : CMD echo &quot;----end----&quot;</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> 12563e09abad</span></span><br><span class="line">Removing intermediate container 12563e09abad</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">820a8596c7f4</span></span><br><span class="line">Step 10/10 : CMD /bin/bash</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">Running <span class="keyword">in</span> efa3bf6841d5</span></span><br><span class="line">Removing intermediate container efa3bf6841d5</span><br><span class="line"><span class="meta prompt_"> ---&gt; </span><span class="language-bash">4ab2ff5bb2ba</span></span><br><span class="line">Successfully built 4ab2ff5bb2ba</span><br><span class="line">Successfully tagged mycentos:1.0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、查看，测试相关命令</span></span><br><span class="line">[root@haimian dockerfile]# docker images</span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              1.0       4ab2ff5bb2ba   6 minutes ago   291MB</span><br><span class="line">paidaxing/centos      9.1       3bb6b30650fe   2 days ago      209MB</span><br><span class="line">tomcat02              1.0       2cef4ca7716d   3 days ago      654MB</span><br><span class="line">mysql                 5.7       a70d36bc331a   7 weeks ago     449MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   2 months ago    649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   2 months ago    649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   2 months ago    133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago    209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago    79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago   791MB</span><br><span class="line">[root@haimian dockerfile]# docker run -it mycentos:1.0 /bin/bash</span><br><span class="line">[root@a1b9d01a04e2 local]# pwd</span><br><span class="line">/use/local</span><br><span class="line">[root@a1b9d01a04e2 local]# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 172.17.0.2  netmask 255.255.0.0  broadcast 172.17.255.255</span><br><span class="line">        ether 02:42:ac:11:00:02  txqueuelen 0  (Ethernet)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们平时拿到一个镜像，可以用 “docker <span class="built_in">history</span> 镜像<span class="built_in">id</span>” 研究一下是什么做的</span></span><br><span class="line"></span><br><span class="line">CMD 和 ENTRYPOINT区别</span><br><span class="line">CMD					# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span><br><span class="line">ENTRYPOINT			# 指定这个容器启动的时候要运行的命令，可以追加命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">测试cmd</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line">vim dockerfile-test-cmd</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]					# 启动后执行 ls -a 命令</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line">docker build  -f dockerfile-test-cmd -t cmd-test:0.1 .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行镜像</span></span><br><span class="line">docker run cmd-test:0.1		# 由结果可得，运行后就执行了 ls -a 命令</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">想追加一个命令  -l 成为<span class="built_in">ls</span> -al：展示列表详细数据</span></span><br><span class="line">docker run cmd-test:0.1 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;:</span><br><span class="line">executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">cmd的情况下 -l 替换了CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-l&quot;</span>] 而 -l  不是命令所以报错</span></span><br><span class="line"></span><br><span class="line">测试ENTRYPOINT</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">编写dockerfile文件</span></span><br><span class="line">vim dockerfile-test-entrypoint</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">构建镜像</span></span><br><span class="line">docker build  -f dockerfile-test-entrypoint -t cmd-test:0.1 .</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">运行镜像</span></span><br><span class="line">docker run entrypoint-test:0.1</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found ...</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们的命令，是直接拼接在我们得ENTRYPOINT命令后面的</span></span><br><span class="line">docker run entrypoint-test:0.1 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 16 06:32 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 16 06:32 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -&gt; usr/lib64 ....</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="实战Tomcat镜像"><a class="header-anchor" href="#实战Tomcat镜像">¶</a>实战Tomcat镜像</h4>
<h5 id="1、准备镜像文件"><a class="header-anchor" href="#1、准备镜像文件">¶</a><strong>1、准备镜像文件</strong></h5>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#上传文件到服务器文件夹</span></span><br><span class="line"><span class="comment">#发现rz命令没有，yum一下lrzsz</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># rz</span></span><br><span class="line">-bash: rz: <span class="built_in">command</span> not found</span><br><span class="line">[root@haimian tomcat]<span class="comment"># yum -y install lrzsz</span></span><br><span class="line"><span class="comment">#查看是否安装成功</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># rpm -qa lrzsz </span></span><br><span class="line">lrzsz-0.12.20-36.el7.x86_64</span><br><span class="line"><span class="comment">#传输成功后查看文件</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># ls</span></span><br><span class="line">apache-tomcat-9.0.44.tar.gz  Dockerfile  jdk-8u281-linux-x64.tar.gz  readme.txt</span><br><span class="line">[root@haimian tomcat]<span class="comment"># ll</span></span><br><span class="line">total 151584</span><br><span class="line">-rw-r--r-- 1 root root  11487016 Mar 15 15:24 apache-tomcat-9.0.44.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root        96 Mar 15 15:23 Dockerfile</span><br><span class="line">-rw-r--r-- 1 root root 143722924 Mar 15 11:30 jdk-8u281-linux-x64.tar.gz</span><br><span class="line">-rw-r--r-- 1 root root         0 Mar 15 15:18 readme.txt</span><br><span class="line"><span class="comment">#编辑生成脚本</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># cat Dockerfile</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">MAINTAINER paidaxing&lt;571022036&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u281-linux-x64.tar.gz /usr/local/</span><br><span class="line">ADD apache-tomcat-9.0.44.tar.gz /usr/local/</span><br><span class="line"></span><br><span class="line">RUN yum -y vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR <span class="variable">$MYPATH</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk.1.8.2.81</span><br><span class="line">ENV CLASSPATH <span class="variable">$JAVA_HOME</span>/lib/dt.jar:<span class="variable">$JAVA_HOME</span>/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-9.0.44</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.44</span><br><span class="line">ENV PATH <span class="variable">$PATH</span>:<span class="variable">$JAVA_HOME</span>/bin:<span class="variable">$CATALINA_HOME</span>/lib:<span class="variable">$CATALINA_HOME</span>/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-9.0.44/bin/startup.sh &amp;&amp; <span class="built_in">tail</span> -F /usr/local/apache-tomcat-9.0.44/logs/catalina.out </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@haimian tomcat]<span class="comment"># docker build -t diytomcat .</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#发布成功</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED              SIZE</span><br><span class="line">diytomcat             latest    3f9a321c0efa   About a minute ago   640MB</span><br><span class="line">mycentos              1.0       4ab2ff5bb2ba   5 hours ago          291MB</span><br><span class="line">paidaxing/centos      9.1       3bb6b30650fe   3 days ago           209MB</span><br><span class="line">tomcat02              1.0       2cef4ca7716d   3 days ago           654MB</span><br><span class="line">mysql                 5.7       a70d36bc331a   7 weeks ago          449MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   2 months ago         649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   2 months ago         649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   2 months ago         133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago         209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago         79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago        791MB</span><br><span class="line"><span class="comment">#运行</span></span><br><span class="line">[root@haimian home]<span class="comment"># docker run -d --net=&quot;host&quot; -p 8080:8080 --name tomcat01   -v /home/paidaxing/build/tomcat/test:/usr/local/apache-tomcat-9.0.44/webapps/test  -v/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.44/logs diytomcat</span></span><br><span class="line">fbeb93e7c177c401a2535153300ba55f90cc9173e732ba5c44764452704a6146</span><br><span class="line">[root@haimian home]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                    NAMES</span><br><span class="line">fbeb93e7c177   diytomcat   <span class="string">&quot;/bin/sh -c &#x27;/usr/lo…&quot;</span>   9 seconds ago   Up 8 seconds   0.0.0.0:8080-&gt;8080/tcp   tomcat01</span><br><span class="line"><span class="comment">#进入容器</span></span><br><span class="line">[root@haimian home]<span class="comment"># docker exec -it fbeb93e7c177 /bin/bash</span></span><br><span class="line">[root@fbeb93e7c177 <span class="built_in">local</span>]<span class="comment"># ls</span></span><br><span class="line">apache-tomcat-9.0.44  bin  etc	games  include	jdk1.8.0_281  lib  lib64  libexec  readme.txt  sbin  share  src</span><br><span class="line">[root@fbeb93e7c177 <span class="built_in">local</span>]<span class="comment"># pwd</span></span><br><span class="line">/usr/local</span><br><span class="line">[root@fbeb93e7c177 <span class="built_in">local</span>]<span class="comment"># ls -l</span></span><br><span class="line">total 52</span><br><span class="line">drwxr-xr-x 1 root  root  4096 Mar 15 07:45 apache-tomcat-9.0.44</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 bin</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 etc</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 games</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 include</span><br><span class="line">drwxr-xr-x 8 10143 10143 4096 Dec  9 12:50 jdk1.8.0_281</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 lib</span><br><span class="line">drwxr-xr-x 3 root  root  4096 Dec  4 17:37 lib64</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 libexec</span><br><span class="line">-rw-r--r-- 1 root  root     0 Mar 15 07:18 readme.txt</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 sbin</span><br><span class="line">drwxr-xr-x 5 root  root  4096 Dec  4 17:37 share</span><br><span class="line">drwxr-xr-x 2 root  root  4096 Nov  3 15:22 src</span><br><span class="line"></span><br><span class="line"><span class="comment">#报错，未解决</span></span><br><span class="line">[root@haimian tomcat]<span class="comment"># curl localhost:8080</span></span><br><span class="line">curl: (56) Recv failure: Connection reset by peer</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h5 id="2、编写dockerfile文件"><a class="header-anchor" href="#2、编写dockerfile文件">¶</a><strong>2、编写dockerfile文件</strong></h5>
<h3 id="发布自己的镜像"><a class="header-anchor" href="#发布自己的镜像">¶</a>发布自己的镜像</h3>
<h4 id="1、注册登录dockerhub"><a class="header-anchor" href="#1、注册登录dockerhub">¶</a>1、注册登录dockerhub</h4>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian /]<span class="comment"># docker login -u paidaxin</span></span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted <span class="keyword">in</span> /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/<span class="comment">#credentials-store</span></span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br><span class="line"></span><br><span class="line"><span class="comment">#给镜像更名，要你的hub登录名/镜像名：版本号</span></span><br><span class="line">[root@haimian /]<span class="comment"># docker tag 3ec66db83b5d paidaxin/tomcat:1.0</span></span><br><span class="line">[root@haimian /]<span class="comment"># docker images</span></span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">diytomcat             latest    3ec66db83b5d   16 hours ago    640MB</span><br><span class="line">paidaxin/tomcat       1.0       3ec66db83b5d   16 hours ago    640MB</span><br><span class="line">mycentos              1.0       4ab2ff5bb2ba   23 hours ago    291MB</span><br><span class="line">paidaxing/centos      9.1       3bb6b30650fe   3 days ago      209MB</span><br><span class="line">tomcat02              1.0       2cef4ca7716d   4 days ago      654MB</span><br><span class="line">mysql                 5.7       a70d36bc331a   8 weeks ago     449MB</span><br><span class="line">tomcat                9.0       040bdb29ab37   2 months ago    649MB</span><br><span class="line">tomcat                latest    040bdb29ab37   2 months ago    649MB</span><br><span class="line">nginx                 latest    f6d0b4767a6c   2 months ago    133MB</span><br><span class="line">centos                latest    300e315adb2f   3 months ago    209MB</span><br><span class="line">portainer/portainer   latest    62771b0b9b09   7 months ago    79.1MB</span><br><span class="line">elasticsearch         7.6.2     f29a1ee41030   11 months ago   791MB</span><br><span class="line"><span class="comment">#push 镜像，和下载一样，上传也是分层的</span></span><br><span class="line">[root@haimian /]<span class="comment"># docker push paidaxin/tomcat:1.0</span></span><br><span class="line">The push refers to repository [docker.io/paidaxin/tomcat]</span><br><span class="line">3840eb430363: Pushing [==&gt;                                                ]  2.778MB/58.03MB</span><br><span class="line">5a5ac5466a8f: Pushing [=======&gt;                                           ]  2.532MB/15.9MB</span><br><span class="line">24825b25e159: Pushing [&gt;                                                  ]  2.751MB/356.6MB</span><br><span class="line">413a81c31294: Pushed </span><br><span class="line">2653d992f4ef: Pushing [&gt;                                                  ]  3.807MB/209.3MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="2、阿里云镜像服务"><a class="header-anchor" href="#2、阿里云镜像服务">¶</a>2、阿里云镜像服务</h4>
<p>1、登录阿里云</p>
<p>2、找到容器镜像服务</p>
<p>3、创建命名空间</p>
<p>4、创建容器镜像</p>
<p>5、浏览阿里云信息</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316101924804.png" alt="image-20210316101924804"></p>
<p>6、push镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@haimian /]# docker push registry.cn-chengdu.aliyuncs.com/paidaxing/paidaxing:1.0</span><br><span class="line">The push refers to repository [registry.cn-chengdu.aliyuncs.com/paidaxing/paidaxing]</span><br><span class="line">5c40d26fba08: Pushed </span><br><span class="line">dd4969f97241: Pushed </span><br><span class="line">1.0: digest: sha256:02c51e3116cddbeff35da5a968ce909fcb07ff1b9688faa2eaaa2c237e9f7548 size: 739</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>7、上传成功，在镜像仓库查看</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210316103417821.png" alt="image-20210316103417821"></p>
<h3 id="小结-v2"><a class="header-anchor" href="#小结-v2">¶</a>小结</h3>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjE3MTE1NTY2Ny5wbmc?x-oss-process=image/format,png" alt="img"></p>
<h3 id="docker网络"><a class="header-anchor" href="#docker网络">¶</a>docker网络</h3>
<h4 id="理解Docker-0"><a class="header-anchor" href="#理解Docker-0">¶</a>理解Docker 0</h4>
<p>学习之前清空下前面的docker 镜像、容器</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除全部容器</span></span><br><span class="line">docker rm -f $(docker ps -aq)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">删除全部镜像</span></span><br><span class="line">docker rmi -f $(docker images -aq)</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看容器内部地址</span></span><br><span class="line">ip address</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新下载Tomcat镜像测试</span></span><br><span class="line">[root@haimian /]# docker run -d -P --name tomcat01 tomcat</span><br><span class="line">[root@haimian /]# docker images</span><br><span class="line">REPOSITORY   TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat       latest    040bdb29ab37   2 months ago   649MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看容器的内部网络地址 ip address</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">发现有个143的网络地址，是docker分配的</span></span><br><span class="line">[root@haimian /]# docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">142: eth0@if143: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">思考。liunx能不能ping通容器内部</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以的</span></span><br><span class="line">[root@haimian ~]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.074 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要按照了docker，就会有一个docker0桥接模式，使用的技术是veth-pair技术！</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再次查看docker网络信息，发现多了一个143的网络地址</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以发现这个143和之前启动的Tomcat01的142地址是对应的</span></span><br><span class="line">[root@haimian ~]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:e9:d7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.20.245.58/20 brd 172.20.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314843138sec preferred_lft 314843138sec</span><br><span class="line">74: br-63d3626d7dc7: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:85:3c:22:e8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-63d3626d7dc7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">133: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 8e:80:24:0f:b4:13 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">143: veth5b4e9c0@if142: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 8e:80:24:0f:b4:13 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再启动一个Tomcat02 网卡是144</span>   </span><br><span class="line">[root@haimian /]# docker run -d -P --name tomcat02 tomcat</span><br><span class="line">36de4fb03692eafe717b7b42f6b518245eede2596b73de1beb713b88fefc551d</span><br><span class="line">[root@haimian /]# docker exec -it tomcat02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">144: eth0@if145: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再查看docker网络信息</span></span><br><span class="line">[root@haimian /]# docker exec -it tomcat02 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">144: eth0@if145: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:03 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.3/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@haimian /]# ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:16:3e:01:e9:d7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.20.245.58/20 brd 172.20.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 314842883sec preferred_lft 314842883sec</span><br><span class="line">74: br-63d3626d7dc7: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:85:3c:22:e8 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.18.0.1/16 brd 172.18.255.255 scope global br-63d3626d7dc7</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">133: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000</span><br><span class="line">    link/ether 76:b4:59:05:94:8d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">143: veth5b4e9c0@if142: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 8e:80:24:0f:b4:13 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">145: veth7ab2e2a@if144: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    link/ether 76:b4:59:05:94:8d brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们发现这个容器的网卡，都是一对对的。</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">veth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">正因为有这个特性 veth-pair 充当一个桥梁，连接各种虚拟网络设备的</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">OpenStac,Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们来测试下Tomcat01和Tomcat02是否可以ping通</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">也是可以的</span></span><br><span class="line">[root@haimian /]# docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.114 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">结论：容器和容器之间是可以互相ping通</span></span><br></pre></td></tr></table></figure>
<p><strong>网图：</strong></p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjE3NDI0ODYyNi5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>结论：tomcat01和tomcat02公用一个路由器，docker0。</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip。</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥 docker0</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjE3NDcwMTA2My5wbmc?x-oss-process=image/format,png" alt="img"></p>
<p>Docker中所有网络接口都是虚拟的，虚拟的转发效率高（内网传递文件）</p>
<p>只要容器删除，对应的网桥一对就没了！</p>
<h4 id="–link"><a class="header-anchor" href="#–link">¶</a>–link</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">思考一个场景：我们编写了一个微服务，database url=ip: 项目不重启，数据ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">直接ping是ping不同的</span></span><br><span class="line">[root@haimian /]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">如何解决</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过--<span class="built_in">link</span>可以解决</span></span><br><span class="line">[root@haimian /]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">d5b624d5ccc5e32094beb37e6c7a8b0317c5506ea6d46baa63bb8d07fc4af95d</span><br><span class="line">[root@haimian /]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.102 ms</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看网络信息</span></span><br><span class="line">[root@haimian /]# docker network inspect fc147941dd4b</span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;fc147941dd4b4f86f9d6991e9e4224cae145080f6898f68b15e81103c2d81b53&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-03-15T17:45:42.319600456+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: null,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;172.17.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot; #docker0</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;36de4fb03692eafe717b7b42f6b518245eede2596b73de1beb713b88fefc551d&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;465e2300914d5d1362a8130b39113781dc937abbc08cbfdbf340ba9045a75276&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;3a8d9a318c825971e2969320920352b09ba059829f07bfb09a93946cad634859&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;5f7db6cad386842705eb4c655175c4fbbbcd80d8e7a604939adc5d825d54207f&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;d5b624d5ccc5e32094beb37e6c7a8b0317c5506ea6d46baa63bb8d07fc4af95d&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat03&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;5428ccd4b4a038c032f4c7925253beeae6034ec25515f1f2ceb513eb2c7b4fb5&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:11:00:04&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.17.0.4/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其实这个Tomcat03是在本地配置了tomcat02的地址</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看hosts配置，在这里原理发现。</span></span><br><span class="line">[root@haimian /]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 36de4fb03692</span><br><span class="line">172.17.0.4	d5b624d5ccc5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">–<span class="built_in">link</span> 本质就是在hosts配置中添加映射</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">现在使用Docker已经不建议使用–<span class="built_in">link</span>了！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">自定义网络，不适用docker0！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker0问题：不支持容器名连接访问！</span></span><br></pre></td></tr></table></figure>
<h4 id="自定义网络"><a class="header-anchor" href="#自定义网络">¶</a>自定义网络</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看docker网络</span></span><br><span class="line">[root@haimian ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME          DRIVER    SCOPE</span><br><span class="line">fc147941dd4b   bridge        bridge    local</span><br><span class="line">a6ac3789c498   host          host      local</span><br><span class="line">4d1ab894aec6   none          null      local</span><br><span class="line">63d3626d7dc7   somenetwork   bridge    local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">bridge ：桥接 docker（默认，自己创建也是用bridge模式）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">none ：不配置网络，一般不用</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">host ：和所主机共享网络</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">container ：容器网络连通（用得少！局限很大）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们直接启动的命令 --net bridge,而这个就是我们得docker0</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">bridge就是docker0</span></span><br><span class="line">docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line">等价于 =&gt; docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">docker0，特点：默认，域名不能访问。 --<span class="built_in">link</span>可以打通连接，但是很麻烦！</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">我们可以 自定义一个网络</span></span><br><span class="line">[root@haimian ~]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">5d36c3180b51968029b07ec3ea42955619118b3cfd5ff23629f3e3848ea5169c</span><br><span class="line">[root@haimian ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME          DRIVER    SCOPE</span><br><span class="line">fc147941dd4b   bridge        bridge    local</span><br><span class="line">a6ac3789c498   host          host      local</span><br><span class="line">5d36c3180b51   mynet         bridge    local</span><br><span class="line">4d1ab894aec6   none          null      local</span><br><span class="line">63d3626d7dc7   somenetwork   bridge    local</span><br><span class="line"></span><br><span class="line">[root@haimian ~]# docker network inspect mynet</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新创建容器分配我们自定义的网络</span></span><br><span class="line">[root@haimian ~]# docker run -d -P --name tomcat01 --net mynet tomcat</span><br><span class="line">8225c3b0aeaf38b5680c67d91ddeff9afeded0ec4f0d8befb7107882dc114e65</span><br><span class="line">[root@haimian ~]# docker run -d -P --name tomcat02 --net mynet tomcat</span><br><span class="line">34d7b50e65e37a40ed08ab3021a6f8d98efcaafdd05ea3b73e14adf723c3ad35</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">发现直接用容器名可以直接ping，因为都在同一个网段，不使用--<span class="built_in">link</span>也可以直接ping</span></span><br><span class="line">[root@haimian ~]# docker exec -it tomcat01 ping tomcat02</span><br><span class="line">PING tomcat02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.079 ms</span><br><span class="line">[root@haimian ~]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">PING tomcat01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.092 ms</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">好处：</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis -不同的集群使用不同的网络，保证集群是安全和健康的</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">mysql-不同的集群使用不同的网络，保证集群是安全和健康的</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">那么网段不同的两个容器是否可以ping通</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建一个tomcat03使用默认的docker0网卡</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">发现是ping不同的</span></span><br><span class="line">[root@haimian ~]# docker run -d -P --name tomcat03  tomcat</span><br><span class="line">411de1e33b75e995ead240087edd02e7a358b5eb215c0c2c2b223103debc1fb0</span><br><span class="line">[root@haimian ~]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">要将tomcat03 连通 tomcat02 ，连通就是将 tomcat03加到 mynet网络</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">一个容器两个ip（tomcat03）</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">tomcat03发现添加了mynet网络之后可以ping通</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">结论：假设要跨网络操作别人，就需要使用docker network connect 连通！</span></span><br><span class="line">[root@haimian ~]# docker network connect mynet tomcat03</span><br><span class="line">[root@haimian ~]# docker exec tomcat01 ping tomcat03</span><br><span class="line">PING tomcat03 (192.168.0.4) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat03.mynet (192.168.0.4): icmp_seq=1 ttl=64 time=0.104 ms</span><br><span class="line">64 bytes from tomcat03.mynet (192.168.0.4): icmp_seq=2 ttl=64 time=0.072 ms</span><br></pre></td></tr></table></figure>
<h4 id="实战：部署Redis集群"><a class="header-anchor" href="#实战：部署Redis集群">¶</a>实战：部署Redis集群</h4>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2NoZW5nY29kZXgvY2xvdWRpbWcvbWFzdGVyL2ltZy9pbWFnZS0yMDIwMDUxNjE5NDQxOTQ3MS5wbmc?x-oss-process=image/format,png" alt="img"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建Redis专属的网络</span></span><br><span class="line">[root@haimian ~]# docker network create redis --subnet 172.38.0.0/16</span><br><span class="line">ec86a0358f3302a1899ecc595955f3c40e58f7a321162963b9a913f315e09110</span><br><span class="line">[root@haimian ~]# docker network ls</span><br><span class="line">NETWORK ID     NAME          DRIVER    SCOPE</span><br><span class="line">fc147941dd4b   bridge        bridge    local</span><br><span class="line">a6ac3789c498   host          host      local</span><br><span class="line">5d36c3180b51   mynet         bridge    local</span><br><span class="line">4d1ab894aec6   none          null      local</span><br><span class="line">ec86a0358f33   redis         bridge    local</span><br><span class="line">63d3626d7dc7   somenetwork   bridge    local</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">通过<span class="keyword">for</span>循环创建六个Redis文件</span></span><br><span class="line">[root@haimian ~]# for port in $(seq 1 6);\</span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">do</span> \</span></span><br><span class="line"><span class="language-bash">&gt; <span class="built_in">mkdir</span> -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">touch</span> /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="built_in">cat</span> &lt;&lt; <span class="string">EOF &gt;&gt; /mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">port 6379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">bind 0.0.0.0</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-enabled yes</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-config-file nodes.conf</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-node-timeout 5000</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-ip 172.38.0.1$&#123;port&#125;</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-port 6379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">cluster-announce-bus-port 16379</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">appendonly yes</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="string">EOF</span></span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash"><span class="keyword">done</span></span></span><br><span class="line">[root@haimian ~]# ls</span><br><span class="line">[root@haimian ~]# cd mydata</span><br><span class="line">-bash: cd: mydata: No such file or directory</span><br><span class="line">[root@haimian ~]# cd /mydata</span><br><span class="line">[root@haimian mydata]# ls</span><br><span class="line">redis</span><br><span class="line">[root@haimian mydata]# cd redis</span><br><span class="line">[root@haimian redis]# ls</span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">启动服务</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis1</span></span><br><span class="line">docker run -p 6371:6379 -p 16379:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis2</span></span><br><span class="line">docker run -p 6372:6379 -p 16380:16379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis3</span></span><br><span class="line">docker run -p 6373:6379 -p 16381:16379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis4</span></span><br><span class="line">docker run -p 6374:6379 -p 16382:16379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">redis5</span></span><br><span class="line">docker run -p 6375:6379 -p 16383:16379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">Redis6</span></span><br><span class="line">docker run -p 6376:6379 -p 16384:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">全部脚本执行完了之后查看一下已经全部挂起来了</span></span><br><span class="line">[root@haimian ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE                    COMMAND                  CREATED          STATUS          PORTS                                              NAMES</span><br><span class="line">2885c3c36a09   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   20 seconds ago   Up 19 seconds   0.0.0.0:6376-&gt;6379/tcp, 0.0.0.0:16384-&gt;16379/tcp   redis-6</span><br><span class="line">f8fa02919e15   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   30 seconds ago   Up 29 seconds   0.0.0.0:6375-&gt;6379/tcp, 0.0.0.0:16383-&gt;16379/tcp   redis-5</span><br><span class="line">cade69bb1a40   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   39 seconds ago   Up 38 seconds   0.0.0.0:6374-&gt;6379/tcp, 0.0.0.0:16382-&gt;16379/tcp   redis-4</span><br><span class="line">55e1fd4f41ec   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   49 seconds ago   Up 48 seconds   0.0.0.0:6373-&gt;6379/tcp, 0.0.0.0:16381-&gt;16379/tcp   redis-3</span><br><span class="line">961882696d76   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   59 seconds ago   Up 57 seconds   0.0.0.0:6372-&gt;6379/tcp, 0.0.0.0:16380-&gt;16379/tcp   redis-2</span><br><span class="line">d5bb9167df2c   redis:5.0.9-alpine3.11   &quot;docker-entrypoint.s…&quot;   3 minutes ago    Up 3 minutes    0.0.0.0:16379-&gt;16379/tcp, 0.0.0.0:6371-&gt;6379/tcp   redis-1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">进入容器Redis-1</span></span><br><span class="line">[root@haimian ~]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # ls</span><br><span class="line">appendonly.aof  nodes.conf</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建集群</span></span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建成功后进入集群查看相关信息</span></span><br><span class="line">/data # redis-cli -c</span><br><span class="line">127.0.0.1:6379&gt; cluster info</span><br><span class="line">cluster_state:ok</span><br><span class="line">cluster_slots_assigned:16384</span><br><span class="line">cluster_slots_ok:16384</span><br><span class="line">cluster_slots_pfail:0</span><br><span class="line">cluster_slots_fail:0</span><br><span class="line">cluster_known_nodes:6</span><br><span class="line">cluster_size:3</span><br><span class="line">cluster_current_epoch:6</span><br><span class="line">cluster_my_epoch:1</span><br><span class="line">cluster_stats_messages_ping_sent:73</span><br><span class="line">cluster_stats_messages_pong_sent:75</span><br><span class="line">cluster_stats_messages_sent:148</span><br><span class="line">cluster_stats_messages_ping_received:70</span><br><span class="line">cluster_stats_messages_pong_received:73</span><br><span class="line">cluster_stats_messages_meet_received:5</span><br><span class="line">cluster_stats_messages_received:148</span><br><span class="line">127.0.0.1:6379&gt; cluster nodes</span><br><span class="line">2485d749d748c0bd373d25e2c1e6de36094e2879 172.38.0.14:6379@16379 slave eff86a3299f4794d143ffb1ccb735549eb7a79c9 0 1615888137000 4 connected</span><br><span class="line">eff86a3299f4794d143ffb1ccb735549eb7a79c9 172.38.0.13:6379@16379 master - 0 1615888137590 3 connected 10923-16383</span><br><span class="line">b4f869da6eead890365089d941f9d85e7758cf75 172.38.0.16:6379@16379 slave ddd614967750281f19f41a679a77322435019499 0 1615888136588 6 connected</span><br><span class="line">31efa7504ce8c14b909bc9d1f3bcce33d2fdf2a9 172.38.0.15:6379@16379 slave 9b36017e9541d55d64096a1f6e366131694f57ef 0 1615888136000 5 connected</span><br><span class="line">ddd614967750281f19f41a679a77322435019499 172.38.0.12:6379@16379 master - 0 1615888136588 2 connected 5461-10922</span><br><span class="line">9b36017e9541d55d64096a1f6e366131694f57ef 172.38.0.11:6379@16379 myself,master - 0 1615888137000 1 connected 0-5460</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停掉master，看看从机是否会自动启用</span></span><br><span class="line">127.0.0.1:6379&gt; set a b</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.13:6379</span></span><br><span class="line">OK</span><br><span class="line"></span><br><span class="line">[root@haimian /]# docker stop redis-3</span><br><span class="line">redis-3</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">没有问题</span></span><br><span class="line">127.0.0.1:6379&gt; get a</span><br><span class="line"><span class="meta prompt_">-&gt; </span><span class="language-bash">Redirected to slot [15495] located at 172.38.0.14:6379</span></span><br><span class="line">&quot;b&quot;</span><br><span class="line"></span><br><span class="line">172.38.0.14:6379&gt; cluster nodes</span><br><span class="line">9b36017e9541d55d64096a1f6e366131694f57ef 172.38.0.11:6379@16379 master - 0 1615888482000 1 connected 0-5460</span><br><span class="line">ddd614967750281f19f41a679a77322435019499 172.38.0.12:6379@16379 master - 0 1615888482827 2 connected 5461-10922</span><br><span class="line">31efa7504ce8c14b909bc9d1f3bcce33d2fdf2a9 172.38.0.15:6379@16379 slave 9b36017e9541d55d64096a1f6e366131694f57ef 0 1615888481000 5 connected</span><br><span class="line">b4f869da6eead890365089d941f9d85e7758cf75 172.38.0.16:6379@16379 slave ddd614967750281f19f41a679a77322435019499 0 1615888481323 6 connected</span><br><span class="line">2485d749d748c0bd373d25e2c1e6de36094e2879 172.38.0.14:6379@16379 myself,master - 0 1615888482000 7 connected 10923-16383</span><br><span class="line">eff86a3299f4794d143ffb1ccb735549eb7a79c9 172.38.0.13:6379@16379 master,fail - 1615888316140 1615888314000 3 connected</span><br><span class="line">172.38.0.14:6379&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="springboot微服务打包docker镜像"><a class="header-anchor" href="#springboot微服务打包docker镜像">¶</a>springboot微服务打包docker镜像</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、构建SpringBoot项目</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建一个hellocontroller测试</span></span><br><span class="line">package com.example.demo.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">@RestController</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">    @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">    public String hello()&#123;</span><br><span class="line">        return &quot;hello,paidaxing&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我本机的8080端口被占用了，我切换到了7788端口启动服务访问成功</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、打包运行</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、编写dockerfile</span></span><br><span class="line">FROM java:8</span><br><span class="line"></span><br><span class="line">COPY *.jar /app.jar</span><br><span class="line"></span><br><span class="line">CMD [&quot;--server.port=7788&quot;]</span><br><span class="line"></span><br><span class="line">EXPOSE 7788</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;java&quot;,&quot;-jar&quot;,&quot;/app.jar&quot;]</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、上传文件，构建镜像</span></span><br><span class="line"></span><br><span class="line">[root@haimian idea]# ll</span><br><span class="line">total 16656</span><br><span class="line">-rw-r--r-- 1 root root 17048669 Mar 17 11:08 demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">-rw-r--r-- 1 root root      120 Mar 17 11:07 Dockerfile</span><br><span class="line">[root@haimian idea]# docker build -t paidaxing .</span><br><span class="line">[root@haimian idea]# docker images</span><br><span class="line">REPOSITORY   TAG                IMAGE ID       CREATED         SIZE</span><br><span class="line">paidaxing    latest             94a761fada63   2 minutes ago   660MB</span><br><span class="line">tomcat       latest             040bdb29ab37   2 months ago    649MB</span><br><span class="line">redis        5.0.9-alpine3.11   3661c84ee9d0   10 months ago   29.8MB</span><br><span class="line">java         8                  d23bdf5b1b1b   4 years ago     643MB</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">5、运行容器访问网站</span></span><br><span class="line">[root@haimian idea]# docker run -d -P --name paidaxing-hello paidaixing</span><br><span class="line"></span><br><span class="line">[root@haimian idea]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE              COMMAND                  CREATED          STATUS          PORTS                     NAMES</span><br><span class="line">a9f37ee2675b   paidaxing:latest   &quot;java -jar /app.jar …&quot;   37 seconds ago   Up 36 seconds   0.0.0.0:49161-&gt;7788/tcp   paidaxing-hello</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">访问成功！！</span></span><br><span class="line">[root@haimian idea]# curl localhost:49161</span><br><span class="line">&#123;&quot;timestamp&quot;:&quot;2021-03-17T03:17:17.811+00:00&quot;,&quot;status&quot;:404,&quot;error&quot;:&quot;Not Found&quot;,&quot;message&quot;:&quot;&quot;,&quot;path&quot;:&quot;/&quot;&#125;</span><br><span class="line">[root@haimian idea]# curl localhost:49161/hello</span><br><span class="line">hello,paidaxing[root@haimian idea]# </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317103454755.png" alt="image-20210317103454755"></p>
<p>#文件上传</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317110827306.png" alt="image-20210317110827306"></p>
<h2 id="-v2"><a class="header-anchor" href="#-v2">¶</a></h2>
<h2 id="docker-Compose"><a class="header-anchor" href="#docker-Compose">¶</a>docker Compose</h2>
<h3 id="简介"><a class="header-anchor" href="#简介">¶</a>简介</h3>
<p>dockerfile build run 手动操作，单个容器</p>
<p>微服务。100个微服务！依赖关系。</p>
<p>docker compose 来轻松高效的管理容器。定义运行多个容器。</p>
<p>官方文档简介：（<a target="_blank" rel="noopener" href="https://docs.docker.com/compose/%EF%BC%89">https://docs.docker.com/compose/）</a></p>
<p>定义运行多个容器</p>
<p>YAML file配置文件。</p>
<p>single command 命令</p>
<p>所有环境都可以使用compose。</p>
<p>Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application’s services. Then, with a single command, you create and start all the services from your configuration. To learn more about all the features of Compose, see <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#features">the list of features</a>.</p>
<p>Compose works in all environments: production, staging, development, testing, as well as CI workflows. You can learn more about each case in <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/#common-use-cases">Common Use Cases</a>.</p>
<p>Using Compose is basically a three-step process:</p>
<p>Define your app’s environment with a <strong><code>Dockerfile</code></strong> so it can be reproduced anywhere.</p>
<p>dockerfile保证我们的项目在任何地方都可以运行。</p>
<p>Define the services that make up your app in <strong><code>docker-compose.yml</code></strong> so they can be run together in an isolated environment.</p>
<p>servers是什么服务</p>
<p>docker-compose-yml 这个文件怎么写</p>
<p>Run <strong><code>docker compose up</code></strong> and the <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/cli-command/">Docker compose command</a> starts and runs your entire app. You can alternatively run <code>docker-compose up</code> using the docker-compose binary.</p>
<p>启动项目。</p>
<p>作用：批量容器编排</p>
<p>compose是docker官方的开源项目。需要安装</p>
<p>dockerfile 让程序在任何地方运行。 Web服务、Redis、MySQL、Nginx……多个容器</p>
<p>compose</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.9&quot;  # optional since v1.27.0</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;5000:5000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - .:/code</span><br><span class="line">      - logvolume01:/var/log</span><br><span class="line">    links:</span><br><span class="line">      - redis</span><br><span class="line">  redis:</span><br><span class="line">    image: redis</span><br><span class="line">volumes:</span><br><span class="line">  logvolume01: &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>compose重要概念：</p>
<p>服务services:容器，应用（Web服务、Redis、MySQL、Nginx）</p>
<p>项目project：一组相关的容器。</p>
<h3 id="安装compose"><a class="header-anchor" href="#安装compose">¶</a>安装compose</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">官方文档下载方式（非常慢）</span></span><br><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.28.5/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">百度上找的国内镜像地址下载非常快</span></span><br><span class="line">[root@haimian ~]# curl -L &quot;https://get.daocloud.io/docker/compose/releases/download/1.24.0/docker-compose-$(uname -s)-$(uname -m)&quot; &gt; /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_">  % </span><span class="language-bash">Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span></span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100   423  100   423    0     0    214      0  0:00:01  0:00:01 --:--:--   214</span><br><span class="line">100 15.4M  100 15.4M    0     0  5896k      0  0:00:02  0:00:02 --:--:-- 36.5M</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看下载目录下是否有文件</span></span><br><span class="line">[root@haimian ~]# cd /usr/local/bin</span><br><span class="line">[root@haimian bin]# ls</span><br><span class="line">chardetect  cloud-init      docker-compose  easy_install-3.6  jsondiff   jsonpointer</span><br><span class="line">cloud-id    cloud-init-per  easy_install    easy_install-3.8  jsonpatch  jsonschema</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">授权</span></span><br><span class="line">[root@haimian bin]# sudo chmod +x /usr/local/bin/docker-compose</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看版本信息，查得到代表安装成功</span></span><br><span class="line">[root@haimian bin]# docker-compose version</span><br><span class="line">docker-compose version 1.27.4, build 40524192</span><br><span class="line">docker-py version: 4.3.1</span><br><span class="line">CPython version: 3.7.7</span><br><span class="line">OpenSSL version: OpenSSL 1.1.0l  10 Sep 2019</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="体验compose"><a class="header-anchor" href="#体验compose">¶</a>体验compose</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文档地址https://docs.docker.com/compose/gettingstarted/</span></span><br><span class="line">[root@haimian home]# mkdir composetest</span><br><span class="line">[root@haimian home]# cd composetest</span><br><span class="line">[root@haimian composetest]# ll</span><br><span class="line">total 0</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">接着按照官方文档创建 app.py，requirements.txtDockerfile，docker-compose.yml</span></span><br><span class="line">[root@haimian composetest]# ll</span><br><span class="line">total 16</span><br><span class="line">-rw-r--r-- 1 root root 513 Mar 17 15:35 app.py</span><br><span class="line">-rw-r--r-- 1 root root 111 Mar 17 15:41 docker-compose.yml</span><br><span class="line">-rw-r--r-- 1 root root 254 Mar 17 15:38 dockerfile</span><br><span class="line">-rw-r--r-- 1 root root  12 Mar 17 15:36 requirements.txt</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">思路整理</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（1）创建一个应用、（2）dockerfile应用打包为镜像</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（3）docker-compose.yam文件（定义整个服务需要的环境。web\redis）--完整的上线服务</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">（4）启动compose项目（docker-compose up）</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">流程</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、创建网络</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、执行docker-compose yaml</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、启动服务 docker-compose yaml</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">creating composetest_web_1 ...<span class="keyword">done</span></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">creating composetest_redis_1 ...<span class="keyword">done</span></span> </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行的时候会报这个错composetest_web_1 exited with code 1</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们按照代码的提示退出运行执行</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再执行docker-compose build</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">执行完了之后再 docker-compose up</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再查看容器已经起来了</span></span><br><span class="line">[root@haimian composetest]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE             COMMAND                  CREATED          STATUS          PORTS                    NAMES</span><br><span class="line">fe5c2ec7b0c3   composetest_web   &quot;flask run&quot;              58 seconds ago   Up 57 seconds   0.0.0.0:5000-&gt;5000/tcp   composetest_web_1</span><br><span class="line">827fd362ac1c   redis:alpine      &quot;docker-entrypoint.s…&quot;   11 minutes ago   Up 57 seconds   6379/tcp                 composetest_redis_1</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">web页面也可以正常访问</span></span><br><span class="line">[root@haimian composetest]# curl localhost:5000</span><br><span class="line">Hello World! I have been seen 1 times.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">依赖的镜像也已经自动下载</span></span><br><span class="line">[root@haimian composetest]# docker images</span><br><span class="line">REPOSITORY        TAG                IMAGE ID       CREATED          SIZE</span><br><span class="line">composetest_web   latest             ac6045d1daa4   14 minutes ago   196MB</span><br><span class="line">&lt;none&gt;            &lt;none&gt;             2a51e65a5d98   24 minutes ago   196MB</span><br><span class="line">paidaxing         latest             94a761fada63   6 hours ago      660MB</span><br><span class="line">redis             alpine             933c79ea2511   2 months ago     31.6MB</span><br><span class="line">tomcat            latest             040bdb29ab37   2 months ago     649MB</span><br><span class="line">python            3.7-alpine         72e4ef8abf8e   2 months ago     41.1MB</span><br><span class="line">redis             5.0.9-alpine3.11   3661c84ee9d0   10 months ago    29.8MB</span><br><span class="line">java              8                  d23bdf5b1b1b   4 years ago      643MB</span><br><span class="line"></span><br><span class="line">[root@haimian composetest]# docker service ls</span><br><span class="line">Error response from daemon: This node is not a swarm manager. Use &quot;docker swarm init&quot; or &quot;docker swarm join&quot; to connect this node to swarm and try again.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">默认的服务名，文件名_服务名_num</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">多个服务器。集群 A B _num副本数量</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务Redis&gt;=4个副本</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群状态。服务都不可能只有一个实例运行。弹性 高并发</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kubecl service负载均衡</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">网络规则</span></span><br><span class="line">[root@haimian composetest]# docker network ls</span><br><span class="line">NETWORK ID     NAME                  DRIVER    SCOPE</span><br><span class="line">fc147941dd4b   bridge                bridge    local</span><br><span class="line">ec3648819180   composetest_default   bridge    local#compose网络</span><br><span class="line">a6ac3789c498   host                  host      local</span><br><span class="line">5d36c3180b51   mynet                 bridge    local</span><br><span class="line">4d1ab894aec6   none                  null      local</span><br><span class="line">ec86a0358f33   redis                 bridge    local</span><br><span class="line">63d3626d7dc7   somenetwork           bridge    local</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">composetest_redis_1和composetest_web_1在同一个网段</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以通过域名直接访问。</span></span><br><span class="line">[root@haimian composetest]# docker network inspect composetest_default</span><br><span class="line"></span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;827fd362ac1c2549581430d4641bc1928e60ede82b0af3fac7a703b229d32340&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;composetest_redis_1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;377227b4d71ba26e4e5b88dda1986b86c045b0cb7cec159f5c4ff1a05e31f5da&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:13:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.19.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;fe5c2ec7b0c33953eba56e863dfdc2fab1f8bf40358a7b504cdc2b0989e443c2&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;composetest_web_1&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;3384abbc243f87da99e04824e59521ce0661d24c7fdd16b2f6c1306487a8e410&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:ac:13:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;172.19.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">停止docker-compose down Ctrl+c</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">要在项目目录下</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-compose。通过docker-compose编写yaml配置文件。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以通过compose一键启动所有服务、停止。</span></span><br></pre></td></tr></table></figure>
<p>浏览器上面访问也是可以的，这就是官方测试的一个web应用</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210317164008230.png" alt="image-20210317164008230"></p>
<h3 id="compose-yaml-编写规则"><a class="header-anchor" href="#compose-yaml-编写规则">¶</a>compose yaml 编写规则</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker-composeyaml 核心</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文档地址：https://docs.docker.com/compose/compose-file/</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3层</span></span><br><span class="line"></span><br><span class="line">version： &quot; &quot; #版本</span><br><span class="line">service：     #服务</span><br><span class="line">服务1：web</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务配置</span></span><br><span class="line">images</span><br><span class="line">build</span><br><span class="line">network</span><br><span class="line">……</span><br><span class="line">服务2：Redis</span><br><span class="line">……</span><br><span class="line">服务3：Redis</span><br><span class="line">……</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">其它配置 网络/卷 全局规则</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">volumes、network、configs</span></span><br></pre></td></tr></table></figure>
<h3 id="开源项目（wordpress博客）"><a class="header-anchor" href="#开源项目（wordpress博客）">¶</a>开源项目（wordpress博客）</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker官方文档地址：https://docs.docker.com/compose/wordpress/</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建一个新的文件夹</span></span><br><span class="line">[root@haimian home]# cd my_wordpress</span><br><span class="line">[root@haimian my_wordpress]# ll</span><br><span class="line">total 0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">编写docker-compose.yml</span></span><br><span class="line">version: &quot;3.9&quot; #版本</span><br><span class="line">    </span><br><span class="line">services:</span><br><span class="line">  db:</span><br><span class="line">    image: mysql:5.7#数据库应用</span><br><span class="line">    volumes:</span><br><span class="line">      - db_data:/var/lib/mysql</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      MYSQL_ROOT_PASSWORD: somewordpress</span><br><span class="line">      MYSQL_DATABASE: wordpress</span><br><span class="line">      MYSQL_USER: wordpress</span><br><span class="line">      MYSQL_PASSWORD: wordpress</span><br><span class="line">    </span><br><span class="line">  wordpress:</span><br><span class="line">    depends_on:#依赖</span><br><span class="line">      - db</span><br><span class="line">    image: wordpress:latest#应用2</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8000:80&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    environment:</span><br><span class="line">      WORDPRESS_DB_HOST: db:3306</span><br><span class="line">      WORDPRESS_DB_USER: wordpress</span><br><span class="line">      WORDPRESS_DB_PASSWORD: wordpress</span><br><span class="line">      WORDPRESS_DB_NAME: wordpress</span><br><span class="line">volumes:</span><br><span class="line">  db_data: &#123;&#125;</span><br><span class="line">  </span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">启动项目docker-compose up</span></span><br><span class="line"><span class="meta prompt_">  #</span><span class="language-bash">后台启动docker-compose up -d</span></span><br><span class="line">  [root@haimian my_wordpress]# docker compose up</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">文件准备齐全（直接一键启动项目）</span></span><br></pre></td></tr></table></figure>
<p>访问博客站点进行搭建，搭建成功我们访问前台，完全没有问题</p>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210318095408543.png" alt="image-20210318095408543"></p>
<h3 id="实战：计数器"><a class="header-anchor" href="#实战：计数器">¶</a>实战：计数器</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">1、编写项目微服务</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">2、dockerfile构建镜像</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">3、docker-compose.yaml编排项目</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">4、在服务器上启动</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">上传文件</span></span><br><span class="line">[root@haimian haimian]# ll</span><br><span class="line">total 25812</span><br><span class="line">-rw-r--r-- 1 root root 26421170 Mar 18 10:51 demo-0.0.1-SNAPSHOT.jar</span><br><span class="line">-rw-r--r-- 1 root root      171 Mar 18 10:52 docker-compose.yml</span><br><span class="line">-rw-r--r-- 1 root root      122 Mar 18 10:52 Dockerfile</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">compose up 一键启动</span></span><br><span class="line">[root@haimian haimian]# docker-compose up --build</span><br><span class="line"></span><br><span class="line">[root@haimian my_wordpress]# curl localhost:7788/hello</span><br><span class="line">hello,paidadxing,thonk you with me happy1[root@haimian my_wordpress]# curl localhost:7788/hello</span><br><span class="line">hello,paidadxing,thonk you with me happy2[root@haimian my_wordpress]#</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">远程访问也没有问题。</span></span><br><span class="line">总结：</span><br><span class="line">工程、服务、容器</span><br><span class="line">项目：compose：三层</span><br><span class="line"></span><br><span class="line">工程Poriect</span><br><span class="line">服务 服务</span><br><span class="line">容器运行实例！ docker k8s 容器</span><br></pre></td></tr></table></figure>
<h2 id="Docker-Swarm"><a class="header-anchor" href="#Docker-Swarm">¶</a>Docker Swarm</h2>
<h4 id="集群"><a class="header-anchor" href="#集群">¶</a>集群</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">阿里云租4台服务器，一核两G即可，费用在一块钱左右一小时四台机子。</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319095333554.png" alt="image-20210319095333554"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">为四台服务安装docker</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装完毕之后先看一下docker官方文档swarm一些原理</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>地址：<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/">https://docs.docker.com/engine/swarm/how-swarm-mode-works/nodes/</a></p>
<p>Docker Engine 1.12引入了swarm模式，使您可以创建一个或多个Docker Engine集群，称为swarm。一个群集由一个或多个节点组成：以群集模式运行Docker Engine 1.12或更高版本的物理机或虚拟机。</p>
<p><img src="https://docs.docker.com/engine/swarm/images/swarm-diagram.png" alt="Swarm mode cluster"></p>
<p>管理节点和工作节点，操作都在manager管理节点上。</p>
<p>管理节点最少需要三台。</p>
<h4 id="搭建集群"><a class="header-anchor" href="#搭建集群">¶</a>搭建集群</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker swarm --help</span><br><span class="line"></span><br><span class="line">Usage:  docker swarm COMMAND</span><br><span class="line"></span><br><span class="line">Manage Swarm</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  ca          Display and rotate the root CA</span><br><span class="line">  init        Initialize a swarm</span><br><span class="line">  join        Join a swarm as a node and/or manager</span><br><span class="line">  join-token  Manage join tokens</span><br><span class="line">  leave       Leave the swarm</span><br><span class="line">  unlock      Unlock swarm</span><br><span class="line">  unlock-key  Manage the unlock key</span><br><span class="line">  update      Update the swarm</span><br><span class="line"></span><br><span class="line">Run &#x27;docker swarm COMMAND --help&#x27; for more information on a command.</span><br><span class="line"></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker swarm init --help</span><br><span class="line"></span><br><span class="line">Usage:  docker swarm init [OPTIONS]</span><br><span class="line"></span><br><span class="line">Initialize a swarm</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --advertise-addr string                  Advertised address (format: &lt;ip|interface&gt;[:port])</span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">创建集群 docker swarm init 初始化一个节点</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker swarm <span class="built_in">join</span> 加入一个节点</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker swarm join-token manager 获取令牌</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker swarm join-token worker</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker swarm leave --force 管理节点，解散集群</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker swarm init --advertise-addr 172.28.239.103</span><br><span class="line">Swarm initialized: current node (681hwoonzdmw28thceumiuieq) is now a manager.</span><br><span class="line"></span><br><span class="line">To add a worker to this swarm, run the following command:</span><br><span class="line"></span><br><span class="line">    docker swarm join --token SWMTKN-1- 1jr3qs75lpu6zcprc2z2ka6ye485dpqxucb19w6qcqgia9uv7j-1neo402s3yfhqzswzqw5shpji 172.28.239.103:2377</span><br><span class="line"></span><br><span class="line">To add a manager to this swarm, run &#x27;c&#x27; and follow the instructions.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务器docker-2加入集群成为worker节点</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9uplZ ~]# docker swarm join --token SWMTKN-1-1jr3qs75lpu6zcprc2z2ka6ye485dpqxucb19w6qcqgia9uv7j-1neo402s3yfhqzswzqw5shpji 172.28.239.103:2377</span><br><span class="line">This node joined a swarm as a worker.</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看集群节点信息</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">681hwoonzdmw28thceumiuieq *   iZm5e7tq4538l94vqz9upjZ   Ready     Active         Leader           20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">让另外两个主机加入集群节点成为双主双从</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">dn4dj1o6g8fn0bx9md2qmhim0     iZm5e7tq4538l94vqz9upiZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">681hwoonzdmw28thceumiuieq *   iZm5e7tq4538l94vqz9upjZ   Ready     Active         Leader           20.10.5</span><br><span class="line">xhkwosy7afij6sphlybcukq8r     iZm5e7tq4538l94vqz9upkZ   Ready     Active                          20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     </span><br></pre></td></tr></table></figure>
<h4 id="raft协议"><a class="header-anchor" href="#raft协议">¶</a>raft协议</h4>
<p>思考：双主双从已经搭设完毕，假设一个节点挂了。其它节点是否可用。</p>
<p>raft协议：保证 大多数节点存活才可用。集群至少要大于三台。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">挂掉一个集群管理节点</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# systemctl stop docker</span><br><span class="line">Warning: Stopping docker.service, but it can still be activated by:</span><br><span class="line">  docker.socket</span><br><span class="line"><span class="meta prompt_"> #</span><span class="language-bash">查看另一个集群管理节点</span> </span><br><span class="line"> [root@iZm5e7tq4538l94vqz9upiZ ~]# docker node ls</span><br><span class="line">Error response from daemon: rpc error: code = DeadlineExceeded desc = context deadline exceeded</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">因为是双主，其中一个主机停了，另一个就也使用不了。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">重新挂起节点，发现可以用了，但是Leader已经不是我们挂掉的那个节点了，变成了另外一个管理节点。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">dn4dj1o6g8fn0bx9md2qmhim0     iZm5e7tq4538l94vqz9upiZ   Ready     Active         Leader           20.10.5</span><br><span class="line">681hwoonzdmw28thceumiuieq *   iZm5e7tq4538l94vqz9upjZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">xhkwosy7afij6sphlybcukq8r     iZm5e7tq4538l94vqz9upkZ   Ready     Active                          20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">让一个工作节点离开集群 docker swarm leave</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">dn4dj1o6g8fn0bx9md2qmhim0     iZm5e7tq4538l94vqz9upiZ   Ready     Active         Leader           20.10.5</span><br><span class="line">681hwoonzdmw28thceumiuieq *   iZm5e7tq4538l94vqz9upjZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">xhkwosy7afij6sphlybcukq8r     iZm5e7tq4538l94vqz9upkZ   Down      Active                          20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">恢复离开的节点，设置其为管理节点，模式变成三主一从。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upkZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">dn4dj1o6g8fn0bx9md2qmhim0     iZm5e7tq4538l94vqz9upiZ   Ready     Active         Leader           20.10.5</span><br><span class="line">681hwoonzdmw28thceumiuieq     iZm5e7tq4538l94vqz9upjZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">cqubo1rk3hzma2ynkcf8vj7u9 *   iZm5e7tq4538l94vqz9upkZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">xhkwosy7afij6sphlybcukq8r     iZm5e7tq4538l94vqz9upkZ   Down      Active                          20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">再次down掉一个管理节点，这次我们发现其它两个管理节点是可用的，这符合了我们raft协议大多数可用</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upkZ ~]# docker node ls</span><br><span class="line">ID                            HOSTNAME                  STATUS    AVAILABILITY   MANAGER STATUS   ENGINE VERSION</span><br><span class="line">dn4dj1o6g8fn0bx9md2qmhim0     iZm5e7tq4538l94vqz9upiZ   Ready     Active         Leader           20.10.5</span><br><span class="line">681hwoonzdmw28thceumiuieq     iZm5e7tq4538l94vqz9upjZ   Ready     Active         Unreachable      20.10.5</span><br><span class="line">cqubo1rk3hzma2ynkcf8vj7u9 *   iZm5e7tq4538l94vqz9upkZ   Ready     Active         Reachable        20.10.5</span><br><span class="line">xhkwosy7afij6sphlybcukq8r     iZm5e7tq4538l94vqz9upkZ   Down      Active                          20.10.5</span><br><span class="line">vbhakfutdb5jkom5j1n5zm5qd     iZm5e7tq4538l94vqz9uplZ   Ready     Active                          20.10.5</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们再down掉一个管理节点，发现剩下的管理节点是不可用的。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upiZ ~]# docker node ls</span><br><span class="line">Error response from daemon: rpc error: code = Unknown desc = The swarm does not have a leader. It&#x27;s possible that too few managers are online. Make sure more than half of the managers are online.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">这就能很好地理解上面那个官方网站的图，最少需要三个主节点，保证存活大于1台的管理节点存活</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">raft协议：保证大多数存活，才可使用，达到我们高可用的要求。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="Docker-swarm-集群弹性创建服务"><a class="header-anchor" href="#Docker-swarm-集群弹性创建服务">¶</a>Docker swarm 集群弹性创建服务</h4>
<p>弹性，扩缩容，集群</p>
<p>告别docker run</p>
<p>docker-compose ，启动一个项目 单机</p>
<p>集群：swarm service</p>
<p>容器&gt;服务</p>
<p>容器&gt;服务&gt;副本</p>
<p>Redis服务&gt;=10个副本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">灰度发布，金丝雀</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service --help</span><br><span class="line"></span><br><span class="line">Usage:  docker service COMMAND</span><br><span class="line"></span><br><span class="line">Manage services</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a new service</span><br><span class="line">  inspect     Display detailed information on one or more services</span><br><span class="line">  logs        Fetch the logs of a service or task</span><br><span class="line">  ls          List services</span><br><span class="line">  ps          List the tasks of one or more services</span><br><span class="line">  rm          Remove one or more services</span><br><span class="line">  rollback    Revert changes to a service&#x27;s configuration</span><br><span class="line">  scale       Scale one or multiple replicated services</span><br><span class="line">  update      Update a service</span><br><span class="line"></span><br><span class="line">Run &#x27;docker service COMMAND --help&#x27; for more information on a command.</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker run 容器启动！不具备扩缩容。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker service 服务！ 具有扩缩容器，滚动更新。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service create -p 7788:80 --name my-nginx nginx</span><br><span class="line">qktvdpw9j2i0543cvscc8hit9</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged</span><br><span class="line"></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service ps my-nginx</span><br><span class="line">ID             NAME         IMAGE          NODE                      DESIRED STATE   CURRENT STATE           ERROR     PORTS</span><br><span class="line">ij9np5kqyliq   my-nginx.1   nginx:latest   iZm5e7tq4538l94vqz9upjZ   Running         Running 2 minutes ago </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看服务 replicas</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service ls</span><br><span class="line">ID             NAME       MODE         REPLICAS   IMAGE          PORTS</span><br><span class="line">qktvdpw9j2i0   my-nginx   replicated   1/1        nginx:latest   *:7788-&gt;80/tcp</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">为服务增加副本</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service update --replicas 3 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 3 out of 3 tasks </span><br><span class="line">1/3: running   [==================================================&gt;] </span><br><span class="line">2/3: running   [==================================================&gt;] </span><br><span class="line">3/3: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我们可以通过docker ps 查看到我们所创建的容器副本被随机分配到其它集群节点上。</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">查看docker2节点，这个节点上没有运行容器副本，但是一样可以远程访问服务。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9uplZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群就是一个整体</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">动态扩缩容</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">服务，集群中任意节点都可以访问，服务可以有多个副本动态扩缩容实现高可用</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">我现在不想要那么多副本，只想要一个，也是可以的，我们直接更新服务为一个副本就行了</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service update --replicas 1 my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">overall progress: 1 out of 1 tasks </span><br><span class="line">1/1: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS     NAMES</span><br><span class="line">9a33d46f1cf4   nginx:latest   &quot;/docker-entrypoint.…&quot;   16 minutes ago   Up 16 minutes   80/tcp    my-nginx.1.ij9np5kqyliqhejn1rrblyb95</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">副本拓展docker service scale my-nginx=5</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">和之前那个是一样的，不过这个更方便。</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service scale my-nginx=5</span><br><span class="line">my-nginx scaled to 5</span><br><span class="line">overall progress: 5 out of 5 tasks </span><br><span class="line">1/5: running   [==================================================&gt;] </span><br><span class="line">2/5: running   [==================================================&gt;] </span><br><span class="line">3/5: running   [==================================================&gt;] </span><br><span class="line">4/5: running   [==================================================&gt;] </span><br><span class="line">5/5: running   [==================================================&gt;] </span><br><span class="line">verify: Service converged </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">移除服务</span></span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service rm my-nginx</span><br><span class="line">my-nginx</span><br><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker service ls</span><br><span class="line">ID        NAME      MODE      REPLICAS   IMAGE     PORTS</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">docker swarm其实不难</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">只要会搭建集群，会启动服务，动态管理容器就可以了。</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><img src="C:%5CUsers%5CAdministrator%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319121702026.png" alt="image-20210319121702026"></p>
<h4 id="概念总结"><a class="header-anchor" href="#概念总结">¶</a>概念总结</h4>
<p><strong>swarm</strong></p>
<p>集群的管理和编排，docker可以初始化一个swarm集群，其它节点可以加入。</p>
<p><strong>node</strong></p>
<p>就是一个docker节点，多个节点组成了一个网络集群。</p>
<p><strong>service</strong></p>
<p>任务，可以在管理节点或工作节点来运行。</p>
<p><strong>task</strong></p>
<p>容器的命令</p>
<p><strong>拓展</strong></p>
<p>网络模式：</p>
<p>swarm</p>
<p>overlay</p>
<p>ingress：特殊overlay网络！负载均衡功能！IPVS VIP！</p>
<p>虽然docker在四台机子上，实际上是一个网络。</p>
<h4 id="Docker-Stack"><a class="header-anchor" href="#Docker-Stack">¶</a>Docker Stack</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">单机</span></span><br><span class="line">docker-compose up -d wordpress.yaml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">集群</span></span><br><span class="line">docker stack deploy wordpress.yaml</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">案例</span></span><br><span class="line">version: &quot;3&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  nginx:</span><br><span class="line">    image: nginx:alpine</span><br><span class="line">    ports:</span><br><span class="line">      - 80:80</span><br><span class="line">    deploy:</span><br><span class="line">      mode: replicated</span><br><span class="line">      replicas: 4</span><br><span class="line"></span><br><span class="line">  visualizer:</span><br><span class="line">    image: dockersamples/visualizer</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9001:8080&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    deploy:#集群部署</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br><span class="line"></span><br><span class="line">  portainer:</span><br><span class="line">    image: portainer/portainer</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;9000:9000&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - &quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span><br><span class="line">    deploy:</span><br><span class="line">      replicas: 1</span><br><span class="line">      placement:</span><br><span class="line">        constraints: [node.role == manager]</span><br></pre></td></tr></table></figure>
<h4 id="Docker-Secret"><a class="header-anchor" href="#Docker-Secret">¶</a>Docker Secret</h4>
<p>安全！配置密码。证书。</p>
<p>k8s里面再深入了解。</p>
<h4 id="Docker-Config"><a class="header-anchor" href="#Docker-Config">¶</a>Docker Config</h4>
<p>配置</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@iZm5e7tq4538l94vqz9upjZ ~]# docker config --help</span><br><span class="line"></span><br><span class="line">Usage:  docker config COMMAND</span><br><span class="line"></span><br><span class="line">Manage Docker configs</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">  create      Create a config from a file or STDIN</span><br><span class="line">  inspect     Display detailed information on one or more configs</span><br><span class="line">  ls          List configs</span><br><span class="line">  rm          Remove one or more configs</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="结语："><a class="header-anchor" href="#结语：">¶</a>结语：</h4>
<p>–help</p>
<p>k8s</p>
<p>go语言</p>
<p>云原生</p>
<h2 id="CI-CD"><a class="header-anchor" href="#CI-CD">¶</a>CI\CD</h2>
<p>devops是一种思想方法论，它涵盖开发、测试、运维的整个过程。</p>
<p>devops强调软件开发人员与软件测试、软件运维，质量保证（QA）</p>
<p>部门之间有效的沟通与协作。</p>
<p>强调通过自动化的方法管理软件变更，软件继承。</p>
<p>使软件从构建到测试，发布更加快捷、可靠，最终按时交付。</p>
<p><img src="https://ss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=1362993610,936639805&amp;fm=26&amp;gp=0.jpg" alt="img"></p>
<p>最初是瀑布模型，后来是敏捷开发，现在是DevOps，这是现代开发人员构建出色的产品的技术路线。随着DevOps的兴起，出现了持续集成（Continuous Integration）、持续交付（Continuous Delivery） 、持续部署（Continuous Deployment） 的新方法。传统的软件开发和交付方法正在迅速变得过时。从历史上看，在敏捷时代，大多数公司会每月，每季度，每两年甚至每年发布部署/发布软件。然而，现在，在DevOps时代，每周，每天，甚至每天多次是常态。当SaaS正在占领世界时，尤其如此，您可以轻松地动态更新应用程序，而无需强迫客户下载新组件。很多时候，他们甚至都不会意识到正在发生变化。开发团队通过软件交付流水线（Pipeline）实现自动化，以缩短交付周期，大多数团队都有自动化流程来检查代码并部署到新环境。今天，我们将介绍什么是CI / CD / CD，以及现代软件公司如何使用工具将部署代码的流程自动化。<br>
持续集成的重点是将各个开发人员的工作集合到一个代码仓库中。通常，每天都要进行几次，主要目的是尽早发现集成错误，使团队更加紧密结合，更好地协作。<br>
持续交付的目的是最小化部署或释放过程中固有的摩擦。它的实现通常能够将构建部署的每个步骤自动化，以便任何时刻能够安全地完成代码发布（理想情况下）。<br>
持续部署是一种更高程度的自动化，无论何时对代码进行重大更改，都会自动进行构建/部署。<br>
这些阶段中的每一个都是交付管道的一部分 。在Humble和Farley的书《持续交付：可靠的软件版本中，通过构建，测试和部署自动化》，解释“对软件的每次更改，都会在发布过程中经历一个复杂的过程。该过程涉及构建软件，然后通过多个测试和部署阶段进行这些构建。反过来，这需要许多人之间的合作，也许需要几个团队之间的合作。部署管道对此过程进行建模，并且它在持续集成和发布管理工具中的实现，使您能够在从版本控制转移到各种测试和部署，以向用户发布时查看和控制每个更改的进度。”</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://www.yxyl6125.eu.org">YxYL</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://www.yxyl6125.eu.org/2022/09/17/docker/">https://www.yxyl6125.eu.org/2022/09/17/docker/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yxyl6125.eu.org" target="_blank">YxYL</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/docker/">docker</a></div><div class="post_share"><div class="social-share" data-image="https://www.dmoe.cc/random.php" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2022/09/17/JUC/"><img class="next-cover" src="https://www.dmoe.cc/random.php" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JUC</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">YxYL</div><div class="author-info__description">һ���������ҵ�ʹ</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">2</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">2</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/YxYL6125"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is Why We</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">了解阿里云</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E6%B3%A8%E5%86%8C"><span class="toc-number">1.1.</span> <span class="toc-text">阿里云注册</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">docker学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E6%A6%82%E8%BF%B0"><span class="toc-number">2.1.</span> <span class="toc-text">docker概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BC%9A%E5%87%BA%E7%8E%B0"><span class="toc-number">2.1.1.</span> <span class="toc-text">docker为什么会出现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%9A%84%E5%8E%86%E5%8F%B2"><span class="toc-number">2.1.2.</span> <span class="toc-text">docker的历史</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%8A%E8%81%8Adocker"><span class="toc-number">2.1.2.1.</span> <span class="toc-text">聊聊docker</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker-%E8%83%BD%E5%B9%B2%E5%98%9B"><span class="toc-number">2.1.3.</span> <span class="toc-text">docker 能干嘛</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%AE%89%E8%A3%85"><span class="toc-number">2.2.</span> <span class="toc-text">docker安装</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%BB%84%E6%88%90"><span class="toc-number">2.2.1.</span> <span class="toc-text">docker的基本组成</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85docker"><span class="toc-number">2.2.2.</span> <span class="toc-text">安装docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="toc-number">2.2.3.</span> <span class="toc-text">阿里云镜像加速</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E9%A1%BEHelloWorld%E6%B5%81%E7%A8%8B"><span class="toc-number">2.2.4.</span> <span class="toc-text">回顾HelloWorld流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#docker-run-%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">2.2.4.1.</span> <span class="toc-text">docker run 流程图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">2.2.5.</span> <span class="toc-text">底层原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E4%B8%BA%E4%BB%80%E4%B9%88%E6%AF%94VM%E5%BF%AB"><span class="toc-number">2.2.6.</span> <span class="toc-text">docker为什么比VM快</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.</span> <span class="toc-text">docker命令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.1.</span> <span class="toc-text">基本命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.2.</span> <span class="toc-text">镜像命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%B9%E5%99%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.3.</span> <span class="toc-text">容器命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E5%85%B6%E5%AE%83%E5%91%BD%E4%BB%A4"><span class="toc-number">2.3.4.</span> <span class="toc-text">常用的其它命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">2.3.5.</span> <span class="toc-text">小结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E5%90%88%E9%9B%86"><span class="toc-number">2.3.5.1.</span> <span class="toc-text">常用代码合集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E7%BB%83%E4%B9%A0"><span class="toc-number">2.3.6.</span> <span class="toc-text">作业练习</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AB%AF%E5%8F%A3%E6%98%A0%E5%B0%84"><span class="toc-number">2.3.6.1.</span> <span class="toc-text">端口映射</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A2"><span class="toc-number">2.3.6.2.</span> <span class="toc-text">作业2</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A3"><span class="toc-number">2.3.6.3.</span> <span class="toc-text">作业3</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-number">2.3.7.</span> <span class="toc-text">可视化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">2.3.8.</span> <span class="toc-text">¶</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker%E9%95%9C%E5%83%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">2.4.</span> <span class="toc-text">docker镜像讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">2.4.1.</span> <span class="toc-text">镜像是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E9%95%9C%E5%83%8F%E5%8A%A0%E8%BD%BD%E5%8E%9F%E7%90%86"><span class="toc-number">2.4.2.</span> <span class="toc-text">Docker镜像加载原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit%E9%95%9C%E5%83%8F"><span class="toc-number">2.4.3.</span> <span class="toc-text">commit镜像</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%B9%E5%99%A8%E5%8D%B7"><span class="toc-number">2.5.</span> <span class="toc-text">数据容器卷</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">2.5.0.1.</span> <span class="toc-text">什么是容器数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="toc-number">2.5.0.2.</span> <span class="toc-text">使用数据卷</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E5%AE%89%E8%A3%85MySQL"><span class="toc-number">2.5.0.3.</span> <span class="toc-text">实战：安装MySQL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B7%E5%90%8D%E5%92%8C%E5%8C%BF%E5%90%8D%E6%8C%82%E8%BD%BD"><span class="toc-number">2.5.0.4.</span> <span class="toc-text">具名和匿名挂载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9D%E8%AF%86dockerfile"><span class="toc-number">2.5.0.5.</span> <span class="toc-text">初识dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8D%B7%E5%AE%B9%E5%99%A8"><span class="toc-number">2.5.0.6.</span> <span class="toc-text">数据卷容器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dockerfile"><span class="toc-number">2.5.0.7.</span> <span class="toc-text">dockerfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DockerFile%E6%9E%84%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">2.5.0.8.</span> <span class="toc-text">DockerFile构建过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#dockerfile%E7%9A%84%E6%8C%87%E4%BB%A4"><span class="toc-number">2.5.0.9.</span> <span class="toc-text">dockerfile的指令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%E6%B5%8B%E8%AF%95"><span class="toc-number">2.5.0.10.</span> <span class="toc-text">实战测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98Tomcat%E9%95%9C%E5%83%8F"><span class="toc-number">2.5.0.11.</span> <span class="toc-text">实战Tomcat镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%E3%80%81%E5%87%86%E5%A4%87%E9%95%9C%E5%83%8F%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.0.11.1.</span> <span class="toc-text">1、准备镜像文件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%E3%80%81%E7%BC%96%E5%86%99dockerfile%E6%96%87%E4%BB%B6"><span class="toc-number">2.5.0.11.2.</span> <span class="toc-text">2、编写dockerfile文件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E9%95%9C%E5%83%8F"><span class="toc-number">2.5.1.</span> <span class="toc-text">发布自己的镜像</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E3%80%81%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95dockerhub"><span class="toc-number">2.5.1.1.</span> <span class="toc-text">1、注册登录dockerhub</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%E3%80%81%E9%98%BF%E9%87%8C%E4%BA%91%E9%95%9C%E5%83%8F%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.5.1.2.</span> <span class="toc-text">2、阿里云镜像服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93-v2"><span class="toc-number">2.5.2.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#docker%E7%BD%91%E7%BB%9C"><span class="toc-number">2.5.3.</span> <span class="toc-text">docker网络</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%90%86%E8%A7%A3Docker-0"><span class="toc-number">2.5.3.1.</span> <span class="toc-text">理解Docker 0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E2%80%93link"><span class="toc-number">2.5.3.2.</span> <span class="toc-text">–link</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%BD%91%E7%BB%9C"><span class="toc-number">2.5.3.3.</span> <span class="toc-text">自定义网络</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E9%83%A8%E7%BD%B2Redis%E9%9B%86%E7%BE%A4"><span class="toc-number">2.5.3.4.</span> <span class="toc-text">实战：部署Redis集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#springboot%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%89%93%E5%8C%85docker%E9%95%9C%E5%83%8F"><span class="toc-number">2.5.3.5.</span> <span class="toc-text">springboot微服务打包docker镜像</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#-v2"><span class="toc-number">2.6.</span> <span class="toc-text">¶</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#docker-Compose"><span class="toc-number">2.7.</span> <span class="toc-text">docker Compose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">2.7.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85compose"><span class="toc-number">2.7.2.</span> <span class="toc-text">安装compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%93%E9%AA%8Ccompose"><span class="toc-number">2.7.3.</span> <span class="toc-text">体验compose</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#compose-yaml-%E7%BC%96%E5%86%99%E8%A7%84%E5%88%99"><span class="toc-number">2.7.4.</span> <span class="toc-text">compose yaml 编写规则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%EF%BC%88wordpress%E5%8D%9A%E5%AE%A2%EF%BC%89"><span class="toc-number">2.7.5.</span> <span class="toc-text">开源项目（wordpress博客）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E6%88%98%EF%BC%9A%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="toc-number">2.7.6.</span> <span class="toc-text">实战：计数器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Swarm"><span class="toc-number">2.8.</span> <span class="toc-text">Docker Swarm</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4"><span class="toc-number">2.8.0.1.</span> <span class="toc-text">集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4"><span class="toc-number">2.8.0.2.</span> <span class="toc-text">搭建集群</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#raft%E5%8D%8F%E8%AE%AE"><span class="toc-number">2.8.0.3.</span> <span class="toc-text">raft协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-swarm-%E9%9B%86%E7%BE%A4%E5%BC%B9%E6%80%A7%E5%88%9B%E5%BB%BA%E6%9C%8D%E5%8A%A1"><span class="toc-number">2.8.0.4.</span> <span class="toc-text">Docker swarm 集群弹性创建服务</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5%E6%80%BB%E7%BB%93"><span class="toc-number">2.8.0.5.</span> <span class="toc-text">概念总结</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Stack"><span class="toc-number">2.8.0.6.</span> <span class="toc-text">Docker Stack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Secret"><span class="toc-number">2.8.0.7.</span> <span class="toc-text">Docker Secret</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Docker-Config"><span class="toc-number">2.8.0.8.</span> <span class="toc-text">Docker Config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%93%E8%AF%AD%EF%BC%9A"><span class="toc-number">2.8.0.9.</span> <span class="toc-text">结语：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CI-CD"><span class="toc-number">2.9.</span> <span class="toc-text">CI\CD</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/09/17/docker/" title="docker"><img src="https://www.dmoe.cc/random.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="docker"/></a><div class="content"><a class="title" href="/2022/09/17/docker/" title="docker">docker</a><time datetime="2022-09-17T11:38:06.000Z" title="发表于 2022-09-17 19:38:06">2022-09-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/09/17/JUC/" title="JUC"><img src="https://www.dmoe.cc/random.php" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC"/></a><div class="content"><a class="title" href="/2022/09/17/JUC/" title="JUC">JUC</a><time datetime="2022-09-17T07:19:47.000Z" title="发表于 2022-09-17 15:19:47">2022-09-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By YxYL</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>